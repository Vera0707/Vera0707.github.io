<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="dns-prefetch" href="http://xieyuxuan.cc">
  <title>谢雨轩的博客 | Vera Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="前端技术分享,前端个人博客">
<meta property="og:type" content="website">
<meta property="og:title" content="谢雨轩的博客 | Vera Blog">
<meta property="og:url" content="http://xieyuxuan.cc/index.html">
<meta property="og:site_name" content="谢雨轩的博客 | Vera Blog">
<meta property="og:description" content="前端技术分享,前端个人博客">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="谢雨轩的博客 | Vera Blog">
<meta name="twitter:description" content="前端技术分享,前端个人博客">
  
    <link rel="alternative" href="/atom.xml" title="谢雨轩的博客 | Vera Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/images/favicon.png">
  
  <link rel="stylesheet" href="/main.css">
  



  <!-- Piwik -->
  <script type="text/javascript">
    var _paq = _paq || [];
    // tracker methods like "setCustomDimension" should be called before "trackPageView"
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
      var u="//piwik.mritd.me/";
      _paq.push(['setTrackerUrl', u+'piwik.php']);
      _paq.push(['setSiteId', '3']);
      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
      g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
    })();
  </script>
  <!-- End Piwik Code -->
</head>
</html>
<body>
  <div id="container">
    <div class="left-col">
      <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="/images/userimg.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">谢雨轩</a></h1>
		</hgroup>

		
		<p class="header-subtitle">Web前端技术宅升级打倒小怪兽</p>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
				<li><a href="/web">移动端直通车</a></li>
	        
				<li><a href="/css">炫酷CSS3</a></li>
	        
				<li><a href="/script">神奇JS</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
	        
    		
    			
    			<a class="js-smart-menu" data-idx="0" href="javascript:void(0)">所有文章</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="1" href="javascript:void(0)">标签</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="2" href="javascript:void(0)">我的项目</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="3" href="javascript:void(0)">关于我</a>
    			
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/Vera0707/huanhuashuixie" title="github">github</a>
		        
					<a class="mail" target="_blank" href="/lishuxia@gozap.com" title="mail">mail</a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"><i class="icon-list"></i></div>
  		<h1 class="header-author js-mobile-header hide">谢雨轩</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img src="/images/userimg.jpg" class="js-avatar">
				
			</div>
			<hgroup>
			  <h1 class="header-author">谢雨轩</h1>
			</hgroup>
			
			<p class="header-subtitle">Web前端技术宅升级打倒小怪兽</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/web">移动端直通车</a></li>
		        
					<li><a href="/css">炫酷CSS3</a></li>
		        
					<li><a href="/script">神奇JS</a></li>
		        
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/Vera0707/huanhuashuixie" title="github">github</a>
			        
						<a class="mail" target="_blank" href="/lishuxia@gozap.com" title="mail">mail</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <canvas id="body-wrap"> </canvas>
      <div class="body-wrap">
          
  
    <article id="post-jquerySourceCode1" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/09/02/jquerySourceCode1/">上古利器jQuery源码剖析(一)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><abbr style="display:block;margin-top: -50px;font-size: 12px;color:#999;text-align: center;border-bottom: 1px dotted #999;">上古利器 虽经沧海变革 宝剑尚锋</abbr></p>
<p>&emsp;随着数据驱动时代的到来，jQuery不可避免的跌下神坛，但应记得它曾何等辉煌<br>&emsp;我们学习jQuery，不是学习它的用法，而是学习它的架构，它的思想，来深刻理解JS<br>&emsp;优秀的jQuery并未落伍，像当下最火着的axios/fetch等都源自对ajax的吸纳，11年就出现的异步解决方法deferred，我们在ES6的Promise里看到了它的影子<br>&emsp;开拔</p>
<p>&emsp;$ 只是一个 jQuery的一个别名<br>&emsp;jQuery是一个构造函数,现在可以理解为就是一个最普通的构造函数<br>&emsp;但是我们在调用jQuery的时候,并没有使用new关键字呢.其实这里,jQuery帮我们做了一层语法糖的封装,即调用$()的时候,它自动帮我们创建了jQuery的实例对象<br>&emsp;即$() 就是new $()</p>
<p>&emsp;&emsp;<abbr style="display:block;color: brown;">* 起手式</abbr> </p>
<p>&emsp;首先我们创造一个自执行函数,传入this,通过root来接收<br>&emsp;在匿名函数里 我们创建一个叫jQuery的变量,jQuery变量拿到的是一个匿名函数的引用<br>&emsp;这个匿名函数,我们会把它当成构造函数<br>&emsp;因为我们是在全局环境下传入的this,所以这里的this指的就是window对象<br>&emsp;给环境变量root扩展一个叫做jQuery的属性,让它指向jQuery变量,同时再给root扩展一个叫做$的别名<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">root</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> jQuery = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;   <span class="comment">// 构造函数</span></span><br><span class="line">    </span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//root.jQuery = jQuery;</span></span><br><span class="line">    root.$ = root.jQuery = jQuery;</span><br><span class="line">&#125;)(<span class="keyword">this</span>);   <span class="comment">// 环境变量this 因为是全局环境 所以这里指的是window</span></span><br></pre></td></tr></table></figure></p>
<p>&emsp;这个时候我们输出$,得到的会是一个匿名函数,那源码是如何将其这个语法糖封装的?<br>&emsp;我们给jQuery的原型对象封装一个init的方法<br>&emsp;我们会把这个init对象当做一个构造函数<br>&emsp;我们如何把这个init方法当做一个构造函数呢<br>&emsp;在ES5中构造函数本身就是一个函数对象,也就是说,构造函数与我们普通创建的函数是完全一样的(在其他语言中绝非如此,JS中为了得以区分我们都会将构造函数首字母大写)<br>&emsp;一个普通函数,如果我们通过new去创建它的实例,那么我们就把它当做构造函数,并给他指明原型对象<br>&emsp;我们将init方法的原型对象指向为jQuery的原型对象<br>&emsp;init是jQuery.prototype的一个方法,init的原型对象又是jQuery.prototype,那么init拥有了jQuery.prototype的所有方法(包括它自己)<br>&emsp;我们将jQuery返回init的实例new jQuery.prototype.init()<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">root</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> jQuery = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;  <span class="comment">// 别忘了 jQuery我们也是当做构造函数的</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> jQuery.prototype.init();  <span class="comment">// 返回构造函数init的实例对象</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    jQuery.prototype = &#123;</span><br><span class="line">        init: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;       <span class="comment">// init是一个匿名对象,在这里我们将它当做一个构造函数</span></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="number">111</span>);   <span class="comment">// 测试代码</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    jQuery.prototype.init.prototype = jQuery.prototype; <span class="comment">// init的原型对象指向为jQuery的原型原型对象</span></span><br><span class="line"></span><br><span class="line">    root.$ = root.jQuery = jQuery;</span><br><span class="line">&#125;)(<span class="keyword">this</span>);</span><br></pre></td></tr></table></figure></p>
<p>&emsp;设计的思路是这样的,我们有两个函数jQuery和init,$()就等同于实例化jQuery即new jQuery(),但们无法直接让jQuery函数返回new jQuery,这样会形成死循环,于是我们实例化了另一个构造函数init<br>&emsp;我们将init方法的原型也指向了jQuery的方法原型,实现了原型共享<br>&emsp;因此,jQuery.prototype原型对象里封装的所有属性和方法,jQuery与init都是可以调用的<br>&emsp;最反思维的地方就在于了,init是Query.prototype原型对象的一个方法,可以想想计算机的自举~<br>&emsp;此时我们再调用$(),将输入111</p>
<p>&emsp;<abbr style="display:block;color: brown;">* 工具函数</abbr> </p>
<p>&emsp;jQuery框架非常重要的一个函数-工具函数,它的作用是将jQuery所有的自身对象或者实例对象的属性和方法,全部都剥离开来,进行分类管理<br>&emsp;jQuery中一共有两个对象,一个是实例对象,一个是jQuery本身的对象<br>&emsp;起手式中我们实现了实例对象,而jQuery除了是一个构造函数,它也是一个函数对象,我们也有很多函数对象是挂载到jQuery本身上的,例如$.ajax/$.each等<br>&emsp;我们给jQuery添加一个静态属性fn,我们让fn等于jQuery的原型对象,这样我们在外部扩展时,至需要扩展jQuery.fn即可<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">root</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> jQuery = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> jQuery.prototype.init();</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    jQuery.fn = jQuery.prototype = &#123;    <span class="comment">// jQuery的静态方法等于jQuery的原型对象,原型对象也是对象</span></span><br><span class="line">        init: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    jQuery.fn.init.prototype = jQuery.fn;   <span class="comment">// 替换</span></span><br><span class="line"></span><br><span class="line">    root.$ = root.jQuery = jQuery;</span><br><span class="line"></span><br><span class="line">&#125;)(<span class="keyword">this</span>);</span><br></pre></td></tr></table></figure></p>
<p>&emsp;外部扩展时,只需要$.fn.新方法名 = function(){} -&gt;插件编写的形式<br>&emsp;通过调用静态属性扩展到jQuery的实例对象上</p>
<p>&emsp;<abbr style="display:block;color: brown;">* extend</abbr> </p>
<p>&emsp;extend在jQuery函数内部是作为一个工具函数存在,用它来管理不同对象(jQuery本身以及它的原型对象)的扩展<br>&emsp;extend在外部可以给 ①任意对象扩展/浅拷贝/深拷贝 ②jQuery本身扩展 ③jQuery实例对象扩展<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">root</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> jQuery = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> jQuery.prototype.init();</span><br><span class="line">    &#125;;</span><br><span class="line">    jQuery.fn = jQuery.prototype = &#123;</span><br><span class="line">        init: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// jQuery与 jQuery.prototype的原型都扩展了一个extend属性</span></span><br><span class="line">    jQuery.extend = jQuery.prototype.extend = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 方法调用时,我们有可能给任何对象/jQuery对象/jQuery原型对象进行扩展</span></span><br><span class="line">        <span class="comment">// 我们通过参数来进行区分</span></span><br><span class="line">        <span class="comment">// 参数1 是我们要扩展的对象 参数2 是我们要变量的对象</span></span><br><span class="line">        <span class="comment">// 分析 有1个参数 可能给jQuery对象/jQuery原型对象扩展 有2个及以上 给任意对象arguments[0]扩展</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> target = <span class="built_in">arguments</span>[<span class="number">0</span>] || &#123;&#125;;   <span class="comment">// 参数处理: 参数为空? 赋值对象不是引用类型?</span></span><br><span class="line">        <span class="keyword">var</span> length = <span class="built_in">arguments</span>.length;  <span class="comment">// 参数个数</span></span><br><span class="line">        <span class="keyword">var</span> i = <span class="number">1</span>;  <span class="comment">// 默认参数个数</span></span><br><span class="line">        <span class="keyword">var</span> option;</span><br><span class="line">        <span class="keyword">var</span> name;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">typeof</span> target !== <span class="string">"object"</span>)&#123;</span><br><span class="line">            target = &#123;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1个参数</span></span><br><span class="line">        <span class="keyword">if</span>(length == i)&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2个及以上参数</span></span><br><span class="line">        <span class="keyword">for</span>(;i&lt;length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>((option = <span class="built_in">arguments</span>[i]) !== <span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">for</span>(name <span class="keyword">in</span> option)&#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    jQuery.fn.init.prototype = jQuery.fn;</span><br><span class="line">    root.$ = root.jQuery = jQuery;</span><br><span class="line"></span><br><span class="line">&#125;)(<span class="keyword">this</span>);</span><br></pre></td></tr></table></figure></p>
<p>&emsp;<br>&emsp;<br>&emsp;</p>

      
    </div>
      <div id="remark"></div>
    <div class="article-info article-info-index">
      
      <a href="/2019/09/02/jquerySourceCode1/" class="archive-article-date">
  	<time datetime="2019-09-02T05:17:50.000Z" itemprop="datePublished"><i class="icon-clock"></i>2019-09-02</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jquery/">jquery</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jquery源码/">jquery源码</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jquery源码教程/">jquery源码教程</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端/">前端</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/个人博客/">个人博客</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-flutter_text" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/08/29/flutter_text/">Flutter组件之Text</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&emsp;&emsp;<abbr style="color: #999;font-size: 12px;">* 本文非教程,仅作简单讲解,能来看我的一定都是真爱</abbr></p>
<p>&emsp;&emsp;Text组件是flutter最基本的组件之一,我们知道在Flutter的世界万物皆Widget,Text组件也是一个Widget。<br>&emsp;&emsp;Text组件主要分为普通文本组件和富文本组件<br>&emsp;&emsp;Vscode输入stl+回车键,可快速创建一个无状态组件。stf+回车创建有状态组件<br>&emsp;&emsp;Vscode鼠标右键Refactor可快速将组件导出为Widget或Method<br>&emsp;&emsp;通过上述方法,我们快速创建一个安卓风格的页面如下：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/widgets.dart'</span>;</span><br><span class="line"></span><br><span class="line">main(<span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; args) =&gt; runApp(MyApp());</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) =&gt; MaterialApp(</span><br><span class="line">    home: Scaffold(</span><br><span class="line">      body: Scaffold(</span><br><span class="line">        appBar: AppBar(</span><br><span class="line">          title: Text(<span class="string">'Flutter组件之Text'</span>),</span><br><span class="line">        ),</span><br><span class="line">        body: _MyTextWidget(),</span><br><span class="line">      ),</span><br><span class="line">    ),</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_MyTextWidget</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> _MyTextWidget(&#123;</span><br><span class="line">    Key key,</span><br><span class="line">  &#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Center(</span><br><span class="line"></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;以下我们仅关注_MyTextWidget组件<br>&emsp;&emsp;普通文本如下：<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_MyTextWidget</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> _MyTextWidget(&#123;</span><br><span class="line">    Key key,</span><br><span class="line">  &#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Center(</span><br><span class="line">        child: Column(</span><br><span class="line">          children: &lt;Widget&gt;[</span><br><span class="line">            Text(<span class="string">'个人觉得不管是现代 web 前端技术还是古代 web 前端技术，甚至是学习其他任何东西，都应该注重基础，否则你学到一定程度都会遇到很明显的瓶颈。今天你看到了 React，Vue，Angular，明天你还会看到更多的新东西。而事实上，这些东西背后的原理和本质都离不开那些基础的东西。这个打好基础的原则是学习技术的最大前提，始终都要牢记。'</span>,</span><br><span class="line">              style: TextStyle(</span><br><span class="line">                fontSize: <span class="number">20.0</span>,          <span class="comment">// 文号</span></span><br><span class="line">                fontFamily: <span class="string">'微软雅黑'</span>,   <span class="comment">// 字体</span></span><br><span class="line">                color:  Colors.orange,   <span class="comment">// 文本颜色</span></span><br><span class="line">                letterSpacing: <span class="number">1.0</span>,      <span class="comment">// 文本间距</span></span><br><span class="line">                decoration: TextDecoration.underline,  <span class="comment">// 文本线位置</span></span><br><span class="line">                decorationColor: Colors.blue,         <span class="comment">// 文本线颜色</span></span><br><span class="line">                decorationStyle: TextDecorationStyle.dotted  <span class="comment">// 文本线条类型</span></span><br><span class="line">              ), </span><br><span class="line">              maxLines: <span class="number">3</span>,               <span class="comment">// 文本最多显示几行</span></span><br><span class="line">              overflow: TextOverflow.ellipsis,  <span class="comment">// 文本超出显示......</span></span><br><span class="line">              textAlign: TextAlign.justify,  <span class="comment">// 文本对齐方式</span></span><br><span class="line">              softWrap: <span class="keyword">true</span>,            <span class="comment">// 文本是否换行</span></span><br><span class="line">            )</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

      
    </div>
      <div id="remark"></div>
    <div class="article-info article-info-index">
      
      <a href="/2019/08/29/flutter_text/" class="archive-article-date">
  	<time datetime="2019-08-29T03:01:44.000Z" itemprop="datePublished"><i class="icon-clock"></i>2019-08-29</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/flutter/">flutter</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/flutter组件/">flutter组件</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/全栈/">全栈</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/原创/">原创</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-wbpackDepthExplanation2" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/08/28/wbpackDepthExplanation2/">从0基础到大牛-webpack深入浅出超强完整版(二)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><abbr style="display:block;margin-top: -50px;font-size: 12px;color:#999;text-align: center;border-bottom: 1px dotted #999;">你可能只需要这一个教程</abbr></p>
<h2 id="webpack小试牛刀-ES6-转-ES5"><a href="#webpack小试牛刀-ES6-转-ES5" class="headerlink" title="webpack小试牛刀 - ES6+ 转 ES5"></a>webpack小试牛刀 - ES6+ 转 ES5</h2><ul>
<li>全局垫片 polyfill</li>
</ul>
<p>&emsp;&emsp;使用babel,需要下载 babel-loader @babel/core @babel/preset-env<br>&emsp;&emsp;<a href="https://webpack.js.org/loaders/babel-loader/" target="_blank" rel="noopener">babel-loader</a> 下载 <code>npm install -D babel-loader @babel/core @babel/preset-env webpack</code><br>&emsp;&emsp;配置如下<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [    </span><br><span class="line">          &#123;</span><br><span class="line">              test: <span class="regexp">/\.js$/</span>,            <span class="comment">// 正则 匹配规则</span></span><br><span class="line">              exclude: <span class="regexp">/node_modules/</span>,  <span class="comment">// 依赖文件已做过处理，无需再处理，节省打包时间</span></span><br><span class="line">              loader: <span class="string">"babel-loader"</span>,   <span class="comment">// 使用的loader</span></span><br><span class="line">              option: &#123;                 <span class="comment">// 配置  option的配置应参照使用的loader配置列表</span></span><br><span class="line">                  presets: [<span class="string">"@babel/preset-env"</span> ] </span><br><span class="line">              &#125;</span><br><span class="line">          &#125;  </span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;打包生成的文件中，ES6语法将会转为ES5语法<br>&emsp;&emsp;但并不是所有的ES6都可以被转化，ES6中一些内置API和功能（Promise set Map）、Object.assign等无法转化<br>&emsp;&emsp;如果想要实现上述这些方法，我们需要使用垫片库（polyfill）<code>npm install -D @babel/polyfill</code><br>&emsp;&emsp;直接引入垫片库，会将所有方法都加载进来<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"@babel/polyfill"</span>;</span><br><span class="line"><span class="keyword">const</span> arr = [<span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">()</span>=&gt;</span>&#123;&#125;),<span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">()</span>=&gt;</span>&#123;&#125;)];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 此时  Object.assign Set Map等方法也会被打入,生成文件骤然变大</span></span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;如何实现按需加载呢？需要配置如下<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                rule: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                loader: <span class="string">"@babel-loader"</span>,</span><br><span class="line">                options: &#123;</span><br><span class="line">                    presets: [</span><br><span class="line">                        [<span class="string">"@babel/preset-env"</span>,&#123;</span><br><span class="line">                            <span class="string">"useBuiltIns"</span> : <span class="string">"usage"</span>, </span><br><span class="line">                            <span class="comment">// usage: 按需加载  页面无需引入"@babel/polyfill" </span></span><br><span class="line">                            <span class="comment">// entry: 按需加载  页面需手动引入 import "@babel/polyfill"</span></span><br><span class="line">                            <span class="comment">// 自测时发现 entry比usage打出的包更轻量</span></span><br><span class="line">                            </span><br><span class="line">                            <span class="string">"target"</span>: &#123;  <span class="comment">// 目标  针对浏览器版本打包</span></span><br><span class="line">                                ie: <span class="string">"9"</span></span><br><span class="line">                            &#125;    </span><br><span class="line">                        &#125;]</span><br><span class="line">                    ]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>babel的全局配置<br>&emsp;&emsp;webpack中options的配置可以全部放置到babel全局配置文件中，其作用和用法完全一致。首先我们先将webpack中babel的options清除<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">        <span class="built_in">module</span>: &#123;</span><br><span class="line">            rules: [</span><br><span class="line">                &#123;</span><br><span class="line">                    rule: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                    exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                    loader: <span class="string">"@babel-loader"</span>,</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>&emsp;&emsp;根目录下新建babel配置文件: .babelrc 并配置如下(此处注意JSON写法)<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"presets"</span> : [[<span class="string">"@babel/preset-env"</span>,&#123;</span><br><span class="line">    <span class="attr">"useBuiltIns"</span>: <span class="string">"entry"</span>,</span><br><span class="line">    <span class="attr">"targets"</span>: &#123;</span><br><span class="line">      <span class="attr">"chrome"</span>: <span class="number">67</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;]]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>局部垫片 transform-runtime</li>
</ul>
<p>&emsp;&emsp;polyfill是一个全局的垫片，会将方法全部扩展到原型上。如果是开发库或者框架，就需要使用局部垫片。<br>&emsp;&emsp;下载<a href="https://babeljs.io/docs/en/babel-plugin-transform-runtime" target="_blank" rel="noopener">transform-runtime</a> <code>npm install --save-dev @babel/plugin-transform-runtime</code> 和 <code>npm install --save @babel/runtime</code><br>&emsp;&emsp;.babelrc配置如下<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"presets"</span> : [<span class="string">"@babel/preset-env"</span>],</span><br><span class="line">  <span class="attr">"plugins"</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">"@babel/plugin-transform-runtime"</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"absoluteRuntime"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"corejs"</span>: <span class="literal">false</span>,  </span><br><span class="line">        <span class="attr">"helpers"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"regenerator"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"useESModules"</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;transform-runtime默认按需加载，无需配置<br>&emsp;&emsp;corejs可取值false，2，3或{ version: 2 | 3, proposals: boolean }，默认为false详见文档</p>
<ul>
<li>更改文件打包地址</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>); <span class="comment">// node</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    output:&#123;</span><br><span class="line">        filename: <span class="string">'[name].js'</span>,</span><br><span class="line">        path: path.resolve(__dirname,<span class="string">'dist'</span>), <span class="comment">// __dirname为当前文件路径 dist可更改为要打包的路径名 默认dist</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>转换TS文件</li>
</ul>
<p>&emsp;&emsp;webpack支持<a href="https://webpack.js.org/guides/typescript/" target="_blank" rel="noopener">Typescript</a>打包，需先下载<code>npm install --save-dev typescript ts-loader</code><br>&emsp;&emsp;根目录下新建ts配置文件：tsconfig.json 并配置如下<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"compilerOptions"</span>: &#123;</span><br><span class="line">    <span class="string">"module"</span>: <span class="string">"es6"</span>,  <span class="comment">// 模块的引入方式 es6|commonjs</span></span><br><span class="line">    <span class="string">"target"</span>: <span class="string">"es5"</span>,  <span class="comment">// 目标语法</span></span><br><span class="line">    <span class="string">"allowJs"</span>: <span class="literal">true</span>   <span class="comment">// 是否允许JS语法</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"include"</span>: [        <span class="comment">// 包含文件列表</span></span><br><span class="line">      <span class="string">"./src/"</span>,</span><br><span class="line">      <span class="string">"./"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"exclude"</span>: [        <span class="comment">//  不包含的文件</span></span><br><span class="line">      <span class="string">"node_modules"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;并在webpack配置中新增loader<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">   <span class="built_in">module</span>: &#123;</span><br><span class="line">       rules: [</span><br><span class="line">           &#123;</span><br><span class="line">              test: <span class="regexp">/\.ts$/</span>,</span><br><span class="line">              loader: <span class="string">"ts-loader"</span>,</span><br><span class="line">              exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">           &#125;</span><br><span class="line">       ]</span><br><span class="line">   &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;<a href="https://microsoft.github.io/TypeSearch/" target="_blank" rel="noopener">TypeSearch类型约束查找地址</a></p>
<ul>
<li>图片打包</li>
</ul>
<p>&emsp;&emsp;下载<a href="https://webpack.js.org/loaders/file-loader/" target="_blank" rel="noopener">file-loader</a> <code>npm install file-loader --save-dev</code><br>&emsp;&emsp;webpack中新增图片转换的loader<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line"> <span class="built_in">module</span> : &#123;</span><br><span class="line">     rules : [</span><br><span class="line">         &#123;</span><br><span class="line">            test: <span class="regexp">/\.(png|jpe?g|gif)/</span>,</span><br><span class="line">            use: &#123;</span><br><span class="line">               loader: <span class="string">"file-loader"</span>,</span><br><span class="line">               options:&#123;</span><br><span class="line">                   name: <span class="string">"[name]-[hash:5].[ext]"</span>,   <span class="comment">// name:图片名 ext:图片后缀名 hash:5 取Hash前5位值 默认文件名为hash:5</span></span><br><span class="line">                   outputPath: <span class="string">"images/"</span>            <span class="comment">// 输出文件夹(output.path)下 打包输出地址 </span></span><br><span class="line">               &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            exclude: <span class="regexp">/node_modules/</span></span><br><span class="line">         &#125;</span><br><span class="line">     ]</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;注：loader有多种引入写法<br>&emsp;&emsp;另一个插件<a href="https://webpack.js.org/loaders/url-loader/" target="_blank" rel="noopener">url-loader</a>包含file-loader,比file-loader更强大。<code>npm install -D url-loader</code><br>&emsp;&emsp;将上述配置file-loader改为url-loader,将不再生成image文件，会自动将图片转为base64位并注入js中。现在我们修改配置,限制转Base64大小<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line"> <span class="built_in">module</span> : &#123;</span><br><span class="line">     rules : [</span><br><span class="line">         &#123;</span><br><span class="line">            test: <span class="regexp">/\.(png|jpe?g|gif)/</span>,</span><br><span class="line">            use: &#123;</span><br><span class="line">               loader: <span class="string">"file-loader"</span>,</span><br><span class="line">               options:&#123;</span><br><span class="line">                   name: <span class="string">"[name]-[hash:5].[ext]"</span>,</span><br><span class="line">                   outputPath: <span class="string">"images/"</span>,  </span><br><span class="line">                   limit: <span class="number">1024</span> * <span class="number">1</span>            <span class="comment">//1024 = 1kb 低于1kb生成base64位，以减少http请求</span></span><br><span class="line">               &#125; </span><br><span class="line">            &#125;,   </span><br><span class="line">            exclude: <span class="regexp">/node_modules/</span></span><br><span class="line">         &#125;</span><br><span class="line">     ]</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

      
    </div>
      <div id="remark"></div>
    <div class="article-info article-info-index">
      
      <a href="/2019/08/28/wbpackDepthExplanation2/" class="archive-article-date">
  	<time datetime="2019-08-28T10:14:43.000Z" itemprop="datePublished"><i class="icon-clock"></i>2019-08-28</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webpack/">webpack</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webpack-4-0/">webpack 4.0</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webpack教程/">webpack教程</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端/">前端</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/个人博客/">个人博客</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-wbpackDepthExplanation1" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/08/15/wbpackDepthExplanation1/">从0基础到大牛-webpack深入浅出超强完整版(一)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><abbr style="display:block;margin-top: -50px;font-size: 12px;color:#999;text-align: center;border-bottom: 1px dotted #999;">你可能只需要这一个教程</abbr></p>
<h2 id="webpack介绍"><a href="#webpack介绍" class="headerlink" title="webpack介绍"></a>webpack介绍</h2><h6 id="1-webpack发展历程"><a href="#1-webpack发展历程" class="headerlink" title="1.webpack发展历程"></a>1.webpack发展历程</h6><p><abbr style="display:block;color: brown;">发布时间</abbr></p>
<ul>
<li>webpack &emsp; v1.x &emsp; 2014.02</li>
<li>webpack &emsp; v2.x &emsp; 2017.01</li>
<li>webpack &emsp; v3.x &emsp; 2017.06 </li>
<li>webpack &emsp; v4.0 &emsp; 2018.05  &emsp; 稳定版4.32.2</li>
<li>webpack &emsp; v5.x &emsp; 2019.xx  &emsp; 目前不是稳定的版本</li>
</ul>
<p><abbr style="display:block;color: brown;">模块化历程</abbr><br>&emsp;单页面应用(Vue React)都在用模块化</p>
<p><abbr style="font-size: 13px;color: burlywood;font-weight:bold;">命名空间</abbr> </p>
<p>&emsp;蛮荒时代的模块化<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line">obj.type = obj.type || &#123;&#125;;</span><br><span class="line">obj.type.method = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">obj.type.add = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">obj.type.sub = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line">   </span><br><span class="line">obj.addin = obj.addin || &#123;&#125;;</span><br><span class="line">obj.addin.remove = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">obj.addin.append = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br></pre></td></tr></table></figure></p>
<p>&emsp;AMD与CMD的中原逐鹿</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AMD 异步加载 依赖前置 先加载后使用</span></span><br><span class="line"><span class="comment">// 需要库文件 - require.js</span></span><br><span class="line"><span class="comment">// 定义AMD模块  文件名amd</span></span><br><span class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>) </span>&#123;</span><br><span class="line"><span class="meta">    'use strict'</span>;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        add: <span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> a + b;</span><br><span class="line">        &#125;,</span><br><span class="line">        sub: <span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> a - b;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载AMD模块</span></span><br><span class="line"><span class="built_in">require</span>([<span class="string">'moduleA'</span>,<span class="string">'moduleB'</span>,<span class="string">'amd'</span>],<span class="function"><span class="keyword">function</span>(<span class="params">a,b,amd</span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(a);  <span class="comment">// a模块</span></span><br><span class="line">   <span class="built_in">console</span>.log(b);  <span class="comment">// b模块</span></span><br><span class="line">   </span><br><span class="line">   amd.add(<span class="number">1</span>,<span class="number">2</span>);   <span class="comment">// 调用amd</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CMD 同步加载 依赖后置 使用时引入 </span></span><br><span class="line"><span class="comment">// 需要库文件 - sea.js</span></span><br><span class="line"><span class="comment">// 定义CMD模块  文件名cmd</span></span><br><span class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params">require,exports,module</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> moduleA = <span class="built_in">require</span>(<span class="string">'moduleA'</span>);   <span class="comment">// 需要时引入</span></span><br><span class="line">    </span><br><span class="line">    exports = &#123;</span><br><span class="line">        add: <span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> a+b;</span><br><span class="line">        &#125;,</span><br><span class="line">        sub: <span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> a - b;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载CMD模块</span></span><br><span class="line">seajs.use([<span class="string">'cmd'</span>],<span class="function"><span class="keyword">function</span>(<span class="params">cmd</span>) </span>&#123;</span><br><span class="line">    cmd.add(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">    cmd.sub(<span class="number">2</span>,<span class="number">3</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>&emsp;commonJS -  Node.js主要践行者<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 一个文件就是一个模块 文件名common</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="number">20</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出方式 一</span></span><br><span class="line">modules.export = &#123;</span><br><span class="line">    a : a,</span><br><span class="line">    b : b,</span><br><span class="line">    fun : b</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出方式 二</span></span><br><span class="line"><span class="comment">// export.add = function()&#123;&#125;; ...</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过关键字require引入文件【相对路径/绝对路径引入】</span></span><br><span class="line"><span class="keyword">var</span> common = <span class="built_in">require</span>(<span class="string">'common'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(common.a);  <span class="comment">// 10</span></span><br></pre></td></tr></table></figure></p>
<p>&emsp;官方科普最硬核 - ES Module(ES6的模块化)<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用方式 一</span></span><br><span class="line"><span class="comment">// 导出 文件名es1</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">var</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">var</span> add = <span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入</span></span><br><span class="line"><span class="keyword">import</span> &#123; a,add &#125; <span class="keyword">from</span> <span class="string">'es1'</span>;</span><br><span class="line">add(<span class="number">3</span>,<span class="number">5</span>);   <span class="comment">// 调用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用方式 二</span></span><br><span class="line"> <span class="comment">// 导出 文件名es2</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">const</span> b = &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">20</span>;  </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入</span></span><br><span class="line"><span class="keyword">import</span> b <span class="keyword">from</span> <span class="string">'es2'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(b);</span><br></pre></td></tr></table></figure></p>
<p>&emsp;<abbr style="color: red;font-weight: bold;">*</abbr>CSS模块化</p>
<ul>
<li>OOCSS(面向对象)</li>
<li>AMCSS(属性模块)</li>
</ul>
<p><abbr style="display:block;color: brown;">webpack 4.32.2核心组成</abbr></p>
<ul>
<li>entry : 命令行中写入口，配置文件中 </li>
<li>output</li>
<li>module</li>
<li>plugins</li>
</ul>
<p>&emsp;准备工作<br>&emsp;&emsp;卸载旧的webpack版本 <code>npm uninstall webpack -g</code><br>&emsp;&emsp;下载最新的版本 <code>npm install webpack -g</code><br>&emsp;&emsp;检查当前webpack版本 <code>webpack --version</code><br>&emsp;&emsp;需要在本地文件内下载webpack,初始化package.json文件 <code>npm init -y</code><br>&emsp;&emsp;去下载 webpack 和 webpack-cli,3.x 的版本是不需要 webpack-cli,webpack 中集成了 webpack-cli, 4.X以后没有集成<br>&emsp;&emsp;webpack4.x 以下的使用 webpack app.js 是可以的，4.x以后因为增加了一个多入口命令打包，需要指定出口文: <code>webpack app.js -o bundle.js</code><br>&emsp;&emsp;如果不加 –mode development 参数，默认是生产环境，会自动压缩代码<br>&emsp;&emsp;当前可下载的webpack版本 <code>npm info webpack</code> webpack-5.x-bate(公测的版本)</p>
<p>&emsp;起手式<br>&emsp;&emsp;根目录下新建配置文件,默认配置文件为 webpack.config.js<br>&emsp;&emsp;你的第一个配置文件<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// 入口 相对文件地址</span></span><br><span class="line">    entry: <span class="string">'./app.js'</span>,</span><br><span class="line">    <span class="comment">// 出口</span></span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: <span class="string">'bundle.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    mode: <span class="string">"development"</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;执行命令webpack后会生成 /dist/bundle.js 文件<br>&emsp;&emsp;使用自定义名称的配置文件my-webpack-setting.js打包，请执行 <code>webpack --config my-webpack-setting.js</code></p>
<ul>
<li><p>多入口打包</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">   entry: [<span class="string">'app.js'</span>,<span class="string">'app1.js'</span>,<span class="string">'app2.js'</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>自定义出口文件名打包</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        main: <span class="string">'./app1.js'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: <span class="string">'[name].js'</span>,</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>&emsp;&emsp;将生成 /dist/main.js 文件</p>
<ul>
<li>多入口多出口文件打包<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        main: <span class="string">'./app.js'</span>,</span><br><span class="line">        select: <span class="string">'./my_select.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: <span class="string">'[name].js'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>&emsp;&emsp;将在dist文件夹下生成main.js与select.js<br>&emsp;&emsp;注：多入口对应多出口,多入口对应单一出口配置时将会报错</p>
<ul>
<li>ES6 module 打包<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  导出文件 es6.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> add = <span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入文件 app.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; add &#125; <span class="keyword">from</span> <span class="string">'./es6.js'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(add(<span class="number">4</span>,<span class="number">7</span>));   <span class="comment">// 11</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// webpack配置文件</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        app: <span class="string">'./app.js'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: <span class="string">'[name].js'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    mode: <span class="string">"development"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>&emsp;&emsp;结果生成 /dist/app.js 文件, 文件内包含 es6.js 与 app.js 代码</p>
<ul>
<li>CommonJS 打包<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导出 common.js</span></span><br><span class="line"><span class="built_in">module</span>.exports =  &#123;</span><br><span class="line">  add : <span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">  &#125;,</span><br><span class="line">  sub: <span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>)</span>&#123;</span><br><span class="line">     <span class="keyword">return</span> a - b;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入 app.js</span></span><br><span class="line"><span class="keyword">const</span>  method = reqiore(<span class="string">'./common,js'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(method.add(<span class="number">4</span>,<span class="number">7</span>));   <span class="comment">// 11</span></span><br><span class="line"><span class="built_in">console</span>.log(method.sub(<span class="number">8</span>,<span class="number">3</span>));  <span class="comment">// 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// webpack配置文件 同上</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>&emsp;&emsp;结果生成 /dist/app.js 文件, 文件内包含 common.js 与 app.js 代码</p>
<ul>
<li>amd模块 打包</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导出 amd.js</span></span><br><span class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params">require,factory</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">      mul: <span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a * b;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入</span></span><br><span class="line"><span class="built_in">require</span>([<span class="string">'./amd.js'</span>],<span class="function"><span class="keyword">function</span>(<span class="params">method</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(method.mul(<span class="number">10</span>,<span class="number">4</span>));   <span class="comment">// 40</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"> <span class="comment">// webpack配置文件 同上</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;dist文件夹下将生成 app.js与 0.js<br>&emsp;&emsp;0.js异步加载的内容(amd.js内容)</p>

      
    </div>
      <div id="remark"></div>
    <div class="article-info article-info-index">
      
      <a href="/2019/08/15/wbpackDepthExplanation1/" class="archive-article-date">
  	<time datetime="2019-08-15T07:20:27.000Z" itemprop="datePublished"><i class="icon-clock"></i>2019-08-15</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webpack/">webpack</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webpack-4-0/">webpack 4.0</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webpack教程/">webpack教程</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端/">前端</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/个人博客/">个人博客</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-javascriptPrototype" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/08/13/javascriptPrototype/">前端设计模式之依赖倒置原则(DIP)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h6 id="前端原型的个人猜想"><a href="#前端原型的个人猜想" class="headerlink" title="前端原型的个人猜想"></a>前端原型的个人猜想</h6><p>&emsp;&emsp;相信每个学习javaScript的同僚,一定对一个说法非常熟悉『一切皆对象』.</p>
<p>&emsp;&emsp;这个说法很好的将我们从现实社会连接进了程序世界，同时也解释了程序界很多古怪无法理解的东西.</p>
<p>&emsp;&emsp;而事实真是这样么？在我写了这么久代码之后，我反而对javaScript最基本的东西产生了越发的迷茫和混乱.</p>
<p>&emsp;&emsp;像隐式转换、原型链的继承这种更是完全无法想通，当我看到null和undefined时鬼知道我的脑子会爆炸出什么,最后扭合到一起，变成一堆的问号…</p>
<p>&emsp;&emsp;现在我希望彻底能搞清祖师爷在创造javaScript是究竟是怎样的思路，这对我来说很难，但我知道当我搞清楚这个问题时，会有一个很大的飞跃，我不应该继续『不了解但不影响工作』在的舒适区混下去.</p>
<p>&emsp;&emsp;感谢jQuery的源码，让我有了共享原型的概念，不然我一定会强制要求原型链必须是个有唯一顶点的树状结构。</p>
<p>&emsp;&emsp;*请注意下面代码中，一定要将Object.prototype和Function.prototype当成是独立的一部分</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.prototype.__proto__ == <span class="literal">null</span>   <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里我们知道了Object.prototype的原型链向上指向是null，注意我没有说它继承自null,因为null是个很特别的类型，我们都知道原型的本质是个对象，所以它应该继承自对象.<br>&emsp;&emsp;那这里怎么会是个null呢？我是猜想浏览器帮我们指向了null.<br>&emsp;&emsp;太好了，至少有一个封闭的点了！我们继续.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.__proto__ == <span class="built_in">Function</span>.prototype  <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;大声尖叫，Object竟然继承自Function.prototype,『一切皆对象』并不是最后的真像！就好比我们好不容易发现了真菌细菌这些肉眼看不见的小东西，转眼我们又发现了分子原子，难道大世界无限的在嵌套我们不知道的小世界么？</p>
<p>&emsp;&emsp;好在程序世界的构成元素就是这几个，根本不存在宇宙这种无休无止的构成一说，但程序世界与现实世界还有一个最大的区别,叫做『自举』,这里我们可以简单理解为『我可以创造我自己』.</p>
<p>&emsp;&emsp;有了上面代码，就下面代码的成立.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span> <span class="keyword">instanceof</span> <span class="built_in">Function</span> == <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;但是我们还知道</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span> <span class="keyword">instanceof</span> <span class="built_in">Object</span> == <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里是『我创造了我自己』么?不是的，这里完全是多绕了一步</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.__proto__ == <span class="built_in">Function</span>.prototype   <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Function</span>.prototype.__proto__ == <span class="built_in">Object</span>.prototype    <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;目前还没有出现Object，我们又回到了Object.prototype，而Object.prototype.<strong>proto</strong>等于null这件事我们在第一步就已经证实过了.</p>
<p>&emsp;&emsp;问题出在哪呢？当然还是Object.prototype的继承问题！刚刚说过了Object.prototype很有可能是Object的实例,并保留了其继承关系，而浏览器对其赋值为null.</p>
<p>&emsp;&emsp;这完全出自我的个人想法，因为如果不是这样，这条原型链的解释则都不成立.</p>
<p>&emsp;&emsp;再看这个</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Function</span>.__proto__ == <span class="built_in">Function</span>.prototype  <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;Function继承自自己</p>
<pre><code>/* 这里非常明确了Object继承自Function.prototype */


/*我们知道了上面代码的关系 下面这句就理所当然了*/


/* 但我们还知道*/
</code></pre>
      
    </div>
      <div id="remark"></div>
    <div class="article-info article-info-index">
      
      <a href="/2019/08/13/javascriptPrototype/" class="archive-article-date">
  	<time datetime="2019-08-13T07:09:30.000Z" itemprop="datePublished"><i class="icon-clock"></i>2019-08-13</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/js原型/">js原型</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端/">前端</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/个人博客/">个人博客</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-webpackStudyQuick" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/11/webpackStudyQuick/">webpack4.X 小白从0开始一步学到位</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><abbr style="display:block;margin-top: -50px;font-size: 12px;color:#999;text-align: center;border-bottom: 1px dotted #999;">来自三刷老肖的学习视频，依个人理解有增删</abbr></p>
<h2 id="webpack介绍"><a href="#webpack介绍" class="headerlink" title="webpack介绍"></a>webpack介绍</h2><h6 id="1-webpack是什么"><a href="#1-webpack是什么" class="headerlink" title="1.webpack是什么"></a>1.webpack是什么</h6><ul>
<li>打包工具(模块)</li>
<li>前端必不可少的工具</li>
</ul>
<h6 id="2-webpack的作用"><a href="#2-webpack的作用" class="headerlink" title="2. webpack的作用"></a>2. webpack的作用</h6><ul>
<li>打包（把多个文件打包成一个js文件，减少服务器压力、带宽）</li>
<li>转化（比如less/sass/ts）需要loader</li>
<li>优化（SPA越来越盛行，前端项目复杂度高,webpack可以对项目进行优化）</li>
</ul>
<h6 id="3-webpack构成"><a href="#3-webpack构成" class="headerlink" title="3. webpack构成"></a>3. webpack构成</h6><ul>
<li>入口 （entry）</li>
<li>出口 （output）</li>
<li>转化器 （loader）</li>
<li>插件 （plugins）</li>
<li>开发服务器 （devServer）</li>
<li>模式 （mode）</li>
</ul>
<h6 id="4-安装webpack"><a href="#4-安装webpack" class="headerlink" title="4. 安装webpack"></a>4. 安装webpack</h6><pre><code><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack-cli -g</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line">yarn add webpack-cli -g</span><br><span class="line"><span class="comment">// 验证webpack环境已经OK ？</span></span><br><span class="line">webpack -v</span><br></pre></td></tr></table></figure>
</code></pre><h6 id="5-开发环境和生产环境"><a href="#5-开发环境和生产环境" class="headerlink" title="5. 开发环境和生产环境"></a>5. 开发环境和生产环境</h6><ul>
<li>开发环境(development)： 就是你平时编写代码的环境</li>
<li>生产环境(production): 项目开发完毕，部署上线</li>
</ul>
<h6 id="6-npm基本命令"><a href="#6-npm基本命令" class="headerlink" title="6. npm基本命令"></a>6. npm基本命令</h6><ul>
<li>生成package.json: <ul>
<li>npm init  </li>
<li>npm init -y</li>
</ul>
</li>
<li>下载线上环境包依赖<ul>
<li>npm install [包名,包名,包名…] –save</li>
<li>npm i [包名,包名,包名…] -S</li>
</ul>
</li>
<li>下载开发环境包依赖 <ul>
<li>npm install [包名,包名,包名…] –save–dev  </li>
<li>npm i [包名,包名,包名…] -D</li>
</ul>
</li>
</ul>
<h2 id="webpack4-x初探"><a href="#webpack4-x初探" class="headerlink" title="webpack4.x初探"></a>webpack4.x初探</h2><h6 id="1-跑一跑webpack"><a href="#1-跑一跑webpack" class="headerlink" title="1. 跑一跑webpack"></a>1. 跑一跑webpack</h6><p>&emsp;&emsp;当前项目下，新建src文件,src文件下新建index.js<br>&emsp;&emsp;index.js文件编写测试代码【console.log(‘Hello World’);】<br>&emsp;&emsp;将src下index.js打包为dist下bundle.js，执行如下:</p>
<pre><code><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webpack src/index.js --output dist/bundle.js</span><br></pre></td></tr></table></figure>
</code></pre><h6 id="2-webpack-config-js配置文件"><a href="#2-webpack-config-js配置文件" class="headerlink" title="2. webpack.config.js配置文件"></a>2. webpack.config.js配置文件</h6><p>&emsp;&emsp;当前项目下执行npm init -y<br>&emsp;&emsp;当前项目下新增webpack.config.js<br>    <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        app: <span class="string">'./src/index.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    output:&#123;</span><br><span class="line">        filename: <span class="string">'bundle.js'</span>,</span><br><span class="line">        path: path.resolve(__dirname,<span class="string">'/dist'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;&#125;,</span><br><span class="line">    plugins: [],</span><br><span class="line">    devServer:&#123;&#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h6 id="3-使用自定义webpack配置文件名-例：myself-config-js"><a href="#3-使用自定义webpack配置文件名-例：myself-config-js" class="headerlink" title="3. 使用自定义webpack配置文件名 例：myself.config.js"></a>3. 使用自定义webpack配置文件名 例：myself.config.js</h6><pre><code><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webpack --config myself.config.js</span><br></pre></td></tr></table></figure>
</code></pre><h6 id="4-package-json配置运行命令"><a href="#4-package-json配置运行命令" class="headerlink" title="4. package.json配置运行命令"></a>4. package.json配置运行命令</h6><p>&emsp;&emsp;package.json文件scripts下配置命令<br>&emsp;&emsp;配置webpack开发环境(dev)/线上环境(build)命令如下<br>    <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"dev"</span>: <span class="string">"webpack --mode development"</span>,</span><br><span class="line">    <span class="string">"build"</span>: <span class="string">"webpack --mode production"</span>,</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;执行开发环境打包：npm run dev<br>&emsp;&emsp;执行线上环境打包：npm run build<br>&emsp;&emsp;mode:设置打包环境</p>
<h2 id="多入口、多出口、html插件使用"><a href="#多入口、多出口、html插件使用" class="headerlink" title="多入口、多出口、html插件使用"></a>多入口、多出口、html插件使用</h2><h6 id="1-多入口打包"><a href="#1-多入口打包" class="headerlink" title="1. 多入口打包"></a>1. 多入口打包</h6><pre><code><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: [<span class="string">'./src/index.js'</span>,<span class="string">'./src/index2.js'</span>],</span><br><span class="line">    output:&#123;</span><br><span class="line">        filename: <span class="string">'bundle.js'</span>,</span><br><span class="line">        path: path.resolve(__dirname,<span class="string">'dist'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</code></pre><h6 id="2-多出口"><a href="#2-多出口" class="headerlink" title="2. 多出口"></a>2. 多出口</h6><pre><code><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        app: <span class="string">'./src/index'</span>,</span><br><span class="line">        main: <span class="string">'./src/index2.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    output:&#123;</span><br><span class="line">        filename: <span class="string">'[name].bundle.js'</span>,</span><br><span class="line">        path: path.resolve(__dirname,<span class="string">'dist'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</code></pre><h6 id="3-html-webpack-plugin"><a href="#3-html-webpack-plugin" class="headerlink" title="3. html-webpack-plugin"></a>3. html-webpack-plugin</h6><p>&emsp;&emsp;作用：生成页面<br>&emsp;&emsp;依赖webpack webpack-cli<br>&emsp;&emsp;安装插件：npm i html-webpack-plugin -D<br>&emsp;&emsp;使用如下<br>    <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    ...,</span><br><span class="line">    plugins:[</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: <span class="string">'./src/index.html'</span>,</span><br><span class="line">            title: <span class="string">'可配置标题'</span>,</span><br><span class="line">            hash: <span class="literal">true</span>,</span><br><span class="line">            minify:&#123;</span><br><span class="line">               collapseWhitespace: <span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">         &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<pre><code><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">htmlWebpackPlugin.options.title</span>%&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--htmlWebpackPlugin 为插件定义名称,与js中自定义的插件名无关 --&gt;</span></span><br></pre></td></tr></table></figure>
</code></pre><p>参数解析</p>
<ul>
<li>title：HTML文档标题</li>
<li>filename: 文件名,默认为index.html，可设置</li>
<li>template: 版本地址,默认查询 src/index.ejs,若未查到,将自动生成模板</li>
<li>templateParameters: 允许重新模板参数</li>
<li>inject: 注入，允许对head、body等添加脚本</li>
<li>favicon: 设置网页顶部图标</li>
<li>meta: 在head中注入mate标签</li>
<li>base: 设置公共地址，如 <a href="https://example.com/path/page.html" target="_blank" rel="noopener">https://example.com/path/page.html</a></li>
<li>minify: 是否压缩</li>
<li>hash: 是否生成哈希值,若为true将为所以注入文件加入哈希值</li>
<li>cache: 是否启用缓存，仅在文件有改动后才更新文件</li>
<li>showErrors: 是否报错</li>
<li>chunks: 是否仅允许添加指定块</li>
<li>chunksSortMode: 设置块加载排序方式</li>
<li>excludeChunks: 不允许加入的块</li>
<li>xhtml: 是否遵照xhtml加入link标签</li>
</ul>
<h2 id="HTML插件优化、服务器、热更新"><a href="#HTML插件优化、服务器、热更新" class="headerlink" title="HTML插件优化、服务器、热更新"></a>HTML插件优化、服务器、热更新</h2><h6 id="1-生成多页面"><a href="#1-生成多页面" class="headerlink" title="1. 生成多页面"></a>1. 生成多页面</h6><pre><code><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">plugins: [</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">        template: <span class="string">'./src/index.html'</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">        filename: <span class="string">'index2.html'</span>,</span><br><span class="line">        template: <span class="string">'./src/index2.html'</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</code></pre><p>&emsp;&emsp;配置多个页面时，此处一定要配置filename<br>&emsp;&emsp;mpa项目可用node读取文件，来生成多个模板<br>&emsp;&emsp;默认js都会打入模板内</p>
<h6 id="2-指定文件打入指定模板"><a href="#2-指定文件打入指定模板" class="headerlink" title="2. 指定文件打入指定模板"></a>2. 指定文件打入指定模板</h6><p>&emsp;&emsp;将app文件打入index.html，将main文件打入index2.html,配置如下<br>    <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        app: <span class="string">'./src/index'</span>,</span><br><span class="line">        main: <span class="string">'./src/index2.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            chunks:[<span class="string">'app'</span>],</span><br><span class="line">            template: <span class="string">'./src/index.html'</span>,</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            chunks:[<span class="string">'main'</span>],</span><br><span class="line">            filename: <span class="string">'index2.html'</span>,</span><br><span class="line">            template: <span class="string">'./src/index2.html'</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h6 id="3-clean-webpack-plugin"><a href="#3-clean-webpack-plugin" class="headerlink" title="3. clean-webpack-plugin"></a>3. clean-webpack-plugin</h6><p>&emsp;&emsp;作用：清除文件/文件夹<br>&emsp;&emsp;使用方式：<br>    <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;CleanWebpackPlugin&#125; = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    ...,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> CleanWebpackPlugin(),</span><br><span class="line">    ],</span><br><span class="line">    devServer:&#123;&#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h6 id="4-devServer"><a href="#4-devServer" class="headerlink" title="4. devServer"></a>4. devServer</h6><p>&emsp;&emsp;下载: npm install webpack-dev-server<br>&emsp;&emsp;package.json中配置启动项</p>
<pre><code><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"dev"</span>: <span class="string">"webpack --mode development"</span>,</span><br><span class="line">    <span class="string">"build"</span>: <span class="string">"webpack --mode production"</span>,</span><br><span class="line">    <span class="string">"start:dev"</span>: <span class="string">"webpack-dev-server"</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
</code></pre><p>&emsp;&emsp;配置一个基本的devServer</p>
<pre><code><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    ...,</span><br><span class="line">    devServer:&#123;</span><br><span class="line">        <span class="comment">// 设置服务器访问的基本目录</span></span><br><span class="line">        contentBase: path.resolve(__dirname,<span class="string">'dist'</span>),</span><br><span class="line">        <span class="comment">// 服务IP地址，本地可设置 localhost / 127.0.0.1</span></span><br><span class="line">        host: <span class="string">'localhost'</span>,</span><br><span class="line">        <span class="comment">// 设置端口</span></span><br><span class="line">        port: <span class="string">'8090'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</code></pre><p>&emsp;&emsp;项目中我们发现dist文件为空，因为devServer将contentBase下的文件放到了活动内存中<br>&emsp;&emsp;devServer支持自动刷新</p>
<h6 id="5-热更新"><a href="#5-热更新" class="headerlink" title="5. 热更新"></a>5. 热更新</h6><p>&emsp;&emsp;作用：不重新加载整个文档，保留之前的操作，仅对有变动的部分更改<br>    <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    ...,</span><br><span class="line">    devServer:&#123;</span><br><span class="line">        <span class="comment">// 设置服务器访问的基本目录</span></span><br><span class="line">        contentBase: path.resolve(__dirname,<span class="string">'dist'</span>),</span><br><span class="line">        <span class="comment">// 服务IP地址，本地可设置 localhost / 127.0.0.1</span></span><br><span class="line">        host: <span class="string">'localhost'</span>,</span><br><span class="line">        <span class="comment">// 设置端口</span></span><br><span class="line">        port: <span class="string">'8090'</span>,</span><br><span class="line">        <span class="comment">// 是否开启热更新</span></span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> webpack.HotModuleReplacementPlugin()</span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h6 id="6-实现跨域"><a href="#6-实现跨域" class="headerlink" title="6, 实现跨域"></a>6, 实现跨域</h6><p>&emsp;&emsp;利用devServer实现跨域<br>&emsp;&emsp;将所有/api开头的请求，代理至本机3000端口，配置如下<br>    <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">devServer: &#123;</span><br><span class="line">    proxy: &#123;</span><br><span class="line">      <span class="string">'/api'</span>: &#123;</span><br><span class="line">        target: <span class="string">'http://localhost:3000'</span>,</span><br><span class="line">        pathRewrite: &#123;<span class="string">'^/api'</span> : <span class="string">''</span>&#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;pathRewrite：重写</p>
<h2 id="loader作用，处理css文件及压缩方式"><a href="#loader作用，处理css文件及压缩方式" class="headerlink" title="loader作用，处理css文件及压缩方式"></a>loader作用，处理css文件及压缩方式</h2><h6 id="1-loader介绍"><a href="#1-loader介绍" class="headerlink" title="1. loader介绍"></a>1. loader介绍</h6><p>&emsp;&emsp;作用：加载器、转化器<br>&emsp;&emsp;比如：less/scss转成css；ES7/8/9、JSX转成js<br>&emsp;&emsp;loader从后向前加载</p>
<h6 id="2-css-loader"><a href="#2-css-loader" class="headerlink" title="2. css loader"></a>2. css loader</h6><p>&emsp;&emsp;我们编写了一个app.css文件，并在js文件中引用了它<br>    <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"./app.css"</span>;</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;此时工具将会报编译错误，提示我们缺少loader，下面我是使用loader将其转化<br>&emsp;&emsp;下载css相关的两个最核心loader:style-loader与css-loader<br>&emsp;&emsp;loader基础配置如下:<br>    <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                loader:[<span class="string">'style-loader'</span>,<span class="string">'css-loader'</span>],</span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>关于loader的写法</p>
<ul>
<li>loader: [‘loader1’,’loader2’,…]</li>
<li>use: [‘loader1’,’loader2’,…]</li>
<li>use: [{loader: ‘loader1’},{ loader: ‘loader2’ },…]</li>
</ul>
<p>css-loader先于style-loader解析<br>css-loader用来解析文件，style-loader将注入到模板内(在模板的head标签内注入style标签，并将样式放入style标签内)</p>
<h6 id="3-文件压缩"><a href="#3-文件压缩" class="headerlink" title="3. 文件压缩"></a>3. 文件压缩</h6><p>&emsp;&emsp;4.x版本之前，压缩插件使用uglifyjs-webpack-plugin<br>&emsp;&emsp;4.x版本之后，仅需将模式改为线上模式，将自动生成压缩文件</p>
<h2 id="处理图片，分离css"><a href="#处理图片，分离css" class="headerlink" title="处理图片，分离css"></a>处理图片，分离css</h2><h6 id="1-图片处理"><a href="#1-图片处理" class="headerlink" title="1. 图片处理"></a>1. 图片处理</h6><p>&emsp;&emsp;当我们在css中引用一张路径正确的图片时,编译工具会报错（当时直接引入css的时候也是这样）<br>&emsp;&emsp;图片转化我们经常会用到两个loader: url-loader和file-loader<br>&emsp;&emsp;url-loader: 支持js引入文件,并将文件输出到output的文件夹<br>&emsp;&emsp;file-loader与url-loader相似，但比url-loader功能还要强大<br>&emsp;&emsp;url-loader使用如下：<br>    <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">       &#123;</span><br><span class="line">          test: <span class="regexp">/\.(png|jpg|gif|jpeg)$/i</span>,</span><br><span class="line">          use: &#123;</span><br><span class="line">                   loader: <span class="string">'url-loader'</span>,</span><br><span class="line">                   options: &#123;</span><br><span class="line">                   limit: <span class="number">50</span>*<span class="number">1000</span>,</span><br><span class="line">                   outputPath: <span class="string">'image'</span>,</span><br><span class="line">               &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          exclude: <span class="regexp">/node_modules/</span></span><br><span class="line">       &#125;</span><br><span class="line">    ]</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;背景图小于50kb时，图片会生成base64位</p>
<h6 id="2-图片分离"><a href="#2-图片分离" class="headerlink" title="2. 图片分离"></a>2. 图片分离</h6><p>&emsp;&emsp;图片分离插件 extract-text-webpack-plugin 4.0版后已废弃<br>&emsp;&emsp;4.0版后请使用mini-css-extract-plugin<br>&emsp;&emsp;使用如下<br>    <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">'mini-css-extract-plugin'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">      <span class="built_in">module</span>: &#123;</span><br><span class="line">              rules: [</span><br><span class="line">                  &#123;</span><br><span class="line">                      test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                      loader:[&#123;</span><br><span class="line">                          loader: MiniCssExtractPlugin.loader,</span><br><span class="line">                          options:&#123;</span><br><span class="line">                              publicPath: <span class="string">''</span></span><br><span class="line">                          &#125;</span><br><span class="line">                      &#125;,<span class="string">'css-loader'</span>],</span><br><span class="line">                      exclude: <span class="regexp">/node_modules/</span></span><br><span class="line">                  &#125;,&#123;</span><br><span class="line">                      test: <span class="regexp">/\.(png|jpg|gif|jpeg)$/i</span>,</span><br><span class="line">                      use: &#123;</span><br><span class="line">                          loader: <span class="string">'url-loader'</span>,</span><br><span class="line">                           options: &#123;</span><br><span class="line">                              outputPath: <span class="string">'image'</span>,</span><br><span class="line">                              limit: <span class="number">50</span>*<span class="number">1000</span></span><br><span class="line">                          &#125;</span><br><span class="line">                      &#125;,</span><br><span class="line">                      exclude: <span class="regexp">/node_modules/</span></span><br><span class="line">                  &#125;</span><br><span class="line">              ]</span><br><span class="line">      &#125;,</span><br><span class="line">      plugins: [</span><br><span class="line">             <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">                 filename: <span class="string">'[name].css'</span>,</span><br><span class="line">                 chunkFilename: <span class="string">'[id].css'</span></span><br><span class="line">             &#125;),</span><br><span class="line">           </span><br><span class="line">         ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="less-sass处理，添加前缀，消除冗余css"><a href="#less-sass处理，添加前缀，消除冗余css" class="headerlink" title="less/sass处理，添加前缀，消除冗余css"></a>less/sass处理，添加前缀，消除冗余css</h2><h6 id="1-处理less"><a href="#1-处理less" class="headerlink" title="1. 处理less"></a>1. 处理less</h6><p>&emsp;&emsp;下载转化less的loader： npm install less less-loader -D<br>&emsp;&emsp;配置如下：<br>    <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">        &#123;</span><br><span class="line">            test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">            use: [<span class="string">'style-loader'</span>,<span class="string">'css-loader'</span>,<span class="string">'less-loader'</span>],</span><br><span class="line">            exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">        &#125;</span><br><span class="line">     ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<h6 id="2-处理sass"><a href="#2-处理sass" class="headerlink" title="2. 处理sass"></a>2. 处理sass</h6><p>&emsp;&emsp;下载转化sass的loader： npm install node-sass sass-loader -D<br>&emsp;&emsp;配置如下：<br>    <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">        &#123;</span><br><span class="line">            test: <span class="regexp">/\.s(a|c)ss/</span>,</span><br><span class="line">            use: [<span class="string">'style-loader'</span>,<span class="string">'css-loader'</span>,<span class="string">'sass-loader'</span>],</span><br><span class="line">            exclude: <span class="regexp">/node_modules/</span></span><br><span class="line">        &#125;</span><br><span class="line">     ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<h6 id="3-自动添加css前缀"><a href="#3-自动添加css前缀" class="headerlink" title="3. 自动添加css前缀"></a>3. 自动添加css前缀</h6><p>&emsp;&emsp;CSS预处理器： postCss<br>&emsp;&emsp;下载预处理器loader：npm install postcss-loader autoprefixer -D<br>&emsp;&emsp;项目根目录下新增postcss配置文件： postcss.config.js，配置如下<br>    <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="built_in">require</span>(<span class="string">'autoprefixer'</span>)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;webpack配置如下<br>      <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">     rules: [</span><br><span class="line">          &#123;</span><br><span class="line">               test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">               use: [<span class="string">'style-loader'</span>,<span class="string">'css-loader'</span>,<span class="string">'postcss-loader'</span>],</span><br><span class="line">               exclude: <span class="regexp">/node_modules/</span></span><br><span class="line">          &#125;</span><br><span class="line">     ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;目前遇到项目中不显示前缀，但demo中就可以，还在排查原因</p>
<h6 id="4-消除冗余CSS代码"><a href="#4-消除冗余CSS代码" class="headerlink" title="4. 消除冗余CSS代码"></a>4. 消除冗余CSS代码</h6><p>&emsp;&emsp;下载依赖：npm install purifycss-webpack purify-css -D<br>&emsp;&emsp;paths参数用来设置需要分析的路径地址<br>&emsp;&emsp;配置如下：<br>    <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   </span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> glob = <span class="built_in">require</span>(<span class="string">'glob'</span>);</span><br><span class="line"><span class="keyword">const</span> PurifyCssPlugin = <span class="built_in">require</span>(<span class="string">'purifycss-webpack'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> PurifyCssPlugin(&#123;</span><br><span class="line">            paths: glob.sync(path.join(__dirname, <span class="string">'dist/*.html'</span>))</span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="SourceMap、babel、react环境配置"><a href="#SourceMap、babel、react环境配置" class="headerlink" title="SourceMap、babel、react环境配置"></a>SourceMap、babel、react环境配置</h2><h6 id="1-SourceMap"><a href="#1-SourceMap" class="headerlink" title="1. SourceMap"></a>1. SourceMap</h6><p>&emsp;&emsp;webpack 4.x版本默认在development环境下自动开启调试模式<br>&emsp;&emsp;webpack 3.采用sourceMap</p>
<pre><code><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">     ...,</span><br><span class="line">     devTool: <span class="string">'source-map'</span></span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>
</code></pre><h6 id="2-babel"><a href="#2-babel" class="headerlink" title="2. babel"></a>2. babel</h6><p>作用：</p>
<ul>
<li>babel用来编译js</li>
<li>能够轻松使用ESnext转化</li>
<li>支持jsx等语法</li>
</ul>
<p>&emsp;&emsp;babel核心模块： babel-loader @babel/core @babel/preset-env<br>&emsp;&emsp;配置如下：</p>
<pre><code><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">      rules: [</span><br><span class="line">           test: <span class="regexp">/\.jsx?$/</span>,</span><br><span class="line">           exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">           use: [&#123;</span><br><span class="line">                loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">                options: &#123;</span><br><span class="line">                     presets: [<span class="string">'@babel/preset-env'</span>]</span><br><span class="line">           &#125;]</span><br><span class="line">      ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre><h6 id="3-支持JSX语法"><a href="#3-支持JSX语法" class="headerlink" title="3. 支持JSX语法"></a>3. 支持JSX语法</h6><p>&emsp;&emsp;下载插件：npm install react react-dom @babel/preset-react -D<br>&emsp;&emsp;项目根目录下新建babel配置文件.babelrc.json<br>    <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> <span class="attr">"presets"</span>: [<span class="string">"@babel/preset-react"</span>],</span><br><span class="line">   <span class="attr">"env"</span>: &#123;</span><br><span class="line">     <span class="attr">"development"</span>: &#123;</span><br><span class="line">       <span class="attr">"presets"</span>: [[<span class="string">"@babel/preset-react"</span>, &#123; <span class="attr">"development"</span>: <span class="literal">true</span> &#125;]]</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h2 id="JSON配置、模块化设置、静态资源、插件"><a href="#JSON配置、模块化设置、静态资源、插件" class="headerlink" title="JSON配置、模块化设置、静态资源、插件"></a>JSON配置、模块化设置、静态资源、插件</h2><h6 id="1-使用模块化"><a href="#1-使用模块化" class="headerlink" title="1. 使用模块化"></a>1. 使用模块化</h6><p>&emsp;&emsp;以提取rules为例<br>&emsp;&emsp;新建rules模块文件webpack.rule.js<br>&emsp;&emsp;复制模块规则并通过module.exports导出<br>&emsp;&emsp;webpack配置文件引入如下<br>    <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ruleConfig = <span class="built_in">require</span>(<span class="string">'./webpack.rule'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: ruleConfig</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;在webpack中使用JSON</p>
<ul>
<li>webpack 3.X之前使用json-loader</li>
<li>webpack 3.X之后默认可自动识别</li>
</ul>
<h6 id="2-静态资源输出"><a href="#2-静态资源输出" class="headerlink" title="2. 静态资源输出"></a>2. 静态资源输出</h6><p>&emsp;&emsp;使用插件copy-webpack-plugin<br>&emsp;&emsp;配置如下<br>    <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> CopyWebpackPlugin = <span class="built_in">require</span>(<span class="string">'copy-webpack-plugin'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> CopyWebpackPlugin([</span><br><span class="line">           &#123;<span class="attr">from</span> : path.resolve(__dirname,<span class="string">'src/assets'</span>),<span class="attr">to</span>: <span class="string">'./assets'</span>&#125;,</span><br><span class="line">        ])</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;注：默认打入dist文件</p>
<h2 id="优雅使用第三方库、提取JS文件、优化"><a href="#优雅使用第三方库、提取JS文件、优化" class="headerlink" title="优雅使用第三方库、提取JS文件、优化"></a>优雅使用第三方库、提取JS文件、优化</h2><h6 id="1-使用第三方库"><a href="#1-使用第三方库" class="headerlink" title="1. 使用第三方库"></a>1. 使用第三方库</h6><p>&emsp;&emsp; ① 通过npm引入<br>&emsp;&emsp; ② 通过webpack内置插件ProvidePlugin,向全局暴露，使用方法如下<br>    <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack =  <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> webpack.ProvidePlugin(&#123;</span><br><span class="line">            $: <span class="string">'jquery'</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;通过ProvidePlugin引入与通过import引入的区别：</p>
<ul>
<li>通过import引入后，无论是否使用，都会被打包，这样会产生大量冗余js</li>
<li>ProvidePlugin只有在使用后才会打包</li>
</ul>
<h6 id="2-提取JS文件"><a href="#2-提取JS文件" class="headerlink" title="2. 提取JS文件"></a>2. 提取JS文件</h6><p>&emsp;&emsp;在webpack 3.x及之前使用CommonsChunkPlugin<br>&emsp;&emsp;webpack 4.x使用SplitChunksPlugin,使用如下<br>    <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    optimization: &#123;</span><br><span class="line">        splitChunks: &#123;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;最后，这套课程老肖录制于18年初，截至到现在已经有一些插件、loader或写法发生了变化，我已对其做了少量调整，即便如此，对于新手而言这一定是一个很棒的课。<br>&emsp;&emsp;这套课使自己快速入了webpack的门，每看一遍都有新收获，后面我将再写一篇由浅入深更全面、更深入的教程课，但老肖这套，唯有纸笔记之算自己才觉得可以算完结，好在我做到了。</p>

      
    </div>
      <div id="remark"></div>
    <div class="article-info article-info-index">
      
      <a href="/2019/07/11/webpackStudyQuick/" class="archive-article-date">
  	<time datetime="2019-07-11T04:19:24.000Z" itemprop="datePublished"><i class="icon-clock"></i>2019-07-11</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webpack/">webpack</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webpack-4-0/">webpack 4.0</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webpack教程/">webpack教程</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/个人博客/">个人博客</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-webpackOptimization" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/04/webpackOptimization/">webpack优化</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><abbr style="font-weight:bold;color:orange;font-size: 28px;">开发阶段</abbr></p>
<p>1 开启多核压缩JS<br>&emsp;&emsp;uglifyjs-webpack-plugin</p>
<p>2 兼容面板-webpack速度显示<br>&emsp;&emsp;speed-measure-webpack-plugin</p>
<p>3 开启通知面板<br>&emsp;&emsp;webpack-build-notifier</p>
<p>4 开启打包进度<br>&emsp;&emsp;progress-bar-webpack-plugin</p>
<p>5 开发面板更清晰<br>&emsp;&emsp;webpack-dashboard</p>
<p>6 开启窗口的标题<br>&emsp;&emsp;node-bash-title</p>
<p><abbr style="font-weight:bold;color:orange;font-size: 28px;">上线阶段</abbr></p>
<p>1.es6不需要编译</p>
<p>2.前端缓存负载<br>&emsp;&emsp;webpack-manifest-plugin   </p>
<p>3.真正的loading<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">new HtmlWebpackPlugin(&#123;</span><br><span class="line">    loading:&#123;</span><br><span class="line">        html: &apos;加载中......&apos;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<pre><code>```html
 &lt;%= htmlWebpackPlugin.options.loading.html %&gt; 
``` 
</code></pre><p>4.分析打包结果<br>&emsp;&emsp;bundlesize<br>&emsp;&emsp;webpack-chart</p>
<p>5.文件压缩<br>&emsp;&emsp;uglifyjs-webpack-plugin<br>&emsp;&emsp;webpack-parallel-uglify-plugin</p>
<p>6.happypack</p>
<p>7.devtool</p>
<p>8.cache-loader      </p>

      
    </div>
      <div id="remark"></div>
    <div class="article-info article-info-index">
      
      <a href="/2019/07/04/webpackOptimization/" class="archive-article-date">
  	<time datetime="2019-07-04T09:36:29.000Z" itemprop="datePublished"><i class="icon-clock"></i>2019-07-04</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webpack/">webpack</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webpack优化/">webpack优化</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端打包工具/">前端打包工具</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/个人博客/">个人博客</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-applets-rich-text" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/05/27/applets-rich-text/">小程序之rich-text如何生成渲染DOM</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&emsp;&emsp; 今天要吐血紧急发一篇关于小程序富文本渲染的<br>&emsp;&emsp; 之所以吐血,是因为小程序wxs语法出错无法打印，无法调试，更无从知道原因<br>&emsp;&emsp; 根据字符串,解析正则,此方法不是万能的，但，完全可以帮你省很大力气,当然它目前仅适用我的项目,稍改动一下即可</p>
<p>&emsp;&emsp; 以下为 wxs 文件内,module=m1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    function matchEmoticon(content,regStr)&#123;</span><br><span class="line">        var node = [&#123;</span><br><span class="line">              type: &apos;node&apos;,</span><br><span class="line">              name: &apos;span&apos;,</span><br><span class="line">              children: []</span><br><span class="line">          &#125;];</span><br><span class="line"></span><br><span class="line">          if(getRegExp(regStr,&quot;g&quot;).test(content)) &#123;</span><br><span class="line">              var contentCopy =  content;</span><br><span class="line">              while (contentCopy.length &gt; 0 &amp;&amp; getRegExp(regStr,&quot;g&quot;).test(contentCopy))&#123;</span><br><span class="line"></span><br><span class="line">                  var result = getRegExp(regStr).exec(contentCopy);</span><br><span class="line">                  var searchIndex = contentCopy.search(getRegExp(regStr));</span><br><span class="line"></span><br><span class="line">                  if(searchIndex == 0)&#123;</span><br><span class="line">                      node[0].children.push(&#123;</span><br><span class="line">                          type: &quot;node&quot;,</span><br><span class="line">                          name: &apos;img&apos;,</span><br><span class="line">                          attrs : &#123; &quot;src&quot;: &quot;https://www.mifengapp.com/resources/emoticon/&quot; +  result[1]  +&quot;.png&quot;,</span><br><span class="line">                          style : &quot;width: 20px;height:20px;padding: 0 1px&quot; &#125;,</span><br><span class="line">                          children: []</span><br><span class="line">                      &#125;);</span><br><span class="line"></span><br><span class="line">                    contentCopy = contentCopy.slice(result[0].length);</span><br><span class="line"></span><br><span class="line">                  &#125;else&#123;</span><br><span class="line">                     node[0].children.push(&#123;</span><br><span class="line">                          type: &quot;node&quot;,</span><br><span class="line">                          name: &apos;span&apos;,</span><br><span class="line">                          children: [&#123;</span><br><span class="line">                              type: &apos;text&apos;,</span><br><span class="line">                              text: contentCopy.slice(0,searchIndex)</span><br><span class="line">                          &#125;]</span><br><span class="line">                      &#125;);</span><br><span class="line"></span><br><span class="line">                      contentCopy = contentCopy.slice(searchIndex);</span><br><span class="line">                  &#125;</span><br><span class="line">             &#125;</span><br><span class="line"></span><br><span class="line">             if(contentCopy.length &gt; 0)&#123;</span><br><span class="line">                node[0].children.push(&#123;</span><br><span class="line">                    type: &quot;node&quot;,</span><br><span class="line">                    name: &apos;span&apos;,</span><br><span class="line">                    children: [&#123;</span><br><span class="line">                        type: &apos;text&apos;,</span><br><span class="line">                        text: contentCopy</span><br><span class="line">                    &#125;]</span><br><span class="line">                &#125;);</span><br><span class="line">             &#125;</span><br><span class="line"></span><br><span class="line">          &#125;else&#123;</span><br><span class="line">              node[0].children.push(&#123;</span><br><span class="line">                  type: &apos;node&apos;,</span><br><span class="line">                  name: &apos;span&apos;,</span><br><span class="line">                  children: [&#123;</span><br><span class="line">                      type: &apos;text&apos;,</span><br><span class="line">                      text: content</span><br><span class="line">                  &#125;]</span><br><span class="line">              &#125;)</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          return node;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    matchEmoticon: matchEmoticon</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp; 以下为 wxml文件内调用上述方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;rich-text nodes=&quot;&#123;&#123;m1.matchEmoticon(&quot;监督检查吃顿饭呢看到基础酒店吧地方好的宝贝底线很好的716969797979SSS1&quot;,&quot;[\uE000]([\d]+)[\uE001]&quot;)&#125;&#125;&quot;&gt;&lt;/rich-text&gt;</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;注：<br>&emsp;&emsp; ① 为什么不用ES6？<br>&emsp;&emsp;&emsp;&emsp;&emsp;wxs内暂不支持ES6<br>&emsp;&emsp; ② 为什么使用getRegExp而不是RegExp或字面量创建？<br>&emsp;&emsp;&emsp;&emsp;&emsp;小程序内正则使用封装的getRegExp,否则会无法解析<br>&emsp;&emsp; ③ 为什么不提取getRegExp(regStr,”g”)做公共变量?<br>&emsp;&emsp;&emsp;&emsp;&emsp;不知道内部如何封装的，提取后会无法解析<br>&emsp;&emsp; ④ 为什么用了exec还要用search?<br>&emsp;&emsp;&emsp;&emsp;&emsp;因为需要获取下标值,虽然exec的返回值result有result[0]和result[1],但是没有result.index<br>&emsp;&emsp; ⑤ 代码异常了会怎样？<br>&emsp;&emsp;&emsp;&emsp;&emsp;内部应该做了捕获处理,会直接返回空</p>
<p>&emsp;&emsp; 希望这些问题后续能够解决，毕竟不太优雅.</p>

      
    </div>
      <div id="remark"></div>
    <div class="article-info article-info-index">
      
      <a href="/2019/05/27/applets-rich-text/" class="archive-article-date">
  	<time datetime="2019-05-27T03:29:09.000Z" itemprop="datePublished"><i class="icon-clock"></i>2019-05-27</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rich-text/">rich-text</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端/">前端</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/原创/">原创</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/微信小程序/">微信小程序</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/个人博客/">个人博客</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-regexp" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/03/13/regexp/">前端源码里的那些正则</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&emsp;&emsp; 通读了一遍老姚的<a href="https://zhuanlan.zhihu.com/p/29707385" target="_blank" rel="noopener">《JavaScript 正则表达式迷你书》</a>个人收获极多。<br>&emsp;&emsp; 忽想到之前学源码时，那些晦涩难懂的正则表达式,或者防不胜防的『骚操作』,我遂决定将其摘出，细细品味。</p>
<h3 id="jQuery"><a href="#jQuery" class="headerlink" title="jQuery"></a>jQuery</h3><pre><code>1. 驼峰命名

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">var camelizeRE = /-(\w)/g;</span><br><span class="line">var camelize = cached(function (str) &#123;</span><br><span class="line">  return str.replace(camelizeRE, function (_, c) &#123; return c ? c.toUpperCase() : &apos;&apos;; &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">/* cached为缓存函数，可忽略，核心代码修改如下 */</span><br><span class="line"></span><br><span class="line">var camelizeRE = /-(\w)/g;</span><br><span class="line">var camelize = function (str) &#123;</span><br><span class="line">  return str.replace(camelizeRE, function (_, c) &#123; return c ? c.toUpperCase() : &apos;&apos;; &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> *  ① camelizeRE正则捕获所有连字符[-]后的首个元素</span><br><span class="line"> *  ② _ 为符合正则的部分,c为正则$1[第一个括号包裹的内容]捕获到的元素，即我们的目标子符</span><br><span class="line"> *  ③ 若该字符存在,则大写</span><br><span class="line"> */</span><br></pre></td></tr></table></figure>
</code></pre>
      
    </div>
      <div id="remark"></div>
    <div class="article-info article-info-index">
      
      <a href="/2019/03/13/regexp/" class="archive-article-date">
  	<time datetime="2019-03-13T03:20:49.000Z" itemprop="datePublished"><i class="icon-clock"></i>2019-03-13</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端/">前端</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/正则/">正则</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/源码/">源码</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/个人博客/">个人博客</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-gooleWorkPrinciple" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/20/gooleWorkPrinciple/">史上最全！图解浏览器的工作原理</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h6 id="译注：本文作者FrontEndInDepth"><a href="#译注：本文作者FrontEndInDepth" class="headerlink" title="译注：本文作者FrontEndInDepth"></a>译注：本文作者<a href="https://zhuanlan.zhihu.com/p/47407398" target="_blank" rel="noopener">FrontEndInDepth</a></h6><p><img src="https://static001.geekbang.org/resource/image/db/0f/db0269ec53a84b9578300b6cfaa42f0f.jpg" alt=""></p>
<p>&emsp;&emsp;可能每一个前端工程师都想要理解浏览器的工作原理。</p>
<p>&emsp;&emsp;我们希望知道从在浏览器地址栏中输入 url 到页面展现的短短几秒内浏览器究竟做了什么；</p>
<p>&emsp;&emsp;我们希望了解平时常常听说的各种代码优化方案是究竟为什么能起到优化的作用；</p>
<p>&emsp;&emsp;我们希望更细化的了解浏览器的渲染流程。</p>
<p>&emsp;&emsp;<abbr style="font-size: 28px;color:#333">浏览器的多进程架构</abbr></p>
<p>&emsp;&emsp;一个好的程序常常被划分为几个相互独立又彼此配合的模块，浏览器也是如此，以 Chrome 为例，它由多个进程组成，每个进程都有自己核心的职责，它们相互配合完成浏览器的整体功能，每个进程中又包含多个线程，一个进程内的多个线程也会协同工作，配合完成所在进程的职责。</p>
<p>&emsp;&emsp;对一些前端开发同学来说，进程和线程的概念可能会有些模糊，为了更好的理解浏览器的多进程架构，这里我们简单讨论一下进程和线程。</p>
<p>&emsp;&emsp;<abbr style="font-size: 28px;color:#333">进程（process）和线程（thread）</abbr></p>
<p><img src="https://static.geekbang.org/infoq/5bee594c329b3.png" alt=""></p>
<p>&emsp;&emsp;进程就像是一个有边界的生产厂间，而线程就像是厂间内的一个个员工，可以自己做自己的事情，也可以相互配合做同一件事情。</p>
<p>&emsp;&emsp;当我们启动一个应用，计算机会创建一个进程，操作系统会为进程分配一部分内存，应用的所有状态都会保存在这块内存中，应用也许还会创建多个线程来辅助工作，这些线程可以共享这部分内存中的数据。如果应用关闭，进程会被终结，操作系统会释放相关内存。</p>
<p>&emsp;&emsp;一个进程还可以要求操作系统生成另一个进程来执行不同的任务，系统会为新的进程分配独立的内存，两个进程之间可以使用 IPC （Inter Process Communication）进行通信。很多应用都会采用这样的设计，如果一个工作进程反应迟钝，重启这个进程不会影响应用其它进程的工作。</p>
<p>&emsp;&emsp;<abbr style="font-size: 28px;color:#333">浏览器的架构</abbr></p>
<p>&emsp;&emsp;有了上面的知识做铺垫，我们可以更合理的讨论浏览器的架构了，其实如果要开发一个浏览器，它可以是单进程多线程的应用，也可以是使用 IPC 通信的多进程应</p>
<p><img src="https://static.geekbang.org/infoq/5bee5b825f797.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">浏览器的架构模型</abbr></p>
<p>&emsp;&emsp;不同浏览器采用了不同的架构模式，这里并不存在标准，本文以 Chrome 为例进行说明 ：</p>
<p>&emsp;&emsp;Chrome 采用多进程架构，其顶层存在一个 Browser process 用以协调浏览器的其它进程。</p>
<p><img src="https://static.geekbang.org/infoq/5bee5bceb417a.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">Chrome 的不同进程</abbr></p>
<p>&emsp;&emsp;具体说来，Chrome 的主要进程及其职责如下：</p>
<p>&emsp;&emsp;Browser Process：</p>
<p>&emsp;&emsp;- 负责包括地址栏，书签栏，前进后退按钮等部分的工作；</p>
<p>&emsp;&emsp;- 负责处理浏览器的一些不可见的底层操作，比如网络请求和文件访问；</p>
<p>&emsp;&emsp;Renderer Process：</p>
<p>&emsp;&emsp;- 负责一个 tab 内关于网页呈现的所有事情</p>
<p>&emsp;&emsp;Plugin Process：</p>
<p>&emsp;&emsp;- 负责控制一个网页用到的所有插件，如 flash GPU Process</p>
<p>&emsp;&emsp;- 负责处理 GPU 相关的任务</p>
<p><img src="https://static.geekbang.org/infoq/5bee5c111b0cd.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">不同进程负责的浏览器区域示意图</abbr></p>
<p>&emsp;&emsp;Chrome 还为我们提供了「任务管理器」，供我们方便的查看当前浏览器中运行的所有进程及每个进程占用的系统资源，右键单击还可以查看更多类别信息。</p>
<p>&emsp;&emsp;通过「页面右上角的三个点点点 — 更多工具 — 任务管理器」即可打开相关面板。</p>
<p>&emsp;&emsp;<abbr style="font-size: 24px;color:#333">Chrome 多进程架构的优缺点</abbr></p>
<p>&emsp;&emsp;<abbr style="font-weight:bold;color:#333;">优点</abbr></p>
<p>&emsp;&emsp;某一渲染进程出问题不会影响其他进程</p>
<p>&emsp;&emsp;更为安全，在系统层面上限定了不同进程的权限</p>
<p>&emsp;&emsp;<abbr style="font-weight:bold;color:#333;">缺点</abbr></p>
<p>&emsp;&emsp;由于不同进程间的内存不共享，不同进程的内存常常需要包含相同的内容。</p>
<p>&emsp;&emsp;为了节省内存，Chrome 限制了最多的进程数，最大进程数量由设备的内存和 CPU 能力决定，当达到这一限制时，新打开的 Tab 会共用之前同一个站点的渲染进程。</p>
<p>&emsp;&emsp;测试了一下在 Chrome 中打开不断打开知乎首页，在 Mac i5 8g 上可以启动四十多个渲染进程，之后新打开 tab 会合并到已有的渲染进程中。</p>
<p>&emsp;&emsp;Chrome 把浏览器不同程序的功能看做服务，这些服务可以方便的分割为不同的进程或者合并为一个进程。以 Broswer Process 为例，如果 Chrome 运行在强大的硬件上，它会分割不同的服务到不同的进程，这样 Chrome 整体的运行会更加稳定，但是如果 Chrome 运行在资源贫瘠的设备上，这些服务又会合并到同一个进程中运行，这样可以节省内存，示意图如下。</p>
<p>&emsp;&emsp;<abbr style="font-size: 24px;color:#333">iframe 的渲染 – Site Isolation</abbr></p>
<p>&emsp;&emsp;在上面的进程图中我们还可以看到一些进程下还存在着 Subframe，这就是 Site Isolation 机制作用的结果。</p>
<p>&emsp;&emsp;Site Isolation 机制从 Chrome 67 开始默认启用。这种机制允许在同一个 Tab 下的跨站 iframe 使用单独的进程来渲染，这样会更为安全。</p>
<p><img src="https://static.geekbang.org/infoq/5bee72864411e.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">iframe 会采用不同的渲染进程</abbr></p>
<p>&emsp;&emsp;Site Isolation 被大家看做里程碑式的功能， 其成功实现是多年工程努力的结果。Site Isolation 不是简单的叠加多个进程。这种机制在底层改变了 iframe 之间通信的方法，Chrome 的其它功能都需要做对应的调整，比如说 devtools 需要相应的支持，甚至 Ctrl + F 也需要支持。</p>
<p>&emsp;&emsp;介绍完了浏览器的基本架构模式，接下来我们看看一个常见的导航过程对浏览器来说究竟发生了什么。</p>
<p>&emsp;&emsp;<abbr style="font-size: 24px;color:#333">导航过程发生了什么</abbr></p>
<p>&emsp;&emsp;也许大多数人使用 Chrome 最多的场景就是在地址栏输入关键字进行搜索或者输入地址导航到某个网站，我们来看看浏览器是怎么看待这个过程的。</p>
<p>&emsp;&emsp;我们知道浏览器 Tab 外的工作主要由 Browser Process 掌控，Browser Process 又对这些工作进一步划分，使用不同线程进行处理：</p>
<p>&emsp;&emsp;- UI thread ： 控制浏览器上的按钮及输入框；</p>
<p>&emsp;&emsp;- network thread: 处理网络请求，从网上获取数据；</p>
<p>&emsp;&emsp;- storage thread: 控制文件等的访问；</p>
<p><img src="https://static.geekbang.org/infoq/5bee73021bd91.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">浏览器主进程中的不同线程</abbr></p>
<p>&emsp;&emsp;回到我们的问题，当我们在浏览器地址栏中输入文字，并点击回车获得页面内容的过程在浏览器看来可以分为以下几步：</p>
<p>&emsp;&emsp;1. 处理输入</p>
<p>&emsp;&emsp;UI thread 需要判断用户输入的是 URL 还是 query；</p>
<p>&emsp;&emsp;2. 开始导航</p>
<p>&emsp;&emsp;当用户点击回车键，UI thread 通知 network thread 获取网页内容，并控制 tab 上的 spinner 展现，表示正在加载中。</p>
<p>&emsp;&emsp;network thread 会执行 DNS 查询，随后为请求建立 TLS 连接。</p>
<p><img src="https://static.geekbang.org/infoq/5bee737f56ada.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">UI thread 通知 Network thread 加载相关信息</abbr></p>
<p>&emsp;&emsp;如果 network thread 接收到了重定向请求头如 301，network thread 会通知 UI thread 服务器要求重定向，之后，另外一个 URL 请求会被触发</p>
<p>&emsp;&emsp;3. 读取响应</p>
<p>&emsp;&emsp;当请求响应返回的时候，network thread 会依据 Content-Type 及 MIME Type sniffing 判断响应内容的格式。</p>
<p><img src="https://static.geekbang.org/infoq/5bee73e636686.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">判断响应内容的格式</abbr></p>
<p>&emsp;&emsp;如果响应内容的格式是 HTML ，下一步将会把这些数据传递给 renderer process，如果是 zip 文件或者其它文件，会把相关数据传输给下载管理器。</p>
<p>&emsp;&emsp;Safe Browsing 检查也会在此时触发，如果域名或者请求内容匹配到已知的恶意站点，network thread 会展示一个警告页。此外 CORB 检测也会触发确保敏感数据不会被传递给渲染进程。</p>
<p><img src="https://static.geekbang.org/infoq/5bee741450e1b.png" alt=""></p>
<p>&emsp;&emsp;4. 查找渲染进程</p>
<p>&emsp;&emsp;当上述所有检查完成，network thread 确信浏览器可以导航到请求网页，network thread 会通知 UI thread 数据已经准备好，UI thread 会查找到一个 renderer process 进行网页的渲染。</p>
<p><img src="https://static.geekbang.org/infoq/5bee743b5ffc8.png" alt=""></p>
<p>&emsp;&emsp;收到 Network thread 返回的数据后，UI thread 查找相关的渲染进程</p>
<p>&emsp;&emsp;由于网络请求获取响应需要时间，这里其实还存在着一个加速方案。当 UI thread 发送 URL 请求给 network thread 时，浏览器其实已经知道了将要导航到那个站点。UI thread 会并行的预先查找和启动一个渲染进程，如果一切正常，当 network thread 接收到数据时，渲染进程已经准备就绪了，但是如果遇到重定向，准备好的渲染进程也许就不可用了，这时候就需要重启一个新的渲染进程。</p>
<p>&emsp;&emsp;5. 确认导航</p>
<p>&emsp;&emsp;进过了上述过程，数据以及渲染进程都可用了， Browser Process 会给 renderer process 发送 IPC 消息来确认导航，一旦 Browser Process 收到 renderer process 的渲染确认消息，导航过程结束，页面加载过程开始。</p>
<p>&emsp;&emsp;此时，地址栏会更新，展示出新页面的网页信息。history tab 会更新，可通过返回键返回导航来的页面，为了让关闭 tab 或者窗口后便于恢复，这些信息会存放在硬盘中。</p>
<p><img src="https://static.geekbang.org/infoq/5bee746f304b8.png" alt=""></p>
<p>&emsp;&emsp;6. 额外的步骤</p>
<p>&emsp;&emsp;一旦导航被确认，renderer process 会使用相关的资源渲染页面，下文中我们将重点介绍渲染流程。当 renderer process 渲染结束（渲染结束意味着该页面内的所有的页面，包括所有 iframe 都触发了 onload 时），会发送 IPC 信号到 Browser process， UI thread 会停止展示 tab 中的 spinner。</p>
<p><img src="https://static.geekbang.org/infoq/5bee74a42b6e7.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">Renderer Process 发送 IPC 消息通知 browser process 页面已经加载完成。</abbr></p>
<p>&emsp;&emsp;当然上面的流程只是网页首帧渲染完成，在此之后，客户端依旧可下载额外的资源渲染出新的视图。</p>
<p>&emsp;&emsp;在这里我们可以明确一点，所有的 JS 代码其实都由 renderer Process 控制的，所以在你浏览网页内容的过程大部分时候不会涉及到其它的进程。不过也许你也曾经监听过 beforeunload 事件，这个事件再次涉及到 Browser Process 和 renderer Process 的交互，当当前页面关闭时（关闭 Tab ，刷新等等），Browser Process 需要通知 renderer Process 进行相关的检查，对相关事件进行处理。</p>
<p><img src="https://static.geekbang.org/infoq/5bee74e2e0b86.png" alt=""></p>
<p>&emsp;&emsp;浏览器进程发送 IPC 消息给渲染进程，通知要离开当前网站了</p>
<p>&emsp;&emsp;如果导航由 renderer process 触发（比如在用户点击某链接，或者 JS 执行 window.location = “<a href="http://newsite.com" target="_blank" rel="noopener">http://newsite.com</a>“ ） renderer process 会首先检查是否有 beforeunload 事件处理器，导航请求由 renderer process 传递给 Browser process。</p>
<p>&emsp;&emsp;如果导航到新的网站，会启用一个新的 render process 来处理新页面的渲染，老的进程会留下来处理类似 unload 等事件。</p>
<p>&emsp;&emsp;关于页面的生命周期，更多内容可参考 Page Lifecycle API 。</p>
<p><img src="https://static.geekbang.org/infoq/5bee75121fb11.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">浏览器进程发送 IPC 消息到新的渲染进程通知渲染新的页面，同时通知旧的渲染进程卸载。</abbr></p>
<p>&emsp;&emsp;除了上述流程，有些页面还拥有 Service Worker （服务工作线程），Service Worker 让开发者对本地缓存及判断何时从网络上获取信息有了更多的控制权，如果 Service Worker 被设置为从本地 cache 中加载数据，那么就没有必要从网上获取更多数据了。</p>
<p>&emsp;&emsp;值得注意的是 service worker 也是运行在渲染进程中的 JS 代码，因此对于拥有 Service Worker 的页面，上述流程有些许的不同。</p>
<p>&emsp;&emsp;当有 Service Worker 被注册时，其作用域会被保存，当有导航时，network thread 会在注册过的 Service Worker 的作用域中检查相关域名，如果存在对应的 Service worker，UI thread 会找到一个 renderer process 来处理相关代码，Service Worker 可能会从 cache 中加载数据，从而终止对网络的请求，也可能从网上请求新的数据。</p>
<p><img src="https://static.geekbang.org/infoq/5bee753dde9e7.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">Service Worker 依据具体情形做处理。</abbr></p>
<p>&emsp;&emsp;如果 Service Worker 最终决定通过网上获取数据，Browser 进程 和 renderer 进程的交互其实会延后数据的请求时间 。Navigation Preload 是一种与 Service Worker 并行的加速加载资源的机制，服务端通过请求头可以识别这类请求，而做出相应的处理。</p>
<p>&emsp;&emsp;<abbr style="font-size: 28px;color:#333">渲染进程是如何工作的？</abbr></p>
<p>&emsp;&emsp;渲染进程几乎负责 Tab 内的所有事情，渲染进程的核心目的在于转换 HTML CSS JS 为用户可交互的 web 页面。渲染进程中主要包含以下线程：</p>
<p><img src="https://static.geekbang.org/infoq/5bee75a69dacf.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">渲染进程包含的线程</abbr></p>
<p>&emsp;&emsp;1. 主线程 Main thread</p>
<p>&emsp;&emsp;2. 工作线程 Worker thread</p>
<p>&emsp;&emsp;3. 排版线程 Compositor thread</p>
<p>&emsp;&emsp;4. 光栅线程 Raster thread</p>
<p>&emsp;&emsp;后文我们将逐步介绍不同线程的职责，在此之前我们先看看渲染的流程。</p>
<p>&emsp;&emsp;1. 构建 DOM</p>
<p>&emsp;&emsp;当渲染进程接收到导航的确认信息，开始接受 HTML 数据时，主线程会解析文本字符串为 DOM。</p>
<p>&emsp;&emsp;渲染 html 为 DOM 的方法由 HTML Standard 定义。</p>
<p>&emsp;&emsp;2. 加载次级的资源</p>
<p>&emsp;&emsp;网页中常常包含诸如图片，CSS，JS 等额外的资源，这些资源需要从网络上或者 cache 中获取。主进程可以在构建 DOM 的过程中会逐一请求它们，为了加速 preload scanner 会同时运行，如果在 html 中存在 <img> <link> 等标签，preload scanner 会把这些请求传递给 Browser process 中的 network thread 进行相关资源的下载。</p>
<p>&emsp;&emsp;3.JS 的下载与执行</p>
<p>&emsp;&emsp;当遇到 script 标签时，渲染进程会停止解析 HTML，而去加载，解析和执行 JS 代码，停止解析 html 的原因在于 JS 可能会改变 DOM 的结构（使用诸如 documwnt.write()等 API）。</p>
<p>&emsp;&emsp;不过开发者其实也有多种方式来告知浏览器应对如何应对某个资源，比如说如果在 script 标签上添加了 async 或 defer 等属性，浏览器会异步的加载和执行 JS 代码，而不会阻塞渲染。更多的方法可参考 Resource Prioritization – Getting the Browser to Help You。</p>
<p>&emsp;&emsp;4. 样式计算</p>
<p>&emsp;&emsp;仅仅渲染 DOM 还不足以获知页面的具体样式，主进程还会基于 CSS 选择器解析 CSS 获取每一个节点的最终的计算样式值。即使不提供任何 CSS，浏览器对每个元素也会有一个默认的样式。</p>
<p><img src="https://static.geekbang.org/infoq/5bee778add037.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">渲染进程主线程计算每一个元素节点的最终样式值</abbr></p>
<p>&emsp;&emsp;5. 获取布局</p>
<p>&emsp;&emsp;想要渲染一个完整的页面，除了获知每个节点的具体样式，还需要获知每一个节点在页面上的位置，布局其实是找到所有元素的几何关系的过程。其具体过程如下：</p>
<p>&emsp;&emsp;通过遍历 DOM 及相关元素的计算样式，主线程会构建出包含每个元素的坐标信息及盒子大小的布局树。布局树和 DOM 树类似，但是其中只包含页面可见的元素，如果一个元素设置了 display:none ，这个元素不会出现在布局树上，伪元素虽然在 DOM 树上不可见，但是在布局树上是可见的。</p>
<p><img src="https://static.geekbang.org/infoq/5bee77ba30185.png" alt=""></p>
<p>&emsp;&emsp;6. 绘制各元素</p>
<p>&emsp;&emsp;即使知道了不同元素的位置及样式信息，我们还需要知道不同元素的绘制先后顺序才能正确绘制出整个页面。在绘制阶段，主线程会遍历布局树以创建绘制记录。绘制记录可以看做是记录各元素绘制先后顺序的笔记。</p>
<p><img src="https://static.geekbang.org/infoq/5bee77f679b4d.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">主线程依据布局树构建绘制记录</abbr></p>
<p>&emsp;&emsp;7. 合成帧</p>
<p>&emsp;&emsp;熟悉 PS 等绘图软件的童鞋肯定对图层这一概念不陌生，现代 Chrome 其实利用了这一概念来组合不同的层。</p>
<p>&emsp;&emsp;复合是一种分割页面为不同的层，并单独栅格化，随后组合为帧的技术。不同层的组合由 compositor 线程（合成器线程）完成。</p>
<p>&emsp;&emsp;主线程会遍历布局树来创建层树（layer tree），添加了 will-change CSS 属性的元素，会被看做单独的一层。</p>
<p><img src="https://static.geekbang.org/infoq/5bee782c64422.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">主线程遍历布局树生成层树</abbr></p>
<p>&emsp;&emsp;你可能会想给每一个元素都添加上 will-change，不过组合过多的层也许会比在每一帧都栅格化页面中的某些小部分更慢。为了更合理的使用层，可参考 坚持仅合成器的属性和管理层计数 。</p>
<p>&emsp;&emsp;一旦层树被创建，渲染顺序被确定，主线程会把这些信息通知给合成器线程，合成器线程会栅格化每一层。有的层的可以达到整个页面的大小，因此，合成器线程将它们分成多个磁贴，并将每个磁贴发送到栅格线程，栅格线程会栅格化每一个磁贴并存储在 GPU 显存中。</p>
<p><img src="https://static.geekbang.org/infoq/5bee78655ed69.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">栅格线程会栅格化每一个磁贴并存储在 GPU 显存中</abbr></p>
<p>&emsp;&emsp;一旦磁贴被光栅化，合成器线程会收集称为绘制四边形的磁贴信息以创建合成帧。</p>
<p>&emsp;&emsp;合成帧随后会通过 IPC 消息传递给浏览器进程，由于浏览器的 UI 改变或者其它拓展的渲染进程也可以添加合成帧，这些合成帧会被传递给 GPU 用以展示在屏幕上，如果滚动发生，合成器线程会创建另一个合成帧发送给 GPU。</p>
<p><img src="https://static.geekbang.org/infoq/5bee789fac854.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">合成器线程会发送合成帧给 GPU 渲染</abbr></p>
<p>&emsp;&emsp;合成器的优点在于，其工作无关主线程，合成器线程不需要等待样式计算或者 JS 执行，这就是为什么合成器相关的动画 最流畅，如果某个动画涉及到布局或者绘制的调整，就会涉及到主线程的重新计算，自然会慢很多。</p>
<p>&emsp;&emsp;<abbr style="font-size: 28px;color:#333">浏览器对事件的处理</abbr></p>
<p>&emsp;&emsp;浏览器通过对不同事件的处理来满足各种交互需求，这一部分我们一起看看从浏览器的视角，事件是什么，在此我们先主要考虑鼠标事件。</p>
<p>&emsp;&emsp;在浏览器的看来，用户的所有手势都是输入，鼠标滚动，悬置，点击等等都是。</p>
<p>&emsp;&emsp;当用户在屏幕上触发诸如 touch 等手势时，首先收到手势信息的是 Browser process， 不过 Browser process 只会感知到在哪里发生了手势，对 tab 内内容的处理是还是由渲染进程控制的。</p>
<p>&emsp;&emsp;事件发生时，浏览器进程会发送事件类型及相应的坐标给渲染进程，渲染进程随后找到事件对象并执行所有绑定在其上的相关事件处理函数。</p>
<p><img src="https://static.geekbang.org/infoq/5bee799b19700.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">事件从浏览器进程传送给渲染进程</abbr></p>
<p>&emsp;&emsp;前文中，我们提到过合成器可以独立于主线程之外通过合成栅格化层平滑的处理滚动。如果页面中没有绑定相关事件，组合器线程可以独立于主线程创建组合帧。如果页面绑定了相关事件处理器，主线程就不得不出来工作了。这时候合成器线程会怎么处理呢？</p>
<p>&emsp;&emsp;这里涉及到一个专业名词「理解非快速滚动区域（non-fast scrollable region）」由于执行 JS 是主线程的工作，当页面合成时，合成器线程会标记页面中绑定有事件处理器的区域为 non-fast scrollable region ，如果存在这个标注，合成器线程会把发生在此处的事件发送给主线程，如果事件不是发生在这些区域，合成器线程则会直接合成新的帧而不用等到主线程的响应。</p>
<p><img src="https://static.geekbang.org/infoq/5bee79c0bec31.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">涉及 non-fast scrollable region 的事件，合成器线程会通知主线程进行相关处理。</abbr></p>
<p>&emsp;&emsp;web 开发中常用的事件处理模式是事件委托，基于事件冒泡，我们常常在最顶层绑定事件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.body.addEventListener(<span class="string">'touchstart'</span>,</span><br><span class="line">event =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (event.target === area) &#123;</span><br><span class="line">        event.preventDefault();</span><br><span class="line">    &#125;</span><br><span class="line">   &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;上述做法很常见，但是如果从浏览器的角度看，整个页面都成了 non-fast scrollable region 了。</p>
<p>&emsp;&emsp;这意味着即使操作的是页面无绑定事件处理器的区域，每次输入时，合成器线程也需要和主线程通信并等待反馈，流畅的合成器独立处理合成帧的模式就失效了。</p>
<p><img src="https://static.geekbang.org/infoq/5bee7a0edfb3e.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">由于事件绑定在最顶部，整个页面都成为了 non-fast scrollable region。</abbr></p>
<p>&emsp;&emsp;为了防止这种情况，我们可以为事件处理器传递 passive: true 做为参数，这样写就能让浏览器即监听相关事件，又让组合器线程在等等主线程响应前构建新的组合帧。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.body.addEventListener(<span class="string">'touchstart'</span>,</span><br><span class="line">event =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (event.target === area) &#123;</span><br><span class="line">        event.preventDefault()</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;, &#123;<span class="attr">passive</span>: <span class="literal">true</span>&#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;不过上述写法可能又会带来另外一个问题，假设某个区域你只想要水平滚动，使用 passive: true 可以实现平滑滚动，但是垂直方向的滚动可能会先于event.preventDefault()发生，此时可以通过 event.cancelable 来防止这种情况。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.body.addEventListener(<span class="string">'pointermove'</span>, event =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (event.cancelable) &#123;</span><br><span class="line">        event.preventDefault(); <span class="comment">// block the native scroll</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        *  do what you want the application to do here</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;, &#123;<span class="attr">passive</span>: <span class="literal">true</span>&#125;);</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;也可以使用 css 属性 touch-action 来完全消除事件处理器的影响，如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#area &#123;</span><br><span class="line">  touch-action: pan-x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<abbr style="font-size: 24px;color:#333">查找到事件对象</abbr></p>
<p>&emsp;&emsp;当组合器线程发送输入事件给主线程时，主线程首先会进行命中测试（hit test）来查找对应的事件目标，命中测试会基于渲染过程中生成的绘制记录（ paint records ）查找事件发生坐标下存在的元素。</p>
<p><img src="https://static.geekbang.org/infoq/5bee7a6eabda8.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">主线程依据绘制记录查找事件相关元素。</abbr></p>
<p>&emsp;&emsp;<abbr style="font-size: 24px;color:#333">事件的优化</abbr></p>
<p>&emsp;&emsp;一般我们屏幕的刷新速率为 60fps，但是某些事件的触发量会不止这个值，出于优化的目的，Chrome 会合并连续的事件 (如 wheel, mousewheel, mousemove, pointermove, touchmove )，并延迟到下一帧渲染时候执行 。</p>
<p>&emsp;&emsp;而如 keydown, keyup, mouseup, mousedown, touchstart, 和 touchend 等非连续性事件则会立即被触发。</p>
<p><img src="https://static.geekbang.org/infoq/5bee7aa6246fb.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">Chrome 会合并连续事件到下一帧触发。</abbr></p>
<p>&emsp;&emsp;合并事件虽然能提示性能，但是如果你的应用是绘画等，则很难绘制一条平滑的曲线了，此时可以使用 getCoalescedEvents API 来获取组合的事件。示例代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'pointermove'</span>, event =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> events = event.getCoalescedEvents();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> event <span class="keyword">of</span> events) &#123;</span><br><span class="line">        <span class="keyword">const</span> x = event.pageX;</span><br><span class="line">        <span class="keyword">const</span> y = event.pageY;</span><br><span class="line">        <span class="comment">// draw a line using x and y coordinates.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="https://static.geekbang.org/infoq/5bee7ad900bf5.png" alt=""></p>
<p>&emsp;&emsp;感谢作者,真是好文</p>

      
    </div>
      <div id="remark"></div>
    <div class="article-info article-info-index">
      
      <a href="/2018/11/20/gooleWorkPrinciple/" class="archive-article-date">
  	<time datetime="2018-11-20T08:12:31.000Z" itemprop="datePublished"><i class="icon-clock"></i>2018-11-20</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/依赖倒置原则/">依赖倒置原则</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端/">前端</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端设计模式/">前端设计模式</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/个人博客/">个人博客</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  


      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2019 谢雨轩
    	</div>
      	<div class="footer-right">虽然生的丑 毕竟想的美</div>
    </div>
  </div>
</footer>

    </div>
    <script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: true,
		root: "/",
		innerArchive: true
	}
</script>

<script src="/./main.js"></script>


    
<div class="tools-col">
  <ul class="btn-wrap">
    
      <li class="chose" data-hook="tools-section-all"><span class="text">全部</span><i class="icon-book"></i></li>
    
    
      <li data-hook="tools-section-tag"><span class="text">标签</span><i class="icon-price-tags"></i></li>
    
    
      <li data-hook="tools-section-friends"><span class="text">友链</span><i class="icon-link"></i></li>
    
    
      <li data-hook="tools-section-me"><span class="text">我</span><i class="icon-smile"></i></li>
    
  </ul>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all chose">
    	</section>
    

    
    	<section class="tools-section tools-section-tag">
    			<div class="widget tagcloud" id="js-tagcloud">
    				<a href="/tags/FHS/" style="font-size: 12px;">FHS</a> <a href="/tags/css-hack/" style="font-size: 10px;">css hack</a> <a href="/tags/excel表格导出/" style="font-size: 10px;">excel表格导出</a> <a href="/tags/flutter/" style="font-size: 10px;">flutter</a> <a href="/tags/flutter组件/" style="font-size: 10px;">flutter组件</a> <a href="/tags/jquery/" style="font-size: 10px;">jquery</a> <a href="/tags/jquery源码/" style="font-size: 10px;">jquery源码</a> <a href="/tags/jquery源码教程/" style="font-size: 10px;">jquery源码教程</a> <a href="/tags/js原型/" style="font-size: 10px;">js原型</a> <a href="/tags/license/" style="font-size: 10px;">license</a> <a href="/tags/linux/" style="font-size: 12px;">linux</a> <a href="/tags/linux操作/" style="font-size: 10px;">linux操作</a> <a href="/tags/linux文件/" style="font-size: 10px;">linux文件</a> <a href="/tags/linux环境变量/" style="font-size: 10px;">linux环境变量</a> <a href="/tags/node/" style="font-size: 10px;">node</a> <a href="/tags/nodejs/" style="font-size: 10px;">nodejs</a> <a href="/tags/rich-text/" style="font-size: 10px;">rich-text</a> <a href="/tags/underscore/" style="font-size: 10px;">underscore</a> <a href="/tags/underscore源码/" style="font-size: 10px;">underscore源码</a> <a href="/tags/vim/" style="font-size: 10px;">vim</a> <a href="/tags/vim命令/" style="font-size: 10px;">vim命令</a> <a href="/tags/webpack/" style="font-size: 16px;">webpack</a> <a href="/tags/webpack-4-0/" style="font-size: 14px;">webpack 4.0</a> <a href="/tags/webpack优化/" style="font-size: 10px;">webpack优化</a> <a href="/tags/webpack教程/" style="font-size: 14px;">webpack教程</a> <a href="/tags/依赖倒置原则/" style="font-size: 12px;">依赖倒置原则</a> <a href="/tags/全栈/" style="font-size: 12px;">全栈</a> <a href="/tags/前端/" style="font-size: 20px;">前端</a> <a href="/tags/前端学习/" style="font-size: 10px;">前端学习</a> <a href="/tags/前端工程师/" style="font-size: 10px;">前端工程师</a> <a href="/tags/前端常用网站/" style="font-size: 10px;">前端常用网站</a> <a href="/tags/前端打包工具/" style="font-size: 10px;">前端打包工具</a> <a href="/tags/前端设计模式/" style="font-size: 18px;">前端设计模式</a> <a href="/tags/单一职责原则/" style="font-size: 10px;">单一职责原则</a> <a href="/tags/原创/" style="font-size: 14px;">原创</a> <a href="/tags/图片加载/" style="font-size: 10px;">图片加载</a> <a href="/tags/图片加载完成事件/" style="font-size: 10px;">图片加载完成事件</a> <a href="/tags/开闭原则/" style="font-size: 10px;">开闭原则</a> <a href="/tags/微信小程序/" style="font-size: 10px;">微信小程序</a> <a href="/tags/技术发展/" style="font-size: 10px;">技术发展</a> <a href="/tags/接口隔离原则/" style="font-size: 10px;">接口隔离原则</a> <a href="/tags/正则/" style="font-size: 10px;">正则</a> <a href="/tags/源码/" style="font-size: 12px;">源码</a> <a href="/tags/滚动信息条间歇性滚动/" style="font-size: 10px;">滚动信息条间歇性滚动</a> <a href="/tags/理解https/" style="font-size: 10px;">理解https</a> <a href="/tags/迪米特法则/" style="font-size: 10px;">迪米特法则</a> <a href="/tags/里氏替换原则/" style="font-size: 10px;">里氏替换原则</a>
    			</div>
    	</section>
    

    
    	<section class="tools-section tools-section-friends">
  		
  			<div class="friends-wrap" id="js-friends">
  			
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="https://github.com/Vera0707/huanhuashuixie/tree/master/framework">流行框架练习</a>
  	        
  	        </div>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">一枚深水前端&lt;br/&gt;&lt;br/&gt;大神带带我&lt;br/&gt;小白我要升级打倒小怪兽</div>
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
  <link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
  <script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
  <!--<script>-->
      <!--var WIDTH = window.innerWidth, HEIGHT = window.innerHeight, POINT = 35;-->

      <!--var canvas = document.getElementById('body-wrap');-->
      <!--canvas.width = WIDTH,-->
          <!--canvas.height = HEIGHT;-->
      <!--var context = canvas.getContext('2d');-->
      <!--context.strokeStyle = 'rgba(0,0,0,0.2)',-->
          <!--context.strokeWidth = 1,-->
          <!--context.fillStyle = 'rgba(0,0,0,0.1)';-->
      <!--var circleArr = [];-->

      <!--//线条：开始xy坐标，结束xy坐标，线条透明度-->
      <!--function Line (x, y, _x, _y, o) {-->
          <!--this.beginX = x,-->
              <!--this.beginY = y,-->
              <!--this.closeX = _x,-->
              <!--this.closeY = _y,-->
              <!--this.o = o;-->
      <!--}-->
      <!--//点：圆心xy坐标，半径，每帧移动xy的距离-->
      <!--function Circle (x, y, r, moveX, moveY) {-->
          <!--this.x = x,-->
              <!--this.y = y,-->
              <!--this.r = r,-->
              <!--this.moveX = moveX,-->
              <!--this.moveY = moveY;-->
      <!--}-->
      <!--//生成max和min之间的随机数-->
      <!--function num (max, _min) {-->
          <!--var min = arguments[1] || 0;-->
          <!--return Math.floor(Math.random()*(max-min+1)+min);-->
      <!--}-->
      <!--// 绘制原点-->
      <!--function drawCricle (cxt, x, y, r, moveX, moveY) {-->
          <!--var circle = new Circle(x, y, r, moveX, moveY)-->
          <!--cxt.beginPath()-->
          <!--cxt.arc(circle.x, circle.y, circle.r, 0, 2*Math.PI)-->
          <!--cxt.closePath()-->
          <!--cxt.fill();-->
          <!--return circle;-->
      <!--}-->
      <!--//绘制线条-->
      <!--function drawLine (cxt, x, y, _x, _y, o) {-->
          <!--var line = new Line(x, y, _x, _y, o)-->
          <!--cxt.beginPath()-->
          <!--cxt.strokeStyle = 'rgba(0,0,0,'+ o +')'-->
          <!--cxt.moveTo(line.beginX, line.beginY)-->
          <!--cxt.lineTo(line.closeX, line.closeY)-->
          <!--cxt.closePath()-->
          <!--cxt.stroke();-->

      <!--}-->
      <!--//每帧绘制-->
      <!--function draw () {-->
          <!--context.clearRect(0,0,canvas.width, canvas.height);-->
          <!--for (var i = 0; i < POINT; i++) {-->
              <!--drawCricle(context, circleArr[i].x, circleArr[i].y, circleArr[i].r);-->
          <!--}-->
          <!--for (var i = 0; i < POINT; i++) {-->
              <!--for (var j = 0; j < POINT; j++) {-->
                  <!--if (i + j < POINT) {-->
                      <!--var A = Math.abs(circleArr[i+j].x - circleArr[i].x),-->
                          <!--B = Math.abs(circleArr[i+j].y - circleArr[i].y);-->
                      <!--var lineLength = Math.sqrt(A*A + B*B);-->
                      <!--var C = 1/lineLength*7-0.009;-->
                      <!--var lineOpacity = C > 0.03 ? 0.03 : C;-->
                      <!--if (lineOpacity > 0) {-->
                          <!--drawLine(context, circleArr[i].x, circleArr[i].y, circleArr[i+j].x, circleArr[i+j].y, lineOpacity);-->
                      <!--}-->
                  <!--}-->
              <!--}-->
          <!--}-->
      <!--}-->
      <!--//初始化生成原点-->
      <!--function init () {-->
          <!--circleArr = [];-->
          <!--for (var i = 0; i < POINT; i++) {-->
              <!--circleArr.push(drawCricle(context, num(WIDTH), num(HEIGHT), num(15, 2), num(10, -10)/40, num(10, -10)/40));-->
          <!--}-->
          <!--draw();-->
      <!--}-->
      <!--//调用执行-->
      <!--window.onload = function () {-->
          <!--init();-->
          <!--setInterval(function () {-->
              <!--for (var i = 0; i < POINT; i++) {-->
                  <!--var cir = circleArr[i];-->
                  <!--cir.x += cir.moveX;-->
                  <!--cir.y += cir.moveY;-->
                  <!--if (cir.x > WIDTH) cir.x = 0;-->
                  <!--else if (cir.x < 0) cir.x = WIDTH;-->
                  <!--if (cir.y > HEIGHT) cir.y = 0;-->
                  <!--else if (cir.y < 0) cir.y = HEIGHT;-->
              <!--}-->
              <!--draw();-->
          <!--}, 10);-->
      <!--}-->
  <!--</script>-->
  <!--<script>-->
      <!--var gitment = new Gitment({-->
          <!--id: '', // 可选。默认为 location.href-->
          <!--owner: 'vera0707',-->
          <!--repo: 'https://github.com/vera0707/vera0707.github.io',-->
          <!--labels: "gitment-introduction",-->
          <!--oauth: {-->
              <!--client_id: '412dc716eeeb8fa2983f',-->
              <!--client_secret: 'e350354961bdca67937a21eed747e23ba1e6f86e'-->
          <!--}-->
      <!--})-->
      <!--gitment.render('remark')-->
  <!--</script>-->
</body>
</html>