<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="dns-prefetch" href="http://xieyuxuan.cc">
  <title>谢雨轩的博客 | Vera Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="前端技术分享,前端个人博客">
<meta property="og:type" content="website">
<meta property="og:title" content="谢雨轩的博客 | Vera Blog">
<meta property="og:url" content="http://xieyuxuan.cc/page/2/index.html">
<meta property="og:site_name" content="谢雨轩的博客 | Vera Blog">
<meta property="og:description" content="前端技术分享,前端个人博客">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="谢雨轩的博客 | Vera Blog">
<meta name="twitter:description" content="前端技术分享,前端个人博客">
  
    <link rel="alternative" href="/atom.xml" title="谢雨轩的博客 | Vera Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/images/favicon.png">
  
  <link rel="stylesheet" href="/main.css">
  



  <!-- Piwik -->
  <script type="text/javascript">
    var _paq = _paq || [];
    // tracker methods like "setCustomDimension" should be called before "trackPageView"
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
      var u="//piwik.mritd.me/";
      _paq.push(['setTrackerUrl', u+'piwik.php']);
      _paq.push(['setSiteId', '3']);
      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
      g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
    })();
  </script>
  <!-- End Piwik Code -->
</head>
</html>
<body>
  <div id="container">
    <div class="left-col">
      <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="/images/userimg.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">谢雨轩</a></h1>
		</hgroup>

		
		<p class="header-subtitle">Web前端技术宅升级打倒小怪兽</p>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
				<li><a href="/types/webpack.html">webpack教程</a></li>
	        
				<li><a href="/types/origincode.html">源码剖析</a></li>
	        
				<li><a href="/types/web.html">移动端直通车</a></li>
	        
				<li><a href="/types/script.html">神奇JS</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
	        
    		
    			
    			<a class="js-smart-menu" data-idx="0" href="javascript:void(0)">所有文章</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="1" href="javascript:void(0)">标签</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="2" href="javascript:void(0)">我的项目</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="3" href="javascript:void(0)">关于我</a>
    			
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/Vera0707/huanhuashuixie" title="github">github</a>
		        
					<a class="mail" target="_blank" href="/lishuxia@gozap.com" title="mail">mail</a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"><i class="icon-list"></i></div>
  		<h1 class="header-author js-mobile-header hide">谢雨轩</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img src="/images/userimg.jpg" class="js-avatar">
				
			</div>
			<hgroup>
			  <h1 class="header-author">谢雨轩</h1>
			</hgroup>
			
			<p class="header-subtitle">Web前端技术宅升级打倒小怪兽</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/types/webpack.html">webpack教程</a></li>
		        
					<li><a href="/types/origincode.html">源码剖析</a></li>
		        
					<li><a href="/types/web.html">移动端直通车</a></li>
		        
					<li><a href="/types/script.html">神奇JS</a></li>
		        
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/Vera0707/huanhuashuixie" title="github">github</a>
			        
						<a class="mail" target="_blank" href="/lishuxia@gozap.com" title="mail">mail</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <canvas id="body-wrap"> </canvas>
      <div class="body-wrap">
          
  
    <article id="post-applets-rich-text" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/05/27/applets-rich-text/">小程序之rich-text如何生成渲染DOM</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&emsp;&emsp; 今天要吐血紧急发一篇关于小程序富文本渲染的<br>&emsp;&emsp; 之所以吐血,是因为小程序wxs语法出错无法打印，无法调试，更无从知道原因<br>&emsp;&emsp; 根据字符串,解析正则,此方法不是万能的，但，完全可以帮你省很大力气,当然它目前仅适用我的项目,稍改动一下即可</p>
<p>&emsp;&emsp; 以下为 wxs 文件内,module=m1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    function matchEmoticon(content,regStr)&#123;</span><br><span class="line">        var node = [&#123;</span><br><span class="line">              type: &apos;node&apos;,</span><br><span class="line">              name: &apos;span&apos;,</span><br><span class="line">              children: []</span><br><span class="line">          &#125;];</span><br><span class="line"></span><br><span class="line">          if(getRegExp(regStr,&quot;g&quot;).test(content)) &#123;</span><br><span class="line">              var contentCopy =  content;</span><br><span class="line">              while (contentCopy.length &gt; 0 &amp;&amp; getRegExp(regStr,&quot;g&quot;).test(contentCopy))&#123;</span><br><span class="line"></span><br><span class="line">                  var result = getRegExp(regStr).exec(contentCopy);</span><br><span class="line">                  var searchIndex = contentCopy.search(getRegExp(regStr));</span><br><span class="line"></span><br><span class="line">                  if(searchIndex == 0)&#123;</span><br><span class="line">                      node[0].children.push(&#123;</span><br><span class="line">                          type: &quot;node&quot;,</span><br><span class="line">                          name: &apos;img&apos;,</span><br><span class="line">                          attrs : &#123; &quot;src&quot;: &quot;https://www.mifengapp.com/resources/emoticon/&quot; +  result[1]  +&quot;.png&quot;,</span><br><span class="line">                          style : &quot;width: 20px;height:20px;padding: 0 1px&quot; &#125;,</span><br><span class="line">                          children: []</span><br><span class="line">                      &#125;);</span><br><span class="line"></span><br><span class="line">                    contentCopy = contentCopy.slice(result[0].length);</span><br><span class="line"></span><br><span class="line">                  &#125;else&#123;</span><br><span class="line">                     node[0].children.push(&#123;</span><br><span class="line">                          type: &quot;node&quot;,</span><br><span class="line">                          name: &apos;span&apos;,</span><br><span class="line">                          children: [&#123;</span><br><span class="line">                              type: &apos;text&apos;,</span><br><span class="line">                              text: contentCopy.slice(0,searchIndex)</span><br><span class="line">                          &#125;]</span><br><span class="line">                      &#125;);</span><br><span class="line"></span><br><span class="line">                      contentCopy = contentCopy.slice(searchIndex);</span><br><span class="line">                  &#125;</span><br><span class="line">             &#125;</span><br><span class="line"></span><br><span class="line">             if(contentCopy.length &gt; 0)&#123;</span><br><span class="line">                node[0].children.push(&#123;</span><br><span class="line">                    type: &quot;node&quot;,</span><br><span class="line">                    name: &apos;span&apos;,</span><br><span class="line">                    children: [&#123;</span><br><span class="line">                        type: &apos;text&apos;,</span><br><span class="line">                        text: contentCopy</span><br><span class="line">                    &#125;]</span><br><span class="line">                &#125;);</span><br><span class="line">             &#125;</span><br><span class="line"></span><br><span class="line">          &#125;else&#123;</span><br><span class="line">              node[0].children.push(&#123;</span><br><span class="line">                  type: &apos;node&apos;,</span><br><span class="line">                  name: &apos;span&apos;,</span><br><span class="line">                  children: [&#123;</span><br><span class="line">                      type: &apos;text&apos;,</span><br><span class="line">                      text: content</span><br><span class="line">                  &#125;]</span><br><span class="line">              &#125;)</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          return node;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    matchEmoticon: matchEmoticon</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp; 以下为 wxml文件内调用上述方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;rich-text nodes=&quot;&#123;&#123;m1.matchEmoticon(&quot;监督检查吃顿饭呢看到基础酒店吧地方好的宝贝底线很好的716969797979SSS1&quot;,&quot;[\uE000]([\d]+)[\uE001]&quot;)&#125;&#125;&quot;&gt;&lt;/rich-text&gt;</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;注：<br>&emsp;&emsp; ① 为什么不用ES6？<br>&emsp;&emsp;&emsp;&emsp;&emsp;wxs内暂不支持ES6<br>&emsp;&emsp; ② 为什么使用getRegExp而不是RegExp或字面量创建？<br>&emsp;&emsp;&emsp;&emsp;&emsp;小程序内正则使用封装的getRegExp,否则会无法解析<br>&emsp;&emsp; ③ 为什么不提取getRegExp(regStr,”g”)做公共变量?<br>&emsp;&emsp;&emsp;&emsp;&emsp;不知道内部如何封装的，提取后会无法解析<br>&emsp;&emsp; ④ 为什么用了exec还要用search?<br>&emsp;&emsp;&emsp;&emsp;&emsp;因为需要获取下标值,虽然exec的返回值result有result[0]和result[1],但是没有result.index<br>&emsp;&emsp; ⑤ 代码异常了会怎样？<br>&emsp;&emsp;&emsp;&emsp;&emsp;内部应该做了捕获处理,会直接返回空</p>
<p>&emsp;&emsp; 希望这些问题后续能够解决，毕竟不太优雅.</p>

      
    </div>
      <div id="remark"></div>
    <div class="article-info article-info-index">
      
      <a href="/2019/05/27/applets-rich-text/" class="archive-article-date">
  	<time datetime="2019-05-27T03:29:09.000Z" itemprop="datePublished"><i class="icon-clock"></i>2019-05-27</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rich-text/">rich-text</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端/">前端</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/原创/">原创</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/微信小程序/">微信小程序</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/个人博客/">个人博客</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-regexp" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/03/13/regexp/">前端源码里的那些正则</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&emsp;&emsp; 通读了一遍老姚的<a href="https://zhuanlan.zhihu.com/p/29707385" target="_blank" rel="noopener">《JavaScript 正则表达式迷你书》</a>个人收获极多。<br>&emsp;&emsp; 忽想到之前学源码时，那些晦涩难懂的正则表达式,或者防不胜防的『骚操作』,我遂决定将其摘出，细细品味。</p>
<h3 id="jQuery"><a href="#jQuery" class="headerlink" title="jQuery"></a>jQuery</h3><pre><code>1. 驼峰命名

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">var camelizeRE = /-(\w)/g;</span><br><span class="line">var camelize = cached(function (str) &#123;</span><br><span class="line">  return str.replace(camelizeRE, function (_, c) &#123; return c ? c.toUpperCase() : &apos;&apos;; &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">/* cached为缓存函数，可忽略，核心代码修改如下 */</span><br><span class="line"></span><br><span class="line">var camelizeRE = /-(\w)/g;</span><br><span class="line">var camelize = function (str) &#123;</span><br><span class="line">  return str.replace(camelizeRE, function (_, c) &#123; return c ? c.toUpperCase() : &apos;&apos;; &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> *  ① camelizeRE正则捕获所有连字符[-]后的首个元素</span><br><span class="line"> *  ② _ 为符合正则的部分,c为正则$1[第一个括号包裹的内容]捕获到的元素，即我们的目标子符</span><br><span class="line"> *  ③ 若该字符存在,则大写</span><br><span class="line"> */</span><br></pre></td></tr></table></figure>
</code></pre>
      
    </div>
      <div id="remark"></div>
    <div class="article-info article-info-index">
      
      <a href="/2019/03/13/regexp/" class="archive-article-date">
  	<time datetime="2019-03-13T03:20:49.000Z" itemprop="datePublished"><i class="icon-clock"></i>2019-03-13</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端/">前端</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/正则/">正则</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/源码/">源码</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/个人博客/">个人博客</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-gooleWorkPrinciple" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/20/gooleWorkPrinciple/">史上最全！图解浏览器的工作原理</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h6 id="译注：本文作者FrontEndInDepth"><a href="#译注：本文作者FrontEndInDepth" class="headerlink" title="译注：本文作者FrontEndInDepth"></a>译注：本文作者<a href="https://zhuanlan.zhihu.com/p/47407398" target="_blank" rel="noopener">FrontEndInDepth</a></h6><p><img src="https://static001.geekbang.org/resource/image/db/0f/db0269ec53a84b9578300b6cfaa42f0f.jpg" alt=""></p>
<p>&emsp;&emsp;可能每一个前端工程师都想要理解浏览器的工作原理。</p>
<p>&emsp;&emsp;我们希望知道从在浏览器地址栏中输入 url 到页面展现的短短几秒内浏览器究竟做了什么；</p>
<p>&emsp;&emsp;我们希望了解平时常常听说的各种代码优化方案是究竟为什么能起到优化的作用；</p>
<p>&emsp;&emsp;我们希望更细化的了解浏览器的渲染流程。</p>
<p>&emsp;&emsp;<abbr style="font-size: 28px;color:#333">浏览器的多进程架构</abbr></p>
<p>&emsp;&emsp;一个好的程序常常被划分为几个相互独立又彼此配合的模块，浏览器也是如此，以 Chrome 为例，它由多个进程组成，每个进程都有自己核心的职责，它们相互配合完成浏览器的整体功能，每个进程中又包含多个线程，一个进程内的多个线程也会协同工作，配合完成所在进程的职责。</p>
<p>&emsp;&emsp;对一些前端开发同学来说，进程和线程的概念可能会有些模糊，为了更好的理解浏览器的多进程架构，这里我们简单讨论一下进程和线程。</p>
<p>&emsp;&emsp;<abbr style="font-size: 28px;color:#333">进程（process）和线程（thread）</abbr></p>
<p><img src="https://static.geekbang.org/infoq/5bee594c329b3.png" alt=""></p>
<p>&emsp;&emsp;进程就像是一个有边界的生产厂间，而线程就像是厂间内的一个个员工，可以自己做自己的事情，也可以相互配合做同一件事情。</p>
<p>&emsp;&emsp;当我们启动一个应用，计算机会创建一个进程，操作系统会为进程分配一部分内存，应用的所有状态都会保存在这块内存中，应用也许还会创建多个线程来辅助工作，这些线程可以共享这部分内存中的数据。如果应用关闭，进程会被终结，操作系统会释放相关内存。</p>
<p>&emsp;&emsp;一个进程还可以要求操作系统生成另一个进程来执行不同的任务，系统会为新的进程分配独立的内存，两个进程之间可以使用 IPC （Inter Process Communication）进行通信。很多应用都会采用这样的设计，如果一个工作进程反应迟钝，重启这个进程不会影响应用其它进程的工作。</p>
<p>&emsp;&emsp;<abbr style="font-size: 28px;color:#333">浏览器的架构</abbr></p>
<p>&emsp;&emsp;有了上面的知识做铺垫，我们可以更合理的讨论浏览器的架构了，其实如果要开发一个浏览器，它可以是单进程多线程的应用，也可以是使用 IPC 通信的多进程应</p>
<p><img src="https://static.geekbang.org/infoq/5bee5b825f797.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">浏览器的架构模型</abbr></p>
<p>&emsp;&emsp;不同浏览器采用了不同的架构模式，这里并不存在标准，本文以 Chrome 为例进行说明 ：</p>
<p>&emsp;&emsp;Chrome 采用多进程架构，其顶层存在一个 Browser process 用以协调浏览器的其它进程。</p>
<p><img src="https://static.geekbang.org/infoq/5bee5bceb417a.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">Chrome 的不同进程</abbr></p>
<p>&emsp;&emsp;具体说来，Chrome 的主要进程及其职责如下：</p>
<p>&emsp;&emsp;Browser Process：</p>
<p>&emsp;&emsp;- 负责包括地址栏，书签栏，前进后退按钮等部分的工作；</p>
<p>&emsp;&emsp;- 负责处理浏览器的一些不可见的底层操作，比如网络请求和文件访问；</p>
<p>&emsp;&emsp;Renderer Process：</p>
<p>&emsp;&emsp;- 负责一个 tab 内关于网页呈现的所有事情</p>
<p>&emsp;&emsp;Plugin Process：</p>
<p>&emsp;&emsp;- 负责控制一个网页用到的所有插件，如 flash GPU Process</p>
<p>&emsp;&emsp;- 负责处理 GPU 相关的任务</p>
<p><img src="https://static.geekbang.org/infoq/5bee5c111b0cd.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">不同进程负责的浏览器区域示意图</abbr></p>
<p>&emsp;&emsp;Chrome 还为我们提供了「任务管理器」，供我们方便的查看当前浏览器中运行的所有进程及每个进程占用的系统资源，右键单击还可以查看更多类别信息。</p>
<p>&emsp;&emsp;通过「页面右上角的三个点点点 — 更多工具 — 任务管理器」即可打开相关面板。</p>
<p>&emsp;&emsp;<abbr style="font-size: 24px;color:#333">Chrome 多进程架构的优缺点</abbr></p>
<p>&emsp;&emsp;<abbr style="font-weight:bold;color:#333;">优点</abbr></p>
<p>&emsp;&emsp;某一渲染进程出问题不会影响其他进程</p>
<p>&emsp;&emsp;更为安全，在系统层面上限定了不同进程的权限</p>
<p>&emsp;&emsp;<abbr style="font-weight:bold;color:#333;">缺点</abbr></p>
<p>&emsp;&emsp;由于不同进程间的内存不共享，不同进程的内存常常需要包含相同的内容。</p>
<p>&emsp;&emsp;为了节省内存，Chrome 限制了最多的进程数，最大进程数量由设备的内存和 CPU 能力决定，当达到这一限制时，新打开的 Tab 会共用之前同一个站点的渲染进程。</p>
<p>&emsp;&emsp;测试了一下在 Chrome 中打开不断打开知乎首页，在 Mac i5 8g 上可以启动四十多个渲染进程，之后新打开 tab 会合并到已有的渲染进程中。</p>
<p>&emsp;&emsp;Chrome 把浏览器不同程序的功能看做服务，这些服务可以方便的分割为不同的进程或者合并为一个进程。以 Broswer Process 为例，如果 Chrome 运行在强大的硬件上，它会分割不同的服务到不同的进程，这样 Chrome 整体的运行会更加稳定，但是如果 Chrome 运行在资源贫瘠的设备上，这些服务又会合并到同一个进程中运行，这样可以节省内存，示意图如下。</p>
<p>&emsp;&emsp;<abbr style="font-size: 24px;color:#333">iframe 的渲染 – Site Isolation</abbr></p>
<p>&emsp;&emsp;在上面的进程图中我们还可以看到一些进程下还存在着 Subframe，这就是 Site Isolation 机制作用的结果。</p>
<p>&emsp;&emsp;Site Isolation 机制从 Chrome 67 开始默认启用。这种机制允许在同一个 Tab 下的跨站 iframe 使用单独的进程来渲染，这样会更为安全。</p>
<p><img src="https://static.geekbang.org/infoq/5bee72864411e.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">iframe 会采用不同的渲染进程</abbr></p>
<p>&emsp;&emsp;Site Isolation 被大家看做里程碑式的功能， 其成功实现是多年工程努力的结果。Site Isolation 不是简单的叠加多个进程。这种机制在底层改变了 iframe 之间通信的方法，Chrome 的其它功能都需要做对应的调整，比如说 devtools 需要相应的支持，甚至 Ctrl + F 也需要支持。</p>
<p>&emsp;&emsp;介绍完了浏览器的基本架构模式，接下来我们看看一个常见的导航过程对浏览器来说究竟发生了什么。</p>
<p>&emsp;&emsp;<abbr style="font-size: 24px;color:#333">导航过程发生了什么</abbr></p>
<p>&emsp;&emsp;也许大多数人使用 Chrome 最多的场景就是在地址栏输入关键字进行搜索或者输入地址导航到某个网站，我们来看看浏览器是怎么看待这个过程的。</p>
<p>&emsp;&emsp;我们知道浏览器 Tab 外的工作主要由 Browser Process 掌控，Browser Process 又对这些工作进一步划分，使用不同线程进行处理：</p>
<p>&emsp;&emsp;- UI thread ： 控制浏览器上的按钮及输入框；</p>
<p>&emsp;&emsp;- network thread: 处理网络请求，从网上获取数据；</p>
<p>&emsp;&emsp;- storage thread: 控制文件等的访问；</p>
<p><img src="https://static.geekbang.org/infoq/5bee73021bd91.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">浏览器主进程中的不同线程</abbr></p>
<p>&emsp;&emsp;回到我们的问题，当我们在浏览器地址栏中输入文字，并点击回车获得页面内容的过程在浏览器看来可以分为以下几步：</p>
<p>&emsp;&emsp;1. 处理输入</p>
<p>&emsp;&emsp;UI thread 需要判断用户输入的是 URL 还是 query；</p>
<p>&emsp;&emsp;2. 开始导航</p>
<p>&emsp;&emsp;当用户点击回车键，UI thread 通知 network thread 获取网页内容，并控制 tab 上的 spinner 展现，表示正在加载中。</p>
<p>&emsp;&emsp;network thread 会执行 DNS 查询，随后为请求建立 TLS 连接。</p>
<p><img src="https://static.geekbang.org/infoq/5bee737f56ada.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">UI thread 通知 Network thread 加载相关信息</abbr></p>
<p>&emsp;&emsp;如果 network thread 接收到了重定向请求头如 301，network thread 会通知 UI thread 服务器要求重定向，之后，另外一个 URL 请求会被触发</p>
<p>&emsp;&emsp;3. 读取响应</p>
<p>&emsp;&emsp;当请求响应返回的时候，network thread 会依据 Content-Type 及 MIME Type sniffing 判断响应内容的格式。</p>
<p><img src="https://static.geekbang.org/infoq/5bee73e636686.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">判断响应内容的格式</abbr></p>
<p>&emsp;&emsp;如果响应内容的格式是 HTML ，下一步将会把这些数据传递给 renderer process，如果是 zip 文件或者其它文件，会把相关数据传输给下载管理器。</p>
<p>&emsp;&emsp;Safe Browsing 检查也会在此时触发，如果域名或者请求内容匹配到已知的恶意站点，network thread 会展示一个警告页。此外 CORB 检测也会触发确保敏感数据不会被传递给渲染进程。</p>
<p><img src="https://static.geekbang.org/infoq/5bee741450e1b.png" alt=""></p>
<p>&emsp;&emsp;4. 查找渲染进程</p>
<p>&emsp;&emsp;当上述所有检查完成，network thread 确信浏览器可以导航到请求网页，network thread 会通知 UI thread 数据已经准备好，UI thread 会查找到一个 renderer process 进行网页的渲染。</p>
<p><img src="https://static.geekbang.org/infoq/5bee743b5ffc8.png" alt=""></p>
<p>&emsp;&emsp;收到 Network thread 返回的数据后，UI thread 查找相关的渲染进程</p>
<p>&emsp;&emsp;由于网络请求获取响应需要时间，这里其实还存在着一个加速方案。当 UI thread 发送 URL 请求给 network thread 时，浏览器其实已经知道了将要导航到那个站点。UI thread 会并行的预先查找和启动一个渲染进程，如果一切正常，当 network thread 接收到数据时，渲染进程已经准备就绪了，但是如果遇到重定向，准备好的渲染进程也许就不可用了，这时候就需要重启一个新的渲染进程。</p>
<p>&emsp;&emsp;5. 确认导航</p>
<p>&emsp;&emsp;进过了上述过程，数据以及渲染进程都可用了， Browser Process 会给 renderer process 发送 IPC 消息来确认导航，一旦 Browser Process 收到 renderer process 的渲染确认消息，导航过程结束，页面加载过程开始。</p>
<p>&emsp;&emsp;此时，地址栏会更新，展示出新页面的网页信息。history tab 会更新，可通过返回键返回导航来的页面，为了让关闭 tab 或者窗口后便于恢复，这些信息会存放在硬盘中。</p>
<p><img src="https://static.geekbang.org/infoq/5bee746f304b8.png" alt=""></p>
<p>&emsp;&emsp;6. 额外的步骤</p>
<p>&emsp;&emsp;一旦导航被确认，renderer process 会使用相关的资源渲染页面，下文中我们将重点介绍渲染流程。当 renderer process 渲染结束（渲染结束意味着该页面内的所有的页面，包括所有 iframe 都触发了 onload 时），会发送 IPC 信号到 Browser process， UI thread 会停止展示 tab 中的 spinner。</p>
<p><img src="https://static.geekbang.org/infoq/5bee74a42b6e7.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">Renderer Process 发送 IPC 消息通知 browser process 页面已经加载完成。</abbr></p>
<p>&emsp;&emsp;当然上面的流程只是网页首帧渲染完成，在此之后，客户端依旧可下载额外的资源渲染出新的视图。</p>
<p>&emsp;&emsp;在这里我们可以明确一点，所有的 JS 代码其实都由 renderer Process 控制的，所以在你浏览网页内容的过程大部分时候不会涉及到其它的进程。不过也许你也曾经监听过 beforeunload 事件，这个事件再次涉及到 Browser Process 和 renderer Process 的交互，当当前页面关闭时（关闭 Tab ，刷新等等），Browser Process 需要通知 renderer Process 进行相关的检查，对相关事件进行处理。</p>
<p><img src="https://static.geekbang.org/infoq/5bee74e2e0b86.png" alt=""></p>
<p>&emsp;&emsp;浏览器进程发送 IPC 消息给渲染进程，通知要离开当前网站了</p>
<p>&emsp;&emsp;如果导航由 renderer process 触发（比如在用户点击某链接，或者 JS 执行 window.location = “<a href="http://newsite.com" target="_blank" rel="noopener">http://newsite.com</a>“ ） renderer process 会首先检查是否有 beforeunload 事件处理器，导航请求由 renderer process 传递给 Browser process。</p>
<p>&emsp;&emsp;如果导航到新的网站，会启用一个新的 render process 来处理新页面的渲染，老的进程会留下来处理类似 unload 等事件。</p>
<p>&emsp;&emsp;关于页面的生命周期，更多内容可参考 Page Lifecycle API 。</p>
<p><img src="https://static.geekbang.org/infoq/5bee75121fb11.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">浏览器进程发送 IPC 消息到新的渲染进程通知渲染新的页面，同时通知旧的渲染进程卸载。</abbr></p>
<p>&emsp;&emsp;除了上述流程，有些页面还拥有 Service Worker （服务工作线程），Service Worker 让开发者对本地缓存及判断何时从网络上获取信息有了更多的控制权，如果 Service Worker 被设置为从本地 cache 中加载数据，那么就没有必要从网上获取更多数据了。</p>
<p>&emsp;&emsp;值得注意的是 service worker 也是运行在渲染进程中的 JS 代码，因此对于拥有 Service Worker 的页面，上述流程有些许的不同。</p>
<p>&emsp;&emsp;当有 Service Worker 被注册时，其作用域会被保存，当有导航时，network thread 会在注册过的 Service Worker 的作用域中检查相关域名，如果存在对应的 Service worker，UI thread 会找到一个 renderer process 来处理相关代码，Service Worker 可能会从 cache 中加载数据，从而终止对网络的请求，也可能从网上请求新的数据。</p>
<p><img src="https://static.geekbang.org/infoq/5bee753dde9e7.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">Service Worker 依据具体情形做处理。</abbr></p>
<p>&emsp;&emsp;如果 Service Worker 最终决定通过网上获取数据，Browser 进程 和 renderer 进程的交互其实会延后数据的请求时间 。Navigation Preload 是一种与 Service Worker 并行的加速加载资源的机制，服务端通过请求头可以识别这类请求，而做出相应的处理。</p>
<p>&emsp;&emsp;<abbr style="font-size: 28px;color:#333">渲染进程是如何工作的？</abbr></p>
<p>&emsp;&emsp;渲染进程几乎负责 Tab 内的所有事情，渲染进程的核心目的在于转换 HTML CSS JS 为用户可交互的 web 页面。渲染进程中主要包含以下线程：</p>
<p><img src="https://static.geekbang.org/infoq/5bee75a69dacf.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">渲染进程包含的线程</abbr></p>
<p>&emsp;&emsp;1. 主线程 Main thread</p>
<p>&emsp;&emsp;2. 工作线程 Worker thread</p>
<p>&emsp;&emsp;3. 排版线程 Compositor thread</p>
<p>&emsp;&emsp;4. 光栅线程 Raster thread</p>
<p>&emsp;&emsp;后文我们将逐步介绍不同线程的职责，在此之前我们先看看渲染的流程。</p>
<p>&emsp;&emsp;1. 构建 DOM</p>
<p>&emsp;&emsp;当渲染进程接收到导航的确认信息，开始接受 HTML 数据时，主线程会解析文本字符串为 DOM。</p>
<p>&emsp;&emsp;渲染 html 为 DOM 的方法由 HTML Standard 定义。</p>
<p>&emsp;&emsp;2. 加载次级的资源</p>
<p>&emsp;&emsp;网页中常常包含诸如图片，CSS，JS 等额外的资源，这些资源需要从网络上或者 cache 中获取。主进程可以在构建 DOM 的过程中会逐一请求它们，为了加速 preload scanner 会同时运行，如果在 html 中存在 <img> <link> 等标签，preload scanner 会把这些请求传递给 Browser process 中的 network thread 进行相关资源的下载。</p>
<p>&emsp;&emsp;3.JS 的下载与执行</p>
<p>&emsp;&emsp;当遇到 script 标签时，渲染进程会停止解析 HTML，而去加载，解析和执行 JS 代码，停止解析 html 的原因在于 JS 可能会改变 DOM 的结构（使用诸如 documwnt.write()等 API）。</p>
<p>&emsp;&emsp;不过开发者其实也有多种方式来告知浏览器应对如何应对某个资源，比如说如果在 script 标签上添加了 async 或 defer 等属性，浏览器会异步的加载和执行 JS 代码，而不会阻塞渲染。更多的方法可参考 Resource Prioritization – Getting the Browser to Help You。</p>
<p>&emsp;&emsp;4. 样式计算</p>
<p>&emsp;&emsp;仅仅渲染 DOM 还不足以获知页面的具体样式，主进程还会基于 CSS 选择器解析 CSS 获取每一个节点的最终的计算样式值。即使不提供任何 CSS，浏览器对每个元素也会有一个默认的样式。</p>
<p><img src="https://static.geekbang.org/infoq/5bee778add037.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">渲染进程主线程计算每一个元素节点的最终样式值</abbr></p>
<p>&emsp;&emsp;5. 获取布局</p>
<p>&emsp;&emsp;想要渲染一个完整的页面，除了获知每个节点的具体样式，还需要获知每一个节点在页面上的位置，布局其实是找到所有元素的几何关系的过程。其具体过程如下：</p>
<p>&emsp;&emsp;通过遍历 DOM 及相关元素的计算样式，主线程会构建出包含每个元素的坐标信息及盒子大小的布局树。布局树和 DOM 树类似，但是其中只包含页面可见的元素，如果一个元素设置了 display:none ，这个元素不会出现在布局树上，伪元素虽然在 DOM 树上不可见，但是在布局树上是可见的。</p>
<p><img src="https://static.geekbang.org/infoq/5bee77ba30185.png" alt=""></p>
<p>&emsp;&emsp;6. 绘制各元素</p>
<p>&emsp;&emsp;即使知道了不同元素的位置及样式信息，我们还需要知道不同元素的绘制先后顺序才能正确绘制出整个页面。在绘制阶段，主线程会遍历布局树以创建绘制记录。绘制记录可以看做是记录各元素绘制先后顺序的笔记。</p>
<p><img src="https://static.geekbang.org/infoq/5bee77f679b4d.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">主线程依据布局树构建绘制记录</abbr></p>
<p>&emsp;&emsp;7. 合成帧</p>
<p>&emsp;&emsp;熟悉 PS 等绘图软件的童鞋肯定对图层这一概念不陌生，现代 Chrome 其实利用了这一概念来组合不同的层。</p>
<p>&emsp;&emsp;复合是一种分割页面为不同的层，并单独栅格化，随后组合为帧的技术。不同层的组合由 compositor 线程（合成器线程）完成。</p>
<p>&emsp;&emsp;主线程会遍历布局树来创建层树（layer tree），添加了 will-change CSS 属性的元素，会被看做单独的一层。</p>
<p><img src="https://static.geekbang.org/infoq/5bee782c64422.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">主线程遍历布局树生成层树</abbr></p>
<p>&emsp;&emsp;你可能会想给每一个元素都添加上 will-change，不过组合过多的层也许会比在每一帧都栅格化页面中的某些小部分更慢。为了更合理的使用层，可参考 坚持仅合成器的属性和管理层计数 。</p>
<p>&emsp;&emsp;一旦层树被创建，渲染顺序被确定，主线程会把这些信息通知给合成器线程，合成器线程会栅格化每一层。有的层的可以达到整个页面的大小，因此，合成器线程将它们分成多个磁贴，并将每个磁贴发送到栅格线程，栅格线程会栅格化每一个磁贴并存储在 GPU 显存中。</p>
<p><img src="https://static.geekbang.org/infoq/5bee78655ed69.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">栅格线程会栅格化每一个磁贴并存储在 GPU 显存中</abbr></p>
<p>&emsp;&emsp;一旦磁贴被光栅化，合成器线程会收集称为绘制四边形的磁贴信息以创建合成帧。</p>
<p>&emsp;&emsp;合成帧随后会通过 IPC 消息传递给浏览器进程，由于浏览器的 UI 改变或者其它拓展的渲染进程也可以添加合成帧，这些合成帧会被传递给 GPU 用以展示在屏幕上，如果滚动发生，合成器线程会创建另一个合成帧发送给 GPU。</p>
<p><img src="https://static.geekbang.org/infoq/5bee789fac854.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">合成器线程会发送合成帧给 GPU 渲染</abbr></p>
<p>&emsp;&emsp;合成器的优点在于，其工作无关主线程，合成器线程不需要等待样式计算或者 JS 执行，这就是为什么合成器相关的动画 最流畅，如果某个动画涉及到布局或者绘制的调整，就会涉及到主线程的重新计算，自然会慢很多。</p>
<p>&emsp;&emsp;<abbr style="font-size: 28px;color:#333">浏览器对事件的处理</abbr></p>
<p>&emsp;&emsp;浏览器通过对不同事件的处理来满足各种交互需求，这一部分我们一起看看从浏览器的视角，事件是什么，在此我们先主要考虑鼠标事件。</p>
<p>&emsp;&emsp;在浏览器的看来，用户的所有手势都是输入，鼠标滚动，悬置，点击等等都是。</p>
<p>&emsp;&emsp;当用户在屏幕上触发诸如 touch 等手势时，首先收到手势信息的是 Browser process， 不过 Browser process 只会感知到在哪里发生了手势，对 tab 内内容的处理是还是由渲染进程控制的。</p>
<p>&emsp;&emsp;事件发生时，浏览器进程会发送事件类型及相应的坐标给渲染进程，渲染进程随后找到事件对象并执行所有绑定在其上的相关事件处理函数。</p>
<p><img src="https://static.geekbang.org/infoq/5bee799b19700.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">事件从浏览器进程传送给渲染进程</abbr></p>
<p>&emsp;&emsp;前文中，我们提到过合成器可以独立于主线程之外通过合成栅格化层平滑的处理滚动。如果页面中没有绑定相关事件，组合器线程可以独立于主线程创建组合帧。如果页面绑定了相关事件处理器，主线程就不得不出来工作了。这时候合成器线程会怎么处理呢？</p>
<p>&emsp;&emsp;这里涉及到一个专业名词「理解非快速滚动区域（non-fast scrollable region）」由于执行 JS 是主线程的工作，当页面合成时，合成器线程会标记页面中绑定有事件处理器的区域为 non-fast scrollable region ，如果存在这个标注，合成器线程会把发生在此处的事件发送给主线程，如果事件不是发生在这些区域，合成器线程则会直接合成新的帧而不用等到主线程的响应。</p>
<p><img src="https://static.geekbang.org/infoq/5bee79c0bec31.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">涉及 non-fast scrollable region 的事件，合成器线程会通知主线程进行相关处理。</abbr></p>
<p>&emsp;&emsp;web 开发中常用的事件处理模式是事件委托，基于事件冒泡，我们常常在最顶层绑定事件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.body.addEventListener(<span class="string">'touchstart'</span>,</span><br><span class="line">event =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (event.target === area) &#123;</span><br><span class="line">        event.preventDefault();</span><br><span class="line">    &#125;</span><br><span class="line">   &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;上述做法很常见，但是如果从浏览器的角度看，整个页面都成了 non-fast scrollable region 了。</p>
<p>&emsp;&emsp;这意味着即使操作的是页面无绑定事件处理器的区域，每次输入时，合成器线程也需要和主线程通信并等待反馈，流畅的合成器独立处理合成帧的模式就失效了。</p>
<p><img src="https://static.geekbang.org/infoq/5bee7a0edfb3e.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">由于事件绑定在最顶部，整个页面都成为了 non-fast scrollable region。</abbr></p>
<p>&emsp;&emsp;为了防止这种情况，我们可以为事件处理器传递 passive: true 做为参数，这样写就能让浏览器即监听相关事件，又让组合器线程在等等主线程响应前构建新的组合帧。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.body.addEventListener(<span class="string">'touchstart'</span>,</span><br><span class="line">event =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (event.target === area) &#123;</span><br><span class="line">        event.preventDefault()</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;, &#123;<span class="attr">passive</span>: <span class="literal">true</span>&#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;不过上述写法可能又会带来另外一个问题，假设某个区域你只想要水平滚动，使用 passive: true 可以实现平滑滚动，但是垂直方向的滚动可能会先于event.preventDefault()发生，此时可以通过 event.cancelable 来防止这种情况。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.body.addEventListener(<span class="string">'pointermove'</span>, event =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (event.cancelable) &#123;</span><br><span class="line">        event.preventDefault(); <span class="comment">// block the native scroll</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        *  do what you want the application to do here</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;, &#123;<span class="attr">passive</span>: <span class="literal">true</span>&#125;);</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;也可以使用 css 属性 touch-action 来完全消除事件处理器的影响，如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#area &#123;</span><br><span class="line">  touch-action: pan-x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<abbr style="font-size: 24px;color:#333">查找到事件对象</abbr></p>
<p>&emsp;&emsp;当组合器线程发送输入事件给主线程时，主线程首先会进行命中测试（hit test）来查找对应的事件目标，命中测试会基于渲染过程中生成的绘制记录（ paint records ）查找事件发生坐标下存在的元素。</p>
<p><img src="https://static.geekbang.org/infoq/5bee7a6eabda8.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">主线程依据绘制记录查找事件相关元素。</abbr></p>
<p>&emsp;&emsp;<abbr style="font-size: 24px;color:#333">事件的优化</abbr></p>
<p>&emsp;&emsp;一般我们屏幕的刷新速率为 60fps，但是某些事件的触发量会不止这个值，出于优化的目的，Chrome 会合并连续的事件 (如 wheel, mousewheel, mousemove, pointermove, touchmove )，并延迟到下一帧渲染时候执行 。</p>
<p>&emsp;&emsp;而如 keydown, keyup, mouseup, mousedown, touchstart, 和 touchend 等非连续性事件则会立即被触发。</p>
<p><img src="https://static.geekbang.org/infoq/5bee7aa6246fb.png" alt=""></p>
<p>&emsp;&emsp;<abbr style="font-style:italic;color:#333;">Chrome 会合并连续事件到下一帧触发。</abbr></p>
<p>&emsp;&emsp;合并事件虽然能提示性能，但是如果你的应用是绘画等，则很难绘制一条平滑的曲线了，此时可以使用 getCoalescedEvents API 来获取组合的事件。示例代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'pointermove'</span>, event =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> events = event.getCoalescedEvents();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> event <span class="keyword">of</span> events) &#123;</span><br><span class="line">        <span class="keyword">const</span> x = event.pageX;</span><br><span class="line">        <span class="keyword">const</span> y = event.pageY;</span><br><span class="line">        <span class="comment">// draw a line using x and y coordinates.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="https://static.geekbang.org/infoq/5bee7ad900bf5.png" alt=""></p>
<p>&emsp;&emsp;感谢作者,真是好文</p>

      
    </div>
      <div id="remark"></div>
    <div class="article-info article-info-index">
      
      <a href="/2018/11/20/gooleWorkPrinciple/" class="archive-article-date">
  	<time datetime="2018-11-20T08:12:31.000Z" itemprop="datePublished"><i class="icon-clock"></i>2018-11-20</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/依赖倒置原则/">依赖倒置原则</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端/">前端</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端设计模式/">前端设计模式</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/个人博客/">个人博客</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-underscorejs" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/20/underscorejs/">underscore源码-带中文注解</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br><span class="line">1303</span><br><span class="line">1304</span><br><span class="line">1305</span><br><span class="line">1306</span><br><span class="line">1307</span><br><span class="line">1308</span><br><span class="line">1309</span><br><span class="line">1310</span><br><span class="line">1311</span><br><span class="line">1312</span><br><span class="line">1313</span><br><span class="line">1314</span><br><span class="line">1315</span><br><span class="line">1316</span><br><span class="line">1317</span><br><span class="line">1318</span><br><span class="line">1319</span><br><span class="line">1320</span><br><span class="line">1321</span><br><span class="line">1322</span><br><span class="line">1323</span><br><span class="line">1324</span><br><span class="line">1325</span><br><span class="line">1326</span><br><span class="line">1327</span><br><span class="line">1328</span><br><span class="line">1329</span><br><span class="line">1330</span><br><span class="line">1331</span><br><span class="line">1332</span><br><span class="line">1333</span><br><span class="line">1334</span><br><span class="line">1335</span><br><span class="line">1336</span><br><span class="line">1337</span><br><span class="line">1338</span><br><span class="line">1339</span><br><span class="line">1340</span><br><span class="line">1341</span><br><span class="line">1342</span><br><span class="line">1343</span><br><span class="line">1344</span><br><span class="line">1345</span><br><span class="line">1346</span><br><span class="line">1347</span><br><span class="line">1348</span><br><span class="line">1349</span><br><span class="line">1350</span><br><span class="line">1351</span><br><span class="line">1352</span><br><span class="line">1353</span><br><span class="line">1354</span><br><span class="line">1355</span><br><span class="line">1356</span><br><span class="line">1357</span><br><span class="line">1358</span><br><span class="line">1359</span><br><span class="line">1360</span><br><span class="line">1361</span><br><span class="line">1362</span><br><span class="line">1363</span><br><span class="line">1364</span><br><span class="line">1365</span><br><span class="line">1366</span><br><span class="line">1367</span><br><span class="line">1368</span><br><span class="line">1369</span><br><span class="line">1370</span><br><span class="line">1371</span><br><span class="line">1372</span><br><span class="line">1373</span><br><span class="line">1374</span><br><span class="line">1375</span><br><span class="line">1376</span><br><span class="line">1377</span><br><span class="line">1378</span><br><span class="line">1379</span><br><span class="line">1380</span><br><span class="line">1381</span><br><span class="line">1382</span><br><span class="line">1383</span><br><span class="line">1384</span><br><span class="line">1385</span><br><span class="line">1386</span><br><span class="line">1387</span><br><span class="line">1388</span><br><span class="line">1389</span><br><span class="line">1390</span><br><span class="line">1391</span><br><span class="line">1392</span><br><span class="line">1393</span><br><span class="line">1394</span><br><span class="line">1395</span><br><span class="line">1396</span><br><span class="line">1397</span><br><span class="line">1398</span><br><span class="line">1399</span><br><span class="line">1400</span><br><span class="line">1401</span><br><span class="line">1402</span><br><span class="line">1403</span><br><span class="line">1404</span><br><span class="line">1405</span><br><span class="line">1406</span><br><span class="line">1407</span><br><span class="line">1408</span><br><span class="line">1409</span><br><span class="line">1410</span><br><span class="line">1411</span><br><span class="line">1412</span><br><span class="line">1413</span><br><span class="line">1414</span><br><span class="line">1415</span><br><span class="line">1416</span><br><span class="line">1417</span><br><span class="line">1418</span><br><span class="line">1419</span><br><span class="line">1420</span><br><span class="line">1421</span><br><span class="line">1422</span><br><span class="line">1423</span><br><span class="line">1424</span><br><span class="line">1425</span><br><span class="line">1426</span><br><span class="line">1427</span><br><span class="line">1428</span><br><span class="line">1429</span><br><span class="line">1430</span><br><span class="line">1431</span><br><span class="line">1432</span><br><span class="line">1433</span><br><span class="line">1434</span><br><span class="line">1435</span><br><span class="line">1436</span><br><span class="line">1437</span><br><span class="line">1438</span><br><span class="line">1439</span><br><span class="line">1440</span><br><span class="line">1441</span><br><span class="line">1442</span><br><span class="line">1443</span><br><span class="line">1444</span><br><span class="line">1445</span><br><span class="line">1446</span><br><span class="line">1447</span><br><span class="line">1448</span><br><span class="line">1449</span><br><span class="line">1450</span><br><span class="line">1451</span><br><span class="line">1452</span><br><span class="line">1453</span><br><span class="line">1454</span><br><span class="line">1455</span><br><span class="line">1456</span><br><span class="line">1457</span><br><span class="line">1458</span><br><span class="line">1459</span><br><span class="line">1460</span><br><span class="line">1461</span><br><span class="line">1462</span><br><span class="line">1463</span><br><span class="line">1464</span><br><span class="line">1465</span><br><span class="line">1466</span><br><span class="line">1467</span><br><span class="line">1468</span><br><span class="line">1469</span><br><span class="line">1470</span><br><span class="line">1471</span><br><span class="line">1472</span><br><span class="line">1473</span><br><span class="line">1474</span><br><span class="line">1475</span><br><span class="line">1476</span><br><span class="line">1477</span><br><span class="line">1478</span><br><span class="line">1479</span><br><span class="line">1480</span><br><span class="line">1481</span><br><span class="line">1482</span><br><span class="line">1483</span><br><span class="line">1484</span><br><span class="line">1485</span><br><span class="line">1486</span><br><span class="line">1487</span><br><span class="line">1488</span><br><span class="line">1489</span><br><span class="line">1490</span><br><span class="line">1491</span><br><span class="line">1492</span><br><span class="line">1493</span><br><span class="line">1494</span><br><span class="line">1495</span><br><span class="line">1496</span><br><span class="line">1497</span><br><span class="line">1498</span><br><span class="line">1499</span><br><span class="line">1500</span><br><span class="line">1501</span><br><span class="line">1502</span><br><span class="line">1503</span><br><span class="line">1504</span><br><span class="line">1505</span><br><span class="line">1506</span><br><span class="line">1507</span><br><span class="line">1508</span><br><span class="line">1509</span><br><span class="line">1510</span><br><span class="line">1511</span><br><span class="line">1512</span><br><span class="line">1513</span><br><span class="line">1514</span><br><span class="line">1515</span><br><span class="line">1516</span><br><span class="line">1517</span><br><span class="line">1518</span><br><span class="line">1519</span><br><span class="line">1520</span><br><span class="line">1521</span><br><span class="line">1522</span><br><span class="line">1523</span><br><span class="line">1524</span><br><span class="line">1525</span><br><span class="line">1526</span><br><span class="line">1527</span><br><span class="line">1528</span><br><span class="line">1529</span><br><span class="line">1530</span><br><span class="line">1531</span><br><span class="line">1532</span><br><span class="line">1533</span><br><span class="line">1534</span><br><span class="line">1535</span><br><span class="line">1536</span><br><span class="line">1537</span><br><span class="line">1538</span><br><span class="line">1539</span><br><span class="line">1540</span><br><span class="line">1541</span><br><span class="line">1542</span><br><span class="line">1543</span><br><span class="line">1544</span><br><span class="line">1545</span><br><span class="line">1546</span><br><span class="line">1547</span><br><span class="line">1548</span><br><span class="line">1549</span><br><span class="line">1550</span><br><span class="line">1551</span><br><span class="line">1552</span><br><span class="line">1553</span><br><span class="line">1554</span><br><span class="line">1555</span><br><span class="line">1556</span><br><span class="line">1557</span><br><span class="line">1558</span><br><span class="line">1559</span><br><span class="line">1560</span><br><span class="line">1561</span><br><span class="line">1562</span><br><span class="line">1563</span><br><span class="line">1564</span><br><span class="line">1565</span><br><span class="line">1566</span><br><span class="line">1567</span><br><span class="line">1568</span><br><span class="line">1569</span><br><span class="line">1570</span><br><span class="line">1571</span><br><span class="line">1572</span><br><span class="line">1573</span><br><span class="line">1574</span><br><span class="line">1575</span><br><span class="line">1576</span><br><span class="line">1577</span><br><span class="line">1578</span><br><span class="line">1579</span><br><span class="line">1580</span><br><span class="line">1581</span><br><span class="line">1582</span><br><span class="line">1583</span><br><span class="line">1584</span><br><span class="line">1585</span><br><span class="line">1586</span><br><span class="line">1587</span><br><span class="line">1588</span><br><span class="line">1589</span><br><span class="line">1590</span><br><span class="line">1591</span><br><span class="line">1592</span><br><span class="line">1593</span><br><span class="line">1594</span><br><span class="line">1595</span><br><span class="line">1596</span><br><span class="line">1597</span><br><span class="line">1598</span><br><span class="line">1599</span><br><span class="line">1600</span><br><span class="line">1601</span><br><span class="line">1602</span><br><span class="line">1603</span><br><span class="line">1604</span><br><span class="line">1605</span><br><span class="line">1606</span><br><span class="line">1607</span><br><span class="line">1608</span><br><span class="line">1609</span><br><span class="line">1610</span><br><span class="line">1611</span><br><span class="line">1612</span><br><span class="line">1613</span><br><span class="line">1614</span><br><span class="line">1615</span><br><span class="line">1616</span><br><span class="line">1617</span><br><span class="line">1618</span><br><span class="line">1619</span><br><span class="line">1620</span><br><span class="line">1621</span><br><span class="line">1622</span><br><span class="line">1623</span><br><span class="line">1624</span><br><span class="line">1625</span><br><span class="line">1626</span><br><span class="line">1627</span><br><span class="line">1628</span><br><span class="line">1629</span><br><span class="line">1630</span><br><span class="line">1631</span><br><span class="line">1632</span><br><span class="line">1633</span><br><span class="line">1634</span><br><span class="line">1635</span><br><span class="line">1636</span><br><span class="line">1637</span><br><span class="line">1638</span><br><span class="line">1639</span><br><span class="line">1640</span><br><span class="line">1641</span><br><span class="line">1642</span><br><span class="line">1643</span><br><span class="line">1644</span><br><span class="line">1645</span><br><span class="line">1646</span><br><span class="line">1647</span><br><span class="line">1648</span><br><span class="line">1649</span><br><span class="line">1650</span><br><span class="line">1651</span><br><span class="line">1652</span><br><span class="line">1653</span><br><span class="line">1654</span><br><span class="line">1655</span><br><span class="line">1656</span><br><span class="line">1657</span><br><span class="line">1658</span><br><span class="line">1659</span><br><span class="line">1660</span><br><span class="line">1661</span><br><span class="line">1662</span><br><span class="line">1663</span><br><span class="line">1664</span><br><span class="line">1665</span><br><span class="line">1666</span><br><span class="line">1667</span><br><span class="line">1668</span><br><span class="line">1669</span><br><span class="line">1670</span><br><span class="line">1671</span><br><span class="line">1672</span><br><span class="line">1673</span><br><span class="line">1674</span><br><span class="line">1675</span><br><span class="line">1676</span><br><span class="line">1677</span><br><span class="line">1678</span><br><span class="line">1679</span><br><span class="line">1680</span><br><span class="line">1681</span><br><span class="line">1682</span><br><span class="line">1683</span><br><span class="line">1684</span><br><span class="line">1685</span><br><span class="line">1686</span><br><span class="line">1687</span><br><span class="line">1688</span><br><span class="line">1689</span><br><span class="line">1690</span><br><span class="line">1691</span><br><span class="line">1692</span><br><span class="line">1693</span><br><span class="line">1694</span><br><span class="line">1695</span><br><span class="line">1696</span><br><span class="line">1697</span><br><span class="line">1698</span><br><span class="line">1699</span><br><span class="line">1700</span><br><span class="line">1701</span><br><span class="line">1702</span><br><span class="line">1703</span><br><span class="line">1704</span><br><span class="line">1705</span><br><span class="line">1706</span><br><span class="line">1707</span><br><span class="line">1708</span><br><span class="line">1709</span><br><span class="line">1710</span><br><span class="line">1711</span><br><span class="line">1712</span><br><span class="line">1713</span><br><span class="line">1714</span><br><span class="line">1715</span><br><span class="line">1716</span><br><span class="line">1717</span><br><span class="line">1718</span><br><span class="line">1719</span><br><span class="line">1720</span><br><span class="line">1721</span><br><span class="line">1722</span><br><span class="line">1723</span><br><span class="line">1724</span><br><span class="line">1725</span><br><span class="line">1726</span><br><span class="line">1727</span><br><span class="line">1728</span><br><span class="line">1729</span><br><span class="line">1730</span><br><span class="line">1731</span><br><span class="line">1732</span><br><span class="line">1733</span><br><span class="line">1734</span><br><span class="line">1735</span><br><span class="line">1736</span><br><span class="line">1737</span><br><span class="line">1738</span><br><span class="line">1739</span><br><span class="line">1740</span><br><span class="line">1741</span><br><span class="line">1742</span><br><span class="line">1743</span><br><span class="line">1744</span><br><span class="line">1745</span><br><span class="line">1746</span><br><span class="line">1747</span><br><span class="line">1748</span><br><span class="line">1749</span><br><span class="line">1750</span><br><span class="line">1751</span><br><span class="line">1752</span><br><span class="line">1753</span><br><span class="line">1754</span><br><span class="line">1755</span><br><span class="line">1756</span><br><span class="line">1757</span><br><span class="line">1758</span><br><span class="line">1759</span><br><span class="line">1760</span><br><span class="line">1761</span><br><span class="line">1762</span><br><span class="line">1763</span><br><span class="line">1764</span><br><span class="line">1765</span><br><span class="line">1766</span><br><span class="line">1767</span><br><span class="line">1768</span><br><span class="line">1769</span><br><span class="line">1770</span><br><span class="line">1771</span><br><span class="line">1772</span><br><span class="line">1773</span><br><span class="line">1774</span><br><span class="line">1775</span><br><span class="line">1776</span><br><span class="line">1777</span><br><span class="line">1778</span><br><span class="line">1779</span><br><span class="line">1780</span><br><span class="line">1781</span><br><span class="line">1782</span><br><span class="line">1783</span><br><span class="line">1784</span><br><span class="line">1785</span><br><span class="line">1786</span><br><span class="line">1787</span><br><span class="line">1788</span><br><span class="line">1789</span><br><span class="line">1790</span><br><span class="line">1791</span><br><span class="line">1792</span><br><span class="line">1793</span><br><span class="line">1794</span><br><span class="line">1795</span><br><span class="line">1796</span><br><span class="line">1797</span><br><span class="line">1798</span><br><span class="line">1799</span><br><span class="line">1800</span><br><span class="line">1801</span><br><span class="line">1802</span><br><span class="line">1803</span><br><span class="line">1804</span><br><span class="line">1805</span><br><span class="line">1806</span><br><span class="line">1807</span><br><span class="line">1808</span><br><span class="line">1809</span><br><span class="line">1810</span><br><span class="line">1811</span><br><span class="line">1812</span><br><span class="line">1813</span><br><span class="line">1814</span><br><span class="line">1815</span><br><span class="line">1816</span><br><span class="line">1817</span><br><span class="line">1818</span><br><span class="line">1819</span><br><span class="line">1820</span><br><span class="line">1821</span><br><span class="line">1822</span><br><span class="line">1823</span><br><span class="line">1824</span><br><span class="line">1825</span><br><span class="line">1826</span><br><span class="line">1827</span><br><span class="line">1828</span><br><span class="line">1829</span><br><span class="line">1830</span><br><span class="line">1831</span><br><span class="line">1832</span><br><span class="line">1833</span><br><span class="line">1834</span><br><span class="line">1835</span><br><span class="line">1836</span><br><span class="line">1837</span><br><span class="line">1838</span><br><span class="line">1839</span><br><span class="line">1840</span><br><span class="line">1841</span><br><span class="line">1842</span><br><span class="line">1843</span><br><span class="line">1844</span><br><span class="line">1845</span><br><span class="line">1846</span><br><span class="line">1847</span><br><span class="line">1848</span><br><span class="line">1849</span><br><span class="line">1850</span><br><span class="line">1851</span><br><span class="line">1852</span><br><span class="line">1853</span><br><span class="line">1854</span><br><span class="line">1855</span><br><span class="line">1856</span><br><span class="line">1857</span><br><span class="line">1858</span><br><span class="line">1859</span><br><span class="line">1860</span><br><span class="line">1861</span><br><span class="line">1862</span><br><span class="line">1863</span><br><span class="line">1864</span><br><span class="line">1865</span><br><span class="line">1866</span><br><span class="line">1867</span><br><span class="line">1868</span><br><span class="line">1869</span><br><span class="line">1870</span><br><span class="line">1871</span><br><span class="line">1872</span><br><span class="line">1873</span><br><span class="line">1874</span><br><span class="line">1875</span><br><span class="line">1876</span><br><span class="line">1877</span><br><span class="line">1878</span><br><span class="line">1879</span><br><span class="line">1880</span><br><span class="line">1881</span><br><span class="line">1882</span><br><span class="line">1883</span><br><span class="line">1884</span><br><span class="line">1885</span><br><span class="line">1886</span><br><span class="line">1887</span><br><span class="line">1888</span><br><span class="line">1889</span><br><span class="line">1890</span><br><span class="line">1891</span><br><span class="line">1892</span><br><span class="line">1893</span><br><span class="line">1894</span><br><span class="line">1895</span><br><span class="line">1896</span><br><span class="line">1897</span><br><span class="line">1898</span><br><span class="line">1899</span><br><span class="line">1900</span><br><span class="line">1901</span><br><span class="line">1902</span><br><span class="line">1903</span><br><span class="line">1904</span><br><span class="line">1905</span><br><span class="line">1906</span><br><span class="line">1907</span><br><span class="line">1908</span><br><span class="line">1909</span><br><span class="line">1910</span><br><span class="line">1911</span><br><span class="line">1912</span><br><span class="line">1913</span><br><span class="line">1914</span><br><span class="line">1915</span><br><span class="line">1916</span><br><span class="line">1917</span><br><span class="line">1918</span><br><span class="line">1919</span><br><span class="line">1920</span><br><span class="line">1921</span><br><span class="line">1922</span><br><span class="line">1923</span><br><span class="line">1924</span><br><span class="line">1925</span><br><span class="line">1926</span><br><span class="line">1927</span><br><span class="line">1928</span><br><span class="line">1929</span><br><span class="line">1930</span><br><span class="line">1931</span><br><span class="line">1932</span><br><span class="line">1933</span><br><span class="line">1934</span><br><span class="line">1935</span><br><span class="line">1936</span><br><span class="line">1937</span><br><span class="line">1938</span><br><span class="line">1939</span><br><span class="line">1940</span><br><span class="line">1941</span><br><span class="line">1942</span><br><span class="line">1943</span><br><span class="line">1944</span><br><span class="line">1945</span><br><span class="line">1946</span><br><span class="line">1947</span><br><span class="line">1948</span><br><span class="line">1949</span><br><span class="line">1950</span><br><span class="line">1951</span><br><span class="line">1952</span><br><span class="line">1953</span><br><span class="line">1954</span><br><span class="line">1955</span><br><span class="line">1956</span><br><span class="line">1957</span><br><span class="line">1958</span><br><span class="line">1959</span><br><span class="line">1960</span><br><span class="line">1961</span><br><span class="line">1962</span><br><span class="line">1963</span><br><span class="line">1964</span><br><span class="line">1965</span><br><span class="line">1966</span><br><span class="line">1967</span><br><span class="line">1968</span><br><span class="line">1969</span><br><span class="line">1970</span><br><span class="line">1971</span><br><span class="line">1972</span><br><span class="line">1973</span><br><span class="line">1974</span><br><span class="line">1975</span><br><span class="line">1976</span><br><span class="line">1977</span><br><span class="line">1978</span><br><span class="line">1979</span><br><span class="line">1980</span><br><span class="line">1981</span><br><span class="line">1982</span><br><span class="line">1983</span><br><span class="line">1984</span><br><span class="line">1985</span><br><span class="line">1986</span><br><span class="line">1987</span><br><span class="line">1988</span><br><span class="line">1989</span><br><span class="line">1990</span><br><span class="line">1991</span><br><span class="line">1992</span><br><span class="line">1993</span><br><span class="line">1994</span><br><span class="line">1995</span><br><span class="line">1996</span><br><span class="line">1997</span><br><span class="line">1998</span><br><span class="line">1999</span><br><span class="line">2000</span><br><span class="line">2001</span><br><span class="line">2002</span><br><span class="line">2003</span><br><span class="line">2004</span><br><span class="line">2005</span><br><span class="line">2006</span><br><span class="line">2007</span><br><span class="line">2008</span><br><span class="line">2009</span><br><span class="line">2010</span><br><span class="line">2011</span><br><span class="line">2012</span><br><span class="line">2013</span><br><span class="line">2014</span><br><span class="line">2015</span><br><span class="line">2016</span><br><span class="line">2017</span><br><span class="line">2018</span><br><span class="line">2019</span><br><span class="line">2020</span><br><span class="line">2021</span><br><span class="line">2022</span><br><span class="line">2023</span><br><span class="line">2024</span><br><span class="line">2025</span><br><span class="line">2026</span><br><span class="line">2027</span><br><span class="line">2028</span><br><span class="line">2029</span><br><span class="line">2030</span><br><span class="line">2031</span><br><span class="line">2032</span><br><span class="line">2033</span><br><span class="line">2034</span><br><span class="line">2035</span><br><span class="line">2036</span><br><span class="line">2037</span><br><span class="line">2038</span><br><span class="line">2039</span><br><span class="line">2040</span><br><span class="line">2041</span><br><span class="line">2042</span><br><span class="line">2043</span><br><span class="line">2044</span><br><span class="line">2045</span><br><span class="line">2046</span><br><span class="line">2047</span><br><span class="line">2048</span><br><span class="line">2049</span><br><span class="line">2050</span><br><span class="line">2051</span><br><span class="line">2052</span><br><span class="line">2053</span><br><span class="line">2054</span><br><span class="line">2055</span><br><span class="line">2056</span><br><span class="line">2057</span><br><span class="line">2058</span><br><span class="line">2059</span><br><span class="line">2060</span><br><span class="line">2061</span><br><span class="line">2062</span><br><span class="line">2063</span><br><span class="line">2064</span><br><span class="line">2065</span><br><span class="line">2066</span><br><span class="line">2067</span><br><span class="line">2068</span><br><span class="line">2069</span><br><span class="line">2070</span><br><span class="line">2071</span><br><span class="line">2072</span><br><span class="line">2073</span><br><span class="line">2074</span><br><span class="line">2075</span><br><span class="line">2076</span><br><span class="line">2077</span><br><span class="line">2078</span><br><span class="line">2079</span><br><span class="line">2080</span><br><span class="line">2081</span><br><span class="line">2082</span><br><span class="line">2083</span><br><span class="line">2084</span><br><span class="line">2085</span><br><span class="line">2086</span><br><span class="line">2087</span><br><span class="line">2088</span><br><span class="line">2089</span><br><span class="line">2090</span><br><span class="line">2091</span><br><span class="line">2092</span><br><span class="line">2093</span><br><span class="line">2094</span><br><span class="line">2095</span><br><span class="line">2096</span><br><span class="line">2097</span><br><span class="line">2098</span><br><span class="line">2099</span><br><span class="line">2100</span><br><span class="line">2101</span><br><span class="line">2102</span><br><span class="line">2103</span><br><span class="line">2104</span><br><span class="line">2105</span><br><span class="line">2106</span><br><span class="line">2107</span><br><span class="line">2108</span><br><span class="line">2109</span><br><span class="line">2110</span><br><span class="line">2111</span><br><span class="line">2112</span><br><span class="line">2113</span><br><span class="line">2114</span><br><span class="line">2115</span><br><span class="line">2116</span><br><span class="line">2117</span><br><span class="line">2118</span><br><span class="line">2119</span><br><span class="line">2120</span><br><span class="line">2121</span><br><span class="line">2122</span><br><span class="line">2123</span><br><span class="line">2124</span><br><span class="line">2125</span><br><span class="line">2126</span><br><span class="line">2127</span><br><span class="line">2128</span><br><span class="line">2129</span><br><span class="line">2130</span><br><span class="line">2131</span><br><span class="line">2132</span><br><span class="line">2133</span><br><span class="line">2134</span><br><span class="line">2135</span><br><span class="line">2136</span><br><span class="line">2137</span><br><span class="line">2138</span><br><span class="line">2139</span><br><span class="line">2140</span><br><span class="line">2141</span><br><span class="line">2142</span><br><span class="line">2143</span><br><span class="line">2144</span><br><span class="line">2145</span><br><span class="line">2146</span><br><span class="line">2147</span><br><span class="line">2148</span><br><span class="line">2149</span><br><span class="line">2150</span><br><span class="line">2151</span><br><span class="line">2152</span><br><span class="line">2153</span><br><span class="line">2154</span><br><span class="line">2155</span><br><span class="line">2156</span><br><span class="line">2157</span><br><span class="line">2158</span><br><span class="line">2159</span><br><span class="line">2160</span><br><span class="line">2161</span><br><span class="line">2162</span><br><span class="line">2163</span><br><span class="line">2164</span><br><span class="line">2165</span><br><span class="line">2166</span><br><span class="line">2167</span><br><span class="line">2168</span><br><span class="line">2169</span><br><span class="line">2170</span><br><span class="line">2171</span><br><span class="line">2172</span><br><span class="line">2173</span><br><span class="line">2174</span><br><span class="line">2175</span><br><span class="line">2176</span><br><span class="line">2177</span><br><span class="line">2178</span><br><span class="line">2179</span><br><span class="line">2180</span><br><span class="line">2181</span><br><span class="line">2182</span><br><span class="line">2183</span><br><span class="line">2184</span><br><span class="line">2185</span><br><span class="line">2186</span><br><span class="line">2187</span><br><span class="line">2188</span><br><span class="line">2189</span><br><span class="line">2190</span><br><span class="line">2191</span><br><span class="line">2192</span><br><span class="line">2193</span><br><span class="line">2194</span><br><span class="line">2195</span><br><span class="line">2196</span><br><span class="line">2197</span><br><span class="line">2198</span><br><span class="line">2199</span><br><span class="line">2200</span><br><span class="line">2201</span><br><span class="line">2202</span><br><span class="line">2203</span><br><span class="line">2204</span><br><span class="line">2205</span><br><span class="line">2206</span><br><span class="line">2207</span><br><span class="line">2208</span><br><span class="line">2209</span><br><span class="line">2210</span><br><span class="line">2211</span><br><span class="line">2212</span><br><span class="line">2213</span><br><span class="line">2214</span><br><span class="line">2215</span><br><span class="line">2216</span><br><span class="line">2217</span><br><span class="line">2218</span><br><span class="line">2219</span><br><span class="line">2220</span><br><span class="line">2221</span><br><span class="line">2222</span><br><span class="line">2223</span><br><span class="line">2224</span><br><span class="line">2225</span><br><span class="line">2226</span><br><span class="line">2227</span><br><span class="line">2228</span><br><span class="line">2229</span><br><span class="line">2230</span><br><span class="line">2231</span><br><span class="line">2232</span><br><span class="line">2233</span><br><span class="line">2234</span><br><span class="line">2235</span><br><span class="line">2236</span><br><span class="line">2237</span><br><span class="line">2238</span><br><span class="line">2239</span><br><span class="line">2240</span><br><span class="line">2241</span><br><span class="line">2242</span><br><span class="line">2243</span><br><span class="line">2244</span><br><span class="line">2245</span><br><span class="line">2246</span><br><span class="line">2247</span><br><span class="line">2248</span><br><span class="line">2249</span><br><span class="line">2250</span><br><span class="line">2251</span><br><span class="line">2252</span><br><span class="line">2253</span><br><span class="line">2254</span><br><span class="line">2255</span><br><span class="line">2256</span><br><span class="line">2257</span><br><span class="line">2258</span><br><span class="line">2259</span><br><span class="line">2260</span><br><span class="line">2261</span><br><span class="line">2262</span><br><span class="line">2263</span><br><span class="line">2264</span><br><span class="line">2265</span><br><span class="line">2266</span><br><span class="line">2267</span><br><span class="line">2268</span><br><span class="line">2269</span><br><span class="line">2270</span><br><span class="line">2271</span><br><span class="line">2272</span><br><span class="line">2273</span><br><span class="line">2274</span><br><span class="line">2275</span><br><span class="line">2276</span><br><span class="line">2277</span><br><span class="line">2278</span><br><span class="line">2279</span><br><span class="line">2280</span><br><span class="line">2281</span><br><span class="line">2282</span><br><span class="line">2283</span><br><span class="line">2284</span><br><span class="line">2285</span><br><span class="line">2286</span><br><span class="line">2287</span><br><span class="line">2288</span><br><span class="line">2289</span><br><span class="line">2290</span><br><span class="line">2291</span><br><span class="line">2292</span><br><span class="line">2293</span><br><span class="line">2294</span><br><span class="line">2295</span><br><span class="line">2296</span><br><span class="line">2297</span><br><span class="line">2298</span><br><span class="line">2299</span><br><span class="line">2300</span><br><span class="line">2301</span><br><span class="line">2302</span><br><span class="line">2303</span><br><span class="line">2304</span><br><span class="line">2305</span><br><span class="line">2306</span><br><span class="line">2307</span><br><span class="line">2308</span><br><span class="line">2309</span><br><span class="line">2310</span><br><span class="line">2311</span><br><span class="line">2312</span><br><span class="line">2313</span><br><span class="line">2314</span><br><span class="line">2315</span><br><span class="line">2316</span><br><span class="line">2317</span><br><span class="line">2318</span><br><span class="line">2319</span><br><span class="line">2320</span><br><span class="line">2321</span><br><span class="line">2322</span><br><span class="line">2323</span><br><span class="line">2324</span><br><span class="line">2325</span><br><span class="line">2326</span><br><span class="line">2327</span><br><span class="line">2328</span><br><span class="line">2329</span><br><span class="line">2330</span><br><span class="line">2331</span><br><span class="line">2332</span><br><span class="line">2333</span><br><span class="line">2334</span><br><span class="line">2335</span><br><span class="line">2336</span><br><span class="line">2337</span><br><span class="line">2338</span><br><span class="line">2339</span><br><span class="line">2340</span><br><span class="line">2341</span><br><span class="line">2342</span><br><span class="line">2343</span><br><span class="line">2344</span><br><span class="line">2345</span><br><span class="line">2346</span><br><span class="line">2347</span><br><span class="line">2348</span><br><span class="line">2349</span><br><span class="line">2350</span><br><span class="line">2351</span><br><span class="line">2352</span><br><span class="line">2353</span><br><span class="line">2354</span><br><span class="line">2355</span><br><span class="line">2356</span><br><span class="line">2357</span><br><span class="line">2358</span><br><span class="line">2359</span><br><span class="line">2360</span><br><span class="line">2361</span><br><span class="line">2362</span><br><span class="line">2363</span><br><span class="line">2364</span><br><span class="line">2365</span><br><span class="line">2366</span><br><span class="line">2367</span><br><span class="line">2368</span><br><span class="line">2369</span><br><span class="line">2370</span><br><span class="line">2371</span><br><span class="line">2372</span><br><span class="line">2373</span><br><span class="line">2374</span><br><span class="line">2375</span><br><span class="line">2376</span><br><span class="line">2377</span><br><span class="line">2378</span><br><span class="line">2379</span><br><span class="line">2380</span><br><span class="line">2381</span><br><span class="line">2382</span><br><span class="line">2383</span><br><span class="line">2384</span><br><span class="line">2385</span><br><span class="line">2386</span><br><span class="line">2387</span><br><span class="line">2388</span><br><span class="line">2389</span><br><span class="line">2390</span><br><span class="line">2391</span><br><span class="line">2392</span><br><span class="line">2393</span><br><span class="line">2394</span><br><span class="line">2395</span><br><span class="line">2396</span><br><span class="line">2397</span><br><span class="line">2398</span><br><span class="line">2399</span><br><span class="line">2400</span><br><span class="line">2401</span><br><span class="line">2402</span><br><span class="line">2403</span><br><span class="line">2404</span><br><span class="line">2405</span><br><span class="line">2406</span><br><span class="line">2407</span><br><span class="line">2408</span><br><span class="line">2409</span><br><span class="line">2410</span><br><span class="line">2411</span><br><span class="line">2412</span><br><span class="line">2413</span><br><span class="line">2414</span><br><span class="line">2415</span><br><span class="line">2416</span><br><span class="line">2417</span><br><span class="line">2418</span><br><span class="line">2419</span><br><span class="line">2420</span><br><span class="line">2421</span><br><span class="line">2422</span><br><span class="line">2423</span><br><span class="line">2424</span><br><span class="line">2425</span><br><span class="line">2426</span><br><span class="line">2427</span><br><span class="line">2428</span><br><span class="line">2429</span><br><span class="line">2430</span><br><span class="line">2431</span><br><span class="line">2432</span><br><span class="line">2433</span><br><span class="line">2434</span><br><span class="line">2435</span><br><span class="line">2436</span><br><span class="line">2437</span><br><span class="line">2438</span><br><span class="line">2439</span><br><span class="line">2440</span><br><span class="line">2441</span><br><span class="line">2442</span><br><span class="line">2443</span><br><span class="line">2444</span><br><span class="line">2445</span><br><span class="line">2446</span><br><span class="line">2447</span><br><span class="line">2448</span><br><span class="line">2449</span><br><span class="line">2450</span><br><span class="line">2451</span><br><span class="line">2452</span><br><span class="line">2453</span><br><span class="line">2454</span><br><span class="line">2455</span><br><span class="line">2456</span><br><span class="line">2457</span><br><span class="line">2458</span><br><span class="line">2459</span><br><span class="line">2460</span><br><span class="line">2461</span><br><span class="line">2462</span><br><span class="line">2463</span><br><span class="line">2464</span><br><span class="line">2465</span><br><span class="line">2466</span><br><span class="line">2467</span><br><span class="line">2468</span><br><span class="line">2469</span><br><span class="line">2470</span><br><span class="line">2471</span><br><span class="line">2472</span><br><span class="line">2473</span><br><span class="line">2474</span><br><span class="line">2475</span><br><span class="line">2476</span><br><span class="line">2477</span><br><span class="line">2478</span><br><span class="line">2479</span><br><span class="line">2480</span><br><span class="line">2481</span><br><span class="line">2482</span><br><span class="line">2483</span><br><span class="line">2484</span><br><span class="line">2485</span><br><span class="line">2486</span><br><span class="line">2487</span><br><span class="line">2488</span><br><span class="line">2489</span><br><span class="line">2490</span><br><span class="line">2491</span><br><span class="line">2492</span><br><span class="line">2493</span><br><span class="line">2494</span><br><span class="line">2495</span><br><span class="line">2496</span><br><span class="line">2497</span><br><span class="line">2498</span><br><span class="line">2499</span><br><span class="line">2500</span><br><span class="line">2501</span><br><span class="line">2502</span><br><span class="line">2503</span><br><span class="line">2504</span><br><span class="line">2505</span><br><span class="line">2506</span><br><span class="line">2507</span><br><span class="line">2508</span><br><span class="line">2509</span><br><span class="line">2510</span><br><span class="line">2511</span><br><span class="line">2512</span><br><span class="line">2513</span><br><span class="line">2514</span><br><span class="line">2515</span><br><span class="line">2516</span><br><span class="line">2517</span><br><span class="line">2518</span><br><span class="line">2519</span><br><span class="line">2520</span><br><span class="line">2521</span><br><span class="line">2522</span><br><span class="line">2523</span><br><span class="line">2524</span><br><span class="line">2525</span><br><span class="line">2526</span><br><span class="line">2527</span><br><span class="line">2528</span><br><span class="line">2529</span><br><span class="line">2530</span><br><span class="line">2531</span><br><span class="line">2532</span><br><span class="line">2533</span><br><span class="line">2534</span><br><span class="line">2535</span><br><span class="line">2536</span><br><span class="line">2537</span><br><span class="line">2538</span><br><span class="line">2539</span><br><span class="line">2540</span><br><span class="line">2541</span><br><span class="line">2542</span><br><span class="line">2543</span><br><span class="line">2544</span><br><span class="line">2545</span><br><span class="line">2546</span><br><span class="line">2547</span><br><span class="line">2548</span><br><span class="line">2549</span><br><span class="line">2550</span><br><span class="line">2551</span><br><span class="line">2552</span><br><span class="line">2553</span><br><span class="line">2554</span><br><span class="line">2555</span><br><span class="line">2556</span><br><span class="line">2557</span><br><span class="line">2558</span><br><span class="line">2559</span><br><span class="line">2560</span><br><span class="line">2561</span><br><span class="line">2562</span><br><span class="line">2563</span><br><span class="line">2564</span><br><span class="line">2565</span><br><span class="line">2566</span><br><span class="line">2567</span><br><span class="line">2568</span><br><span class="line">2569</span><br><span class="line">2570</span><br><span class="line">2571</span><br><span class="line">2572</span><br><span class="line">2573</span><br><span class="line">2574</span><br><span class="line">2575</span><br><span class="line">2576</span><br><span class="line">2577</span><br><span class="line">2578</span><br><span class="line">2579</span><br><span class="line">2580</span><br><span class="line">2581</span><br><span class="line">2582</span><br><span class="line">2583</span><br><span class="line">2584</span><br><span class="line">2585</span><br><span class="line">2586</span><br><span class="line">2587</span><br><span class="line">2588</span><br><span class="line">2589</span><br><span class="line">2590</span><br><span class="line">2591</span><br><span class="line">2592</span><br><span class="line">2593</span><br><span class="line">2594</span><br><span class="line">2595</span><br><span class="line">2596</span><br><span class="line">2597</span><br><span class="line">2598</span><br><span class="line">2599</span><br><span class="line">2600</span><br><span class="line">2601</span><br><span class="line">2602</span><br><span class="line">2603</span><br><span class="line">2604</span><br><span class="line">2605</span><br><span class="line">2606</span><br><span class="line">2607</span><br><span class="line">2608</span><br><span class="line">2609</span><br><span class="line">2610</span><br><span class="line">2611</span><br><span class="line">2612</span><br><span class="line">2613</span><br><span class="line">2614</span><br><span class="line">2615</span><br><span class="line">2616</span><br><span class="line">2617</span><br><span class="line">2618</span><br><span class="line">2619</span><br><span class="line">2620</span><br><span class="line">2621</span><br><span class="line">2622</span><br><span class="line">2623</span><br><span class="line">2624</span><br><span class="line">2625</span><br><span class="line">2626</span><br><span class="line">2627</span><br><span class="line">2628</span><br><span class="line">2629</span><br><span class="line">2630</span><br><span class="line">2631</span><br><span class="line">2632</span><br><span class="line">2633</span><br><span class="line">2634</span><br><span class="line">2635</span><br><span class="line">2636</span><br><span class="line">2637</span><br><span class="line">2638</span><br><span class="line">2639</span><br><span class="line">2640</span><br><span class="line">2641</span><br><span class="line">2642</span><br><span class="line">2643</span><br><span class="line">2644</span><br><span class="line">2645</span><br><span class="line">2646</span><br><span class="line">2647</span><br><span class="line">2648</span><br><span class="line">2649</span><br><span class="line">2650</span><br><span class="line">2651</span><br><span class="line">2652</span><br><span class="line">2653</span><br><span class="line">2654</span><br><span class="line">2655</span><br><span class="line">2656</span><br><span class="line">2657</span><br><span class="line">2658</span><br><span class="line">2659</span><br><span class="line">2660</span><br><span class="line">2661</span><br><span class="line">2662</span><br><span class="line">2663</span><br><span class="line">2664</span><br><span class="line">2665</span><br><span class="line">2666</span><br><span class="line">2667</span><br><span class="line">2668</span><br><span class="line">2669</span><br><span class="line">2670</span><br><span class="line">2671</span><br><span class="line">2672</span><br><span class="line">2673</span><br><span class="line">2674</span><br><span class="line">2675</span><br><span class="line">2676</span><br><span class="line">2677</span><br><span class="line">2678</span><br><span class="line">2679</span><br><span class="line">2680</span><br><span class="line">2681</span><br><span class="line">2682</span><br><span class="line">2683</span><br><span class="line">2684</span><br><span class="line">2685</span><br><span class="line">2686</span><br><span class="line">2687</span><br><span class="line">2688</span><br><span class="line">2689</span><br><span class="line">2690</span><br><span class="line">2691</span><br><span class="line">2692</span><br><span class="line">2693</span><br><span class="line">2694</span><br><span class="line">2695</span><br><span class="line">2696</span><br><span class="line">2697</span><br><span class="line">2698</span><br><span class="line">2699</span><br><span class="line">2700</span><br><span class="line">2701</span><br><span class="line">2702</span><br><span class="line">2703</span><br><span class="line">2704</span><br><span class="line">2705</span><br><span class="line">2706</span><br><span class="line">2707</span><br><span class="line">2708</span><br><span class="line">2709</span><br><span class="line">2710</span><br><span class="line">2711</span><br><span class="line">2712</span><br><span class="line">2713</span><br><span class="line">2714</span><br><span class="line">2715</span><br><span class="line">2716</span><br><span class="line">2717</span><br><span class="line">2718</span><br><span class="line">2719</span><br><span class="line">2720</span><br><span class="line">2721</span><br><span class="line">2722</span><br><span class="line">2723</span><br><span class="line">2724</span><br><span class="line">2725</span><br><span class="line">2726</span><br><span class="line">2727</span><br><span class="line">2728</span><br><span class="line">2729</span><br><span class="line">2730</span><br><span class="line">2731</span><br><span class="line">2732</span><br><span class="line">2733</span><br><span class="line">2734</span><br><span class="line">2735</span><br><span class="line">2736</span><br><span class="line">2737</span><br><span class="line">2738</span><br><span class="line">2739</span><br><span class="line">2740</span><br><span class="line">2741</span><br><span class="line">2742</span><br><span class="line">2743</span><br><span class="line">2744</span><br><span class="line">2745</span><br><span class="line">2746</span><br><span class="line">2747</span><br><span class="line">2748</span><br><span class="line">2749</span><br><span class="line">2750</span><br><span class="line">2751</span><br><span class="line">2752</span><br><span class="line">2753</span><br><span class="line">2754</span><br><span class="line">2755</span><br><span class="line">2756</span><br><span class="line">2757</span><br><span class="line">2758</span><br><span class="line">2759</span><br><span class="line">2760</span><br><span class="line">2761</span><br><span class="line">2762</span><br><span class="line">2763</span><br><span class="line">2764</span><br><span class="line">2765</span><br><span class="line">2766</span><br><span class="line">2767</span><br><span class="line">2768</span><br><span class="line">2769</span><br><span class="line">2770</span><br><span class="line">2771</span><br><span class="line">2772</span><br><span class="line">2773</span><br><span class="line">2774</span><br><span class="line">2775</span><br><span class="line">2776</span><br><span class="line">2777</span><br><span class="line">2778</span><br><span class="line">2779</span><br><span class="line">2780</span><br><span class="line">2781</span><br><span class="line">2782</span><br><span class="line">2783</span><br><span class="line">2784</span><br><span class="line">2785</span><br><span class="line">2786</span><br><span class="line">2787</span><br><span class="line">2788</span><br><span class="line">2789</span><br><span class="line">2790</span><br><span class="line">2791</span><br><span class="line">2792</span><br><span class="line">2793</span><br><span class="line">2794</span><br><span class="line">2795</span><br><span class="line">2796</span><br><span class="line">2797</span><br><span class="line">2798</span><br><span class="line">2799</span><br><span class="line">2800</span><br><span class="line">2801</span><br><span class="line">2802</span><br><span class="line">2803</span><br><span class="line">2804</span><br><span class="line">2805</span><br><span class="line">2806</span><br><span class="line">2807</span><br><span class="line">2808</span><br><span class="line">2809</span><br><span class="line">2810</span><br><span class="line">2811</span><br><span class="line">2812</span><br><span class="line">2813</span><br><span class="line">2814</span><br><span class="line">2815</span><br><span class="line">2816</span><br><span class="line">2817</span><br><span class="line">2818</span><br><span class="line">2819</span><br><span class="line">2820</span><br><span class="line">2821</span><br><span class="line">2822</span><br><span class="line">2823</span><br><span class="line">2824</span><br><span class="line">2825</span><br><span class="line">2826</span><br><span class="line">2827</span><br><span class="line">2828</span><br><span class="line">2829</span><br><span class="line">2830</span><br><span class="line">2831</span><br><span class="line">2832</span><br><span class="line">2833</span><br><span class="line">2834</span><br><span class="line">2835</span><br><span class="line">2836</span><br><span class="line">2837</span><br><span class="line">2838</span><br><span class="line">2839</span><br><span class="line">2840</span><br><span class="line">2841</span><br><span class="line">2842</span><br><span class="line">2843</span><br><span class="line">2844</span><br><span class="line">2845</span><br><span class="line">2846</span><br><span class="line">2847</span><br><span class="line">2848</span><br><span class="line">2849</span><br><span class="line">2850</span><br><span class="line">2851</span><br><span class="line">2852</span><br><span class="line">2853</span><br><span class="line">2854</span><br><span class="line">2855</span><br><span class="line">2856</span><br><span class="line">2857</span><br><span class="line">2858</span><br><span class="line">2859</span><br><span class="line">2860</span><br><span class="line">2861</span><br><span class="line">2862</span><br><span class="line">2863</span><br><span class="line">2864</span><br><span class="line">2865</span><br><span class="line">2866</span><br><span class="line">2867</span><br><span class="line">2868</span><br><span class="line">2869</span><br><span class="line">2870</span><br><span class="line">2871</span><br><span class="line">2872</span><br><span class="line">2873</span><br><span class="line">2874</span><br><span class="line">2875</span><br><span class="line">2876</span><br><span class="line">2877</span><br><span class="line">2878</span><br><span class="line">2879</span><br><span class="line">2880</span><br><span class="line">2881</span><br><span class="line">2882</span><br><span class="line">2883</span><br><span class="line">2884</span><br><span class="line">2885</span><br><span class="line">2886</span><br><span class="line">2887</span><br><span class="line">2888</span><br><span class="line">2889</span><br><span class="line">2890</span><br><span class="line">2891</span><br><span class="line">2892</span><br><span class="line">2893</span><br><span class="line">2894</span><br><span class="line">2895</span><br><span class="line">2896</span><br><span class="line">2897</span><br><span class="line">2898</span><br><span class="line">2899</span><br><span class="line">2900</span><br><span class="line">2901</span><br><span class="line">2902</span><br><span class="line">2903</span><br><span class="line">2904</span><br><span class="line">2905</span><br><span class="line">2906</span><br><span class="line">2907</span><br><span class="line">2908</span><br><span class="line">2909</span><br><span class="line">2910</span><br><span class="line">2911</span><br><span class="line">2912</span><br><span class="line">2913</span><br><span class="line">2914</span><br><span class="line">2915</span><br><span class="line">2916</span><br><span class="line">2917</span><br><span class="line">2918</span><br><span class="line">2919</span><br><span class="line">2920</span><br><span class="line">2921</span><br><span class="line">2922</span><br><span class="line">2923</span><br><span class="line">2924</span><br><span class="line">2925</span><br><span class="line">2926</span><br><span class="line">2927</span><br><span class="line">2928</span><br><span class="line">2929</span><br><span class="line">2930</span><br><span class="line">2931</span><br><span class="line">2932</span><br><span class="line">2933</span><br><span class="line">2934</span><br><span class="line">2935</span><br><span class="line">2936</span><br><span class="line">2937</span><br><span class="line">2938</span><br><span class="line">2939</span><br><span class="line">2940</span><br><span class="line">2941</span><br><span class="line">2942</span><br><span class="line">2943</span><br><span class="line">2944</span><br><span class="line">2945</span><br><span class="line">2946</span><br><span class="line">2947</span><br><span class="line">2948</span><br><span class="line">2949</span><br><span class="line">2950</span><br><span class="line">2951</span><br><span class="line">2952</span><br><span class="line">2953</span><br><span class="line">2954</span><br><span class="line">2955</span><br><span class="line">2956</span><br><span class="line">2957</span><br><span class="line">2958</span><br><span class="line">2959</span><br><span class="line">2960</span><br><span class="line">2961</span><br><span class="line">2962</span><br><span class="line">2963</span><br><span class="line">2964</span><br><span class="line">2965</span><br><span class="line">2966</span><br><span class="line">2967</span><br><span class="line">2968</span><br><span class="line">2969</span><br><span class="line">2970</span><br><span class="line">2971</span><br><span class="line">2972</span><br><span class="line">2973</span><br><span class="line">2974</span><br><span class="line">2975</span><br><span class="line">2976</span><br><span class="line">2977</span><br><span class="line">2978</span><br><span class="line">2979</span><br><span class="line">2980</span><br><span class="line">2981</span><br><span class="line">2982</span><br><span class="line">2983</span><br><span class="line">2984</span><br><span class="line">2985</span><br><span class="line">2986</span><br><span class="line">2987</span><br><span class="line">2988</span><br><span class="line">2989</span><br><span class="line">2990</span><br><span class="line">2991</span><br><span class="line">2992</span><br><span class="line">2993</span><br><span class="line">2994</span><br><span class="line">2995</span><br><span class="line">2996</span><br><span class="line">2997</span><br><span class="line">2998</span><br><span class="line">2999</span><br><span class="line">3000</span><br><span class="line">3001</span><br><span class="line">3002</span><br><span class="line">3003</span><br><span class="line">3004</span><br><span class="line">3005</span><br><span class="line">3006</span><br><span class="line">3007</span><br><span class="line">3008</span><br><span class="line">3009</span><br><span class="line">3010</span><br><span class="line">3011</span><br><span class="line">3012</span><br><span class="line">3013</span><br><span class="line">3014</span><br><span class="line">3015</span><br><span class="line">3016</span><br><span class="line">3017</span><br><span class="line">3018</span><br><span class="line">3019</span><br><span class="line">3020</span><br><span class="line">3021</span><br><span class="line">3022</span><br><span class="line">3023</span><br><span class="line">3024</span><br><span class="line">3025</span><br><span class="line">3026</span><br><span class="line">3027</span><br></pre></td><td class="code"><pre><span class="line">//     Underscore.js 1.8.3</span><br><span class="line">//     http://underscorejs.org</span><br><span class="line">//     (c) 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters &amp; Editors</span><br><span class="line">//     Underscore may be freely distributed under the MIT license.</span><br><span class="line">//     中文注释 by hanzichi @https://github.com/hanzichi</span><br><span class="line">//     我的源码解读顺序（跟系列解读文章相对应）</span><br><span class="line">//     Object -&gt; Array -&gt; Collection -&gt; Function -&gt; Utility</span><br><span class="line"></span><br><span class="line">(function() &#123;</span><br><span class="line"></span><br><span class="line">  // Baseline setup</span><br><span class="line">  // 基本设置、配置</span><br><span class="line">  // --------------</span><br><span class="line"></span><br><span class="line">  // Establish the root object, `window` in the browser, or `exports` on the server.</span><br><span class="line">  // 将 this 赋值给局部变量 root</span><br><span class="line">  // root 的值, 客户端为 `window`, 服务端(node) 中为 `exports`</span><br><span class="line">  var root = this;</span><br><span class="line"></span><br><span class="line">  // Save the previous value of the `_` variable.</span><br><span class="line">  // 将原来全局环境中的变量 `_` 赋值给变量 previousUnderscore 进行缓存</span><br><span class="line">  // 在后面的 noConflict 方法中有用到</span><br><span class="line">  var previousUnderscore = root._;</span><br><span class="line"></span><br><span class="line">  // Save bytes in the minified (but not gzipped) version:</span><br><span class="line">  // 缓存变量, 便于压缩代码</span><br><span class="line">  // 此处「压缩」指的是压缩到 min.js 版本</span><br><span class="line">  // 而不是 gzip 压缩</span><br><span class="line">  var ArrayProto = Array.prototype, ObjProto = Object.prototype, FuncProto = Function.prototype;</span><br><span class="line"></span><br><span class="line">  // Create quick reference variables for speed access to core prototypes.</span><br><span class="line">  // 缓存变量, 便于压缩代码</span><br><span class="line">  // 同时可减少在原型链中的查找次数(提高代码效率)</span><br><span class="line">  var</span><br><span class="line">    push             = ArrayProto.push,</span><br><span class="line">    slice            = ArrayProto.slice,</span><br><span class="line">    toString         = ObjProto.toString,</span><br><span class="line">    hasOwnProperty   = ObjProto.hasOwnProperty;</span><br><span class="line"></span><br><span class="line">  // All **ECMAScript 5** native function implementations that we hope to use</span><br><span class="line">  // are declared here.</span><br><span class="line">  // ES5 原生方法, 如果浏览器支持, 则 underscore 中会优先使用</span><br><span class="line">  var</span><br><span class="line">    nativeIsArray      = Array.isArray,</span><br><span class="line">    nativeKeys         = Object.keys,</span><br><span class="line">    nativeBind         = FuncProto.bind,</span><br><span class="line">    nativeCreate       = Object.create;</span><br><span class="line"></span><br><span class="line">  // Naked function reference for surrogate-prototype-swapping.</span><br><span class="line">  var Ctor = function()&#123;&#125;;</span><br><span class="line"></span><br><span class="line">  // Create a safe reference to the Underscore object for use below.</span><br><span class="line">  // 核心函数</span><br><span class="line">  // `_` 其实是一个构造函数</span><br><span class="line">  // 支持无 new 调用的构造函数（思考 jQuery 的无 new 调用）</span><br><span class="line">  // 将传入的参数（实际要操作的数据）赋值给 this._wrapped 属性</span><br><span class="line">  // OOP 调用时，_ 相当于一个构造函数</span><br><span class="line">  // each 等方法都在该构造函数的原型链上</span><br><span class="line">  // _([1, 2, 3]).each(alert)</span><br><span class="line">  // _([1, 2, 3]) 相当于无 new 构造了一个新的对象</span><br><span class="line">  // 调用了该对象的 each 方法，该方法在该对象构造函数的原型链上</span><br><span class="line">  var _ = function(obj) &#123;</span><br><span class="line">    // 以下均针对 OOP 形式的调用</span><br><span class="line">    // 如果是非 OOP 形式的调用，不会进入该函数内部</span><br><span class="line"></span><br><span class="line">    // 如果 obj 已经是 `_` 函数的实例，则直接返回 obj</span><br><span class="line">    if (obj instanceof _)</span><br><span class="line">      return obj;</span><br><span class="line"></span><br><span class="line">    // 如果不是 `_` 函数的实例</span><br><span class="line">    // 则调用 new 运算符，返回实例化的对象</span><br><span class="line">    if (!(this instanceof _))</span><br><span class="line">      return new _(obj);</span><br><span class="line"></span><br><span class="line">    // 将 obj 赋值给 this._wrapped 属性</span><br><span class="line">    this._wrapped = obj;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Export the Underscore object for **Node.js**, with</span><br><span class="line">  // backwards-compatibility for the old `require()` API. If we&apos;re in</span><br><span class="line">  // the browser, add `_` as a global object.</span><br><span class="line">  // 将上面定义的 `_` 局部变量赋值给全局对象中的 `_` 属性</span><br><span class="line">  // 即客户端中 window._ = _</span><br><span class="line">  // 服务端(node)中 exports._ = _</span><br><span class="line">  // 同时在服务端向后兼容老的 require() API</span><br><span class="line">  // 这样暴露给全局后便可以在全局环境中使用 `_` 变量(方法)</span><br><span class="line">  if (typeof exports !== &apos;undefined&apos;) &#123;</span><br><span class="line">    if (typeof module !== &apos;undefined&apos; &amp;&amp; module.exports) &#123;</span><br><span class="line">      exports = module.exports = _;</span><br><span class="line">    &#125;</span><br><span class="line">    exports._ = _;</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    root._ = _;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // Current version.</span><br><span class="line">  // 当前 underscore 版本号</span><br><span class="line">  _.VERSION = &apos;1.8.3&apos;;</span><br><span class="line"></span><br><span class="line">  // Internal function that returns an efficient (for current engines) version</span><br><span class="line">  // of the passed-in callback, to be repeatedly applied in other Underscore</span><br><span class="line">  // functions.</span><br><span class="line">  // underscore 内部方法</span><br><span class="line">  // 根据 this 指向（context 参数）</span><br><span class="line">  // 以及 argCount 参数</span><br><span class="line">  // 二次操作返回一些回调、迭代方法</span><br><span class="line">  var optimizeCb = function(func, context, argCount) &#123;</span><br><span class="line">    // 如果没有指定 this 指向，则返回原函数</span><br><span class="line">    if (context === void 0)</span><br><span class="line">      return func;</span><br><span class="line"></span><br><span class="line">    switch (argCount == null ? 3 : argCount) &#123;</span><br><span class="line">      case 1: return function(value) &#123;</span><br><span class="line">        return func.call(context, value);</span><br><span class="line">      &#125;;</span><br><span class="line">      case 2: return function(value, other) &#123;</span><br><span class="line">        return func.call(context, value, other);</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      // 如果有指定 this，但没有传入 argCount 参数</span><br><span class="line">      // 则执行以下 case</span><br><span class="line">      // _.each、_.map</span><br><span class="line">      case 3: return function(value, index, collection) &#123;</span><br><span class="line">        return func.call(context, value, index, collection);</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      // _.reduce、_.reduceRight</span><br><span class="line">      case 4: return function(accumulator, value, index, collection) &#123;</span><br><span class="line">        return func.call(context, accumulator, value, index, collection);</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 其实不用上面的 switch-case 语句</span><br><span class="line">    // 直接执行下面的 return 函数就行了</span><br><span class="line">    // 不这样做的原因是 call 比 apply 快很多</span><br><span class="line">    // .apply 在运行前要对作为参数的数组进行一系列检验和深拷贝，.call 则没有这些步骤</span><br><span class="line">    // 具体可以参考：</span><br><span class="line">    // https://segmentfault.com/q/1010000007894513</span><br><span class="line">    // http://www.ecma-international.org/ecma-262/5.1/#sec-15.3.4.3</span><br><span class="line">    // http://www.ecma-international.org/ecma-262/5.1/#sec-15.3.4.4</span><br><span class="line">    return function() &#123;</span><br><span class="line">      return func.apply(context, arguments);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // A mostly-internal function to generate callbacks that can be applied</span><br><span class="line">  // to each element in a collection, returning the desired result — either</span><br><span class="line">  // identity, an arbitrary callback, a property matcher, or a property accessor.</span><br><span class="line">  var cb = function(value, context, argCount) &#123;</span><br><span class="line">    if (value == null) return _.identity;</span><br><span class="line">    if (_.isFunction(value)) return optimizeCb(value, context, argCount);</span><br><span class="line">    if (_.isObject(value)) return _.matcher(value);</span><br><span class="line">    return _.property(value);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  _.iteratee = function(value, context) &#123;</span><br><span class="line">    return cb(value, context, Infinity);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // An internal function for creating assigner functions.</span><br><span class="line">  // 有三个方法用到了这个内部函数</span><br><span class="line">  // _.extend &amp; _.extendOwn &amp; _.defaults</span><br><span class="line">  // _.extend = createAssigner(_.allKeys);</span><br><span class="line">  // _.extendOwn = _.assign = createAssigner(_.keys);</span><br><span class="line">  // _.defaults = createAssigner(_.allKeys, true);</span><br><span class="line">  var createAssigner = function(keysFunc, undefinedOnly) &#123;</span><br><span class="line">    // 返回函数</span><br><span class="line">    // 经典闭包（undefinedOnly 参数在返回的函数中被引用）</span><br><span class="line">    // 返回的函数参数个数 &gt;= 1</span><br><span class="line">    // 将第二个开始的对象参数的键值对 &quot;继承&quot; 给第一个参数</span><br><span class="line">    return function(obj) &#123;</span><br><span class="line">      var length = arguments.length;</span><br><span class="line">      // 只传入了一个参数（或者 0 个？）</span><br><span class="line">      // 或者传入的第一个参数是 null</span><br><span class="line">      if (length &lt; 2 || obj == null) return obj;</span><br><span class="line"></span><br><span class="line">      // 枚举第一个参数除外的对象参数</span><br><span class="line">      // 即 arguments[1], arguments[2] ...</span><br><span class="line">      for (var index = 1; index &lt; length; index++) &#123;</span><br><span class="line">        // source 即为对象参数</span><br><span class="line">        var source = arguments[index],</span><br><span class="line">            // 提取对象参数的 keys 值</span><br><span class="line">            // keysFunc 参数表示 _.keys</span><br><span class="line">            // 或者 _.allKeys</span><br><span class="line">            keys = keysFunc(source),</span><br><span class="line">            l = keys.length;</span><br><span class="line"></span><br><span class="line">        // 遍历该对象的键值对</span><br><span class="line">        for (var i = 0; i &lt; l; i++) &#123;</span><br><span class="line">          var key = keys[i];</span><br><span class="line">          // _.extend 和 _.extendOwn 方法</span><br><span class="line">          // 没有传入 undefinedOnly 参数，即 !undefinedOnly 为 true</span><br><span class="line">          // 即肯定会执行 obj[key] = source[key]</span><br><span class="line">          // 后面对象的键值对直接覆盖 obj</span><br><span class="line">          // ==========================================</span><br><span class="line">          // _.defaults 方法，undefinedOnly 参数为 true</span><br><span class="line">          // 即 !undefinedOnly 为 false</span><br><span class="line">          // 那么当且仅当 obj[key] 为 undefined 时才覆盖</span><br><span class="line">          // 即如果有相同的 key 值，取最早出现的 value 值</span><br><span class="line">          // *defaults 中有相同 key 的也是一样取首次出现的</span><br><span class="line">          if (!undefinedOnly || obj[key] === void 0)</span><br><span class="line">            obj[key] = source[key];</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      // 返回已经继承后面对象参数属性的第一个参数对象</span><br><span class="line">      return obj;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // An internal function for creating a new object that inherits from another.</span><br><span class="line">  // use in `_.create`</span><br><span class="line">  var baseCreate = function(prototype) &#123;</span><br><span class="line">    // 如果 prototype 参数不是对象</span><br><span class="line">    if (!_.isObject(prototype)) return &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    // 如果浏览器支持 ES5 Object.create</span><br><span class="line">    if (nativeCreate) return nativeCreate(prototype);</span><br><span class="line"></span><br><span class="line">    Ctor.prototype = prototype;</span><br><span class="line">    var result = new Ctor;</span><br><span class="line">    Ctor.prototype = null;</span><br><span class="line">    return result;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // 闭包</span><br><span class="line">  var property = function(key) &#123;</span><br><span class="line">    return function(obj) &#123;</span><br><span class="line">      return obj == null ? void 0 : obj[key];</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Helper for collection methods to determine whether a collection</span><br><span class="line">  // should be iterated as an array or as an object</span><br><span class="line">  // Related: http://people.mozilla.org/~jorendorff/es6-draft.html#sec-tolength</span><br><span class="line">  // Avoids a very nasty iOS 8 JIT bug on ARM-64. #2094</span><br><span class="line"></span><br><span class="line">  // Math.pow(2, 53) - 1 是 JavaScript 中能精确表示的最大数字</span><br><span class="line">  var MAX_ARRAY_INDEX = Math.pow(2, 53) - 1;</span><br><span class="line"></span><br><span class="line">  // getLength 函数</span><br><span class="line">  // 该函数传入一个参数，返回参数的 length 属性值</span><br><span class="line">  // 用来获取 array 以及 arrayLike 元素的 length 属性值</span><br><span class="line">  var getLength = property(&apos;length&apos;);</span><br><span class="line"></span><br><span class="line">  // 判断是否是 ArrayLike Object</span><br><span class="line">  // 类数组，即拥有 length 属性并且 length 属性值为 Number 类型的元素</span><br><span class="line">  // 包括数组、arguments、HTML Collection 以及 NodeList 等等</span><br><span class="line">  // 包括类似 &#123;length: 10&#125; 这样的对象</span><br><span class="line">  // 包括字符串、函数等</span><br><span class="line">  var isArrayLike = function(collection) &#123;</span><br><span class="line">    // 返回参数 collection 的 length 属性值</span><br><span class="line">    var length = getLength(collection);</span><br><span class="line">    return typeof length == &apos;number&apos; &amp;&amp; length &gt;= 0 &amp;&amp; length &lt;= MAX_ARRAY_INDEX;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  // Collection Functions</span><br><span class="line">  // 数组或者对象的扩展方法</span><br><span class="line">  // 共 25 个扩展方法</span><br><span class="line">  // --------------------</span><br><span class="line"></span><br><span class="line">  // The cornerstone, an `each` implementation, aka `forEach`.</span><br><span class="line">  // Handles raw objects in addition to array-likes. Treats all</span><br><span class="line">  // sparse array-likes as if they were dense.</span><br><span class="line">  // 与 ES5 中 Array.prototype.forEach 使用方法类似</span><br><span class="line">  // 遍历数组或者对象的每个元素</span><br><span class="line">  // 第一个参数为数组（包括类数组）或者对象</span><br><span class="line">  // 第二个参数为迭代方法，对数组或者对象每个元素都执行该方法</span><br><span class="line">  // 该方法又能传入三个参数，分别为 (item, index, array)（(value, key, obj) for object）</span><br><span class="line">  // 与 ES5 中 Array.prototype.forEach 方法传参格式一致</span><br><span class="line">  // 第三个参数（可省略）确定第二个参数 iteratee 函数中的（可能有的）this 指向</span><br><span class="line">  // 即 iteratee 中出现的（如果有）所有 this 都指向 context</span><br><span class="line">  // notice: 不要传入一个带有 key 类型为 number 的对象！</span><br><span class="line">  // notice: _.each 方法不能用 return 跳出循环（同样，Array.prototype.forEach 也不行）</span><br><span class="line">  _.each = _.forEach = function(obj, iteratee, context) &#123;</span><br><span class="line">    // 根据 context 确定不同的迭代函数</span><br><span class="line">    iteratee = optimizeCb(iteratee, context);</span><br><span class="line"></span><br><span class="line">    var i, length;</span><br><span class="line"></span><br><span class="line">    // 如果是类数组</span><br><span class="line">    // 默认不会传入类似 &#123;length: 10&#125; 这样的数据</span><br><span class="line">    if (isArrayLike(obj)) &#123;</span><br><span class="line">      // 遍历</span><br><span class="line">      for (i = 0, length = obj.length; i &lt; length; i++) &#123;</span><br><span class="line">        iteratee(obj[i], i, obj);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; else &#123; // 如果 obj 是对象</span><br><span class="line">      // 获取对象的所有 key 值</span><br><span class="line">      var keys = _.keys(obj);</span><br><span class="line"></span><br><span class="line">      // 如果是对象，则遍历处理 values 值</span><br><span class="line">      for (i = 0, length = keys.length; i &lt; length; i++) &#123;</span><br><span class="line">        iteratee(obj[keys[i]], keys[i], obj); // (value, key, obj)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 返回 obj 参数</span><br><span class="line">    // 供链式调用（Returns the list for chaining）</span><br><span class="line">    // 应该仅 OOP 调用有效</span><br><span class="line">    return obj;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Return the results of applying the iteratee to each element.</span><br><span class="line">  // 与 ES5 中 Array.prototype.map 使用方法类似</span><br><span class="line">  // 传参形式与 _.each 方法类似</span><br><span class="line">  // 遍历数组（每个元素）或者对象的每个元素（value）</span><br><span class="line">  // 对每个元素执行 iteratee 迭代方法</span><br><span class="line">  // 将结果保存到新的数组中，并返回</span><br><span class="line">  _.map = _.collect = function(obj, iteratee, context) &#123;</span><br><span class="line">    // 根据 context 确定不同的迭代函数</span><br><span class="line">    iteratee = cb(iteratee, context);</span><br><span class="line"></span><br><span class="line">    // 如果传参是对象，则获取它的 keys 值数组（短路表达式）</span><br><span class="line">    var keys = !isArrayLike(obj) &amp;&amp; _.keys(obj),</span><br><span class="line">        // 如果 obj 为对象，则 length 为 key.length</span><br><span class="line">        // 如果 obj 为数组，则 length 为 obj.length</span><br><span class="line">        length = (keys || obj).length,</span><br><span class="line">        results = Array(length); // 结果数组</span><br><span class="line"></span><br><span class="line">    // 遍历</span><br><span class="line">    for (var index = 0; index &lt; length; index++) &#123;</span><br><span class="line">      // 如果 obj 为对象，则 currentKey 为对象键值 key</span><br><span class="line">      // 如果 obj 为数组，则 currentKey 为 index 值</span><br><span class="line">      var currentKey = keys ? keys[index] : index;</span><br><span class="line">      results[index] = iteratee(obj[currentKey], currentKey, obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 返回新的结果数组</span><br><span class="line">    return results;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Create a reducing function iterating left or right.</span><br><span class="line">  // dir === 1 -&gt; _.reduce</span><br><span class="line">  // dir === -1 -&gt; _.reduceRight</span><br><span class="line">  function createReduce(dir) &#123;</span><br><span class="line">    // Optimized iterator function as using arguments.length</span><br><span class="line">    // in the main function will deoptimize the, see #1991.</span><br><span class="line">    function iterator(obj, iteratee, memo, keys, index, length) &#123;</span><br><span class="line">      for (; index &gt;= 0 &amp;&amp; index &lt; length; index += dir) &#123;</span><br><span class="line">        var currentKey = keys ? keys[index] : index;</span><br><span class="line">        // 迭代，返回值供下次迭代调用</span><br><span class="line">        memo = iteratee(memo, obj[currentKey], currentKey, obj);</span><br><span class="line">      &#125;</span><br><span class="line">      // 每次迭代返回值，供下次迭代调用</span><br><span class="line">      return memo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // _.reduce（_.reduceRight）可传入的 4 个参数</span><br><span class="line">    // obj 数组或者对象</span><br><span class="line">    // iteratee 迭代方法，对数组或者对象每个元素执行该方法</span><br><span class="line">    // memo 初始值，如果有，则从 obj 第一个元素开始迭代</span><br><span class="line">    // 如果没有，则从 obj 第二个元素开始迭代，将第一个元素作为初始值</span><br><span class="line">    // context 为迭代函数中的 this 指向</span><br><span class="line">    return function(obj, iteratee, memo, context) &#123;</span><br><span class="line">      iteratee = optimizeCb(iteratee, context, 4);</span><br><span class="line">      var keys = !isArrayLike(obj) &amp;&amp; _.keys(obj),</span><br><span class="line">          length = (keys || obj).length,</span><br><span class="line">          index = dir &gt; 0 ? 0 : length - 1;</span><br><span class="line"></span><br><span class="line">      // Determine the initial value if none is provided.</span><br><span class="line">      // 如果没有指定初始值</span><br><span class="line">      // 则把第一个元素指定为初始值</span><br><span class="line">      if (arguments.length &lt; 3) &#123;</span><br><span class="line">        memo = obj[keys ? keys[index] : index];</span><br><span class="line">        // 根据 dir 确定是向左还是向右遍历</span><br><span class="line">        index += dir;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      return iterator(obj, iteratee, memo, keys, index, length);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // **Reduce** builds up a single result from a list of values, aka `inject`,</span><br><span class="line">  // or `foldl`.</span><br><span class="line">  // 与 ES5 中 Array.prototype.reduce 使用方法类似</span><br><span class="line">  // _.reduce(list, iteratee, [memo], [context])</span><br><span class="line">  // _.reduce 方法最多可传入 4 个参数</span><br><span class="line">  // memo 为初始值，可选</span><br><span class="line">  // context 为指定 iteratee 中 this 指向，可选</span><br><span class="line">  _.reduce = _.foldl = _.inject = createReduce(1);</span><br><span class="line"></span><br><span class="line">  // The right-associative version of reduce, also known as `foldr`.</span><br><span class="line">  // 与 ES5 中 Array.prototype.reduceRight 使用方法类似</span><br><span class="line">  _.reduceRight = _.foldr = createReduce(-1);</span><br><span class="line"></span><br><span class="line">  // Return the first value which passes a truth test. Aliased as `detect`.</span><br><span class="line">  // 寻找数组或者对象中第一个满足条件（predicate 函数返回 true）的元素</span><br><span class="line">  // 并返回该元素值</span><br><span class="line">  // _.find(list, predicate, [context])</span><br><span class="line">  _.find = _.detect = function(obj, predicate, context) &#123;</span><br><span class="line">    var key;</span><br><span class="line">    // 如果 obj 是数组，key 为满足条件的下标</span><br><span class="line">    if (isArrayLike(obj)) &#123;</span><br><span class="line">      key = _.findIndex(obj, predicate, context);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      // 如果 obj 是对象，key 为满足条件的元素的 key 值</span><br><span class="line">      key = _.findKey(obj, predicate, context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 如果该元素存在，则返回该元素</span><br><span class="line">    // 如果不存在，则默认返回 undefined（函数没有返回，即返回 undefined）</span><br><span class="line">    if (key !== void 0 &amp;&amp; key !== -1) return obj[key];</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Return all the elements that pass a truth test.</span><br><span class="line">  // Aliased as `select`.</span><br><span class="line">  // 与 ES5 中 Array.prototype.filter 使用方法类似</span><br><span class="line">  // 寻找数组或者对象中所有满足条件的元素</span><br><span class="line">  // 如果是数组，则将 `元素值` 存入数组</span><br><span class="line">  // 如果是对象，则将 `value 值` 存入数组</span><br><span class="line">  // 返回该数组</span><br><span class="line">  // _.filter(list, predicate, [context])</span><br><span class="line">  _.filter = _.select = function(obj, predicate, context) &#123;</span><br><span class="line">    var results = [];</span><br><span class="line"></span><br><span class="line">    // 根据 this 指向，返回 predicate 函数（判断函数）</span><br><span class="line">    predicate = cb(predicate, context);</span><br><span class="line"></span><br><span class="line">    // 遍历每个元素，如果符合条件则存入数组</span><br><span class="line">    _.each(obj, function(value, index, list) &#123;</span><br><span class="line">      if (predicate(value, index, list)) results.push(value);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    return results;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Return all the elements for which a truth test fails.</span><br><span class="line">  // 寻找数组或者对象中所有不满足条件的元素</span><br><span class="line">  // 并以数组方式返回</span><br><span class="line">  // 所得结果是 _.filter 方法的补集</span><br><span class="line">  _.reject = function(obj, predicate, context) &#123;</span><br><span class="line">    return _.filter(obj, _.negate(cb(predicate)), context);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Determine whether all of the elements match a truth test.</span><br><span class="line">  // Aliased as `all`.</span><br><span class="line">  // 与 ES5 中的 Array.prototype.every 方法类似</span><br><span class="line">  // 判断数组中的每个元素或者对象中每个 value 值是否都满足 predicate 函数中的判断条件</span><br><span class="line">  // 如果是，则返回 ture；否则返回 false（有一个不满足就返回 false）</span><br><span class="line">  // _.every(list, [predicate], [context])</span><br><span class="line">  _.every = _.all = function(obj, predicate, context) &#123;</span><br><span class="line">    // 根据 this 指向，返回相应 predicate 函数</span><br><span class="line">    predicate = cb(predicate, context);</span><br><span class="line"></span><br><span class="line">    var keys = !isArrayLike(obj) &amp;&amp; _.keys(obj),</span><br><span class="line">        length = (keys || obj).length;</span><br><span class="line"></span><br><span class="line">    for (var index = 0; index &lt; length; index++) &#123;</span><br><span class="line">      var currentKey = keys ? keys[index] : index;</span><br><span class="line">      // 如果有一个不能满足 predicate 中的条件</span><br><span class="line">      // 则返回 false</span><br><span class="line">      if (!predicate(obj[currentKey], currentKey, obj))</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return true;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Determine if at least one element in the object matches a truth test.</span><br><span class="line">  // Aliased as `any`.</span><br><span class="line">  // 与 ES5 中 Array.prototype.some 方法类似</span><br><span class="line">  // 判断数组或者对象中是否有一个元素（value 值 for object）满足 predicate 函数中的条件</span><br><span class="line">  // 如果是则返回 true；否则返回 false</span><br><span class="line">  // _.some(list, [predicate], [context])</span><br><span class="line">  _.some = _.any = function(obj, predicate, context) &#123;</span><br><span class="line">    // 根据 context 返回 predicate 函数</span><br><span class="line">    predicate = cb(predicate, context);</span><br><span class="line">    // 如果传参是对象，则返回该对象的 keys 数组</span><br><span class="line">    var keys = !isArrayLike(obj) &amp;&amp; _.keys(obj),</span><br><span class="line">        length = (keys || obj).length;</span><br><span class="line">    for (var index = 0; index &lt; length; index++) &#123;</span><br><span class="line">      var currentKey = keys ? keys[index] : index;</span><br><span class="line">      // 如果有一个元素满足条件，则返回 true</span><br><span class="line">      if (predicate(obj[currentKey], currentKey, obj)) return true;</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Determine if the array or object contains a given item (using `===`).</span><br><span class="line">  // Aliased as `includes` and `include`.</span><br><span class="line">  // 判断数组或者对象中（value 值）是否有指定元素</span><br><span class="line">  // 如果是 object，则忽略 key 值，只需要查找 value 值即可</span><br><span class="line">  // 即该 obj 中是否有指定的 value 值</span><br><span class="line">  // 返回布尔值</span><br><span class="line">  _.contains = _.includes = _.include = function(obj, item, fromIndex, guard) &#123;</span><br><span class="line">    // 如果是对象，返回 values 组成的数组</span><br><span class="line">    if (!isArrayLike(obj)) obj = _.values(obj);</span><br><span class="line"></span><br><span class="line">    // fromIndex 表示查询起始位置</span><br><span class="line">    // 如果没有指定该参数，则默认从头找起</span><br><span class="line">    if (typeof fromIndex != &apos;number&apos; || guard) fromIndex = 0;</span><br><span class="line"></span><br><span class="line">    // _.indexOf 是数组的扩展方法（Array Functions）</span><br><span class="line">    // 数组中寻找某一元素</span><br><span class="line">    return _.indexOf(obj, item, fromIndex) &gt;= 0;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Invoke a method (with arguments) on every item in a collection.</span><br><span class="line">  // Calls the method named by methodName on each value in the list.</span><br><span class="line">  // Any extra arguments passed to invoke will be forwarded on to the method invocation.</span><br><span class="line">  // 数组或者对象中的每个元素都调用 method 方法</span><br><span class="line">  // 返回调用后的结果（数组或者关联数组）</span><br><span class="line">  // method 参数后的参数会被当做参数传入 method 方法中</span><br><span class="line">  // _.invoke(list, methodName, *arguments)</span><br><span class="line">  _.invoke = function(obj, method) &#123;</span><br><span class="line">    // *arguments 参数</span><br><span class="line">    var args = slice.call(arguments, 2);</span><br><span class="line"></span><br><span class="line">    // 判断 method 是不是函数</span><br><span class="line">    var isFunc = _.isFunction(method);</span><br><span class="line"></span><br><span class="line">    // 用 map 方法对数组或者对象每个元素调用方法</span><br><span class="line">    // 返回数组</span><br><span class="line">    return _.map(obj, function(value) &#123;</span><br><span class="line">      // 如果 method 不是函数，则可能是 obj 的 key 值</span><br><span class="line">      // 而 obj[method] 可能为函数</span><br><span class="line">      var func = isFunc ? method : value[method];</span><br><span class="line">      return func == null ? func : func.apply(value, args);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Convenience version of a common use case of `map`: fetching a property.</span><br><span class="line">  // 一个数组，元素都是对象</span><br><span class="line">  // 根据指定的 key 值</span><br><span class="line">  // 返回一个数组，元素都是指定 key 值的 value 值</span><br><span class="line">  /*</span><br><span class="line">  var property = function(key) &#123;</span><br><span class="line">    return function(obj) &#123;</span><br><span class="line">      return obj == null ? void 0 : obj[key];</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">  */</span><br><span class="line">  // _.pluck(list, propertyName)</span><br><span class="line">  _.pluck = function(obj, key) &#123;</span><br><span class="line">    return _.map(obj, _.property(key));</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Convenience version of a common use case of `filter`: selecting only objects</span><br><span class="line">  // containing specific `key:value` pairs.</span><br><span class="line">  // 根据指定的键值对</span><br><span class="line">  // 选择对象</span><br><span class="line">  _.where = function(obj, attrs) &#123;</span><br><span class="line">    return _.filter(obj, _.matcher(attrs));</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Convenience version of a common use case of `find`: getting the first object</span><br><span class="line">  // containing specific `key:value` pairs.</span><br><span class="line">  // 寻找第一个有指定 key-value 键值对的对象</span><br><span class="line">  _.findWhere = function(obj, attrs) &#123;</span><br><span class="line">    return _.find(obj, _.matcher(attrs));</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Return the maximum element (or element-based computation).</span><br><span class="line">  // 寻找数组中的最大元素</span><br><span class="line">  // 或者对象中的最大 value 值</span><br><span class="line">  // 如果有 iteratee 参数，则求每个元素经过该函数迭代后的最值</span><br><span class="line">  // _.max(list, [iteratee], [context])</span><br><span class="line">  _.max = function(obj, iteratee, context) &#123;</span><br><span class="line">    var result = -Infinity, lastComputed = -Infinity,</span><br><span class="line">        value, computed;</span><br><span class="line"></span><br><span class="line">    // 单纯地寻找最值</span><br><span class="line">    if (iteratee == null &amp;&amp; obj != null) &#123;</span><br><span class="line">      // 如果是数组，则寻找数组中最大元素</span><br><span class="line">      // 如果是对象，则寻找最大 value 值</span><br><span class="line">      obj = isArrayLike(obj) ? obj : _.values(obj);</span><br><span class="line"></span><br><span class="line">      for (var i = 0, length = obj.length; i &lt; length; i++) &#123;</span><br><span class="line">        value = obj[i];</span><br><span class="line">        if (value &gt; result) &#123;</span><br><span class="line">          result = value;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; else &#123;  // 寻找元素经过迭代后的最值</span><br><span class="line">      iteratee = cb(iteratee, context);</span><br><span class="line"></span><br><span class="line">      // result 保存结果元素</span><br><span class="line">      // lastComputed 保存计算过程中出现的最值</span><br><span class="line">      // 遍历元素</span><br><span class="line">      _.each(obj, function(value, index, list) &#123;</span><br><span class="line">        // 经过迭代函数后的值</span><br><span class="line">        computed = iteratee(value, index, list);</span><br><span class="line">        // &amp;&amp; 的优先级高于 ||</span><br><span class="line">        if (computed &gt; lastComputed || computed === -Infinity &amp;&amp; result === -Infinity) &#123;</span><br><span class="line">          result = value;</span><br><span class="line">          lastComputed = computed;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return result;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Return the minimum element (or element-based computation).</span><br><span class="line">  // 寻找最小的元素</span><br><span class="line">  // 类似 _.max</span><br><span class="line">  // _.min(list, [iteratee], [context])</span><br><span class="line">  _.min = function(obj, iteratee, context) &#123;</span><br><span class="line">    var result = Infinity, lastComputed = Infinity,</span><br><span class="line">        value, computed;</span><br><span class="line">    if (iteratee == null &amp;&amp; obj != null) &#123;</span><br><span class="line">      obj = isArrayLike(obj) ? obj : _.values(obj);</span><br><span class="line">      for (var i = 0, length = obj.length; i &lt; length; i++) &#123;</span><br><span class="line">        value = obj[i];</span><br><span class="line">        if (value &lt; result) &#123;</span><br><span class="line">          result = value;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      iteratee = cb(iteratee, context);</span><br><span class="line">      _.each(obj, function(value, index, list) &#123;</span><br><span class="line">        computed = iteratee(value, index, list);</span><br><span class="line">        if (computed &lt; lastComputed || computed === Infinity &amp;&amp; result === Infinity) &#123;</span><br><span class="line">          result = value;</span><br><span class="line">          lastComputed = computed;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    return result;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Shuffle a collection, using the modern version of the</span><br><span class="line">  // [Fisher-Yates shuffle](http://en.wikipedia.org/wiki/Fisher–Yates_shuffle).</span><br><span class="line">  // 将数组乱序</span><br><span class="line">  // 如果是对象，则返回一个数组，数组由对象 value 值构成</span><br><span class="line">  // Fisher-Yates shuffle 算法</span><br><span class="line">  // 最优的洗牌算法，复杂度 O(n)</span><br><span class="line">  // 乱序不要用 sort + Math.random()，复杂度 O(nlogn)</span><br><span class="line">  // 而且，并不是真正的乱序</span><br><span class="line">  // @see https://github.com/hanzichi/underscore-analysis/issues/15</span><br><span class="line">  _.shuffle = function(obj) &#123;</span><br><span class="line">    // 如果是对象，则对 value 值进行乱序</span><br><span class="line">    var set = isArrayLike(obj) ? obj : _.values(obj);</span><br><span class="line">    var length = set.length;</span><br><span class="line"></span><br><span class="line">    // 乱序后返回的数组副本（参数是对象则返回乱序后的 value 数组）</span><br><span class="line">    var shuffled = Array(length);</span><br><span class="line"></span><br><span class="line">    // 枚举元素</span><br><span class="line">    for (var index = 0, rand; index &lt; length; index++) &#123;</span><br><span class="line">      // 将当前所枚举位置的元素和 `index=rand` 位置的元素交换</span><br><span class="line">      rand = _.random(0, index);</span><br><span class="line">      if (rand !== index) shuffled[index] = shuffled[rand];</span><br><span class="line">      shuffled[rand] = set[index];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return shuffled;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Sample **n** random values from a collection.</span><br><span class="line">  // If **n** is not specified, returns a single random element.</span><br><span class="line">  // The internal `guard` argument allows it to work with `map`.</span><br><span class="line">  // 随机返回数组或者对象中的一个元素</span><br><span class="line">  // 如果指定了参数 `n`，则随机返回 n 个元素组成的数组</span><br><span class="line">  // 如果参数是对象，则数组由 values 组成</span><br><span class="line">  _.sample = function(obj, n, guard) &#123;</span><br><span class="line">    // 随机返回一个元素</span><br><span class="line">    if (n == null || guard) &#123;</span><br><span class="line">      if (!isArrayLike(obj)) obj = _.values(obj);</span><br><span class="line">      return obj[_.random(obj.length - 1)];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 随机返回 n 个</span><br><span class="line">    return _.shuffle(obj).slice(0, Math.max(0, n));</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Sort the object&apos;s values by a criterion produced by an iteratee.</span><br><span class="line">  // 排序</span><br><span class="line">  // _.sortBy(list, iteratee, [context])</span><br><span class="line">  _.sortBy = function(obj, iteratee, context) &#123;</span><br><span class="line">    iteratee = cb(iteratee, context);</span><br><span class="line"></span><br><span class="line">    // 根据指定的 key 返回 values 数组</span><br><span class="line">    // _.pluck([&#123;&#125;, &#123;&#125;, &#123;&#125;], &apos;value&apos;)</span><br><span class="line">    return _.pluck(</span><br><span class="line">      // _.map(obj, function()&#123;&#125;).sort()</span><br><span class="line">      // _.map 后的结果 [&#123;&#125;, &#123;&#125;..]</span><br><span class="line">      // sort 后的结果 [&#123;&#125;, &#123;&#125;..]</span><br><span class="line">      _.map(obj, function(value, index, list) &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          value: value,</span><br><span class="line">          index: index,</span><br><span class="line">          // 元素经过迭代函数迭代后的值</span><br><span class="line">          criteria: iteratee(value, index, list)</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;).sort(function(left, right) &#123;</span><br><span class="line">      var a = left.criteria;</span><br><span class="line">      var b = right.criteria;</span><br><span class="line">      if (a !== b) &#123;</span><br><span class="line">        if (a &gt; b || a === void 0) return 1;</span><br><span class="line">        if (a &lt; b || b === void 0) return -1;</span><br><span class="line">      &#125;</span><br><span class="line">      return left.index - right.index;</span><br><span class="line">    &#125;), &apos;value&apos;);</span><br><span class="line"></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // An internal function used for aggregate &quot;group by&quot; operations.</span><br><span class="line">  // behavior 是一个函数参数</span><br><span class="line">  // _.groupBy, _.indexBy 以及 _.countBy 其实都是对数组元素进行分类</span><br><span class="line">  // 分类规则就是 behavior 函数</span><br><span class="line">  var group = function(behavior) &#123;</span><br><span class="line">    return function(obj, iteratee, context) &#123;</span><br><span class="line">      // 返回结果是一个对象</span><br><span class="line">      var result = &#123;&#125;;</span><br><span class="line">      iteratee = cb(iteratee, context);</span><br><span class="line">      // 遍历元素</span><br><span class="line">      _.each(obj, function(value, index) &#123;</span><br><span class="line">        // 经过迭代，获取结果值，存为 key</span><br><span class="line">        var key = iteratee(value, index, obj);</span><br><span class="line">        // 按照不同的规则进行分组操作</span><br><span class="line">        // 将变量 result 当做参数传入，能在 behavior 中改变该值</span><br><span class="line">        behavior(result, value, key);</span><br><span class="line">      &#125;);</span><br><span class="line">      // 返回结果对象</span><br><span class="line">      return result;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Groups the object&apos;s values by a criterion. Pass either a string attribute</span><br><span class="line">  // to group by, or a function that returns the criterion.</span><br><span class="line">  // groupBy_  _.groupBy(list, iteratee, [context])</span><br><span class="line">  // 根据特定规则对数组或者对象中的元素进行分组</span><br><span class="line">  // result 是返回对象</span><br><span class="line">  // value 是数组元素</span><br><span class="line">  // key 是迭代后的值</span><br><span class="line">  _.groupBy = group(function(result, value, key) &#123;</span><br><span class="line">    // 根据 key 值分组</span><br><span class="line">    // key 是元素经过迭代函数后的值</span><br><span class="line">    // 或者元素自身的属性值</span><br><span class="line"></span><br><span class="line">    // result 对象已经有该 key 值了</span><br><span class="line">    if (_.has(result, key))</span><br><span class="line">      result[key].push(value);</span><br><span class="line">    else result[key] = [value];</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  // Indexes the object&apos;s values by a criterion, similar to `groupBy`, but for</span><br><span class="line">  // when you know that your index values will be unique.</span><br><span class="line">  _.indexBy = group(function(result, value, key) &#123;</span><br><span class="line">    // key 值必须是独一无二的</span><br><span class="line">    // 不然后面的会覆盖前面的</span><br><span class="line">    // 其他和 _.groupBy 类似</span><br><span class="line">    result[key] = value;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  // Counts instances of an object that group by a certain criterion. Pass</span><br><span class="line">  // either a string attribute to count by, or a function that returns the</span><br><span class="line">  // criterion.</span><br><span class="line">  _.countBy = group(function(result, value, key) &#123;</span><br><span class="line">    // 不同 key 值元素数量</span><br><span class="line">    if (_.has(result, key))</span><br><span class="line">      result[key]++;</span><br><span class="line">    else result[key] = 1;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  // Safely create a real, live array from anything iterable.</span><br><span class="line">  // 伪数组 -&gt; 数组</span><br><span class="line">  // 对象 -&gt; 提取 value 值组成数组</span><br><span class="line">  // 返回数组</span><br><span class="line">  _.toArray = function(obj) &#123;</span><br><span class="line">    if (!obj) return [];</span><br><span class="line"></span><br><span class="line">    // 如果是数组，则返回副本数组</span><br><span class="line">    // 是否用 obj.concat() 更方便？</span><br><span class="line">    if (_.isArray(obj)) return slice.call(obj);</span><br><span class="line"></span><br><span class="line">    // 如果是类数组，则重新构造新的数组</span><br><span class="line">    // 是否也可以直接用 slice 方法？</span><br><span class="line">    if (isArrayLike(obj)) return _.map(obj, _.identity);</span><br><span class="line"></span><br><span class="line">    // 如果是对象，则返回 values 集合</span><br><span class="line">    return _.values(obj);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Return the number of elements in an object.</span><br><span class="line">  // 如果是数组（类数组），返回长度（length 属性）</span><br><span class="line">  // 如果是对象，返回键值对数量</span><br><span class="line">  _.size = function(obj) &#123;</span><br><span class="line">    if (obj == null) return 0;</span><br><span class="line">    return isArrayLike(obj) ? obj.length : _.keys(obj).length;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Split a collection into two arrays: one whose elements all satisfy the given</span><br><span class="line">  // predicate, and one whose elements all do not satisfy the predicate.</span><br><span class="line">  // 将数组或者对象中符合条件（predicate）的元素</span><br><span class="line">  // 和不符合条件的元素（数组为元素，对象为 value 值）</span><br><span class="line">  // 分别放入两个数组中</span><br><span class="line">  // 返回一个数组，数组元素为以上两个数组（[[pass array], [fail array]]）</span><br><span class="line">  _.partition = function(obj, predicate, context) &#123;</span><br><span class="line">    predicate = cb(predicate, context);</span><br><span class="line">    var pass = [], fail = [];</span><br><span class="line">    _.each(obj, function(value, key, obj) &#123;</span><br><span class="line">      (predicate(value, key, obj) ? pass : fail).push(value);</span><br><span class="line">    &#125;);</span><br><span class="line">    return [pass, fail];</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  // Array Functions</span><br><span class="line">  // 数组的扩展方法</span><br><span class="line">  // 共 20 个扩展方法</span><br><span class="line">  // Note: All array functions will also work on the arguments object.</span><br><span class="line">  // However, Underscore functions are not designed to work on &quot;sparse&quot; arrays.</span><br><span class="line">  // ---------------</span><br><span class="line"></span><br><span class="line">  // Get the first element of an array. Passing **n** will return the first N</span><br><span class="line">  // values in the array. Aliased as `head` and `take`. The **guard** check</span><br><span class="line">  // allows it to work with `_.map`.</span><br><span class="line">  // 返回数组第一个元素</span><br><span class="line">  // 如果有参数 n，则返回数组前 n 个元素（组成的数组）</span><br><span class="line">  _.first = _.head = _.take = function(array, n, guard) &#123;</span><br><span class="line">    // 容错，数组为空则返回 undefined</span><br><span class="line">    if (array == null) return void 0;</span><br><span class="line"></span><br><span class="line">    // 没指定参数 n，则默认返回第一个元素</span><br><span class="line">    if (n == null || guard) return array[0];</span><br><span class="line"></span><br><span class="line">    // 如果传入参数 n，则返回前 n 个元素组成的数组</span><br><span class="line">    // 返回前 n 个元素，即剔除后 array.length - n 个元素</span><br><span class="line">    return _.initial(array, array.length - n);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Returns everything but the last entry of the array. Especially useful on</span><br><span class="line">  // the arguments object. Passing **n** will return all the values in</span><br><span class="line">  // the array, excluding the last N.</span><br><span class="line">  // 传入一个数组</span><br><span class="line">  // 返回剔除最后一个元素之后的数组副本</span><br><span class="line">  // 如果传入参数 n，则剔除最后 n 个元素</span><br><span class="line">  _.initial = function(array, n, guard) &#123;</span><br><span class="line">    return slice.call(array, 0, Math.max(0, array.length - (n == null || guard ? 1 : n)));</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Get the last element of an array. Passing **n** will return the last N</span><br><span class="line">  // values in the array.</span><br><span class="line">  // 返回数组最后一个元素</span><br><span class="line">  // 如果传入参数 n</span><br><span class="line">  // 则返回该数组后 n 个元素组成的数组</span><br><span class="line">  // 即剔除前 array.length - n 个元素</span><br><span class="line">  _.last = function(array, n, guard) &#123;</span><br><span class="line">    // 容错</span><br><span class="line">    if (array == null) return void 0;</span><br><span class="line"></span><br><span class="line">    // 如果没有指定参数 n，则返回最后一个元素</span><br><span class="line">    if (n == null || guard) return array[array.length - 1];</span><br><span class="line"></span><br><span class="line">    // 如果传入参数 n，则返回后 n 个元素组成的数组</span><br><span class="line">    // 即剔除前 array.length - n 个元素</span><br><span class="line">    return _.rest(array, Math.max(0, array.length - n));</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Returns everything but the first entry of the array. Aliased as `tail` and `drop`.</span><br><span class="line">  // Especially useful on the arguments object. Passing an **n** will return</span><br><span class="line">  // the rest N values in the array.</span><br><span class="line">  // 传入一个数组</span><br><span class="line">  // 返回剔除第一个元素后的数组副本</span><br><span class="line">  // 如果传入参数 n，则剔除前 n 个元素</span><br><span class="line">  _.rest = _.tail = _.drop = function(array, n, guard) &#123;</span><br><span class="line">    return slice.call(array, n == null || guard ? 1 : n);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Trim out all falsy values from an array.</span><br><span class="line">  // 去掉数组中所有的假值</span><br><span class="line">  // 返回数组副本</span><br><span class="line">  // JavaScript 中的假值包括 false、null、undefined、&apos;&apos;、NaN、0</span><br><span class="line">  // 联想 PHP 中的 array_filter() 函数</span><br><span class="line">  // _.identity = function(value) &#123;</span><br><span class="line">  //   return value;</span><br><span class="line">  // &#125;;</span><br><span class="line">  _.compact = function(array) &#123;</span><br><span class="line">    return _.filter(array, _.identity);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Internal implementation of a recursive `flatten` function.</span><br><span class="line">  // 递归调用数组，将数组展开</span><br><span class="line">  // 即 [1, 2, [3, 4]] =&gt; [1, 2, 3, 4]</span><br><span class="line">  // flatten(array, shallow, false)</span><br><span class="line">  // flatten(arguments, true, true, 1)</span><br><span class="line">  // flatten(arguments, true, true)</span><br><span class="line">  // flatten(arguments, false, false, 1)</span><br><span class="line">  // ===== //</span><br><span class="line">  // input =&gt; Array 或者 arguments</span><br><span class="line">  // shallow =&gt; 是否只展开一层</span><br><span class="line">  // strict === true，通常和 shallow === true 配合使用</span><br><span class="line">  // 表示只展开一层，但是不保存非数组元素（即无法展开的基础类型）</span><br><span class="line">  // flatten([[1, 2], 3, 4], true, true) =&gt; [1, 2]</span><br><span class="line">  // flatten([[1, 2], 3, 4], false, true) = &gt; []</span><br><span class="line">  // startIndex =&gt; 从 input 的第几项开始展开</span><br><span class="line">  // ===== //</span><br><span class="line">  // 可以看到，如果 strict 参数为 true，那么 shallow 也为 true</span><br><span class="line">  // 也就是展开一层，同时把非数组过滤</span><br><span class="line">  // [[1, 2], [3, 4], 5, 6] =&gt; [1, 2, 3, 4]</span><br><span class="line">  var flatten = function(input, shallow, strict, startIndex) &#123;</span><br><span class="line">    // output 数组保存结果</span><br><span class="line">    // 即 flatten 方法返回数据</span><br><span class="line">    // idx 为 output 的累计数组下标</span><br><span class="line">    var output = [], idx = 0;</span><br><span class="line"></span><br><span class="line">    // 根据 startIndex 变量确定需要展开的起始位置</span><br><span class="line">    for (var i = startIndex || 0, length = getLength(input); i &lt; length; i++) &#123;</span><br><span class="line">      var value = input[i];</span><br><span class="line">      // 数组 或者 arguments</span><br><span class="line">      // 注意 isArrayLike 还包括 &#123;length: 10&#125; 这样的，过滤掉</span><br><span class="line">      if (isArrayLike(value) &amp;&amp; (_.isArray(value) || _.isArguments(value))) &#123;</span><br><span class="line">        // flatten current level of array or arguments object</span><br><span class="line">        // (!shallow === true) =&gt; (shallow === false)</span><br><span class="line">        // 则表示需深度展开</span><br><span class="line">        // 继续递归展开</span><br><span class="line">        if (!shallow)</span><br><span class="line">          // flatten 方法返回数组</span><br><span class="line">          // 将上面定义的 value 重新赋值</span><br><span class="line">          value = flatten(value, shallow, strict);</span><br><span class="line"></span><br><span class="line">        // 递归展开到最后一层（没有嵌套的数组了）</span><br><span class="line">        // 或者 (shallow === true) =&gt; 只展开一层</span><br><span class="line">        // value 值肯定是一个数组</span><br><span class="line">        var j = 0, len = value.length;</span><br><span class="line"></span><br><span class="line">        // 这一步貌似没有必要</span><br><span class="line">        // 毕竟 JavaScript 的数组会自动扩充</span><br><span class="line">        // 但是这样写，感觉比较好，对于元素的 push 过程有个比较清晰的认识</span><br><span class="line">        output.length += len;</span><br><span class="line"></span><br><span class="line">        // 将 value 数组的元素添加到 output 数组中</span><br><span class="line">        while (j &lt; len) &#123;</span><br><span class="line">          output[idx++] = value[j++];</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; else if (!strict) &#123;</span><br><span class="line">        // (!strict === true) =&gt; (strict === false)</span><br><span class="line">        // 如果是深度展开，即 shallow 参数为 false</span><br><span class="line">        // 那么当最后 value 不是数组，是基本类型时</span><br><span class="line">        // 肯定会走到这个 else-if 判断中</span><br><span class="line">        // 而如果此时 strict 为 true，则不能跳到这个分支内部</span><br><span class="line">        // 所以 shallow === false 如果和 strict === true 搭配</span><br><span class="line">        // 调用 flatten 方法得到的结果永远是空数组 []</span><br><span class="line">        output[idx++] = value;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return output;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Flatten out an array, either recursively (by default), or just one level.</span><br><span class="line">  // 将嵌套的数组展开</span><br><span class="line">  // 如果参数 (shallow === true)，则仅展开一层</span><br><span class="line">  // _.flatten([1, [2], [3, [[4]]]]);</span><br><span class="line">  // =&gt; [1, 2, 3, 4];</span><br><span class="line">  // ====== //</span><br><span class="line">  // _.flatten([1, [2], [3, [[4]]]], true);</span><br><span class="line">  // =&gt; [1, 2, 3, [[4]]];</span><br><span class="line">  _.flatten = function(array, shallow) &#123;</span><br><span class="line">    // array =&gt; 需要展开的数组</span><br><span class="line">    // shallow =&gt; 是否只展开一层</span><br><span class="line">    // false 为 flatten 方法 strict 变量</span><br><span class="line">    return flatten(array, shallow, false);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Return a version of the array that does not contain the specified value(s).</span><br><span class="line">  // without_.without(array, *values)</span><br><span class="line">  // Returns a copy of the array with all instances of the values removed.</span><br><span class="line">  // ====== //</span><br><span class="line">  // _.without([1, 2, 1, 0, 3, 1, 4], 0, 1);</span><br><span class="line">  // =&gt; [2, 3, 4]</span><br><span class="line">  // ===== //</span><br><span class="line">  // 从数组中移除指定的元素</span><br><span class="line">  // 返回移除后的数组副本</span><br><span class="line">  _.without = function(array) &#123;</span><br><span class="line">    // slice.call(arguments, 1)</span><br><span class="line">    // 将 arguments 转为数组（同时去掉第一个元素）</span><br><span class="line">    // 之后便可以调用 _.difference 方法</span><br><span class="line">    return _.difference(array, slice.call(arguments, 1));</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Produce a duplicate-free version of the array. If the array has already</span><br><span class="line">  // been sorted, you have the option of using a faster algorithm.</span><br><span class="line">  // Aliased as `unique`.</span><br><span class="line">  // 数组去重</span><br><span class="line">  // 如果第二个参数 `isSorted` 为 true</span><br><span class="line">  // 则说明事先已经知道数组有序</span><br><span class="line">  // 程序会跑一个更快的算法（一次线性比较，元素和数组前一个元素比较即可）</span><br><span class="line">  // 如果有第三个参数 iteratee，则对数组每个元素迭代</span><br><span class="line">  // 对迭代之后的结果进行去重</span><br><span class="line">  // 返回去重后的数组（array 的子数组）</span><br><span class="line">  // PS: 暴露的 API 中没 context 参数</span><br><span class="line">  // _.uniq(array, [isSorted], [iteratee])</span><br><span class="line">  _.uniq = _.unique = function(array, isSorted, iteratee, context) &#123;</span><br><span class="line">    // 没有传入 isSorted 参数</span><br><span class="line">    // 转为 _.unique(array, false, undefined, iteratee)</span><br><span class="line">    if (!_.isBoolean(isSorted)) &#123;</span><br><span class="line">      context = iteratee;</span><br><span class="line">      iteratee = isSorted;</span><br><span class="line">      isSorted = false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 如果有迭代函数</span><br><span class="line">    // 则根据 this 指向二次返回新的迭代函数</span><br><span class="line">    if (iteratee != null)</span><br><span class="line">      iteratee = cb(iteratee, context);</span><br><span class="line"></span><br><span class="line">    // 结果数组，是 array 的子集</span><br><span class="line">    var result = [];</span><br><span class="line"></span><br><span class="line">    // 已经出现过的元素（或者经过迭代过的值）</span><br><span class="line">    // 用来过滤重复值</span><br><span class="line">    var seen = [];</span><br><span class="line"></span><br><span class="line">    for (var i = 0, length = getLength(array); i &lt; length; i++) &#123;</span><br><span class="line">      var value = array[i],</span><br><span class="line">          // 如果指定了迭代函数</span><br><span class="line">          // 则对数组每一个元素进行迭代</span><br><span class="line">          // 迭代函数传入的三个参数通常是 value, index, array 形式</span><br><span class="line">          computed = iteratee ? iteratee(value, i, array) : value;</span><br><span class="line"></span><br><span class="line">      // 如果是有序数组，则当前元素只需跟上一个元素对比即可</span><br><span class="line">      // 用 seen 变量保存上一个元素</span><br><span class="line">      if (isSorted) &#123;</span><br><span class="line">        // 如果 i === 0，是第一个元素，则直接 push</span><br><span class="line">        // 否则比较当前元素是否和前一个元素相等</span><br><span class="line">        if (!i || seen !== computed) result.push(value);</span><br><span class="line">        // seen 保存当前元素，供下一次对比</span><br><span class="line">        seen = computed;</span><br><span class="line">      &#125; else if (iteratee) &#123;</span><br><span class="line">        // 如果 seen[] 中没有 computed 这个元素值</span><br><span class="line">        if (!_.contains(seen, computed)) &#123;</span><br><span class="line">          seen.push(computed);</span><br><span class="line">          result.push(value);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; else if (!_.contains(result, value)) &#123;</span><br><span class="line">        // 如果不用经过迭代函数计算，也就不用 seen[] 变量了</span><br><span class="line">        result.push(value);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return result;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Produce an array that contains the union: each distinct element from all of</span><br><span class="line">  // the passed-in arrays.</span><br><span class="line">  // union_.union(*arrays)</span><br><span class="line">  // Computes the union of the passed-in arrays:</span><br><span class="line">  // the list of unique items, in order, that are present in one or more of the arrays.</span><br><span class="line">  // ========== //</span><br><span class="line">  // _.union([1, 2, 3], [101, 2, 1, 10], [2, 1]);</span><br><span class="line">  // =&gt; [1, 2, 3, 101, 10]</span><br><span class="line">  // ========== //</span><br><span class="line">  // 将多个数组的元素集中到一个数组中</span><br><span class="line">  // 并且去重，返回数组副本</span><br><span class="line">  _.union = function() &#123;</span><br><span class="line">    // 首先用 flatten 方法将传入的数组展开成一个数组</span><br><span class="line">    // 然后就可以愉快地调用 _.uniq 方法了</span><br><span class="line">    // 假设 _.union([1, 2, 3], [101, 2, 1, 10], [2, 1]);</span><br><span class="line">    // arguments 为 [[1, 2, 3], [101, 2, 1, 10], [2, 1]]</span><br><span class="line">    // shallow 参数为 true，展开一层</span><br><span class="line">    // 结果为 [1, 2, 3, 101, 2, 1, 10, 2, 1]</span><br><span class="line">    // 然后对其去重</span><br><span class="line">    return _.uniq(flatten(arguments, true, true));</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Produce an array that contains every item shared between all the</span><br><span class="line">  // passed-in arrays.</span><br><span class="line">  // 寻找几个数组中共有的元素</span><br><span class="line">  // 将这些每个数组中都有的元素存入另一个数组中返回</span><br><span class="line">  // _.intersection(*arrays)</span><br><span class="line">  // _.intersection([1, 2, 3, 1], [101, 2, 1, 10, 1], [2, 1, 1])</span><br><span class="line">  // =&gt; [1, 2]</span><br><span class="line">  // 注意：返回的结果数组是去重的</span><br><span class="line">  _.intersection = function(array) &#123;</span><br><span class="line">    // 结果数组</span><br><span class="line">    var result = [];</span><br><span class="line"></span><br><span class="line">    // 传入的参数（数组）个数</span><br><span class="line">    var argsLength = arguments.length;</span><br><span class="line"></span><br><span class="line">     // 遍历第一个数组的元素</span><br><span class="line">    for (var i = 0, length = getLength(array); i &lt; length; i++) &#123;</span><br><span class="line">      var item = array[i];</span><br><span class="line"></span><br><span class="line">      // 如果 result[] 中已经有 item 元素了，continue</span><br><span class="line">      // 即 array 中出现了相同的元素</span><br><span class="line">      // 返回的 result[] 其实是个 &quot;集合&quot;（是去重的）</span><br><span class="line">      if (_.contains(result, item)) continue;</span><br><span class="line"></span><br><span class="line">      // 判断其他参数数组中是否都有 item 这个元素</span><br><span class="line">      for (var j = 1; j &lt; argsLength; j++) &#123;</span><br><span class="line">        if (!_.contains(arguments[j], item))</span><br><span class="line">          break;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      // 遍历其他参数数组完毕</span><br><span class="line">      // j === argsLength 说明其他参数数组中都有 item 元素</span><br><span class="line">      // 则将其放入 result[] 中</span><br><span class="line">      if (j === argsLength)</span><br><span class="line">        result.push(item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return result;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Take the difference between one array and a number of other arrays.</span><br><span class="line">  // Only the elements present in just the first array will remain.</span><br><span class="line">  // _.difference(array, *others)</span><br><span class="line">  // Similar to without, but returns the values from array that are not present in the other arrays.</span><br><span class="line">  // ===== //</span><br><span class="line">  // _.difference([1, 2, 3, 4, 5], [5, 2, 10]);</span><br><span class="line">  // =&gt; [1, 3, 4]</span><br><span class="line">  // ===== //</span><br><span class="line">  // 剔除 array 数组中在 others 数组中出现的元素</span><br><span class="line">  _.difference = function(array) &#123;</span><br><span class="line">    // 将 others 数组展开一层</span><br><span class="line">    // rest[] 保存展开后的元素组成的数组</span><br><span class="line">    // strict 参数为 true</span><br><span class="line">    // 不可以这样用 _.difference([1, 2, 3, 4, 5], [5, 2], 10);</span><br><span class="line">    // 10 就会取不到</span><br><span class="line">    var rest = flatten(arguments, true, true, 1);</span><br><span class="line"></span><br><span class="line">    // 遍历 array，过滤</span><br><span class="line">    return _.filter(array, function(value)&#123;</span><br><span class="line">      // 如果 value 存在在 rest 中，则过滤掉</span><br><span class="line">      return !_.contains(rest, value);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Zip together multiple lists into a single array -- elements that share</span><br><span class="line">  // an index go together.</span><br><span class="line">  // ===== //</span><br><span class="line">  // _.zip([&apos;moe&apos;, &apos;larry&apos;, &apos;curly&apos;], [30, 40, 50], [true, false, false]);</span><br><span class="line">  // =&gt; [[&quot;moe&quot;, 30, true], [&quot;larry&quot;, 40, false], [&quot;curly&quot;, 50, false]]</span><br><span class="line">  // ===== //</span><br><span class="line">  // 将多个数组中相同位置的元素归类</span><br><span class="line">  // 返回一个数组</span><br><span class="line">  _.zip = function() &#123;</span><br><span class="line">    return _.unzip(arguments);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Complement of _.zip. Unzip accepts an array of arrays and groups</span><br><span class="line">  // each array&apos;s elements on shared indices</span><br><span class="line">  // The opposite of zip. Given an array of arrays,</span><br><span class="line">  // returns a series of new arrays,</span><br><span class="line">  // the first of which contains all of the first elements in the input arrays,</span><br><span class="line">  // the second of which contains all of the second elements, and so on.</span><br><span class="line">  // ===== //</span><br><span class="line">  // _.unzip([[&quot;moe&quot;, 30, true], [&quot;larry&quot;, 40, false], [&quot;curly&quot;, 50, false]]);</span><br><span class="line">  // =&gt; [[&apos;moe&apos;, &apos;larry&apos;, &apos;curly&apos;], [30, 40, 50], [true, false, false]]</span><br><span class="line">  // ===== //</span><br><span class="line">  _.unzip = function(array) &#123;</span><br><span class="line">    var length = array &amp;&amp; _.max(array, getLength).length || 0;</span><br><span class="line">    var result = Array(length);</span><br><span class="line"></span><br><span class="line">    for (var index = 0; index &lt; length; index++) &#123;</span><br><span class="line">      result[index] = _.pluck(array, index);</span><br><span class="line">    &#125;</span><br><span class="line">    return result;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Converts lists into objects. Pass either a single array of `[key, value]`</span><br><span class="line">  // pairs, or two parallel arrays of the same length -- one of keys, and one of</span><br><span class="line">  // the corresponding values.</span><br><span class="line">  // 将数组转化为对象</span><br><span class="line">  _.object = function(list, values) &#123;</span><br><span class="line">    var result = &#123;&#125;;</span><br><span class="line">    for (var i = 0, length = getLength(list); i &lt; length; i++) &#123;</span><br><span class="line">      if (values) &#123;</span><br><span class="line">        result[list[i]] = values[i];</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        result[list[i][0]] = list[i][1];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return result;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Generator function to create the findIndex and findLastIndex functions</span><br><span class="line">  // (dir === 1) =&gt; 从前往后找</span><br><span class="line">  // (dir === -1) =&gt; 从后往前找</span><br><span class="line">  function createPredicateIndexFinder(dir) &#123;</span><br><span class="line">    // 经典闭包</span><br><span class="line">    return function(array, predicate, context) &#123;</span><br><span class="line">      predicate = cb(predicate, context);</span><br><span class="line"></span><br><span class="line">      var length = getLength(array);</span><br><span class="line"></span><br><span class="line">      // 根据 dir 变量来确定数组遍历的起始位置</span><br><span class="line">      var index = dir &gt; 0 ? 0 : length - 1;</span><br><span class="line"></span><br><span class="line">      for (; index &gt;= 0 &amp;&amp; index &lt; length; index += dir) &#123;</span><br><span class="line">        // 找到第一个符合条件的元素</span><br><span class="line">        // 并返回下标值</span><br><span class="line">        if (predicate(array[index], index, array))</span><br><span class="line">          return index;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      return -1;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // Returns the first index on an array-like that passes a predicate test</span><br><span class="line">  // 从前往后找到数组中 `第一个满足条件` 的元素，并返回下标值</span><br><span class="line">  // 没找到返回 -1</span><br><span class="line">  // _.findIndex(array, predicate, [context])</span><br><span class="line">  _.findIndex = createPredicateIndexFinder(1);</span><br><span class="line"></span><br><span class="line">  // 从后往前找到数组中 `第一个满足条件` 的元素，并返回下标值</span><br><span class="line">  // 没找到返回 -1</span><br><span class="line">  // _.findLastIndex(array, predicate, [context])</span><br><span class="line">  _.findLastIndex = createPredicateIndexFinder(-1);</span><br><span class="line"></span><br><span class="line">  // Use a comparator function to figure out the smallest index at which</span><br><span class="line">  // an object should be inserted so as to maintain order. Uses binary search.</span><br><span class="line">  // The iteratee may also be the string name of the property to sort by (eg. length).</span><br><span class="line">  // ===== //</span><br><span class="line">  // _.sortedIndex([10, 20, 30, 40, 50], 35);</span><br><span class="line">  // =&gt; 3</span><br><span class="line">  // ===== //</span><br><span class="line">  // var stooges = [&#123;name: &apos;moe&apos;, age: 40&#125;, &#123;name: &apos;curly&apos;, age: 60&#125;];</span><br><span class="line">  // _.sortedIndex(stooges, &#123;name: &apos;larry&apos;, age: 50&#125;, &apos;age&apos;);</span><br><span class="line">  // =&gt; 1</span><br><span class="line">  // ===== //</span><br><span class="line">  // 二分查找</span><br><span class="line">  // 将一个元素插入已排序的数组</span><br><span class="line">  // 返回该插入的位置下标</span><br><span class="line">  // _.sortedIndex(list, value, [iteratee], [context])</span><br><span class="line">  _.sortedIndex = function(array, obj, iteratee, context) &#123;</span><br><span class="line">    // 注意 cb 方法</span><br><span class="line">    // iteratee 为空 || 为 String 类型（key 值）时会返回不同方法</span><br><span class="line">    iteratee = cb(iteratee, context, 1);</span><br><span class="line"></span><br><span class="line">    // 经过迭代函数计算的值</span><br><span class="line">    // 可打印 iteratee 出来看看</span><br><span class="line">    var value = iteratee(obj);</span><br><span class="line"></span><br><span class="line">    var low = 0, high = getLength(array);</span><br><span class="line"></span><br><span class="line">    // 二分查找</span><br><span class="line">    while (low &lt; high) &#123;</span><br><span class="line">      var mid = Math.floor((low + high) / 2);</span><br><span class="line">      if (iteratee(array[mid]) &lt; value)</span><br><span class="line">        low = mid + 1;</span><br><span class="line">      else</span><br><span class="line">        high = mid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return low;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Generator function to create the indexOf and lastIndexOf functions</span><br><span class="line">  // _.indexOf = createIndexFinder(1, _.findIndex, _.sortedIndex);</span><br><span class="line">  // _.lastIndexOf = createIndexFinder(-1, _.findLastIndex);</span><br><span class="line">  function createIndexFinder(dir, predicateFind, sortedIndex) &#123;</span><br><span class="line">    // API 调用形式</span><br><span class="line">    // _.indexOf(array, value, [isSorted])</span><br><span class="line">    // _.indexOf(array, value, [fromIndex])</span><br><span class="line">    // _.lastIndexOf(array, value, [fromIndex])</span><br><span class="line">    return function(array, item, idx) &#123;</span><br><span class="line">      var i = 0, length = getLength(array);</span><br><span class="line"></span><br><span class="line">      // 如果 idx 为 Number 类型</span><br><span class="line">      // 则规定查找位置的起始点</span><br><span class="line">      // 那么第三个参数不是 [isSorted]</span><br><span class="line">      // 所以不能用二分查找优化了</span><br><span class="line">      // 只能遍历查找</span><br><span class="line">      if (typeof idx == &apos;number&apos;) &#123;</span><br><span class="line">        if (dir &gt; 0) &#123; // 正向查找</span><br><span class="line">          // 重置查找的起始位置</span><br><span class="line">          i = idx &gt;= 0 ? idx : Math.max(idx + length, i);</span><br><span class="line">        &#125; else &#123; // 反向查找</span><br><span class="line">          // 如果是反向查找，重置 length 属性值</span><br><span class="line">          length = idx &gt;= 0 ? Math.min(idx + 1, length) : idx + length + 1;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; else if (sortedIndex &amp;&amp; idx &amp;&amp; length) &#123;</span><br><span class="line">        // 能用二分查找加速的条件</span><br><span class="line">        // 有序 &amp; idx !== 0 &amp;&amp; length !== 0</span><br><span class="line"></span><br><span class="line">        // 用 _.sortIndex 找到有序数组中 item 正好插入的位置</span><br><span class="line">        idx = sortedIndex(array, item);</span><br><span class="line"></span><br><span class="line">        // 如果正好插入的位置的值和 item 刚好相等</span><br><span class="line">        // 说明该位置就是 item 第一次出现的位置</span><br><span class="line">        // 返回下标</span><br><span class="line">        // 否则即是没找到，返回 -1</span><br><span class="line">        return array[idx] === item ? idx : -1;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      // 特判，如果要查找的元素是 NaN 类型</span><br><span class="line">      // 如果 item !== item</span><br><span class="line">      // 那么 item =&gt; NaN</span><br><span class="line">      if (item !== item) &#123;</span><br><span class="line">        idx = predicateFind(slice.call(array, i, length), _.isNaN);</span><br><span class="line">        return idx &gt;= 0 ? idx + i : -1;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      // O(n) 遍历数组</span><br><span class="line">      // 寻找和 item 相同的元素</span><br><span class="line">      // 特判排除了 item 为 NaN 的情况</span><br><span class="line">      // 可以放心地用 `===` 来判断是否相等了</span><br><span class="line">      for (idx = dir &gt; 0 ? i : length - 1; idx &gt;= 0 &amp;&amp; idx &lt; length; idx += dir) &#123;</span><br><span class="line">        if (array[idx] === item) return idx;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      return -1;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // Return the position of the first occurrence of an item in an array,</span><br><span class="line">  // or -1 if the item is not included in the array.</span><br><span class="line">  // If the array is large and already in sort order, pass `true`</span><br><span class="line">  // for **isSorted** to use binary search.</span><br><span class="line">  // _.indexOf(array, value, [isSorted])</span><br><span class="line">  // 找到数组 array 中 value 第一次出现的位置</span><br><span class="line">  // 并返回其下标值</span><br><span class="line">  // 如果数组有序，则第三个参数可以传入 true</span><br><span class="line">  // 这样算法效率会更高（二分查找）</span><br><span class="line">  // [isSorted] 参数表示数组是否有序</span><br><span class="line">  // 同时第三个参数也可以表示 [fromIndex] （见下面的 _.lastIndexOf）</span><br><span class="line">  _.indexOf = createIndexFinder(1, _.findIndex, _.sortedIndex);</span><br><span class="line"></span><br><span class="line">  // 和 _indexOf 相似</span><br><span class="line">  // 反序查找</span><br><span class="line">  // _.lastIndexOf(array, value, [fromIndex])</span><br><span class="line">  // [fromIndex] 参数表示从倒数第几个开始往前找</span><br><span class="line">  _.lastIndexOf = createIndexFinder(-1, _.findLastIndex);</span><br><span class="line"></span><br><span class="line">  // Generate an integer Array containing an arithmetic progression. A port of</span><br><span class="line">  // the native Python `range()` function. See</span><br><span class="line">  // [the Python documentation](http://docs.python.org/library/functions.html#range).</span><br><span class="line">  // 返回某一个范围内的数组成的数组</span><br><span class="line">  _.range = function(start, stop, step) &#123;</span><br><span class="line">    if (stop == null) &#123;</span><br><span class="line">      stop = start || 0;</span><br><span class="line">      start = 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    step = step || 1;</span><br><span class="line"></span><br><span class="line">    // 返回数组的长度</span><br><span class="line">    var length = Math.max(Math.ceil((stop - start) / step), 0);</span><br><span class="line"></span><br><span class="line">    // 返回的数组</span><br><span class="line">    var range = Array(length);</span><br><span class="line"></span><br><span class="line">    for (var idx = 0; idx &lt; length; idx++, start += step) &#123;</span><br><span class="line">      range[idx] = start;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return range;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  // Function (ahem) Functions</span><br><span class="line">  // 函数的扩展方法</span><br><span class="line">  // 共 14 个扩展方法</span><br><span class="line">  // ------------------</span><br><span class="line"></span><br><span class="line">  // Determines whether to execute a function as a constructor</span><br><span class="line">  // or a normal function with the provided arguments</span><br><span class="line">  var executeBound = function(sourceFunc, boundFunc, context, callingContext, args) &#123;</span><br><span class="line">    // 非 new 调用 _.bind 返回的方法（即 bound）</span><br><span class="line">    // callingContext 不是 boundFunc 的一个实例</span><br><span class="line">    if (!(callingContext instanceof boundFunc))</span><br><span class="line">      return sourceFunc.apply(context, args);</span><br><span class="line"></span><br><span class="line">    // 如果是用 new 调用 _.bind 返回的方法</span><br><span class="line"></span><br><span class="line">    // self 为 sourceFunc 的实例，继承了它的原型链</span><br><span class="line">    // self 理论上是一个空对象（还没赋值），但是有原型链</span><br><span class="line">    var self = baseCreate(sourceFunc.prototype);</span><br><span class="line"></span><br><span class="line">    // 用 new 生成一个构造函数的实例</span><br><span class="line">    // 正常情况下是没有返回值的，即 result 值为 undefined</span><br><span class="line">    // 如果构造函数有返回值</span><br><span class="line">    // 如果返回值是对象（非 null），则 new 的结果返回这个对象</span><br><span class="line">    // 否则返回实例</span><br><span class="line">    // @see http://www.cnblogs.com/zichi/p/4392944.html</span><br><span class="line">    var result = sourceFunc.apply(self, args);</span><br><span class="line"></span><br><span class="line">    // 如果构造函数返回了对象</span><br><span class="line">    // 则 new 的结果是这个对象</span><br><span class="line">    // 返回这个对象</span><br><span class="line">    if (_.isObject(result)) return result;</span><br><span class="line"></span><br><span class="line">    // 否则返回 self</span><br><span class="line">    // var result = sourceFunc.apply(self, args);</span><br><span class="line">    // self 对象当做参数传入</span><br><span class="line">    // 会直接改变值</span><br><span class="line">    return self;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Create a function bound to a given object (assigning `this`, and arguments,</span><br><span class="line">  // optionally). Delegates to **ECMAScript 5**&apos;s native `Function.bind` if</span><br><span class="line">  // available.</span><br><span class="line">  // ES5 bind 方法的扩展（polyfill）</span><br><span class="line">  // 将 func 中的 this 指向 context（对象）</span><br><span class="line">  // _.bind(function, object, *arguments)</span><br><span class="line">  // 可选的 arguments 参数会被当作 func 的参数传入</span><br><span class="line">  // func 在调用时，会优先用 arguments 参数，然后使用 _.bind 返回方法所传入的参数</span><br><span class="line">  _.bind = function(func, context) &#123;</span><br><span class="line">    // 如果浏览器支持 ES5 bind 方法，并且 func 上的 bind 方法没有被重写</span><br><span class="line">    // 则优先使用原生的 bind 方法</span><br><span class="line">    if (nativeBind &amp;&amp; func.bind === nativeBind)</span><br><span class="line">      return nativeBind.apply(func, slice.call(arguments, 1));</span><br><span class="line"></span><br><span class="line">    // 如果传入的参数 func 不是方法，则抛出错误</span><br><span class="line">    if (!_.isFunction(func))</span><br><span class="line">      throw new TypeError(&apos;Bind must be called on a function&apos;);</span><br><span class="line"></span><br><span class="line">    // polyfill</span><br><span class="line">    // 经典闭包，函数返回函数</span><br><span class="line">    // args 获取优先使用的参数</span><br><span class="line">    var args = slice.call(arguments, 2);</span><br><span class="line">    var bound = function() &#123;</span><br><span class="line">      // args.concat(slice.call(arguments))</span><br><span class="line">      // 最终函数的实际调用参数由两部分组成</span><br><span class="line">      // 一部分是传入 _.bind 的参数（会被优先调用）</span><br><span class="line">      // 另一部分是传入 bound（_.bind 所返回方法）的参数</span><br><span class="line">      return executeBound(func, bound, context, this, args.concat(slice.call(arguments)));</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    return bound;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Partially apply a function by creating a version that has had some of its</span><br><span class="line">  // arguments pre-filled, without changing its dynamic `this` context. _ acts</span><br><span class="line">  // as a placeholder, allowing any combination of arguments to be pre-filled.</span><br><span class="line">  // _.partial(function, *arguments)</span><br><span class="line">  // _.partial 能返回一个方法</span><br><span class="line">  // pre-fill 该方法的一些参数</span><br><span class="line">  _.partial = function(func) &#123;</span><br><span class="line">    // 提取希望 pre-fill 的参数</span><br><span class="line">    // 如果传入的是 _，则这个位置的参数暂时空着，等待手动填入</span><br><span class="line">    var boundArgs = slice.call(arguments, 1);</span><br><span class="line"></span><br><span class="line">    var bound = function() &#123;</span><br><span class="line">      var position = 0, length = boundArgs.length;</span><br><span class="line">      var args = Array(length);</span><br><span class="line">      for (var i = 0; i &lt; length; i++) &#123;</span><br><span class="line">        // 如果该位置的参数为 _，则用 bound 方法的参数填充这个位置</span><br><span class="line">        // args 为调用 _.partial 方法的 pre-fill 的参数 &amp; bound 方法的 arguments</span><br><span class="line">        args[i] = boundArgs[i] === _ ? arguments[position++] : boundArgs[i];</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      // bound 方法还有剩余的 arguments，添上去</span><br><span class="line">      while (position &lt; arguments.length)</span><br><span class="line">        args.push(arguments[position++]);</span><br><span class="line"></span><br><span class="line">      return executeBound(func, bound, this, this, args);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    return bound;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Bind a number of an object&apos;s methods to that object. Remaining arguments</span><br><span class="line">  // are the method names to be bound. Useful for ensuring that all callbacks</span><br><span class="line">  // defined on an object belong to it.</span><br><span class="line">  // 指定一系列方法（methodNames）中的 this 指向（object）</span><br><span class="line">  // _.bindAll(object, *methodNames)</span><br><span class="line">  _.bindAll = function(obj) &#123;</span><br><span class="line">    var i, length = arguments.length, key;</span><br><span class="line"></span><br><span class="line">    // 如果只传入了一个参数（obj），没有传入 methodNames，则报错</span><br><span class="line">    if (length &lt;= 1)</span><br><span class="line">      throw new Error(&apos;bindAll must be passed function names&apos;);</span><br><span class="line"></span><br><span class="line">    // 遍历 methodNames</span><br><span class="line">    for (i = 1; i &lt; length; i++) &#123;</span><br><span class="line">      key = arguments[i];</span><br><span class="line">      // 逐个绑定</span><br><span class="line">      obj[key] = _.bind(obj[key], obj);</span><br><span class="line">    &#125;</span><br><span class="line">    return obj;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Memoize an expensive function by storing its results.</span><br><span class="line">  //「记忆化」，存储中间运算结果，提高效率</span><br><span class="line">  // 参数 hasher 是个 function，用来计算 key</span><br><span class="line">  // 如果传入了 hasher，则用 hasher 来计算 key</span><br><span class="line">  // 否则用 key 参数直接当 key（即 memoize 方法传入的第一个参数）</span><br><span class="line">  // _.memoize(function, [hashFunction])</span><br><span class="line">  // 适用于需要大量重复求值的场景</span><br><span class="line">  // 比如递归求解菲波那切数</span><br><span class="line">  // @http://www.jameskrob.com/memoize.html</span><br><span class="line">  // create hash for storing &quot;expensive&quot; function outputs</span><br><span class="line">  // run expensive function</span><br><span class="line">  // check whether function has already been run with given arguments via hash lookup</span><br><span class="line">  // if false - run function, and store output in hash</span><br><span class="line">  // if true, return output stored in hash</span><br><span class="line">  _.memoize = function(func, hasher) &#123;</span><br><span class="line">    var memoize = function(key) &#123;</span><br><span class="line">      // 储存变量，方便使用</span><br><span class="line">      var cache = memoize.cache;</span><br><span class="line"></span><br><span class="line">      // 求 key</span><br><span class="line">      // 如果传入了 hasher，则用 hasher 函数来计算 key</span><br><span class="line">      // 否则用 参数 key（即 memoize 方法传入的第一个参数）当 key</span><br><span class="line">      var address = &apos;&apos; + (hasher ? hasher.apply(this, arguments) : key);</span><br><span class="line"></span><br><span class="line">      // 如果这个 key 还没被 hash 过（还没求过值）</span><br><span class="line">      if (!_.has(cache, address))</span><br><span class="line">        cache[address] = func.apply(this, arguments);</span><br><span class="line"></span><br><span class="line">      // 返回</span><br><span class="line">      return cache[address];</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    // cache 对象被当做 key-value 键值对缓存中间运算结果</span><br><span class="line">    memoize.cache = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    // 返回一个函数（经典闭包）</span><br><span class="line">    return memoize;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Delays a function for the given number of milliseconds, and then calls</span><br><span class="line">  // it with the arguments supplied.</span><br><span class="line">  // 延迟触发某方法</span><br><span class="line">  // _.delay(function, wait, *arguments)</span><br><span class="line">  //  如果传入了 arguments 参数，则会被当作 func 的参数在触发时调用</span><br><span class="line">  // 其实是封装了「延迟触发某方法」，使其复用</span><br><span class="line">  _.delay = function(func, wait) &#123;</span><br><span class="line">    // 获取 *arguments</span><br><span class="line">    // 是 func 函数所需要的参数</span><br><span class="line">    var args = slice.call(arguments, 2);</span><br><span class="line">    return setTimeout(function()&#123;</span><br><span class="line">      // 将参数赋予 func 函数</span><br><span class="line">      return func.apply(null, args);</span><br><span class="line">    &#125;, wait);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Defers a function, scheduling it to run after the current call stack has</span><br><span class="line">  // cleared.</span><br><span class="line">  // 和 setTimeout(func, 0) 相似（源码看来似乎应该是 setTimeout(func, 1)）</span><br><span class="line">  // _.defer(function, *arguments)</span><br><span class="line">  // 如果传入 *arguments，会被当做参数，和 _.delay 调用方式类似（少了第二个参数）</span><br><span class="line">  // 其实核心还是调用了 _.delay 方法，但第二个参数（wait 参数）设置了默认值为 1</span><br><span class="line">  // 如何使得方法能设置默认值？用 _.partial 方法</span><br><span class="line">  _.defer = _.partial(_.delay, _, 1);</span><br><span class="line"></span><br><span class="line">  // Returns a function, that, when invoked, will only be triggered at most once</span><br><span class="line">  // during a given window of time. Normally, the throttled function will run</span><br><span class="line">  // as much as it can, without ever going more than once per `wait` duration;</span><br><span class="line">  // but if you&apos;d like to disable the execution on the leading edge, pass</span><br><span class="line">  // `&#123;leading: false&#125;`. To disable execution on the trailing edge, ditto.</span><br><span class="line">  // 函数节流（如果有连续事件响应，则每间隔一定时间段触发）</span><br><span class="line">  // 每间隔 wait(Number) milliseconds 触发一次 func 方法</span><br><span class="line">  // 如果 options 参数传入 &#123;leading: false&#125;</span><br><span class="line">  // 那么不会马上触发（等待 wait milliseconds 后第一次触发 func）</span><br><span class="line">  // 如果 options 参数传入 &#123;trailing: false&#125;</span><br><span class="line">  // 那么最后一次回调不会被触发</span><br><span class="line">  // **Notice: options 不能同时设置 leading 和 trailing 为 false**</span><br><span class="line">  // 示例：</span><br><span class="line">  // var throttled = _.throttle(updatePosition, 100);</span><br><span class="line">  // $(window).scroll(throttled);</span><br><span class="line">  // 调用方式（注意看 A 和 B console.log 打印的位置）：</span><br><span class="line">  // _.throttle(function, wait, [options])</span><br><span class="line">  // sample 1: _.throttle(function()&#123;&#125;, 1000)</span><br><span class="line">  // print: A, B, B, B ...</span><br><span class="line">  // sample 2: _.throttle(function()&#123;&#125;, 1000, &#123;leading: false&#125;)</span><br><span class="line">  // print: B, B, B, B ...</span><br><span class="line">  // sample 3: _.throttle(function()&#123;&#125;, 1000, &#123;trailing: false&#125;)</span><br><span class="line">  // print: A, A, A, A ...</span><br><span class="line">  // ----------------------------------------- //</span><br><span class="line">  _.throttle = function(func, wait, options) &#123;</span><br><span class="line">    var context, args, result;</span><br><span class="line"></span><br><span class="line">    // setTimeout 的 handler</span><br><span class="line">    var timeout = null;</span><br><span class="line"></span><br><span class="line">    // 标记时间戳</span><br><span class="line">    // 上一次执行回调的时间戳</span><br><span class="line">    var previous = 0;</span><br><span class="line"></span><br><span class="line">    // 如果没有传入 options 参数</span><br><span class="line">    // 则将 options 参数置为空对象</span><br><span class="line">    if (!options)</span><br><span class="line">      options = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    var later = function() &#123;</span><br><span class="line">      // 如果 options.leading === false</span><br><span class="line">      // 则每次触发回调后将 previous 置为 0</span><br><span class="line">      // 否则置为当前时间戳</span><br><span class="line">      previous = options.leading === false ? 0 : _.now();</span><br><span class="line">      timeout = null;</span><br><span class="line">      // console.log(&apos;B&apos;)</span><br><span class="line">      result = func.apply(context, args);</span><br><span class="line"></span><br><span class="line">      // 这里的 timeout 变量一定是 null 了吧</span><br><span class="line">      // 是否没有必要进行判断？</span><br><span class="line">      if (!timeout)</span><br><span class="line">        context = args = null;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    // 以滚轮事件为例（scroll）</span><br><span class="line">    // 每次触发滚轮事件即执行这个返回的方法</span><br><span class="line">    // _.throttle 方法返回的函数</span><br><span class="line">    return function() &#123;</span><br><span class="line">      // 记录当前时间戳</span><br><span class="line">      var now = _.now();</span><br><span class="line"></span><br><span class="line">      // 第一次执行回调（此时 previous 为 0，之后 previous 值为上一次时间戳）</span><br><span class="line">      // 并且如果程序设定第一个回调不是立即执行的（options.leading === false）</span><br><span class="line">      // 则将 previous 值（表示上次执行的时间戳）设为 now 的时间戳（第一次触发时）</span><br><span class="line">      // 表示刚执行过，这次就不用执行了</span><br><span class="line">      if (!previous &amp;&amp; options.leading === false)</span><br><span class="line">        previous = now;</span><br><span class="line"></span><br><span class="line">      // 距离下次触发 func 还需要等待的时间</span><br><span class="line">      var remaining = wait - (now - previous);</span><br><span class="line">      context = this;</span><br><span class="line">      args = arguments;</span><br><span class="line"></span><br><span class="line">      // 要么是到了间隔时间了，随即触发方法（remaining &lt;= 0）</span><br><span class="line">      // 要么是没有传入 &#123;leading: false&#125;，且第一次触发回调，即立即触发</span><br><span class="line">      // 此时 previous 为 0，wait - (now - previous) 也满足 &lt;= 0</span><br><span class="line">      // 之后便会把 previous 值迅速置为 now</span><br><span class="line">      // ========= //</span><br><span class="line">      // remaining &gt; wait，表示客户端系统时间被调整过</span><br><span class="line">      // 则马上执行 func 函数</span><br><span class="line">      // @see https://blog.coding.net/blog/the-difference-between-throttle-and-debounce-in-underscorejs</span><br><span class="line">      // ========= //</span><br><span class="line"></span><br><span class="line">      // console.log(remaining) 可以打印出来看看</span><br><span class="line">      if (remaining &lt;= 0 || remaining &gt; wait) &#123;</span><br><span class="line">        if (timeout) &#123;</span><br><span class="line">          clearTimeout(timeout);</span><br><span class="line">          // 解除引用，防止内存泄露</span><br><span class="line">          timeout = null;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 重置前一次触发的时间戳</span><br><span class="line">        previous = now;</span><br><span class="line"></span><br><span class="line">        // 触发方法</span><br><span class="line">        // result 为该方法返回值</span><br><span class="line">        // console.log(&apos;A&apos;)</span><br><span class="line">        result = func.apply(context, args);</span><br><span class="line"></span><br><span class="line">        // 引用置为空，防止内存泄露</span><br><span class="line">        // 感觉这里的 timeout 肯定是 null 啊？这个 if 判断没必要吧？</span><br><span class="line">        if (!timeout)</span><br><span class="line">          context = args = null;</span><br><span class="line">      &#125; else if (!timeout &amp;&amp; options.trailing !== false) &#123; // 最后一次需要触发的情况</span><br><span class="line">        // 如果已经存在一个定时器，则不会进入该 if 分支</span><br><span class="line">        // 如果 &#123;trailing: false&#125;，即最后一次不需要触发了，也不会进入这个分支</span><br><span class="line">        // 间隔 remaining milliseconds 后触发 later 方法</span><br><span class="line">        timeout = setTimeout(later, remaining);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      // 回调返回值</span><br><span class="line">      return result;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Returns a function, that, as long as it continues to be invoked, will not</span><br><span class="line">  // be triggered. The function will be called after it stops being called for</span><br><span class="line">  // N milliseconds. If `immediate` is passed, trigger the function on the</span><br><span class="line">  // leading edge, instead of the trailing.</span><br><span class="line">  // 函数去抖（连续事件触发结束后只触发一次）</span><br><span class="line">  // sample 1: _.debounce(function()&#123;&#125;, 1000)</span><br><span class="line">  // 连续事件结束后的 1000ms 后触发</span><br><span class="line">  // sample 1: _.debounce(function()&#123;&#125;, 1000, true)</span><br><span class="line">  // 连续事件触发后立即触发（此时会忽略第二个参数）</span><br><span class="line">  _.debounce = function(func, wait, immediate) &#123;</span><br><span class="line">    var timeout, args, context, timestamp, result;</span><br><span class="line"></span><br><span class="line">    var later = function() &#123;</span><br><span class="line">      // 定时器设置的回调 later 方法的触发时间，和连续事件触发的最后一次时间戳的间隔</span><br><span class="line">      // 如果间隔为 wait（或者刚好大于 wait），则触发事件</span><br><span class="line">      var last = _.now() - timestamp;</span><br><span class="line"></span><br><span class="line">      // 时间间隔 last 在 [0, wait) 中</span><br><span class="line">      // 还没到触发的点，则继续设置定时器</span><br><span class="line">      // last 值应该不会小于 0 吧？</span><br><span class="line">      if (last &lt; wait &amp;&amp; last &gt;= 0) &#123;</span><br><span class="line">        timeout = setTimeout(later, wait - last);</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        // 到了可以触发的时间点</span><br><span class="line">        timeout = null;</span><br><span class="line">        // 可以触发了</span><br><span class="line">        // 并且不是设置为立即触发的</span><br><span class="line">        // 因为如果是立即触发（callNow），也会进入这个回调中</span><br><span class="line">        // 主要是为了将 timeout 值置为空，使之不影响下次连续事件的触发</span><br><span class="line">        // 如果不是立即执行，随即执行 func 方法</span><br><span class="line">        if (!immediate) &#123;</span><br><span class="line">          // 执行 func 函数</span><br><span class="line">          result = func.apply(context, args);</span><br><span class="line">          // 这里的 timeout 一定是 null 了吧</span><br><span class="line">          // 感觉这个判断多余了</span><br><span class="line">          if (!timeout)</span><br><span class="line">            context = args = null;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    // 嗯，闭包返回的函数，是可以传入参数的</span><br><span class="line">    // 也是 DOM 事件所触发的回调函数</span><br><span class="line">    return function() &#123;</span><br><span class="line">      // 可以指定 this 指向</span><br><span class="line">      context = this;</span><br><span class="line">      args = arguments;</span><br><span class="line"></span><br><span class="line">      // 每次触发函数，更新时间戳</span><br><span class="line">      // later 方法中取 last 值时用到该变量</span><br><span class="line">      // 判断距离上次触发事件是否已经过了 wait seconds 了</span><br><span class="line">      // 即我们需要距离最后一次事件触发 wait seconds 后触发这个回调方法</span><br><span class="line">      timestamp = _.now();</span><br><span class="line"></span><br><span class="line">      // 立即触发需要满足两个条件</span><br><span class="line">      // immediate 参数为 true，并且 timeout 还没设置</span><br><span class="line">      // immediate 参数为 true 是显而易见的</span><br><span class="line">      // 如果去掉 !timeout 的条件，就会一直触发，而不是触发一次</span><br><span class="line">      // 因为第一次触发后已经设置了 timeout，所以根据 timeout 是否为空可以判断是否是首次触发</span><br><span class="line">      var callNow = immediate &amp;&amp; !timeout;</span><br><span class="line"></span><br><span class="line">      // 设置 wait seconds 后触发 later 方法</span><br><span class="line">      // 无论是否 callNow（如果是 callNow，也进入 later 方法，去 later 方法中判断是否执行相应回调函数）</span><br><span class="line">      // 在某一段的连续触发中，只会在第一次触发时进入这个 if 分支中</span><br><span class="line">      if (!timeout)</span><br><span class="line">        // 设置了 timeout，所以以后不会进入这个 if 分支了</span><br><span class="line">        timeout = setTimeout(later, wait);</span><br><span class="line"></span><br><span class="line">      // 如果是立即触发</span><br><span class="line">      if (callNow) &#123;</span><br><span class="line">        // func 可能是有返回值的</span><br><span class="line">        result = func.apply(context, args);</span><br><span class="line">        // 解除引用</span><br><span class="line">        context = args = null;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      return result;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Returns the first function passed as an argument to the second,</span><br><span class="line">  // allowing you to adjust arguments, run code before and after, and</span><br><span class="line">  // conditionally execute the original function.</span><br><span class="line">  _.wrap = function(func, wrapper) &#123;</span><br><span class="line">    return _.partial(wrapper, func);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Returns a negated version of the passed-in predicate.</span><br><span class="line">  // 返回一个 predicate 方法的对立方法</span><br><span class="line">  // 即该方法可以对原来的 predicate 迭代结果值取补集</span><br><span class="line">  _.negate = function(predicate) &#123;</span><br><span class="line">    return function() &#123;</span><br><span class="line">      return !predicate.apply(this, arguments);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Returns a function that is the composition of a list of functions, each</span><br><span class="line">  // consuming the return value of the function that follows.</span><br><span class="line">  // _.compose(*functions)</span><br><span class="line">  // var tmp = _.compose(f, g, h)</span><br><span class="line">  // tmp(args) =&gt; f(g(h(args)))</span><br><span class="line">  _.compose = function() &#123;</span><br><span class="line">    var args = arguments; // funcs</span><br><span class="line">    var start = args.length - 1; // 倒序调用</span><br><span class="line">    return function() &#123;</span><br><span class="line">      var i = start;</span><br><span class="line">      var result = args[start].apply(this, arguments);</span><br><span class="line">      // 一个一个方法地执行</span><br><span class="line">      while (i--)</span><br><span class="line">        result = args[i].call(this, result);</span><br><span class="line">      return result;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Returns a function that will only be executed on and after the Nth call.</span><br><span class="line">  // 第 times 触发执行 func（事实上之后的每次触发还是会执行 func）</span><br><span class="line">  // 有什么用呢？</span><br><span class="line">  // 如果有 N 个异步事件，所有异步执行完后执行该回调，即 func 方法（联想 eventproxy）</span><br><span class="line">  // _.after 会返回一个函数</span><br><span class="line">  // 当这个函数第 times 被执行的时候</span><br><span class="line">  // 触发 func 方法</span><br><span class="line">  _.after = function(times, func) &#123;</span><br><span class="line">    return function() &#123;</span><br><span class="line">      // 函数被触发了 times 了，则执行 func 函数</span><br><span class="line">      // 事实上 times 次后如果函数继续被执行，也会触发 func</span><br><span class="line">      if (--times &lt; 1) &#123;</span><br><span class="line">        return func.apply(this, arguments);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Returns a function that will only be executed up to (but not including) the Nth call.</span><br><span class="line">  // 函数至多被调用 times - 1 次（(but not including) the Nth call）</span><br><span class="line">  // func 函数会触发 time - 1 次（Creates a version of the function that can be called no more than count times）</span><br><span class="line">  // func 函数有个返回值，前 time - 1 次触发的返回值都是将参数代入重新计算的</span><br><span class="line">  // 第 times 开始的返回值为第 times - 1 次时的返回值（不重新计算）</span><br><span class="line">  // The result of the last function call is memoized and returned when count has been reached.</span><br><span class="line">  _.before = function(times, func) &#123;</span><br><span class="line">    var memo;</span><br><span class="line">    return function() &#123;</span><br><span class="line">      if (--times &gt; 0) &#123;</span><br><span class="line">        // 缓存函数执行结果</span><br><span class="line">        memo = func.apply(this, arguments);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      // func 引用置为空，其实不置为空也用不到 func 了</span><br><span class="line">      if (times &lt;= 1)</span><br><span class="line">        func = null;</span><br><span class="line"></span><br><span class="line">      // 前 times - 1 次触发，memo 都是分别计算返回</span><br><span class="line">      // 第 times 次开始，memo 值同 times - 1 次时的 memo</span><br><span class="line">      return memo;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Returns a function that will be executed at most one time, no matter how</span><br><span class="line">  // often you call it. Useful for lazy initialization.</span><br><span class="line">  // 函数至多只能被调用一次</span><br><span class="line">  // 适用于这样的场景，某些函数只能被初始化一次，不得不设置一个变量 flag</span><br><span class="line">  // 初始化后设置 flag 为 true，之后不断 check flag</span><br><span class="line">  // ====== //</span><br><span class="line">  // 其实是调用了 _.before 方法，并且将 times 参数设置为了默认值 2（也就是 func 至多能被调用 2 - 1 = 1 次）</span><br><span class="line">  _.once = _.partial(_.before, 2);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  // Object Functions</span><br><span class="line">  // 对象的扩展方法</span><br><span class="line">  // 共 38 个扩展方法</span><br><span class="line">  // ----------------</span><br><span class="line"></span><br><span class="line">  // Keys in IE &lt; 9 that won&apos;t be iterated by `for key in ...` and thus missed.</span><br><span class="line">  // IE &lt; 9 下 不能用 for key in ... 来枚举对象的某些 key</span><br><span class="line">  // 比如重写了对象的 `toString` 方法，这个 key 值就不能在 IE &lt; 9 下用 for in 枚举到</span><br><span class="line">  // IE &lt; 9，&#123;toString: null&#125;.propertyIsEnumerable(&apos;toString&apos;) 返回 false</span><br><span class="line">  // IE &lt; 9，重写的 `toString` 属性被认为不可枚举</span><br><span class="line">  // 据此可以判断是否在 IE &lt; 9 浏览器环境中</span><br><span class="line">  var hasEnumBug = !&#123;toString: null&#125;.propertyIsEnumerable(&apos;toString&apos;);</span><br><span class="line"></span><br><span class="line">  // IE &lt; 9 下不能用 for in 来枚举的 key 值集合</span><br><span class="line">  // 其实还有个 `constructor` 属性</span><br><span class="line">  // 个人觉得可能是 `constructor` 和其他属性不属于一类</span><br><span class="line">  // nonEnumerableProps[] 中都是方法</span><br><span class="line">  // 而 constructor 表示的是对象的构造函数</span><br><span class="line">  // 所以区分开来了</span><br><span class="line">  var nonEnumerableProps = [&apos;valueOf&apos;, &apos;isPrototypeOf&apos;, &apos;toString&apos;,</span><br><span class="line">                      &apos;propertyIsEnumerable&apos;, &apos;hasOwnProperty&apos;, &apos;toLocaleString&apos;];</span><br><span class="line"></span><br><span class="line">  // obj 为需要遍历键值对的对象</span><br><span class="line">  // keys 为键数组</span><br><span class="line">  // 利用 JavaScript 按值传递的特点</span><br><span class="line">  // 传入数组作为参数，能直接改变数组的值</span><br><span class="line">  function collectNonEnumProps(obj, keys) &#123;</span><br><span class="line">    var nonEnumIdx = nonEnumerableProps.length;</span><br><span class="line">    var constructor = obj.constructor;</span><br><span class="line"></span><br><span class="line">    // 获取对象的原型</span><br><span class="line">    // 如果 obj 的 constructor 被重写</span><br><span class="line">    // 则 proto 变量为 Object.prototype</span><br><span class="line">    // 如果没有被重写</span><br><span class="line">    // 则为 obj.constructor.prototype</span><br><span class="line">    var proto = (_.isFunction(constructor) &amp;&amp; constructor.prototype) || ObjProto;</span><br><span class="line"></span><br><span class="line">    // Constructor is a special case.</span><br><span class="line">    // `constructor` 属性需要特殊处理 (是否有必要？)</span><br><span class="line">    // see https://github.com/hanzichi/underscore-analysis/issues/3</span><br><span class="line">    // 如果 obj 有 `constructor` 这个 key</span><br><span class="line">    // 并且该 key 没有在 keys 数组中</span><br><span class="line">    // 存入 keys 数组</span><br><span class="line">    var prop = &apos;constructor&apos;;</span><br><span class="line">    if (_.has(obj, prop) &amp;&amp; !_.contains(keys, prop)) keys.push(prop);</span><br><span class="line"></span><br><span class="line">    // 遍历 nonEnumerableProps 数组中的 keys</span><br><span class="line">    while (nonEnumIdx--) &#123;</span><br><span class="line">      prop = nonEnumerableProps[nonEnumIdx];</span><br><span class="line">      // prop in obj 应该肯定返回 true 吧？是否有判断必要？</span><br><span class="line">      // obj[prop] !== proto[prop] 判断该 key 是否来自于原型链</span><br><span class="line">      // 即是否重写了原型链上的属性</span><br><span class="line">      if (prop in obj &amp;&amp; obj[prop] !== proto[prop] &amp;&amp; !_.contains(keys, prop)) &#123;</span><br><span class="line">        keys.push(prop);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // Retrieve the names of an object&apos;s own properties.</span><br><span class="line">  // Delegates to **ECMAScript 5**&apos;s native `Object.keys`</span><br><span class="line">  // ===== //</span><br><span class="line">  // _.keys(&#123;one: 1, two: 2, three: 3&#125;);</span><br><span class="line">  // =&gt; [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]</span><br><span class="line">  // ===== //</span><br><span class="line">  // 返回一个对象的 keys 组成的数组</span><br><span class="line">  // 仅返回 own enumerable properties 组成的数组</span><br><span class="line">  _.keys = function(obj) &#123;</span><br><span class="line">    // 容错</span><br><span class="line">    // 如果传入的参数不是对象，则返回空数组</span><br><span class="line">    if (!_.isObject(obj)) return [];</span><br><span class="line"></span><br><span class="line">    // 如果浏览器支持 ES5 Object.key() 方法</span><br><span class="line">    // 则优先使用该方法</span><br><span class="line">    if (nativeKeys) return nativeKeys(obj);</span><br><span class="line"></span><br><span class="line">    var keys = [];</span><br><span class="line"></span><br><span class="line">    // own enumerable properties</span><br><span class="line">    for (var key in obj)</span><br><span class="line">      // hasOwnProperty</span><br><span class="line">      if (_.has(obj, key)) keys.push(key);</span><br><span class="line"></span><br><span class="line">    // Ahem, IE &lt; 9.</span><br><span class="line">    // IE &lt; 9 下不能用 for in 来枚举某些 key 值</span><br><span class="line">    // 传入 keys 数组为参数</span><br><span class="line">    // 因为 JavaScript 下函数参数按值传递</span><br><span class="line">    // 所以 keys 当做参数传入后会在 `collectNonEnumProps` 方法中改变值</span><br><span class="line">    if (hasEnumBug) collectNonEnumProps(obj, keys);</span><br><span class="line"></span><br><span class="line">    return keys;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Retrieve all the property names of an object.</span><br><span class="line">  // 返回一个对象的 keys 数组</span><br><span class="line">  // 不仅仅是 own enumerable properties</span><br><span class="line">  // 还包括原型链上继承的属性</span><br><span class="line">  _.allKeys = function(obj) &#123;</span><br><span class="line">    // 容错</span><br><span class="line">    // 不是对象，则返回空数组</span><br><span class="line">    if (!_.isObject(obj)) return [];</span><br><span class="line"></span><br><span class="line">    var keys = [];</span><br><span class="line">    for (var key in obj) keys.push(key);</span><br><span class="line"></span><br><span class="line">    // Ahem, IE &lt; 9.</span><br><span class="line">    // IE &lt; 9 下的 bug，同 _.keys 方法</span><br><span class="line">    if (hasEnumBug) collectNonEnumProps(obj, keys);</span><br><span class="line"></span><br><span class="line">    return keys;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Retrieve the values of an object&apos;s properties.</span><br><span class="line">  // ===== //</span><br><span class="line">  // _.values(&#123;one: 1, two: 2, three: 3&#125;);</span><br><span class="line">  // =&gt; [1, 2, 3]</span><br><span class="line">  // ===== //</span><br><span class="line">  // 将一个对象的所有 values 值放入数组中</span><br><span class="line">  // 仅限 own properties 上的 values</span><br><span class="line">  // 不包括原型链上的</span><br><span class="line">  // 并返回该数组</span><br><span class="line">  _.values = function(obj) &#123;</span><br><span class="line">    // 仅包括 own properties</span><br><span class="line">    var keys = _.keys(obj);</span><br><span class="line">    var length = keys.length;</span><br><span class="line">    var values = Array(length);</span><br><span class="line">    for (var i = 0; i &lt; length; i++) &#123;</span><br><span class="line">      values[i] = obj[keys[i]];</span><br><span class="line">    &#125;</span><br><span class="line">    return values;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Returns the results of applying the iteratee to each element of the object</span><br><span class="line">  // In contrast to _.map it returns an object</span><br><span class="line">  // 跟 _.map 方法很像</span><br><span class="line">  // 但是是专门为对象服务的 map 方法</span><br><span class="line">  // 迭代函数改变对象的 values 值</span><br><span class="line">  // 返回对象副本</span><br><span class="line">  _.mapObject = function(obj, iteratee, context) &#123;</span><br><span class="line">    // 迭代函数</span><br><span class="line">    // 对每个键值对进行迭代</span><br><span class="line">    iteratee = cb(iteratee, context);</span><br><span class="line"></span><br><span class="line">    var keys =  _.keys(obj),</span><br><span class="line">        length = keys.length,</span><br><span class="line">        results = &#123;&#125;, // 对象副本，该方法返回的对象</span><br><span class="line">        currentKey;</span><br><span class="line"></span><br><span class="line">    for (var index = 0; index &lt; length; index++) &#123;</span><br><span class="line">      currentKey = keys[index];</span><br><span class="line">      // key 值不变</span><br><span class="line">      // 对每个 value 值用迭代函数迭代</span><br><span class="line">      // 返回经过函数运算后的值</span><br><span class="line">      results[currentKey] = iteratee(obj[currentKey], currentKey, obj);</span><br><span class="line">    &#125;</span><br><span class="line">    return results;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Convert an object into a list of `[key, value]` pairs.</span><br><span class="line">  // 将一个对象转换为元素为 [key, value] 形式的数组</span><br><span class="line">  // _.pairs(&#123;one: 1, two: 2, three: 3&#125;);</span><br><span class="line">  // =&gt; [[&quot;one&quot;, 1], [&quot;two&quot;, 2], [&quot;three&quot;, 3]]</span><br><span class="line">  _.pairs = function(obj) &#123;</span><br><span class="line">    var keys = _.keys(obj);</span><br><span class="line">    var length = keys.length;</span><br><span class="line">    var pairs = Array(length);</span><br><span class="line">    for (var i = 0; i &lt; length; i++) &#123;</span><br><span class="line">      pairs[i] = [keys[i], obj[keys[i]]];</span><br><span class="line">    &#125;</span><br><span class="line">    return pairs;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Invert the keys and values of an object. The values must be serializable.</span><br><span class="line">  // 将一个对象的 key-value 键值对颠倒</span><br><span class="line">  // 即原来的 key 为 value 值，原来的 value 值为 key 值</span><br><span class="line">  // 需要注意的是，value 值不能重复（不然后面的会覆盖前面的）</span><br><span class="line">  // 且新构造的对象符合对象构造规则</span><br><span class="line">  // 并且返回新构造的对象</span><br><span class="line">  _.invert = function(obj) &#123;</span><br><span class="line">    // 返回的新的对象</span><br><span class="line">    var result = &#123;&#125;;</span><br><span class="line">    var keys = _.keys(obj);</span><br><span class="line">    for (var i = 0, length = keys.length; i &lt; length; i++) &#123;</span><br><span class="line">      result[obj[keys[i]]] = keys[i];</span><br><span class="line">    &#125;</span><br><span class="line">    return result;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Return a sorted list of the function names available on the object.</span><br><span class="line">  // Aliased as `methods`</span><br><span class="line">  // 传入一个对象</span><br><span class="line">  // 遍历该对象的键值对（包括 own properties 以及 原型链上的）</span><br><span class="line">  // 如果某个 value 的类型是方法（function），则将该 key 存入数组</span><br><span class="line">  // 将该数组排序后返回</span><br><span class="line">  _.functions = _.methods = function(obj) &#123;</span><br><span class="line">    // 返回的数组</span><br><span class="line">    var names = [];</span><br><span class="line"></span><br><span class="line">    // if IE &lt; 9</span><br><span class="line">    // 且对象重写了 `nonEnumerableProps` 数组中的某些方法</span><br><span class="line">    // 那么这些方法名是不会被返回的</span><br><span class="line">    // 可见放弃了 IE &lt; 9 可能对 `toString` 等方法的重写支持</span><br><span class="line">    for (var key in obj) &#123;</span><br><span class="line">      // 如果某个 key 对应的 value 值类型是函数</span><br><span class="line">      // 则将这个 key 值存入数组</span><br><span class="line">      if (_.isFunction(obj[key])) names.push(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 返回排序后的数组</span><br><span class="line">    return names.sort();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Extend a given object with all the properties in passed-in object(s).</span><br><span class="line">  // extend_.extend(destination, *sources)</span><br><span class="line">  // Copy all of the properties in the source objects over to the destination object</span><br><span class="line">  // and return the destination object</span><br><span class="line">  // It&apos;s in-order, so the last source will override properties of the same name in previous arguments.</span><br><span class="line">  // 将几个对象上（第二个参数开始，根据参数而定）的所有键值对添加到 destination 对象（第一个参数）上</span><br><span class="line">  // 因为 key 值可能会相同，所以后面的（键值对）可能会覆盖前面的</span><br><span class="line">  // 参数个数 &gt;= 1</span><br><span class="line">  _.extend = createAssigner(_.allKeys);</span><br><span class="line"></span><br><span class="line">  // Assigns a given object with all the own properties in the passed-in object(s)</span><br><span class="line">  // (https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object/assign)</span><br><span class="line">  // 跟 extend 方法类似，但是只把 own properties 拷贝给第一个参数对象</span><br><span class="line">  // 只继承 own properties 的键值对</span><br><span class="line">  // 参数个数 &gt;= 1</span><br><span class="line">  _.extendOwn = _.assign = createAssigner(_.keys);</span><br><span class="line"></span><br><span class="line">  // Returns the first key on an object that passes a predicate test</span><br><span class="line">  // 跟数组方法的 _.findIndex 类似</span><br><span class="line">  // 找到对象的键值对中第一个满足条件的键值对</span><br><span class="line">  // 并返回该键值对 key 值</span><br><span class="line">  _.findKey = function(obj, predicate, context) &#123;</span><br><span class="line">    predicate = cb(predicate, context);</span><br><span class="line">    var keys = _.keys(obj), key;</span><br><span class="line">    // 遍历键值对</span><br><span class="line">    for (var i = 0, length = keys.length; i &lt; length; i++) &#123;</span><br><span class="line">      key = keys[i];</span><br><span class="line">      // 符合条件，直接返回 key 值</span><br><span class="line">      if (predicate(obj[key], key, obj)) return key;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Return a copy of the object only containing the whitelisted properties.</span><br><span class="line">  // 根据一定的需求（key 值，或者通过 predicate 函数返回真假）</span><br><span class="line">  // 返回拥有一定键值对的对象副本</span><br><span class="line">  // 第二个参数可以是一个 predicate 函数</span><br><span class="line">  // 也可以是 &gt;= 0 个 key</span><br><span class="line">  // _.pick(object, *keys)</span><br><span class="line">  // Return a copy of the object</span><br><span class="line">  // filtered to only have values for the whitelisted keys (or array of valid keys)</span><br><span class="line">  // Alternatively accepts a predicate indicating which keys to pick.</span><br><span class="line">  /*</span><br><span class="line">  _.pick(&#123;name: &apos;moe&apos;, age: 50, userid: &apos;moe1&apos;&#125;, &apos;name&apos;, &apos;age&apos;);</span><br><span class="line">  =&gt; &#123;name: &apos;moe&apos;, age: 50&#125;</span><br><span class="line">  _.pick(&#123;name: &apos;moe&apos;, age: 50, userid: &apos;moe1&apos;&#125;, [&apos;name&apos;, &apos;age&apos;]);</span><br><span class="line">  =&gt; &#123;name: &apos;moe&apos;, age: 50&#125;</span><br><span class="line">  _.pick(&#123;name: &apos;moe&apos;, age: 50, userid: &apos;moe1&apos;&#125;, function(value, key, object) &#123;</span><br><span class="line">    return _.isNumber(value);</span><br><span class="line">  &#125;);</span><br><span class="line">  =&gt; &#123;age: 50&#125;</span><br><span class="line">  */</span><br><span class="line">  _.pick = function(object, oiteratee, context) &#123;</span><br><span class="line">    // result 为返回的对象副本</span><br><span class="line">    var result = &#123;&#125;, obj = object, iteratee, keys;</span><br><span class="line"></span><br><span class="line">    // 容错</span><br><span class="line">    if (obj == null) return result;</span><br><span class="line"></span><br><span class="line">    // 如果第二个参数是函数</span><br><span class="line">    if (_.isFunction(oiteratee)) &#123;</span><br><span class="line">      keys = _.allKeys(obj);</span><br><span class="line">      iteratee = optimizeCb(oiteratee, context);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      // 如果第二个参数不是函数</span><br><span class="line">      // 则后面的 keys 可能是数组</span><br><span class="line">      // 也可能是连续的几个并列的参数</span><br><span class="line">      // 用 flatten 将它们展开</span><br><span class="line">      keys = flatten(arguments, false, false, 1);</span><br><span class="line"></span><br><span class="line">      // 也转为 predicate 函数判断形式</span><br><span class="line">      // 将指定 key 转化为 predicate 函数</span><br><span class="line">      iteratee = function(value, key, obj) &#123; return key in obj; &#125;;</span><br><span class="line">      obj = Object(obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    for (var i = 0, length = keys.length; i &lt; length; i++) &#123;</span><br><span class="line">      var key = keys[i];</span><br><span class="line">      var value = obj[key];</span><br><span class="line">      // 满足条件</span><br><span class="line">      if (iteratee(value, key, obj)) result[key] = value;</span><br><span class="line">    &#125;</span><br><span class="line">    return result;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Return a copy of the object without the blacklisted properties.</span><br><span class="line">  // 跟 _.pick 方法相对</span><br><span class="line">  // 返回 _.pick 的补集</span><br><span class="line">  // 即返回没有指定 keys 值的对象副本</span><br><span class="line">  // 或者返回不能通过 predicate 函数的对象副本</span><br><span class="line">  _.omit = function(obj, iteratee, context) &#123;</span><br><span class="line">    if (_.isFunction(iteratee)) &#123;</span><br><span class="line">      // _.negate 方法对 iteratee 的结果取反</span><br><span class="line">      iteratee = _.negate(iteratee);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      var keys = _.map(flatten(arguments, false, false, 1), String);</span><br><span class="line">      iteratee = function(value, key) &#123;</span><br><span class="line">        return !_.contains(keys, key);</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    return _.pick(obj, iteratee, context);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // _.defaults(object, *defaults)</span><br><span class="line">  // Fill in a given object with default properties.</span><br><span class="line">  // Fill in undefined properties in object</span><br><span class="line">  // with the first value present in the following list of defaults objects.</span><br><span class="line">  // 和 _.extend 非常类似</span><br><span class="line">  // 区别是如果 *defaults 中出现了和 object 中一样的键</span><br><span class="line">  // 则不覆盖 object 的键值对</span><br><span class="line">  // 如果 *defaults 多个参数对象中有相同 key 的对象</span><br><span class="line">  // 则取最早出现的 value 值</span><br><span class="line">  // 参数个数 &gt;= 1</span><br><span class="line">  _.defaults = createAssigner(_.allKeys, true);</span><br><span class="line"></span><br><span class="line">  // Creates an object that inherits from the given prototype object.</span><br><span class="line">  // If additional properties are provided then they will be added to the</span><br><span class="line">  // created object.</span><br><span class="line">  // 给定 prototype</span><br><span class="line">  // 以及一些 own properties</span><br><span class="line">  // 构造一个新的对象并返回</span><br><span class="line">  _.create = function(prototype, props) &#123;</span><br><span class="line">    var result = baseCreate(prototype);</span><br><span class="line"></span><br><span class="line">    // 将 props 的键值对覆盖 result 对象</span><br><span class="line">    if (props) _.extendOwn(result, props);</span><br><span class="line">    return result;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Create a (shallow-cloned) duplicate of an object.</span><br><span class="line">  // 对象的 `浅复制` 副本</span><br><span class="line">  // 注意点：所有嵌套的对象或者数组都会跟原对象用同一个引用</span><br><span class="line">  // 所以是为浅复制，而不是深度克隆</span><br><span class="line">  _.clone = function(obj) &#123;</span><br><span class="line">    // 容错，如果不是对象或者数组类型，则可以直接返回</span><br><span class="line">    // 因为一些基础类型是直接按值传递的</span><br><span class="line">    // 思考，arguments 呢？ Nodelists 呢？ HTML Collections 呢？</span><br><span class="line">    if (!_.isObject(obj))</span><br><span class="line">      return obj;</span><br><span class="line"></span><br><span class="line">    // 如果是数组，则用 obj.slice() 返回数组副本</span><br><span class="line">    // 如果是对象，则提取所有 obj 的键值对覆盖空对象，返回</span><br><span class="line">    return _.isArray(obj) ? obj.slice() : _.extend(&#123;&#125;, obj);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Invokes interceptor with the obj, and then returns obj.</span><br><span class="line">  // The primary purpose of this method is to &quot;tap into&quot; a method chain, in</span><br><span class="line">  // order to perform operations on intermediate results within the chain.</span><br><span class="line">  // _.chain([1,2,3,200])</span><br><span class="line">  // .filter(function(num) &#123; return num % 2 == 0; &#125;)</span><br><span class="line">  // .tap(alert)</span><br><span class="line">  // .map(function(num) &#123; return num * num &#125;)</span><br><span class="line">  // .value();</span><br><span class="line">  // =&gt; // [2, 200] (alerted)</span><br><span class="line">  // =&gt; [4, 40000]</span><br><span class="line">  // 主要是用在链式调用中</span><br><span class="line">  // 对中间值立即进行处理</span><br><span class="line">  _.tap = function(obj, interceptor) &#123;</span><br><span class="line">    interceptor(obj);</span><br><span class="line">    return obj;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Returns whether an object has a given set of `key:value` pairs.</span><br><span class="line">  // attrs 参数为一个对象</span><br><span class="line">  // 判断 object 对象中是否有 attrs 中的所有 key-value 键值对</span><br><span class="line">  // 返回布尔值</span><br><span class="line">  _.isMatch = function(object, attrs) &#123;</span><br><span class="line">    // 提取 attrs 对象的所有 keys</span><br><span class="line">    var keys = _.keys(attrs), length = keys.length;</span><br><span class="line"></span><br><span class="line">    // 如果 object 为空</span><br><span class="line">    // 根据 attrs 的键值对数量返回布尔值</span><br><span class="line">    if (object == null) return !length;</span><br><span class="line"></span><br><span class="line">    // 这一步有必要？</span><br><span class="line">    var obj = Object(object);</span><br><span class="line"></span><br><span class="line">    // 遍历 attrs 对象键值对</span><br><span class="line">    for (var i = 0; i &lt; length; i++) &#123;</span><br><span class="line">      var key = keys[i];</span><br><span class="line"></span><br><span class="line">      // 如果 obj 对象没有 attrs 对象的某个 key</span><br><span class="line">      // 或者对于某个 key，它们的 value 值不同</span><br><span class="line">      // 则证明 object 并不拥有 attrs 的所有键值对</span><br><span class="line">      // 则返回 false</span><br><span class="line">      if (attrs[key] !== obj[key] || !(key in obj)) return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return true;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  // Internal recursive comparison function for `isEqual`.</span><br><span class="line">  // &quot;内部的&quot;/ &quot;递归地&quot;/ &quot;比较&quot;</span><br><span class="line">  // 该内部方法会被递归调用</span><br><span class="line">  var eq = function(a, b, aStack, bStack) &#123;</span><br><span class="line">    // Identical objects are equal. `0 === -0`, but they aren&apos;t identical.</span><br><span class="line">    // See the [Harmony `egal` proposal](http://wiki.ecmascript.org/doku.php?id=harmony:egal).</span><br><span class="line">    // a === b 时</span><br><span class="line">    // 需要注意 `0 === -0` 这个 special case</span><br><span class="line">    // 0 和 -0 被认为不相同（unequal）</span><br><span class="line">    // 至于原因可以参考上面的链接</span><br><span class="line">    if (a === b) return a !== 0 || 1 / a === 1 / b;</span><br><span class="line"></span><br><span class="line">    // A strict comparison is necessary because `null == undefined`.</span><br><span class="line">    // 如果 a 和 b 有一个为 null（或者 undefined）</span><br><span class="line">    // 判断 a === b</span><br><span class="line">    if (a == null || b == null) return a === b;</span><br><span class="line"></span><br><span class="line">    // Unwrap any wrapped objects.</span><br><span class="line">    // 如果 a 和 b 是 underscore OOP 的对象</span><br><span class="line">    // 那么比较 _wrapped 属性值（Unwrap）</span><br><span class="line">    if (a instanceof _) a = a._wrapped;</span><br><span class="line">    if (b instanceof _) b = b._wrapped;</span><br><span class="line"></span><br><span class="line">    // Compare `[[Class]]` names.</span><br><span class="line">    // 用 Object.prototype.toString.call 方法获取 a 变量类型</span><br><span class="line">    var className = toString.call(a);</span><br><span class="line"></span><br><span class="line">    // 如果 a 和 b 类型不相同，则返回 false</span><br><span class="line">    // 类型都不同了还比较个蛋！</span><br><span class="line">    if (className !== toString.call(b)) return false;</span><br><span class="line"></span><br><span class="line">    switch (className) &#123;</span><br><span class="line">      // Strings, numbers, regular expressions, dates, and booleans are compared by value.</span><br><span class="line">      // 以上五种类型的元素可以直接根据其 value 值来比较是否相等</span><br><span class="line">      case &apos;[object RegExp]&apos;:</span><br><span class="line">      // RegExps are coerced to strings for comparison (Note: &apos;&apos; + /a/i === &apos;/a/i&apos;)</span><br><span class="line">      case &apos;[object String]&apos;:</span><br><span class="line">        // Primitives and their corresponding object wrappers are equivalent; thus, `&quot;5&quot;` is</span><br><span class="line">        // equivalent to `new String(&quot;5&quot;)`.</span><br><span class="line">        // 转为 String 类型进行比较</span><br><span class="line">        return &apos;&apos; + a === &apos;&apos; + b;</span><br><span class="line"></span><br><span class="line">      // RegExp 和 String 可以看做一类</span><br><span class="line">      // 如果 obj 为 RegExp 或者 String 类型</span><br><span class="line">      // 那么 &apos;&apos; + obj 会将 obj 强制转为 String</span><br><span class="line">      // 根据 &apos;&apos; + a === &apos;&apos; + b 即可判断 a 和 b 是否相等</span><br><span class="line">      // ================</span><br><span class="line"></span><br><span class="line">      case &apos;[object Number]&apos;:</span><br><span class="line">        // `NaN`s are equivalent, but non-reflexive.</span><br><span class="line">        // Object(NaN) is equivalent to NaN</span><br><span class="line">        // 如果 +a !== +a</span><br><span class="line">        // 那么 a 就是 NaN</span><br><span class="line">        // 判断 b 是否也是 NaN 即可</span><br><span class="line">        if (+a !== +a) return +b !== +b;</span><br><span class="line"></span><br><span class="line">        // An `egal` comparison is performed for other numeric values.</span><br><span class="line">        // 排除了 NaN 干扰</span><br><span class="line">        // 还要考虑 0 的干扰</span><br><span class="line">        // 用 +a 将 Number() 形式转为基本类型</span><br><span class="line">        // 即 +Number(1) ==&gt; 1</span><br><span class="line">        // 0 需要特判</span><br><span class="line">        // 如果 a 为 0，判断 1 / +a === 1 / b</span><br><span class="line">        // 否则判断 +a === +b</span><br><span class="line">        return +a === 0 ? 1 / +a === 1 / b : +a === +b;</span><br><span class="line"></span><br><span class="line">      // 如果 a 为 Number 类型</span><br><span class="line">      // 要注意 NaN 这个 special number</span><br><span class="line">      // NaN 和 NaN 被认为 equal</span><br><span class="line">      // ================</span><br><span class="line"></span><br><span class="line">      case &apos;[object Date]&apos;:</span><br><span class="line">      case &apos;[object Boolean]&apos;:</span><br><span class="line">        // Coerce dates and booleans to numeric primitive values. Dates are compared by their</span><br><span class="line">        // millisecond representations. Note that invalid dates with millisecond representations</span><br><span class="line">        // of `NaN` are not equivalent.</span><br><span class="line">        return +a === +b;</span><br><span class="line"></span><br><span class="line">      // Date 和 Boolean 可以看做一类</span><br><span class="line">      // 如果 obj 为 Date 或者 Boolean</span><br><span class="line">      // 那么 +obj 会将 obj 转为 Number 类型</span><br><span class="line">      // 然后比较即可</span><br><span class="line">      // +new Date() 是当前时间距离 1970 年 1 月 1 日 0 点的毫秒数</span><br><span class="line">      // +true =&gt; 1</span><br><span class="line">      // +new Boolean(false) =&gt; 0</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    // 判断 a 是否是数组</span><br><span class="line">    var areArrays = className === &apos;[object Array]&apos;;</span><br><span class="line"></span><br><span class="line">    // 如果 a 不是数组类型</span><br><span class="line">    if (!areArrays) &#123;</span><br><span class="line">      // 如果 a 不是 object 或者 b 不是 object</span><br><span class="line">      // 则返回 false</span><br><span class="line">      if (typeof a != &apos;object&apos; || typeof b != &apos;object&apos;) return false;</span><br><span class="line"></span><br><span class="line">      // 通过上个步骤的 if 过滤</span><br><span class="line">      // !!保证到此的 a 和 b 均为对象!!</span><br><span class="line"></span><br><span class="line">      // Objects with different constructors are not equivalent, but `Object`s or `Array`s</span><br><span class="line">      // from different frames are.</span><br><span class="line">      // 通过构造函数来判断 a 和 b 是否相同</span><br><span class="line">      // 但是，如果 a 和 b 的构造函数不同</span><br><span class="line">      // 也并不一定 a 和 b 就是 unequal</span><br><span class="line">      // 比如 a 和 b 在不同的 iframes 中！</span><br><span class="line">      // aCtor instanceof aCtor 这步有点不大理解，啥用？</span><br><span class="line">      var aCtor = a.constructor, bCtor = b.constructor;</span><br><span class="line">      if (aCtor !== bCtor &amp;&amp; !(_.isFunction(aCtor) &amp;&amp; aCtor instanceof aCtor &amp;&amp;</span><br><span class="line">                               _.isFunction(bCtor) &amp;&amp; bCtor instanceof bCtor)</span><br><span class="line">                          &amp;&amp; (&apos;constructor&apos; in a &amp;&amp; &apos;constructor&apos; in b)) &#123;</span><br><span class="line">        return false;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Assume equality for cyclic structures. The algorithm for detecting cyclic</span><br><span class="line">    // structures is adapted from ES 5.1 section 15.12.3, abstract operation `JO`.</span><br><span class="line"></span><br><span class="line">    // Initializing stack of traversed objects.</span><br><span class="line">    // It&apos;s done here since we only need them for objects and arrays comparison.</span><br><span class="line">    // 第一次调用 eq() 函数，没有传入 aStack 和 bStack 参数</span><br><span class="line">    // 之后递归调用都会传入这两个参数</span><br><span class="line">    aStack = aStack || [];</span><br><span class="line">    bStack = bStack || [];</span><br><span class="line"></span><br><span class="line">    var length = aStack.length;</span><br><span class="line"></span><br><span class="line">    while (length--) &#123;</span><br><span class="line">      // Linear search. Performance is inversely proportional to the number of</span><br><span class="line">      // unique nested structures.</span><br><span class="line">      if (aStack[length] === a) return bStack[length] === b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Add the first object to the stack of traversed objects.</span><br><span class="line">    aStack.push(a);</span><br><span class="line">    bStack.push(b);</span><br><span class="line"></span><br><span class="line">    // Recursively compare objects and arrays.</span><br><span class="line">    // 将嵌套的对象和数组展开</span><br><span class="line">    // 如果 a 是数组</span><br><span class="line">    // 因为嵌套，所以需要展开深度比较</span><br><span class="line">    if (areArrays) &#123;</span><br><span class="line">      // Compare array lengths to determine if a deep comparison is necessary.</span><br><span class="line">      // 根据 length 判断是否应该继续递归对比</span><br><span class="line">      length = a.length;</span><br><span class="line"></span><br><span class="line">      // 如果 a 和 b length 属性大小不同</span><br><span class="line">      // 那么显然 a 和 b 不同</span><br><span class="line">      // return false 不用继续比较了</span><br><span class="line">      if (length !== b.length) return false;</span><br><span class="line"></span><br><span class="line">      // Deep compare the contents, ignoring non-numeric properties.</span><br><span class="line">      while (length--) &#123;</span><br><span class="line">        // 递归</span><br><span class="line">        if (!eq(a[length], b[length], aStack, bStack)) return false;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      // 如果 a 不是数组</span><br><span class="line">      // 进入这个判断分支</span><br><span class="line"></span><br><span class="line">      // Deep compare objects.</span><br><span class="line">      // 两个对象的深度比较</span><br><span class="line">      var keys = _.keys(a), key;</span><br><span class="line">      length = keys.length;</span><br><span class="line"></span><br><span class="line">      // Ensure that both objects contain the same number of properties before comparing deep equality.</span><br><span class="line">      // a 和 b 对象的键数量不同</span><br><span class="line">      // 那还比较毛？</span><br><span class="line">      if (_.keys(b).length !== length) return false;</span><br><span class="line"></span><br><span class="line">      while (length--) &#123;</span><br><span class="line">        // Deep compare each member</span><br><span class="line">        // 递归比较</span><br><span class="line">        key = keys[length];</span><br><span class="line">        if (!(_.has(b, key) &amp;&amp; eq(a[key], b[key], aStack, bStack))) return false;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Remove the first object from the stack of traversed objects.</span><br><span class="line">    // 与 aStack.push(a) 对应</span><br><span class="line">    // 此时 aStack 栈顶元素正是 a</span><br><span class="line">    // 而代码走到此步</span><br><span class="line">    // a 和 b isEqual 确认</span><br><span class="line">    // 所以 a，b 两个元素可以出栈</span><br><span class="line">    aStack.pop();</span><br><span class="line">    bStack.pop();</span><br><span class="line"></span><br><span class="line">    // 深度搜索递归比较完毕</span><br><span class="line">    // 放心地 return true</span><br><span class="line">    return true;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Perform a deep comparison to check if two objects are equal.</span><br><span class="line">  // 判断两个对象是否一样</span><br><span class="line">  // new Boolean(true)，true 被认为 equal</span><br><span class="line">  // [1, 2, 3], [1, 2, 3] 被认为 equal</span><br><span class="line">  // 0 和 -0 被认为 unequal</span><br><span class="line">  // NaN 和 NaN 被认为 equal</span><br><span class="line">  _.isEqual = function(a, b) &#123;</span><br><span class="line">    return eq(a, b);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Is a given array, string, or object empty?</span><br><span class="line">  // An &quot;empty&quot; object has no enumerable own-properties.</span><br><span class="line">  // 是否是 &#123;&#125;、[] 或者 &quot;&quot; 或者 null、undefined</span><br><span class="line">  _.isEmpty = function(obj) &#123;</span><br><span class="line">    if (obj == null) return true;</span><br><span class="line"></span><br><span class="line">    // 如果是数组、类数组、或者字符串</span><br><span class="line">    // 根据 length 属性判断是否为空</span><br><span class="line">    // 后面的条件是为了过滤 isArrayLike 对于 &#123;length: 10&#125; 这样对象的判断 bug？</span><br><span class="line">    if (isArrayLike(obj) &amp;&amp; (_.isArray(obj) || _.isString(obj) || _.isArguments(obj))) return obj.length === 0;</span><br><span class="line"></span><br><span class="line">    // 如果是对象</span><br><span class="line">    // 根据 keys 数量判断是否为 Empty</span><br><span class="line">    return _.keys(obj).length === 0;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  // Is a given value a DOM element?</span><br><span class="line">  // 判断是否为 DOM 元素</span><br><span class="line">  _.isElement = function(obj) &#123;</span><br><span class="line">    // 确保 obj 不是 null, undefined 等假值</span><br><span class="line">    // 并且 obj.nodeType === 1</span><br><span class="line">    return !!(obj &amp;&amp; obj.nodeType === 1);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Is a given value an array?</span><br><span class="line">  // Delegates to ECMA5&apos;s native Array.isArray</span><br><span class="line">  // 判断是否为数组</span><br><span class="line">  _.isArray = nativeIsArray || function(obj) &#123;</span><br><span class="line">    return toString.call(obj) === &apos;[object Array]&apos;;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Is a given variable an object?</span><br><span class="line">  // 判断是否为对象</span><br><span class="line">  // 这里的对象包括 function 和 object</span><br><span class="line">  _.isObject = function(obj) &#123;</span><br><span class="line">    var type = typeof obj;</span><br><span class="line">    return type === &apos;function&apos; || type === &apos;object&apos; &amp;&amp; !!obj;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Add some isType methods: isArguments, isFunction, isString, isNumber, isDate, isRegExp, isError.</span><br><span class="line">  // 其他类型判断</span><br><span class="line">  _.each([&apos;Arguments&apos;, &apos;Function&apos;, &apos;String&apos;, &apos;Number&apos;, &apos;Date&apos;, &apos;RegExp&apos;, &apos;Error&apos;], function(name) &#123;</span><br><span class="line">    _[&apos;is&apos; + name] = function(obj) &#123;</span><br><span class="line">      return toString.call(obj) === &apos;[object &apos; + name + &apos;]&apos;;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  // Define a fallback version of the method in browsers (ahem, IE &lt; 9), where</span><br><span class="line">  // there isn&apos;t any inspectable &quot;Arguments&quot; type.</span><br><span class="line">  // _.isArguments 方法在 IE &lt; 9 下的兼容</span><br><span class="line">  // IE &lt; 9 下对 arguments 调用 Object.prototype.toString.call 方法</span><br><span class="line">  // 结果是 =&gt; [object Object]</span><br><span class="line">  // 而并非我们期望的 [object Arguments]。</span><br><span class="line">  // so 用是否含有 callee 属性来做兼容</span><br><span class="line">  if (!_.isArguments(arguments)) &#123;</span><br><span class="line">    _.isArguments = function(obj) &#123;</span><br><span class="line">      return _.has(obj, &apos;callee&apos;);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // Optimize `isFunction` if appropriate. Work around some typeof bugs in old v8,</span><br><span class="line">  // IE 11 (#1621), and in Safari 8 (#1929).</span><br><span class="line">  // _.isFunction 在 old v8, IE 11 和 Safari 8 下的兼容</span><br><span class="line">  // 觉得这里有点问题</span><br><span class="line">  // 我用的 chrome 49 (显然不是 old v8)</span><br><span class="line">  // 却也进入了这个 if 判断内部</span><br><span class="line">  if (typeof /./ != &apos;function&apos; &amp;&amp; typeof Int8Array != &apos;object&apos;) &#123;</span><br><span class="line">    _.isFunction = function(obj) &#123;</span><br><span class="line">      return typeof obj == &apos;function&apos; || false;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // Is a given object a finite number?</span><br><span class="line">  // 判断是否是有限的数字</span><br><span class="line">  _.isFinite = function(obj) &#123;</span><br><span class="line">    return isFinite(obj) &amp;&amp; !isNaN(parseFloat(obj));</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Is the given value `NaN`? (NaN is the only number which does not equal itself).</span><br><span class="line">  // 判断是否是 NaN</span><br><span class="line">  // NaN 是唯一的一个 `自己不等于自己` 的 number 类型</span><br><span class="line">  // 这样写有 BUG</span><br><span class="line">  // _.isNaN(new Number(0)) =&gt; true</span><br><span class="line">  // 详见 https://github.com/hanzichi/underscore-analysis/issues/13</span><br><span class="line">  // 最新版本（edge 版）已经修复该 BUG</span><br><span class="line">  _.isNaN = function(obj) &#123;</span><br><span class="line">    return _.isNumber(obj) &amp;&amp; obj !== +obj;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Is a given value a boolean?</span><br><span class="line">  // 判断是否是布尔值</span><br><span class="line">  // 基础类型（true、 false）</span><br><span class="line">  // 以及 new Boolean() 两个方向判断</span><br><span class="line">  // 有点多余了吧？</span><br><span class="line">  // 个人觉得直接用 toString.call(obj) 来判断就可以了</span><br><span class="line">  _.isBoolean = function(obj) &#123;</span><br><span class="line">    return obj === true || obj === false || toString.call(obj) === &apos;[object Boolean]&apos;;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Is a given value equal to null?</span><br><span class="line">  // 判断是否是 null</span><br><span class="line">  _.isNull = function(obj) &#123;</span><br><span class="line">    return obj === null;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Is a given variable undefined?</span><br><span class="line">  // 判断是否是 undefined</span><br><span class="line">  // undefined 能被改写 （IE &lt; 9）</span><br><span class="line">  // undefined 只是全局对象的一个属性</span><br><span class="line">  // 在局部环境能被重新定义</span><br><span class="line">  // 但是「void 0」始终是 undefined</span><br><span class="line">  _.isUndefined = function(obj) &#123;</span><br><span class="line">    return obj === void 0;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Shortcut function for checking if an object has a given property directly</span><br><span class="line">  // on itself (in other words, not on a prototype).</span><br><span class="line">  // 判断对象中是否有指定 key</span><br><span class="line">  // own properties, not on a prototype</span><br><span class="line">  _.has = function(obj, key) &#123;</span><br><span class="line">    // obj 不能为 null 或者 undefined</span><br><span class="line">    return obj != null &amp;&amp; hasOwnProperty.call(obj, key);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  // Utility Functions</span><br><span class="line">  // 工具类方法</span><br><span class="line">  // 共 14 个扩展方法</span><br><span class="line">  // -----------------</span><br><span class="line"></span><br><span class="line">  // Run Underscore.js in *noConflict* mode, returning the `_` variable to its</span><br><span class="line">  // previous owner. Returns a reference to the Underscore object.</span><br><span class="line">  // 如果全局环境中已经使用了 `_` 变量</span><br><span class="line">  // 可以用该方法返回其他变量</span><br><span class="line">  // 继续使用 underscore 中的方法</span><br><span class="line">  // var underscore = _.noConflict();</span><br><span class="line">  // underscore.each(..);</span><br><span class="line">  _.noConflict = function() &#123;</span><br><span class="line">    root._ = previousUnderscore;</span><br><span class="line">    return this;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Keep the identity function around for default iteratees.</span><br><span class="line">  // 返回传入的参数，看起来好像没什么卵用</span><br><span class="line">  // 其实 _.identity 在 undescore 内大量作为迭代函数出现</span><br><span class="line">  // 能简化很多迭代函数的书写</span><br><span class="line">  _.identity = function(value) &#123;</span><br><span class="line">    return value;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Predicate-generating functions. Often useful outside of Underscore.</span><br><span class="line">  _.constant = function(value) &#123;</span><br><span class="line">    return function() &#123;</span><br><span class="line">      return value;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  _.noop = function()&#123;&#125;;</span><br><span class="line"></span><br><span class="line">  // 传送门</span><br><span class="line">  /*</span><br><span class="line">  var property = function(key) &#123;</span><br><span class="line">    return function(obj) &#123;</span><br><span class="line">      return obj == null ? void 0 : obj[key];</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">  */</span><br><span class="line">  _.property = property;</span><br><span class="line"></span><br><span class="line">  // Generates a function for a given object that returns a given property.</span><br><span class="line">  _.propertyOf = function(obj) &#123;</span><br><span class="line">    return obj == null ? function()&#123;&#125; : function(key) &#123;</span><br><span class="line">      return obj[key];</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Returns a predicate for checking whether an object has a given set of</span><br><span class="line">  // `key:value` pairs.</span><br><span class="line">  // 判断一个给定的对象是否有某些键值对</span><br><span class="line">  _.matcher = _.matches = function(attrs) &#123;</span><br><span class="line">    attrs = _.extendOwn(&#123;&#125;, attrs);</span><br><span class="line">    return function(obj) &#123;</span><br><span class="line">      return _.isMatch(obj, attrs);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Run a function **n** times.</span><br><span class="line">  // 执行某函数 n 次</span><br><span class="line">  _.times = function(n, iteratee, context) &#123;</span><br><span class="line">    var accum = Array(Math.max(0, n));</span><br><span class="line">    iteratee = optimizeCb(iteratee, context, 1);</span><br><span class="line">    for (var i = 0; i &lt; n; i++)</span><br><span class="line">      accum[i] = iteratee(i);</span><br><span class="line">    return accum;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Return a random integer between min and max (inclusive).</span><br><span class="line">  // 返回一个 [min, max] 范围内的任意整数</span><br><span class="line">  _.random = function(min, max) &#123;</span><br><span class="line">    if (max == null) &#123;</span><br><span class="line">      max = min;</span><br><span class="line">      min = 0;</span><br><span class="line">    &#125;</span><br><span class="line">    return min + Math.floor(Math.random() * (max - min + 1));</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // A (possibly faster) way to get the current timestamp as an integer.</span><br><span class="line">  // 返回当前时间的 &quot;时间戳&quot;（单位 ms）</span><br><span class="line">  // 其实并不是时间戳，时间戳还要除以 1000（单位 s）</span><br><span class="line">  // +new Date 类似</span><br><span class="line">  _.now = Date.now || function() &#123;</span><br><span class="line">    return new Date().getTime();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // List of HTML entities for escaping.</span><br><span class="line">  // HTML 实体编码</span><br><span class="line">  // escapeMap 用于编码</span><br><span class="line">  // see @http://www.cnblogs.com/zichi/p/5135636.html</span><br><span class="line">  // in PHP, htmlspecialchars — Convert special characters to HTML entities</span><br><span class="line">  // see @http://php.net/manual/zh/function.htmlspecialchars.php</span><br><span class="line">  // 能将 &amp; &quot; &apos; &lt; &gt; 转为实体编码（下面的前 5 种）</span><br><span class="line">  var escapeMap = &#123;</span><br><span class="line">    &apos;&amp;&apos;: &apos;&amp;amp;&apos;,</span><br><span class="line">    &apos;&lt;&apos;: &apos;&amp;lt;&apos;,</span><br><span class="line">    &apos;&gt;&apos;: &apos;&amp;gt;&apos;,</span><br><span class="line">    &apos;&quot;&apos;: &apos;&amp;quot;&apos;,</span><br><span class="line">    // 以上四个为最常用的字符实体</span><br><span class="line">    // 也是仅有的可以在所有环境下使用的实体字符（其他应该用「实体数字」，如下）</span><br><span class="line">    // 浏览器也许并不支持所有实体名称（对实体数字的支持却很好）</span><br><span class="line">    &quot;&apos;&quot;: &apos;&amp;#x27;&apos;,</span><br><span class="line">    &apos;`&apos;: &apos;&amp;#x60;&apos;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // _.invert 方法将一个对象的键值对对调</span><br><span class="line">  // unescapeMap 用于解码</span><br><span class="line">  var unescapeMap = _.invert(escapeMap);</span><br><span class="line"></span><br><span class="line">  // Functions for escaping and unescaping strings to/from HTML interpolation.</span><br><span class="line">  var createEscaper = function(map) &#123;</span><br><span class="line">    var escaper = function(match) &#123;</span><br><span class="line">      return map[match];</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    // Regexes for identifying a key that needs to be escaped</span><br><span class="line">    // 正则替换</span><br><span class="line">    // 注意下 ?:</span><br><span class="line">    var source = &apos;(?:&apos; + _.keys(map).join(&apos;|&apos;) + &apos;)&apos;;</span><br><span class="line"></span><br><span class="line">    // 正则 pattern</span><br><span class="line">    var testRegexp = RegExp(source);</span><br><span class="line"></span><br><span class="line">    // 全局替换</span><br><span class="line">    var replaceRegexp = RegExp(source, &apos;g&apos;);</span><br><span class="line">    return function(string) &#123;</span><br><span class="line">      string = string == null ? &apos;&apos; : &apos;&apos; + string;</span><br><span class="line">      return testRegexp.test(string) ? string.replace(replaceRegexp, escaper) : string;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Escapes a string for insertion into HTML, replacing &amp;, &lt;, &gt;, &quot;, `, and &apos; characters.</span><br><span class="line">  // 编码，防止被 XSS 攻击等一些安全隐患</span><br><span class="line">  _.escape = createEscaper(escapeMap);</span><br><span class="line"></span><br><span class="line">  // The opposite of escape</span><br><span class="line">  // replaces &amp;amp;, &amp;lt;, &amp;gt;, &amp;quot;, &amp;#96; and &amp;#x27; with their unescaped counterparts</span><br><span class="line">  // 解码</span><br><span class="line">  _.unescape = createEscaper(unescapeMap);</span><br><span class="line"></span><br><span class="line">  // If the value of the named `property` is a function then invoke it with the</span><br><span class="line">  // `object` as context; otherwise, return it.</span><br><span class="line">  _.result = function(object, property, fallback) &#123;</span><br><span class="line">    var value = object == null ? void 0 : object[property];</span><br><span class="line">    if (value === void 0) &#123;</span><br><span class="line">      value = fallback;</span><br><span class="line">    &#125;</span><br><span class="line">    return _.isFunction(value) ? value.call(object) : value;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Generate a unique integer id (unique within the entire client session).</span><br><span class="line">  // Useful for temporary DOM ids.</span><br><span class="line">  // 生成客户端临时的 DOM ids</span><br><span class="line">  var idCounter = 0;</span><br><span class="line">  _.uniqueId = function(prefix) &#123;</span><br><span class="line">    var id = ++idCounter + &apos;&apos;;</span><br><span class="line">    return prefix ? prefix + id : id;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // By default, Underscore uses ERB-style template delimiters, change the</span><br><span class="line">  // following template settings to use alternative delimiters.</span><br><span class="line">  // ERB =&gt; Embedded Ruby</span><br><span class="line">  // Underscore 默认采用 ERB-style 风格模板，也可以根据自己习惯自定义模板</span><br><span class="line">  // 1. &lt;%  %&gt; - to execute some code</span><br><span class="line">  // 2. &lt;%= %&gt; - to print some value in template</span><br><span class="line">  // 3. &lt;%- %&gt; - to print some values HTML escaped</span><br><span class="line">  _.templateSettings = &#123;</span><br><span class="line">    // 三种渲染模板</span><br><span class="line">    evaluate    : /&lt;%([\s\S]+?)%&gt;/g,</span><br><span class="line">    interpolate : /&lt;%=([\s\S]+?)%&gt;/g,</span><br><span class="line">    escape      : /&lt;%-([\s\S]+?)%&gt;/g</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // When customizing `templateSettings`, if you don&apos;t want to define an</span><br><span class="line">  // interpolation, evaluation or escaping regex, we need one that is</span><br><span class="line">  // guaranteed not to match.</span><br><span class="line">  var noMatch = /(.)^/;</span><br><span class="line"></span><br><span class="line">  // Certain characters need to be escaped so that they can be put into a</span><br><span class="line">  // string literal.</span><br><span class="line">  var escapes = &#123;</span><br><span class="line">    &quot;&apos;&quot;:      &quot;&apos;&quot;,</span><br><span class="line">    &apos;\\&apos;:     &apos;\\&apos;,</span><br><span class="line">    &apos;\r&apos;:     &apos;r&apos;,  // 回车符</span><br><span class="line">    &apos;\n&apos;:     &apos;n&apos;,  // 换行符</span><br><span class="line">    // http://stackoverflow.com/questions/16686687/json-stringify-and-u2028-u2029-check</span><br><span class="line">    &apos;\u2028&apos;: &apos;u2028&apos;, // Line separator</span><br><span class="line">    &apos;\u2029&apos;: &apos;u2029&apos;  // Paragraph separator</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // RegExp pattern</span><br><span class="line">  var escaper = /\\|&apos;|\r|\n|\u2028|\u2029/g;</span><br><span class="line"></span><br><span class="line">  var escapeChar = function(match) &#123;</span><br><span class="line">    /**</span><br><span class="line">      &apos;      =&gt; \\&apos;</span><br><span class="line">      \\     =&gt; \\\\</span><br><span class="line">      \r     =&gt; \\r</span><br><span class="line">      \n     =&gt; \\n</span><br><span class="line">      \u2028 =&gt; \\u2028</span><br><span class="line">      \u2029 =&gt; \\u2029</span><br><span class="line">    **/</span><br><span class="line">    return &apos;\\&apos; + escapes[match];</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // 将 JavaScript 模板编译为可以用于页面呈现的函数</span><br><span class="line">  // JavaScript micro-templating, similar to John Resig&apos;s implementation.</span><br><span class="line">  // Underscore templating handles arbitrary delimiters, preserves whitespace,</span><br><span class="line">  // and correctly escapes quotes within interpolated code.</span><br><span class="line">  // NB: `oldSettings` only exists for backwards compatibility.</span><br><span class="line">  // oldSettings 参数为了兼容 underscore 旧版本</span><br><span class="line">  // setting 参数可以用来自定义字符串模板（但是 key 要和 _.templateSettings 中的相同，才能 overridden）</span><br><span class="line">  // 1. &lt;%  %&gt; - to execute some code</span><br><span class="line">  // 2. &lt;%= %&gt; - to print some value in template</span><br><span class="line">  // 3. &lt;%- %&gt; - to print some values HTML escaped</span><br><span class="line">  // Compiles JavaScript templates into functions</span><br><span class="line">  // _.template(templateString, [settings])</span><br><span class="line">  _.template = function(text, settings, oldSettings) &#123;</span><br><span class="line">    // 兼容旧版本</span><br><span class="line">    if (!settings &amp;&amp; oldSettings)</span><br><span class="line">      settings = oldSettings;</span><br><span class="line"></span><br><span class="line">    // 相同的 key，优先选择 settings 对象中的</span><br><span class="line">    // 其次选择 _.templateSettings 对象中的</span><br><span class="line">    // 生成最终用来做模板渲染的字符串</span><br><span class="line">    // 自定义模板优先于默认模板 _.templateSettings</span><br><span class="line">    // 如果定义了相同的 key，则前者会覆盖后者</span><br><span class="line">    settings = _.defaults(&#123;&#125;, settings, _.templateSettings);</span><br><span class="line"></span><br><span class="line">    // Combine delimiters into one regular expression via alternation.</span><br><span class="line">    // 正则表达式 pattern，用于正则匹配 text 字符串中的模板字符串</span><br><span class="line">    // /&lt;%-([\s\S]+?)%&gt;|&lt;%=([\s\S]+?)%&gt;|&lt;%([\s\S]+?)%&gt;|$/g</span><br><span class="line">    // 注意最后还有个 |$</span><br><span class="line">    var matcher = RegExp([</span><br><span class="line">      // 注意下 pattern 的 source 属性</span><br><span class="line">      (settings.escape || noMatch).source,</span><br><span class="line">      (settings.interpolate || noMatch).source,</span><br><span class="line">      (settings.evaluate || noMatch).source</span><br><span class="line">    ].join(&apos;|&apos;) + &apos;|$&apos;, &apos;g&apos;);</span><br><span class="line"></span><br><span class="line">    // Compile the template source, escaping string literals appropriately.</span><br><span class="line">    // 编译模板字符串，将原始的模板字符串替换成函数字符串</span><br><span class="line">    // 用拼接成的函数字符串生成函数（new Function(...)）</span><br><span class="line">    var index = 0;</span><br><span class="line"></span><br><span class="line">    // source 变量拼接的字符串用来生成函数</span><br><span class="line">    // 用于当做 new Function 生成函数时的函数字符串变量</span><br><span class="line">    // 记录编译成的函数字符串，可通过 _.template(tpl).source 获取（_.template(tpl) 返回方法）</span><br><span class="line">    var source = &quot;__p+=&apos;&quot;;</span><br><span class="line"></span><br><span class="line">    // replace 函数不需要为返回值赋值，主要是为了在函数内对 source 变量赋值</span><br><span class="line">    // 将 text 变量中的模板提取出来</span><br><span class="line">    // match 为匹配的整个串</span><br><span class="line">    // escape/interpolate/evaluate 为匹配的子表达式（如果没有匹配成功则为 undefined）</span><br><span class="line">    // offset 为字符匹配（match）的起始位置（偏移量）</span><br><span class="line">    text.replace(matcher, function(match, escape, interpolate, evaluate, offset) &#123;</span><br><span class="line">      // \n =&gt; \\n</span><br><span class="line">      source += text.slice(index, offset).replace(escaper, escapeChar);</span><br><span class="line"></span><br><span class="line">      // 改变 index 值，为了下次的 slice</span><br><span class="line">      index = offset + match.length;</span><br><span class="line"></span><br><span class="line">      if (escape) &#123;</span><br><span class="line">        // 需要对变量进行编码（=&gt; HTML 实体编码）</span><br><span class="line">        // 避免 XSS 攻击</span><br><span class="line">        source += &quot;&apos;+\n((__t=(&quot; + escape + &quot;))==null?&apos;&apos;:_.escape(__t))+\n&apos;&quot;;</span><br><span class="line">      &#125; else if (interpolate) &#123;</span><br><span class="line">        // 单纯的插入变量</span><br><span class="line">        source += &quot;&apos;+\n((__t=(&quot; + interpolate + &quot;))==null?&apos;&apos;:__t)+\n&apos;&quot;;</span><br><span class="line">      &#125; else if (evaluate) &#123;</span><br><span class="line">        // 可以直接执行的 JavaScript 语句</span><br><span class="line">        // 注意 &quot;__p+=&quot;，__p 为渲染返回的字符串</span><br><span class="line">        source += &quot;&apos;;\n&quot; + evaluate + &quot;\n__p+=&apos;&quot;;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      // Adobe VMs need the match returned to produce the correct offset.</span><br><span class="line">      // return 的作用是？</span><br><span class="line">      // 将匹配到的内容原样返回（Adobe VMs 需要返回 match 来使得 offset 值正常）</span><br><span class="line">      return match;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    source += &quot;&apos;;\n&quot;;</span><br><span class="line"></span><br><span class="line">    // By default, `template` places the values from your data in the local scope via the `with` statement.</span><br><span class="line">    // However, you can specify a single variable name with the variable setting.</span><br><span class="line">    // This can significantly improve the speed at which a template is able to render.</span><br><span class="line">    // If a variable is not specified, place data values in local scope.</span><br><span class="line">    // 指定 scope</span><br><span class="line">    // 如果设置了 settings.variable，能显著提升模板的渲染速度</span><br><span class="line">    // 否则，默认用 with 语句指定作用域</span><br><span class="line">    if (!settings.variable)</span><br><span class="line">      source = &apos;with(obj||&#123;&#125;)&#123;\n&apos; + source + &apos;&#125;\n&apos;;</span><br><span class="line"></span><br><span class="line">    // 增加 print 功能</span><br><span class="line">    // __p 为返回的字符串</span><br><span class="line">    source = &quot;var __t,__p=&apos;&apos;,__j=Array.prototype.join,&quot; +</span><br><span class="line">      &quot;print=function()&#123;__p+=__j.call(arguments,&apos;&apos;);&#125;;\n&quot; +</span><br><span class="line">      source + &apos;return __p;\n&apos;;</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">      // render 方法，前两个参数为 render 方法的参数</span><br><span class="line">      // obj 为传入的 JSON 对象，传入 _ 参数使得函数内部能用 Underscore 的函数</span><br><span class="line">      var render = new Function(settings.variable || &apos;obj&apos;, &apos;_&apos;, source);</span><br><span class="line">    &#125; catch (e) &#123;</span><br><span class="line">      // 抛出错误</span><br><span class="line">      e.source = source;</span><br><span class="line">      throw e;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 返回的函数</span><br><span class="line">    // data 一般是 JSON 数据，用来渲染模板</span><br><span class="line">    var template = function(data) &#123;</span><br><span class="line">      // render 为模板渲染函数</span><br><span class="line">      // 传入参数 _ ，使得模板里 &lt;%  %&gt; 里的代码能用 underscore 的方法</span><br><span class="line">      //（&lt;%  %&gt; - to execute some code）</span><br><span class="line">      return render.call(this, data, _);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    // Provide the compiled source as a convenience for precompilation.</span><br><span class="line">    // template.source for debug?</span><br><span class="line">    // obj 与 with(obj||&#123;&#125;) 中的 obj 对应</span><br><span class="line">    var argument = settings.variable || &apos;obj&apos;;</span><br><span class="line"></span><br><span class="line">    // 可通过 _.template(tpl).source 获取</span><br><span class="line">    // 可以用来预编译，在服务端预编译好，直接在客户端生成代码，客户端直接调用方法</span><br><span class="line">    // 这样如果出错就能打印出错行</span><br><span class="line">    // Precompiling your templates can be a big help when debugging errors you can&apos;t reproduce.</span><br><span class="line">    // This is because precompiled templates can provide line numbers and a stack trace,</span><br><span class="line">    // something that is not possible when compiling templates on the client.</span><br><span class="line">    // The source property is available on the compiled template function for easy precompilation.</span><br><span class="line">    // see @http://stackoverflow.com/questions/18755292/underscore-js-precompiled-templates-using</span><br><span class="line">    // see @http://stackoverflow.com/questions/13536262/what-is-javascript-template-precompiling</span><br><span class="line">    // see @http://stackoverflow.com/questions/40126223/can-anyone-explain-underscores-precompilation-in-template</span><br><span class="line">    // JST is a server-side thing, not client-side.</span><br><span class="line">    // This mean that you compile Unserscore template on server side by some server-side script and save the result in a file.</span><br><span class="line">    // Then use this file as compiled Unserscore template.</span><br><span class="line">    template.source = &apos;function(&apos; + argument + &apos;)&#123;\n&apos; + source + &apos;&#125;&apos;;</span><br><span class="line"></span><br><span class="line">    return template;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Add a &quot;chain&quot; function. Start chaining a wrapped Underscore object.</span><br><span class="line">  // 使支持链式调用</span><br><span class="line">  /**</span><br><span class="line">  // 非 OOP 调用 chain</span><br><span class="line">  _.chain([1, 2, 3])</span><br><span class="line">    .map(function(a) &#123; return a * 2; &#125;)</span><br><span class="line">    .reverse().value(); // [6, 4, 2]</span><br><span class="line">  // OOP 调用 chain</span><br><span class="line">  _([1, 2, 3])</span><br><span class="line">    .chain()</span><br><span class="line">    .map(function(a)&#123; return a * 2; &#125;)</span><br><span class="line">    .first()</span><br><span class="line">    .value(); // 2</span><br><span class="line">  **/</span><br><span class="line">  _.chain = function(obj) &#123;</span><br><span class="line">    // 无论是否 OOP 调用，都会转为 OOP 形式</span><br><span class="line">    // 并且给新的构造对象添加了一个 _chain 属性</span><br><span class="line">    var instance = _(obj);</span><br><span class="line"></span><br><span class="line">    // 标记是否使用链式操作</span><br><span class="line">    instance._chain = true;</span><br><span class="line"></span><br><span class="line">    // 返回 OOP 对象</span><br><span class="line">    // 可以看到该 instance 对象除了多了个 _chain 属性</span><br><span class="line">    // 其他的和直接 _(obj) 的结果一样</span><br><span class="line">    return instance;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // OOP</span><br><span class="line">  // ---------------</span><br><span class="line">  // If Underscore is called as a function, it returns a wrapped object that</span><br><span class="line">  // can be used OO-style. This wrapper holds altered versions of all the</span><br><span class="line">  // underscore functions. Wrapped objects may be chained.</span><br><span class="line"></span><br><span class="line">  // OOP</span><br><span class="line">  // 如果 `_` 被当做方法（构造函数）调用, 则返回一个被包装过的对象</span><br><span class="line">  // 该对象能使用 underscore 的所有方法</span><br><span class="line">  // 并且支持链式调用</span><br><span class="line"></span><br><span class="line">  // Helper function to continue chaining intermediate results.</span><br><span class="line">  // 一个帮助方法（Helper function）</span><br><span class="line">  var result = function(instance, obj) &#123;</span><br><span class="line">    // 如果需要链式操作，则对 obj 运行 _.chain 方法，使得可以继续后续的链式操作</span><br><span class="line">    // 如果不需要，直接返回 obj</span><br><span class="line">    return instance._chain ? _(obj).chain() : obj;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Add your own custom functions to the Underscore object.</span><br><span class="line">  // 可向 underscore 函数库扩展自己的方法</span><br><span class="line">  // obj 参数必须是一个对象（JavaScript 中一切皆对象）</span><br><span class="line">  // 且自己的方法定义在 obj 的属性上</span><br><span class="line">  // 如 obj.myFunc = function() &#123;...&#125;</span><br><span class="line">  // 形如 &#123;myFunc: function()&#123;&#125;&#125;</span><br><span class="line">  // 之后便可使用如下: _.myFunc(..) 或者 OOP _(..).myFunc(..)</span><br><span class="line">  _.mixin = function(obj) &#123;</span><br><span class="line">    // 遍历 obj 的 key，将方法挂载到 Underscore 上</span><br><span class="line">    // 其实是将方法浅拷贝到 _.prototype 上</span><br><span class="line">    _.each(_.functions(obj), function(name) &#123;</span><br><span class="line">      // 直接把方法挂载到 _[name] 上</span><br><span class="line">      // 调用类似 _.myFunc([1, 2, 3], ..)</span><br><span class="line">      var func = _[name] = obj[name];</span><br><span class="line"></span><br><span class="line">      // 浅拷贝</span><br><span class="line">      // 将 name 方法挂载到 _ 对象的原型链上，使之能 OOP 调用</span><br><span class="line">      _.prototype[name] = function() &#123;</span><br><span class="line">        // 第一个参数</span><br><span class="line">        var args = [this._wrapped];</span><br><span class="line"></span><br><span class="line">        // arguments 为 name 方法需要的其他参数</span><br><span class="line">        push.apply(args, arguments);</span><br><span class="line">        // 执行 func 方法</span><br><span class="line">        // 支持链式操作</span><br><span class="line">        return result(this, func.apply(_, args));</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Add all of the Underscore functions to the wrapper object.</span><br><span class="line">  // 将前面定义的 underscore 方法添加给包装过的对象</span><br><span class="line">  // 即添加到 _.prototype 中</span><br><span class="line">  // 使 underscore 支持面向对象形式的调用</span><br><span class="line">  _.mixin(_);</span><br><span class="line"></span><br><span class="line">  // Add all mutator Array functions to the wrapper.</span><br><span class="line">  // 将 Array 原型链上有的方法都添加到 underscore 中</span><br><span class="line">  _.each([&apos;pop&apos;, &apos;push&apos;, &apos;reverse&apos;, &apos;shift&apos;, &apos;sort&apos;, &apos;splice&apos;, &apos;unshift&apos;], function(name) &#123;</span><br><span class="line">    var method = ArrayProto[name];</span><br><span class="line">    _.prototype[name] = function() &#123;</span><br><span class="line">      var obj = this._wrapped;</span><br><span class="line">      method.apply(obj, arguments);</span><br><span class="line"></span><br><span class="line">      if ((name === &apos;shift&apos; || name === &apos;splice&apos;) &amp;&amp; obj.length === 0)</span><br><span class="line">        delete obj[0];</span><br><span class="line"></span><br><span class="line">      // 支持链式操作</span><br><span class="line">      return result(this, obj);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  // Add all accessor Array functions to the wrapper.</span><br><span class="line">  // 添加 concat、join、slice 等数组原生方法给 Underscore</span><br><span class="line">  _.each([&apos;concat&apos;, &apos;join&apos;, &apos;slice&apos;], function(name) &#123;</span><br><span class="line">    var method = ArrayProto[name];</span><br><span class="line">    _.prototype[name] = function() &#123;</span><br><span class="line">      return result(this, method.apply(this._wrapped, arguments));</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  // Extracts the result from a wrapped and chained object.</span><br><span class="line">  // 一个包装过(OOP)并且链式调用的对象</span><br><span class="line">  // 用 value 方法获取结果</span><br><span class="line">  // _(obj).value === obj?</span><br><span class="line">  _.prototype.value = function() &#123;</span><br><span class="line">    return this._wrapped;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // Provide unwrapping proxy for some methods used in engine operations</span><br><span class="line">  // such as arithmetic and JSON stringification.</span><br><span class="line">  _.prototype.valueOf = _.prototype.toJSON = _.prototype.value;</span><br><span class="line"></span><br><span class="line">  _.prototype.toString = function() &#123;</span><br><span class="line">    return &apos;&apos; + this._wrapped;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // AMD registration happens at the end for compatibility with AMD loaders</span><br><span class="line">  // that may not enforce next-turn semantics on modules. Even though general</span><br><span class="line">  // practice for AMD registration is to be anonymous, underscore registers</span><br><span class="line">  // as a named module because, like jQuery, it is a base library that is</span><br><span class="line">  // popular enough to be bundled in a third party lib, but not be part of</span><br><span class="line">  // an AMD load request. Those cases could generate an error when an</span><br><span class="line">  // anonymous define() is called outside of a loader request.</span><br><span class="line">  // 兼容 AMD 规范</span><br><span class="line">  if (typeof define === &apos;function&apos; &amp;&amp; define.amd) &#123;</span><br><span class="line">    define(&apos;underscore&apos;, [], function() &#123;</span><br><span class="line">      return _;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;.call(this));</span><br></pre></td></tr></table></figure>

      
    </div>
      <div id="remark"></div>
    <div class="article-info article-info-index">
      
      <a href="/2018/11/20/underscorejs/" class="archive-article-date">
  	<time datetime="2018-11-20T04:58:18.000Z" itemprop="datePublished"><i class="icon-clock"></i>2018-11-20</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/underscore/">underscore</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/underscore源码/">underscore源码</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/源码/">源码</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/个人博客/">个人博客</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-designPatternsOCP" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/29/designPatternsOCP/">前端设计模式之开闭原则(OCP)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h6 id="译注：本文作者愤怒的韭菜"><a href="#译注：本文作者愤怒的韭菜" class="headerlink" title="译注：本文作者愤怒的韭菜"></a>译注：本文作者<a href="https://blog.csdn.net/zhengzhb/article/details/7296944" target="_blank" rel="noopener">愤怒的韭菜</a></h6><p>&emsp;&emsp;<abbr style="font-weight:bold;">定义:</abbr><br>&emsp;&emsp;一个软件实体如类、模块和函数应该对扩展开放，对修改关闭。</p>
<p>&emsp;&emsp;<abbr style="font-weight:bold;">问题由来:</abbr><br>&emsp;&emsp;在软件的生命周期内，因为变化、升级和维护等原因需要对软件原有代码进行修改时，可能会给旧代码中引入错误，也可能会使我们不得不对整个功能进行重构，并且需要原有代码经过重新测试。</p>
<p>&emsp;&emsp;<abbr style="font-weight:bold;">解决方案:</abbr><br>&emsp;&emsp;当软件需要变化时，尽量通过扩展软件实体的行为来实现变化，而不是通过修改已有的代码来实现变化。</p>
<p>&emsp;&emsp;开闭原则是面向对象设计中最基础的设计原则，它指导我们如何建立稳定灵活的系统。开闭原则可能是设计模式六项原则中定义最模糊的一个了，它只告诉我们对扩展开放，对修改关闭，可是到底如何才能做到对扩展开放，对修改关闭，并没有明确的告诉我们。以前，如果有人告诉我“你进行设计的时候一定要遵守开闭原则”，我会觉的他什么都没说，但貌似又什么都说了。因为开闭原则真的太虚了。</p>
<p>&emsp;&emsp;在仔细思考以及仔细阅读很多设计模式的文章后，终于对开闭原则有了一点认识。其实，我们遵循设计模式前面5大原则，以及使用23种设计模式的目的就是遵循开闭原则。也就是说，只要我们对前面5项原则遵守的好了，设计出的软件自然是符合开闭原则的，这个开闭原则更像是前面五项原则遵守程度的“平均得分”，前面5项原则遵守的好，平均分自然就高，说明软件设计开闭原则遵守的好；如果前面5项原则遵守的不好，则说明开闭原则遵守的不好。</p>
<p>&emsp;&emsp;其实笔者认为，开闭原则无非就是想表达这样一层意思：用抽象构建框架，用实现扩展细节。因为抽象灵活性好，适应性广，只要抽象的合理，可以基本保持软件架构的稳定。而软件中易变的细节，我们用从抽象派生的实现类来进行扩展，当软件需要发生变化时，我们只需要根据需求重新派生一个实现类来扩展就可以了。当然前提是我们的抽象要合理，要对需求的变更有前瞻性和预见性才行。</p>
<p>&emsp;&emsp;说到这里，再回想一下前面说的5项原则，恰恰是告诉我们用抽象构建框架，用实现扩展细节的注意事项而已：单一职责原则告诉我们实现类要职责单一；里氏替换原则告诉我们不要破坏继承体系；依赖倒置原则告诉我们要面向接口编程；接口隔离原则告诉我们在设计接口的时候要精简单一；迪米特法则告诉我们要降低耦合。而开闭原则是总纲，他告诉我们要对扩展开放，对修改关闭。</p>
<p>&emsp;&emsp;最后说明一下如何去遵守这六个原则。对这六个原则的遵守并不是是和否的问题，而是多和少的问题，也就是说，我们一般不会说有没有遵守，而是说遵守程度的多少。任何事都是过犹不及，设计模式的六个设计原则也是一样，制定这六个原则的目的并不是要我们刻板的遵守他们，而需要根据实际情况灵活运用。对他们的遵守程度只要在一个合理的范围内，就算是良好的设计。我们用一幅图来说明一下。</p>
<p><img src="https://cdn.longdai.com/assets/20180929/0fee8c98bba4190bc1eab1a7321bd52f.gif" alt=""></p>
<p>&emsp;&emsp;图中的每一条维度各代表一项原则，我们依据对这项原则的遵守程度在维度上画一个点，则如果对这项原则遵守的合理的话，这个点应该落在红色的同心圆内部；如果遵守的差，点将会在小圆内部；如果过度遵守，点将会落在大圆外部。一个良好的设计体现在图中，应该是六个顶点都在同心圆中的六边形。</p>
<p><img src="https://cdn.longdai.com/assets/20180929/f0b230fb42289b41ea4b4e3bf7cde9d5.gif" alt=""></p>
<p>&emsp;&emsp;在上图中，设计1、设计2属于良好的设计，他们对六项原则的遵守程度都在合理的范围内；设计3、设计4设计虽然有些不足，但也基本可以接受；设计5则严重不足，对各项原则都没有很好的遵守；而设计6则遵守过渡了，设计5和设计6都是迫切需要重构的设计。</p>

      
    </div>
      <div id="remark"></div>
    <div class="article-info article-info-index">
      
      <a href="/2018/09/29/designPatternsOCP/" class="archive-article-date">
  	<time datetime="2018-09-29T09:29:54.000Z" itemprop="datePublished"><i class="icon-clock"></i>2018-09-29</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端/">前端</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端设计模式/">前端设计模式</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/开闭原则/">开闭原则</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/个人博客/">个人博客</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-designPatternsLOD" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/29/designPatternsLOD/">前端设计模式之迪米特法则(SRP)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h6 id="译注：本文作者愤怒的韭菜"><a href="#译注：本文作者愤怒的韭菜" class="headerlink" title="译注：本文作者愤怒的韭菜"></a>译注：本文作者<a href="https://blog.csdn.net/zhengzhb/article/details/7296930" target="_blank" rel="noopener">愤怒的韭菜</a></h6><p>&emsp;&emsp;<abbr style="font-weight:bold;">定义:</abbr><br>&emsp;&emsp;一个对象应该对其他对象保持最少的了解。</p>
<p>&emsp;&emsp;<abbr style="font-weight:bold;">问题由来:</abbr><br>&emsp;&emsp;与类之间的关系越密切，耦合度越大，当一个类发生改变时，对另一个类的影响也越大。</p>
<p>&emsp;&emsp;<abbr style="font-weight:bold;">解决方案:</abbr><br>&emsp;&emsp;尽量降低类与类之间的耦合。</p>
<p>&emsp;&emsp;自从我们接触编程开始，就知道了软件编程的总的原则：低耦合，高内聚。无论是面向过程编程还是面向对象编程，只有使各个模块之间的耦合尽量的低，才能提高代码的复用率。低耦合的优点不言而喻，但是怎么样编程才能做到低耦合呢？那正是迪米特法则要去完成的。</p>
<p>&emsp;&emsp;迪米特法则又叫最少知道原则，最早是在1987年由美国Northeastern University的Ian Holland提出。通俗的来讲，就是一个类对自己依赖的类知道的越少越好。也就是说，对于被依赖的类来说，无论逻辑多么复杂，都尽量地的将逻辑封装在类的内部，对外除了提供的public方法，不对外泄漏任何信息。迪米特法则还有一个更简单的定义：只与直接的朋友通信。首先来解释一下什么是直接的朋友：每个对象都会与其他对象有耦合关系，只要两个对象之间有耦合关系，我们就说这两个对象之间是朋友关系。耦合的方式很多，依赖、关联、组合、聚合等。其中，我们称出现成员变量、方法参数、方法返回值中的类为直接的朋友，而出现在局部变量中的类则不是直接的朋友。也就是说，陌生的类最好不要作为局部变量的形式出现在类的内部。</p>
<p>&emsp;&emsp;举一个例子：有一个集团公司，下属单位有分公司和直属部门，现在要求打印出所有下属单位的员工ID。先来看一下违反迪米特法则的设计。</p>
<p>&emsp;&emsp;<abbr style="font-weight:bold;">定义1:</abbr></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">//总公司员工</span><br><span class="line">class Employee&#123;</span><br><span class="line">    private String id;</span><br><span class="line">    public void setId(String id)&#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    public String getId()&#123;</span><br><span class="line">        return id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//分公司员工</span><br><span class="line">class SubEmployee&#123;</span><br><span class="line">    private String id;</span><br><span class="line">    public void setId(String id)&#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    public String getId()&#123;</span><br><span class="line">        return id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class SubCompanyManager&#123;</span><br><span class="line">    public List&lt;SubEmployee&gt; getAllEmployee()&#123;</span><br><span class="line">        List&lt;SubEmployee&gt; list = new ArrayList&lt;SubEmployee&gt;();</span><br><span class="line">        for(int i=0; i&lt;100; i++)&#123;</span><br><span class="line">        	SubEmployee emp = new SubEmployee();</span><br><span class="line">        	//为分公司人员按顺序分配一个ID</span><br><span class="line">        	emp.setId(&quot;分公司&quot;+i);</span><br><span class="line">        	list.add(emp);</span><br><span class="line">        &#125;</span><br><span class="line">        return list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class CompanyManager&#123;</span><br><span class="line">    public List&lt;Employee&gt; getAllEmployee()&#123;</span><br><span class="line">        List&lt;Employee&gt; list = new ArrayList&lt;Employee&gt;();</span><br><span class="line">        for(int i=0; i&lt;30; i++)&#123;</span><br><span class="line">        	Employee emp = new Employee();</span><br><span class="line">        	//为总公司人员按顺序分配一个ID</span><br><span class="line">        	emp.setId(&quot;总公司&quot;+i);</span><br><span class="line">        	list.add(emp);</span><br><span class="line">        &#125;</span><br><span class="line">        return list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public void printAllEmployee(SubCompanyManager sub)&#123;</span><br><span class="line">    List&lt;SubEmployee&gt; list1 = sub.getAllEmployee();</span><br><span class="line">    for(SubEmployee e:list1)&#123;</span><br><span class="line">    	System.out.println(e.getId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    List&lt;Employee&gt; list2 = this.getAllEmployee();</span><br><span class="line">    for(Employee e:list2)&#123;</span><br><span class="line">    	System.out.println(e.getId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Client&#123;</span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line">        CompanyManager e = new CompanyManager();</span><br><span class="line">        e.printAllEmployee(new SubCompanyManager());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;现在这个设计的主要问题出在CompanyManager中，根据迪米特法则，只与直接的朋友发生通信，而SubEmployee类并不是CompanyManager类的直接朋友（以局部变量出现的耦合不属于直接朋友），从逻辑上讲总公司只与他的分公司耦合就行了，与分公司的员工并没有任何联系，这样设计显然是增加了不必要的耦合。按照迪米特法则，应该避免类中出现这样非直接朋友关系的耦合。修改后的代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">class SubCompanyManager&#123;</span><br><span class="line">	public List&lt;SubEmployee&gt; getAllEmployee()&#123;</span><br><span class="line">		List&lt;SubEmployee&gt; list = new ArrayList&lt;SubEmployee&gt;();</span><br><span class="line">		for(int i=0; i&lt;100; i++)&#123;</span><br><span class="line">			SubEmployee emp = new SubEmployee();</span><br><span class="line">			//为分公司人员按顺序分配一个ID</span><br><span class="line">			emp.setId(&quot;分公司&quot;+i);</span><br><span class="line">			list.add(emp);</span><br><span class="line">		&#125;</span><br><span class="line">		return list;</span><br><span class="line">	&#125;</span><br><span class="line">	public void printEmployee()&#123;</span><br><span class="line">		List&lt;SubEmployee&gt; list = this.getAllEmployee();</span><br><span class="line">		for(SubEmployee e:list)&#123;</span><br><span class="line">			System.out.println(e.getId());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class CompanyManager&#123;</span><br><span class="line">	public List&lt;Employee&gt; getAllEmployee()&#123;</span><br><span class="line">		List&lt;Employee&gt; list = new ArrayList&lt;Employee&gt;();</span><br><span class="line">		for(int i=0; i&lt;30; i++)&#123;</span><br><span class="line">			Employee emp = new Employee();</span><br><span class="line">			//为总公司人员按顺序分配一个ID</span><br><span class="line">			emp.setId(&quot;总公司&quot;+i);</span><br><span class="line">			list.add(emp);</span><br><span class="line">		&#125;</span><br><span class="line">		return list;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void printAllEmployee(SubCompanyManager sub)&#123;</span><br><span class="line">		sub.printEmployee();</span><br><span class="line">		List&lt;Employee&gt; list2 = this.getAllEmployee();</span><br><span class="line">		for(Employee e:list2)&#123;</span><br><span class="line">			System.out.println(e.getId());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;修改后，为分公司增加了打印人员ID的方法，总公司直接调用来打印，从而避免了与分公司的员工发生耦合。</p>
<p>&emsp;&emsp;迪米特法则的初衷是降低类之间的耦合，由于每个类都减少了不必要的依赖，因此的确可以降低耦合关系。但是凡事都有度，虽然可以避免与非直接的类通信，但是要通信，必然会通过一个“中介”来发生联系，例如本例中，总公司就是通过分公司这个“中介”来与分公司的员工发生联系的。过分的使用迪米特原则，会产生大量这样的中介和传递类，导致系统复杂度变大。所以在采用迪米特法则时要反复权衡，既做到结构清晰，又要高内聚低耦合。</p>

      
    </div>
      <div id="remark"></div>
    <div class="article-info article-info-index">
      
      <a href="/2018/09/29/designPatternsLOD/" class="archive-article-date">
  	<time datetime="2018-09-29T09:18:34.000Z" itemprop="datePublished"><i class="icon-clock"></i>2018-09-29</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端/">前端</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端设计模式/">前端设计模式</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/迪米特法则/">迪米特法则</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/个人博客/">个人博客</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-designPatternsISP" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/29/designPatternsISP/">前端设计模式之接口隔离原则(ISP)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h6 id="译注：本文作者愤怒的韭菜"><a href="#译注：本文作者愤怒的韭菜" class="headerlink" title="译注：本文作者愤怒的韭菜"></a>译注：本文作者<a href="https://blog.csdn.net/zhengzhb/article/details/7296921" target="_blank" rel="noopener">愤怒的韭菜</a></h6><p>&emsp;&emsp;<abbr style="font-weight:bold;">定义:</abbr><br>&emsp;&emsp;客户端不应该依赖它不需要的接口；一个类对另一个类的依赖应该建立在最小的接口上。</p>
<p>&emsp;&emsp;<abbr style="font-weight:bold;">问题由来:</abbr><br>&emsp;&emsp;类A通过接口I依赖类B，类C通过接口I依赖类D，如果接口I对于类A和类B来说不是最小接口，则类B和类D必须去实现他们不需要的方法。</p>
<p>&emsp;&emsp;<abbr style="font-weight:bold;">解决方案:</abbr><br>&emsp;&emsp;将臃肿的接口I拆分为独立的几个接口，类A和类C分别与他们需要的接口建立依赖关系。也就是采用接口隔离原则。</p>
<p>&emsp;&emsp;举例来说明接口隔离原则：</p>
<p><img src="https://cdn.longdai.com/assets/20180929/3b4959dcf38c5dfa2049120091594147.jpg" alt=""><br><abbr style="font-size: 13px;margin-left: 100px;">（图1  未遵循接口隔离原则的设计）</abbr></p>
<p>&emsp;&emsp;这个图的意思是：类A依赖接口I中的方法1、方法2、方法3，类B是对类A依赖的实现。类C依赖接口I中的方法1、方法4、方法5，类D是对类C依赖的实现。对于类B和类D来说，虽然他们都存在着用不到的方法（也就是图中红色字体标记的方法），但由于实现了接口I，所以也必须要实现这些用不到的方法。对类图不熟悉的可以参照程序代码来理解，代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">  interface I&#123;</span><br><span class="line">      public void method1();</span><br><span class="line">      public void method2();</span><br><span class="line">      public void method3();</span><br><span class="line">      public void method4();</span><br><span class="line">      public void method5();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  class A&#123;</span><br><span class="line">      public void depend1(I i)&#123;</span><br><span class="line">          i.method1();</span><br><span class="line">      &#125;</span><br><span class="line">      public void depend1(I i)&#123;</span><br><span class="line">          i.method2();</span><br><span class="line">      &#125;</span><br><span class="line">      public void depend1(I i)&#123;</span><br><span class="line">          i.method3();</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  class B implements I&#123;</span><br><span class="line">      public void method1()&#123;</span><br><span class="line">          System.out.println(&quot;类B实现接口I的方法1&quot;);</span><br><span class="line">      &#125;</span><br><span class="line">      public void method2()&#123;</span><br><span class="line">          System.out.println(&quot;类B实现接口I的方法2&quot;);</span><br><span class="line">      &#125;</span><br><span class="line">      public void method3()&#123;</span><br><span class="line">          System.out.println(&quot;类B实现接口I的方法3&quot;);</span><br><span class="line">      &#125;</span><br><span class="line">      public void method4() &#123;&#125;</span><br><span class="line">      public void method5() &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  class C&#123;</span><br><span class="line">      public void method1()&#123;</span><br><span class="line">           i.method1();</span><br><span class="line">      &#125;</span><br><span class="line">      public void method2()&#123;</span><br><span class="line">           i.method4();</span><br><span class="line">      &#125;</span><br><span class="line">      public void method3()&#123;</span><br><span class="line">           i.method5();</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  class D implements I&#123;</span><br><span class="line">      public void method1()&#123;</span><br><span class="line">          System.out.println(&quot;类D实现接口I的方法1&quot;);</span><br><span class="line">      &#125;</span><br><span class="line">      public void method2() &#123;&#125;</span><br><span class="line">      public void method3() &#123;&#125;</span><br><span class="line">      public void method4() &#123;</span><br><span class="line">          System.out.println(&quot;类D实现接口I的方法4&quot;);</span><br><span class="line">      &#125;</span><br><span class="line">      public void method5() &#123;</span><br><span class="line">          System.out.println(&quot;类D实现接口I的方法5&quot;);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  public class Client&#123;</span><br><span class="line">      public static void main(String[] args)&#123;</span><br><span class="line">          A a = new A();</span><br><span class="line">          a.depend1(new B());</span><br><span class="line">          a.depend2(new B());</span><br><span class="line">          a.depend3(new B());</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      C c = new C();</span><br><span class="line">c.depend1(new D());</span><br><span class="line">c.depend2(new D());</span><br><span class="line">c.depend3(new D());</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;可以看到，如果接口过于臃肿，只要接口中出现的方法，不管对依赖于它的类有没有用处，实现类中都必须去实现这些方法，这显然不是好的设计。如果将这个设计修改为符合接口隔离原则，就必须对接口I进行拆分。在这里我们将原有的接口I拆分为三个接口，拆分后的设计如图2所示</p>
<p><img src="https://cdn.longdai.com/assets/20180929/937fdf05e614415794a7649eab14b59a.jpg" alt=""><br><abbr style="font-size: 13px;margin-left: 100px;">（图2  遵循接口隔离原则的设计）</abbr></p>
<p>&emsp;&emsp;照例贴出程序的代码，供不熟悉类图的朋友参考：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">interface I1 &#123;</span><br><span class="line">    public void method1();</span><br><span class="line">&#125;</span><br><span class="line">interface I2 &#123;</span><br><span class="line">	public void method2();</span><br><span class="line">	public void method3();</span><br><span class="line">&#125;</span><br><span class="line">interface I3 &#123;</span><br><span class="line">	public void method4();</span><br><span class="line">	public void method5();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class A&#123;</span><br><span class="line">	public void depend1(I1 i)&#123;</span><br><span class="line">		i.method1();</span><br><span class="line">	&#125;</span><br><span class="line">	public void depend2(I2 i)&#123;</span><br><span class="line">		i.method2();</span><br><span class="line">	&#125;</span><br><span class="line">	public void depend3(I2 i)&#123;</span><br><span class="line">		i.method3();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class B implements I1, I2&#123;</span><br><span class="line">    public void method1() &#123;</span><br><span class="line">        System.out.println(&quot;类B实现接口I1的方法1&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    public void method2() &#123;</span><br><span class="line">        System.out.println(&quot;类B实现接口I2的方法2&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    public void method3() &#123;</span><br><span class="line">        System.out.println(&quot;类B实现接口I2的方法3&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class C&#123;</span><br><span class="line">	public void depend1(I1 i)&#123;</span><br><span class="line">		i.method1();</span><br><span class="line">	&#125;</span><br><span class="line">	public void depend2(I3 i)&#123;</span><br><span class="line">		i.method4();</span><br><span class="line">	&#125;</span><br><span class="line">	public void depend3(I3 i)&#123;</span><br><span class="line">		i.method5();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class D implements I1, I3&#123;</span><br><span class="line">    public void method1() &#123;</span><br><span class="line">        System.out.println(&quot;类D实现接口I1的方法1&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    public void method4() &#123;</span><br><span class="line">        System.out.println(&quot;类D实现接口I3的方法4&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    public void method5() &#123;</span><br><span class="line">        System.out.println(&quot;类D实现接口I3的方法5&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;接口隔离原则的含义是：建立单一接口，不要建立庞大臃肿的接口，尽量细化接口，接口中的方法尽量少。也就是说，我们要为各个类建立专用的接口，而不要试图去建立一个很庞大的接口供所有依赖它的类去调用。本文例子中，将一个庞大的接口变更为3个专用的接口所采用的就是接口隔离原则。在程序设计中，依赖几个专用的接口要比依赖一个综合的接口更灵活。接口是设计时对外部设定的“契约”，通过分散定义多个接口，可以预防外来变更的扩散，提高系统的灵活性和可维护性。</p>
<p>&emsp;&emsp;说到这里，很多人会觉的接口隔离原则跟之前的单一职责原则很相似，其实不然。其一，单一职责原则原注重的是职责；而接口隔离原则注重对接口依赖的隔离。其二，单一职责原则主要是约束类，其次才是接口和方法，它针对的是程序中的实现和细节；而接口隔离原则主要约束接口，主要针对抽象，针对程序整体框架的构建。</p>
<p>&emsp;&emsp;采用接口隔离原则对接口进行约束时，要注意以下几点：</p>
<p>&emsp;&emsp;&gt; 接口尽量小，但是要有限度。对接口进行细化可以提高程序设计灵活性是不挣的事实，但是如果过小，则会造成接口数量过多，使设计复杂化。所以一定要适度。<br>&emsp;&emsp;&gt; 为依赖接口的类定制服务，只暴露给调用的类它需要的方法，它不需要的方法则隐藏起来。只有专注地为一个模块提供定制服务，才能建立最小的依赖关系。<br>&emsp;&emsp;&gt; 提高内聚，减少对外交互。使接口用最少的方法去完成最多的事情。</p>
<p>&emsp;&emsp;运用接口隔离原则，一定要适度，接口设计的过大或过小都不好。设计接口的时候，只有多花些时间去思考和筹划，才能准确地实践这一原则。</p>

      
    </div>
      <div id="remark"></div>
    <div class="article-info article-info-index">
      
      <a href="/2018/09/29/designPatternsISP/" class="archive-article-date">
  	<time datetime="2018-09-29T08:48:55.000Z" itemprop="datePublished"><i class="icon-clock"></i>2018-09-29</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端/">前端</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端设计模式/">前端设计模式</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/接口隔离原则/">接口隔离原则</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/个人博客/">个人博客</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-designPatternsDIP" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/29/designPatternsDIP/">前端设计模式之依赖倒置原则(DIP)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h6 id="译注：本文作者愤怒的韭菜"><a href="#译注：本文作者愤怒的韭菜" class="headerlink" title="译注：本文作者愤怒的韭菜"></a>译注：本文作者<a href="https://blog.csdn.net/zhengzhb/article/details/7289269" target="_blank" rel="noopener">愤怒的韭菜</a></h6><p>&emsp;&emsp;<abbr style="font-weight:bold;">定义:</abbr><br>&emsp;&emsp;高层模块不应该依赖低层模块，二者都应该依赖其抽象；抽象不应该依赖细节；细节应该依赖抽象。</p>
<p>&emsp;&emsp;<abbr style="font-weight:bold;">问题由来:</abbr><br>&emsp;&emsp;类A直接依赖类B，假如要将类A改为依赖类C，则必须通过修改类A的代码来达成。这种场景下，类A一般是高层模块，负责复杂的业务逻辑；类B和类C是低层模块，负责基本的原子操作；假如修改类A，会给程序带来不必要的风险。</p>
<p>&emsp;&emsp;<abbr style="font-weight:bold;">解决方案:</abbr><br>&emsp;&emsp;将类A修改为依赖接口I，类B和类C各自实现接口I，类A通过接口I间接与类B或者类C发生联系，则会大大降低修改类A的几率。</p>
<p>&emsp;&emsp;依赖倒置原则基于这样一个事实：相对于细节的多变性，抽象的东西要稳定的多。以抽象为基础搭建起来的架构比以细节为基础搭建起来的架构要稳定的多。在java中，抽象指的是接口或者抽象类，细节就是具体的实现类，使用接口或者抽象类的目的是制定好规范和契约，而不去涉及任何具体的操作，把展现细节的任务交给他们的实现类去完成。</p>
<p>&emsp;&emsp;依赖倒置原则的核心思想是面向接口编程，我们依旧用一个例子来说明面向接口编程比相对于面向实现编程好在什么地方。场景是这样的，母亲给孩子讲故事，只要给她一本书，她就可以照着书给孩子讲故事了。代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">class Book &#123;</span><br><span class="line">    public String getContent()&#123;</span><br><span class="line">        return &apos;很久很久以前有一个阿拉伯的故事...&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Mother&#123;</span><br><span class="line">    public void narrate(Book book)&#123;</span><br><span class="line">        System.out.println(&quot;妈妈开始讲故事&quot;);</span><br><span class="line">        System.out.println(book.getContent());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Client&#123;</span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line">        Mother month = new Month();</span><br><span class="line">        moth.narrate(new Book());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;运行结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">妈妈开始讲故事</span><br><span class="line">很久很久以前有一个阿拉伯的故事...</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;运行良好，假如有一天，需求变成这样：不是给书而是给一份报纸，让这位母亲讲一下报纸上的故事，报纸的代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class Newspaper&#123;</span><br><span class="line">    public String getContent()&#123;</span><br><span class="line">        return &apos;林书豪38+7领导尼克斯击败湖人……&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这位母亲却办不到，因为她居然不会读报纸上的故事，这太荒唐了，只是将书换成报纸，居然必须要修改Mother才能读。假如以后需求换成杂志呢？换成网页呢？还要不断地修改Mother，这显然不是好的设计。原因就是Mother与Book之间的耦合性太高了，必须降低他们之间的耦合度才行。</p>
<p>&emsp;&emsp;我们引入一个抽象的接口IReader。读物，只要是带字的都属于读物：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">interface IReader&#123;</span><br><span class="line">    public String getContent();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;Mother类与接口IReader发生依赖关系，而Book和Newspaper都属于读物的范畴，他们各自都去实现IReader接口，这样就符合依赖倒置原则了，代码修改为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">class Newspaper implements IReader&#123;</span><br><span class="line">     public String getContent()&#123;</span><br><span class="line">         return &apos;林书豪38+7领导尼克斯击败湖人……&apos;;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Book implements IReader&#123;</span><br><span class="line">     public String getContent()&#123;</span><br><span class="line">         return &apos;很久很久以前有一个阿拉伯的故事...&apos;;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Month&#123;</span><br><span class="line">     public void narrate(IReader reader)&#123;</span><br><span class="line">          System.out.println(&quot;妈妈开始讲故事&quot;);</span><br><span class="line">          System.out.println(reader.getContent());</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Client&#123;</span><br><span class="line">     public static void main(String[] args)&#123;</span><br><span class="line">         Month month = new Month();</span><br><span class="line">         mother.narrate(new Book());</span><br><span class="line">         month.getContent(new Newspaper());</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;运行结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">妈妈开始讲故事</span><br><span class="line">很久很久以前有一个阿拉伯的故事……</span><br><span class="line">妈妈开始讲故事</span><br><span class="line">林书豪17+9助尼克斯击败老鹰……</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;这样修改后，无论以后怎样扩展Client类，都不需要再修改Mother类了。这只是一个简单的例子，实际情况中，代表高层模块的Mother类将负责完成主要的业务逻辑，一旦需要对它进行修改，引入错误的风险极大。所以遵循依赖倒置原则可以降低类之间的耦合性，提高系统的稳定性，降低修改程序造成的风险。</p>
<p>&emsp;&emsp;采用依赖倒置原则给多人并行开发带来了极大的便利，比如上例中，原本Mother类与Book类直接耦合时，Mother类必须等Book类编码完成后才可以进行编码，因为Mother类依赖于Book类。修改后的程序则可以同时开工，互不影响，因为Mother与Book类一点关系也没有。参与协作开发的人越多、项目越庞大，采用依赖导致原则的意义就越重大。现在很流行的TDD开发模式就是依赖倒置原则最成功的应用</p>
<p>&emsp;&emsp;传递依赖关系有三种方式，以上的例子中使用的方法是接口传递，另外还有两种传递方式：构造方法传递和setter方法传递，相信用过Spring框架的，对依赖的传递方式一定不会陌生。</p>
<p>&emsp;&emsp;在实际编程中，我们一般需要做到如下3点：</p>
<p>&emsp;&emsp;&gt; 低层模块尽量都要有抽象类或接口，或者两者都有。<br>&emsp;&emsp;&gt; 变量的声明类型尽量是抽象类或接口。<br>&emsp;&emsp;&gt; 使用继承时遵循里氏替换原则。<br>&emsp;&emsp;依赖倒置原则的核心就是要我们面向接口编程，理解了面向接口编程，也就理解了依赖倒置。</p>

      
    </div>
      <div id="remark"></div>
    <div class="article-info article-info-index">
      
      <a href="/2018/09/29/designPatternsDIP/" class="archive-article-date">
  	<time datetime="2018-09-29T07:16:52.000Z" itemprop="datePublished"><i class="icon-clock"></i>2018-09-29</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/依赖倒置原则/">依赖倒置原则</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端/">前端</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端设计模式/">前端设计模式</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/个人博客/">个人博客</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-designPatternsLSP" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/29/designPatternsLSP/">前端设计模式之里氏替换原则(LSP)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h6 id="译注：本文作者愤怒的韭菜"><a href="#译注：本文作者愤怒的韭菜" class="headerlink" title="译注：本文作者愤怒的韭菜"></a>译注：本文作者<a href="https://blog.csdn.net/zhengzhb/article/details/7281833" target="_blank" rel="noopener">愤怒的韭菜</a></h6><p>&emsp;&emsp;肯定有不少人跟我刚看到这项原则的时候一样，对这个原则的名字充满疑惑。其实原因就是这项原则最早是在1988年，由麻省理工学院的一位姓里的女士（Barbara Liskov）提出来的。</p>
<p>&emsp;&emsp;<abbr style="font-weight:bold;">定义1:</abbr><br>&emsp;&emsp;如果对每一个类型为 T1的对象 o1，都有类型为 T2 的对象o2，使得以 T1定义的所有程序 P 在所有的对象 o1 都代换成 o2 时，程序 P 的行为没有发生变化，那么类型 T2 是类型 T1 的子类型。</p>
<p>&emsp;&emsp;<abbr style="font-weight:bold;">定义2:</abbr><br>&emsp;&emsp;所有引用基类的地方必须能透明地使用其子类的对象。</p>
<p>&emsp;&emsp;<abbr style="font-weight:bold;">问题由来:</abbr><br>&emsp;&emsp;有一功能P1，由类A完成。现需要将功能P1进行扩展，扩展后的功能为P，其中P由原有功能P1与新功能P2组成。新功能P由类A的子类B来完成，则子类B在完成新功能P2的同时，有可能会导致原有功能P1发生故障。</p>
<p>&emsp;&emsp;<abbr style="font-weight:bold;">解决方案:</abbr><br>&emsp;&emsp;当使用继承时，遵循里氏替换原则。类B继承类A时，除添加新的方法完成新增功能P2外，尽量不要重写父类A的方法，也尽量不要重载父类A的方法。</p>
<p>&emsp;&emsp;继承包含这样一层含义：父类中凡是已经实现好的方法（相对于抽象方法而言），实际上是在设定一系列的规范和契约，虽然它不强制要求所有的子类必须遵从这些契约，但是如果子类对这些非抽象方法任意修改，就会对整个继承体系造成破坏。而里氏替换原则就是表达了这一层含义。</p>
<p>&emsp;&emsp;继承作为面向对象三大特性之一，在给程序设计带来巨大便利的同时，也带来了弊端。比如使用继承会给程序带来侵入性，程序的可移植性降低，增加了对象间的耦合性，如果一个类被其他的类所继承，则当这个类需要修改时，必须考虑到所有的子类，并且父类修改后，所有涉及到子类的功能都有可能会产生故障。</p>
<p>&emsp;&emsp;举例说明继承的风险，我们需要完成一个两数相减的功能，由类A来负责。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class A&#123;</span><br><span class="line">    public int func1(int a,int b)&#123;</span><br><span class="line">        return a-b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Client&#123;</span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line">        A a = new A();</span><br><span class="line">        System.out.println(&quot;100-50=&quot;+a.func1(100, 50));</span><br><span class="line">        System.out.println(&quot;100-80=&quot;+a.func1(100, 80));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;运行结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">100-50=50</span><br><span class="line">100-80=20</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;后来，我们需要增加一个新的功能：完成两数相加，然后再与100求和，由类B来负责。即类B需要完成两个功能：</p>
<p>&emsp;&emsp; &gt; 两数相减。<br>&emsp;&emsp; &gt; 两数相加，然后再加100。</p>
<p>&emsp;&emsp;由于类A已经实现了第一个功能，所以类B继承类A后，只需要再完成第二个功能就可以了，代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">class B extends A&#123;</span><br><span class="line">     public int func1(int a, int b)&#123;</span><br><span class="line">         return a+b;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     public int func2(int a, int b)&#123;</span><br><span class="line">         return func1(a,b)+100;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Client&#123;</span><br><span class="line">     public static void main(String[] args)&#123;</span><br><span class="line">         B b = new B();</span><br><span class="line">         System.out.println(&quot;100-50=&quot;+b.func1(100, 50));</span><br><span class="line">         System.out.println(&quot;100-80=&quot;+b.func1(100, 80));</span><br><span class="line">         System.out.println(&quot;100+20+100=&quot;+b.func2(100, 20));</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;类B完成后，运行结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">100-50=150</span><br><span class="line">100-80=180</span><br><span class="line">100+20+100=220</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;我们发现原本运行正常的相减功能发生了错误。原因就是类B在给方法起名时无意中重写了父类的方法，造成所有运行相减功能的代码全部调用了类B重写后的方法，造成原本运行正常的功能出现了错误。在本例中，引用基类A完成的功能，换成子类B之后，发生了异常。在实际编程中，我们常常会通过重写父类的方法来完成新的功能，这样写起来虽然简单，但是整个继承体系的可复用性会比较差，特别是运用多态比较频繁时，程序运行出错的几率非常大。如果非要重写父类的方法，比较通用的做法是：原来的父类和子类都继承一个更通俗的基类，原有的继承关系去掉，采用依赖、聚合，组合等关系代替。</p>
<p>&emsp;&emsp;&gt; 里氏替换原则通俗的来讲就是：子类可以扩展父类的功能，但不能改变父类原有的功能。它包含以下4层含义<br>&emsp;&emsp;&gt; 子类可以实现父类的抽象方法，但不能覆盖父类的非抽象方法。<br>&emsp;&emsp;&gt; 子类中可以增加自己特有的方法。<br>&emsp;&emsp;&gt; 当子类的方法重载父类的方法时，方法的前置条件（即方法的形参）要比父类方法的输入参数更宽松。<br>&emsp;&emsp;&gt; 当子类的方法实现父类的抽象方法时，方法的后置条件（即方法的返回值）要比父类更严格。</p>
<p>&emsp;&emsp;看上去很不可思议，因为我们会发现在自己编程中常常会违反里氏替换原则，程序照样跑的好好的。所以大家都会产生这样的疑问，假如我非要不遵循里氏替换原则会有什么后果？</p>
<p>&emsp;&emsp;后果就是：你写的代码出问题的几率将会大大增加。</p>

      
    </div>
      <div id="remark"></div>
    <div class="article-info article-info-index">
      
      <a href="/2018/09/29/designPatternsLSP/" class="archive-article-date">
  	<time datetime="2018-09-29T06:46:46.000Z" itemprop="datePublished"><i class="icon-clock"></i>2018-09-29</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端/">前端</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端设计模式/">前端设计模式</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/里氏替换原则/">里氏替换原则</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/个人博客/">个人博客</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-designPatternsSRP" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/29/designPatternsSRP/">前端设计模式之单一职责原则(SRP)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h6 id="译注：本文作者愤怒的韭菜"><a href="#译注：本文作者愤怒的韭菜" class="headerlink" title="译注：本文作者愤怒的韭菜"></a>译注：本文作者<a href="https://blog.csdn.net/zhengzhb/article/details/7278174" target="_blank" rel="noopener">愤怒的韭菜</a></h6><p>&emsp;&emsp;<abbr style="font-weight:bold;">定义:</abbr><br>&emsp;&emsp;不要存在多于一个导致类变更的原因。通俗的说，即一个类只负责一项职责。</p>
<p>&emsp;&emsp;<abbr style="font-weight:bold;">问题由来:</abbr><br>&emsp;&emsp;类T负责两个不同的职责：职责P1，职责P2。当由于职责P1需求发生改变而需要修改类T时，有可能会导致原本运行正常的职责P2功能发生故障。</p>
<p>&emsp;&emsp;<abbr style="font-weight:bold;">解决方案:</abbr><br>&emsp;&emsp;遵循单一职责原则。分别建立两个类T1、T2，使T1完成职责P1功能，T2完成职责P2功能。这样，当修改类T1时，不会使职责P2发生故障风险；同理，当修改T2时，也不会使职责P1发生故障风险。</p>
<p>&emsp;&emsp;说到单一职责原则，很多人都会不屑一顾。因为它太简单了。稍有经验的程序员即使从来没有读过设计模式、从来没有听说过单一职责原则，在设计软件时也会自觉的遵守这一重要原则，因为这是常识。在软件编程中，谁也不希望因为修改了一个功能导致其他的功能发生故障。而避免出现这一问题的方法便是遵循单一职责原则。虽然单一职责原则如此简单，并且被认为是常识，但是即便是经验丰富的程序员写出的程序，也会有违背这一原则的代码存在。为什么会出现这种现象呢？因为有职责扩散。所谓职责扩散，就是因为某种原因，职责P被分化为粒度更细的职责P1和P2。</p>
<p>&emsp;&emsp;比如：类T只负责一个职责P，这样设计是符合单一职责原则的。后来由于某种原因，也许是需求变更了，也许是程序的设计者境界提高了，需要将职责P细分为粒度更细的职责P1，P2，这时如果要使程序遵循单一职责原则，需要将类T也分解为两个类T1和T2，分别负责P1、P2两个职责。但是在程序已经写好的情况下，这样做简直太费时间了。所以，简单的修改类T，用它来负责两个职责是一个比较不错的选择，虽然这样做有悖于单一职责原则。（这样做的风险在于职责扩散的不确定性，因为我们不会想到这个职责P，在未来可能会扩散为P1，P2，P3，P4……Pn。所以记住，在职责扩散到我们无法控制的程度之前，立刻对代码进行重构。）</p>
<p>&emsp;&emsp;举例说明，用一个类描述动物呼吸这个场景：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class Animal&#123;</span><br><span class="line">    public void breathe(String animal)&#123;</span><br><span class="line">        System.out.println(animal+&quot;呼吸空气&quot;);</span><br><span class="line">    &#125;&#125;</span><br><span class="line"></span><br><span class="line">    public class Client&#123;</span><br><span class="line">        public static void main(String[] args)&#123;</span><br><span class="line">            Animal animal = new Animal();</span><br><span class="line">            animal.breathe(&quot;牛&quot;);</span><br><span class="line">            animal.breathe(&quot;羊&quot;);</span><br><span class="line">            animal.breathe(&quot;猪&quot;);</span><br><span class="line">         &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;运行结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">牛呼吸空气</span><br><span class="line">羊呼吸空气</span><br><span class="line">猪呼吸空气</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;程序上线后，发现问题了，并不是所有的动物都呼吸空气的，比如鱼就是呼吸水的。修改时如果遵循单一职责原则，需要将Animal类细分为陆生动物类Terrestrial，水生动物Aquatic，代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">class Terrestrial&#123;</span><br><span class="line">     public void breathe(String animal)&#123;</span><br><span class="line">          System.out.println(animal+&quot;呼吸空气&quot;);</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Aquatic&#123;</span><br><span class="line">     public void breathe(String animal)&#123;</span><br><span class="line">           System.out.println(animal+&quot;呼吸水&quot;);</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Client&#123;</span><br><span class="line">     public static void main(String[] args)&#123;</span><br><span class="line">         Terrestrial terrestrial = new Terrestrial();</span><br><span class="line">         terrestrial.breathe(&quot;牛&quot;);</span><br><span class="line">         terrestrial.breathe(&quot;羊&quot;);</span><br><span class="line">         terrestrial.breathe(&quot;猪&quot;);</span><br><span class="line">         Aquatic aquatic = new Aquatic();</span><br><span class="line">         aquatic.breathe(&quot;鱼&quot;);</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;运行结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">牛呼吸空气</span><br><span class="line">羊呼吸空气</span><br><span class="line">猪呼吸空气</span><br><span class="line">鱼呼吸水</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;我们会发现如果这样修改花销是很大的，除了将原来的类分解之外，还需要修改客户端。而直接修改类Animal来达成目的虽然违背了单一职责原则，但花销却小的多，代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">class Animal&#123;</span><br><span class="line">    public void breathe(String animal)&#123;</span><br><span class="line">        if(&quot;鱼&quot;.equals(animal))&#123;</span><br><span class="line">            System.out.println(animal+&quot;呼吸水&quot;);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            System.out.println(animal+&quot;呼吸空气&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line">public class Client&#123;</span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line">        Animal animal = new Animal();</span><br><span class="line">        animal.breathe(&quot;牛&quot;);</span><br><span class="line">        animal.breathe(&quot;羊&quot;);</span><br><span class="line">        animal.breathe(&quot;猪&quot;);</span><br><span class="line">        animal.breathe(&quot;鱼&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;可以看到，这种修改方式要简单的多。但是却存在着隐患：有一天需要将鱼分为呼吸淡水的鱼和呼吸海水的鱼，则又需要修改Animal类的breathe方法，而对原有代码的修改会对调用“猪”“牛”“羊”等相关功能带来风险，也许某一天你会发现程序运行的结果变为“牛呼吸水”了。这种修改方式直接在代码级别上违背了单一职责原则，虽然修改起来最简单，但隐患却是最大的。还有一种修改方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">class Animal&#123;</span><br><span class="line">     public void breathe(String animal)&#123;</span><br><span class="line">         System.out.println(animal+&quot;呼吸空气&quot;);</span><br><span class="line">     &#125;</span><br><span class="line">     public void breathe2(String animal)&#123;</span><br><span class="line">         System.out.println(animal+&quot;呼吸水&quot;);</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Client&#123;</span><br><span class="line">     public static void main(String[] args)&#123;</span><br><span class="line">         Animal animal = new Animal();</span><br><span class="line">         animal.breathe(&quot;牛&quot;);</span><br><span class="line">         animal.breathe(&quot;羊&quot;);</span><br><span class="line">         animal.breathe(&quot;猪&quot;);</span><br><span class="line">         animal.breathe2(&quot;鱼&quot;);</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;可以看到，这种修改方式没有改动原来的方法，而是在类中新加了一个方法，这样虽然也违背了单一职责原则，但在方法级别上却是符合单一职责原则的，因为它并没有动原来方法的代码。这三种方式各有优缺点，那么在实际编程中，采用哪一中呢？其实这真的比较难说，需要根据实际情况来确定。我的原则是：只有逻辑足够简单，才可以在代码级别上违反单一职责原则；只有类中方法数量足够少，才可以在方法级别上违反单一职责原则；</p>
<p>&emsp;&emsp;例如本文所举的这个例子，它太简单了，它只有一个方法，所以，无论是在代码级别上违反单一职责原则，还是在方法级别上违反，都不会造成太大的影响。实际应用中的类都要复杂的多，一旦发生职责扩散而需要修改类时，除非这个类本身非常简单，否则还是遵循单一职责原则的好。</p>
<p>&emsp;&emsp;遵循单一职责原的优点有：</p>
<p>&emsp;&emsp;&gt; 可以降低类的复杂度，一个类只负责一项职责，其逻辑肯定要比负责多项职责简单的多；<br>&emsp;&emsp;&gt; 提高类的可读性，提高系统的可维护性；<br>&emsp;&emsp;&gt; 变更引起的风险降低，变更是必然的，如果单一职责原则遵守的好，当修改一个功能时，可以显著降低对其他功能的影响。</p>
<p>&emsp;&emsp;需要说明的一点是单一职责原则不只是面向对象编程思想所特有的，只要是模块化的程序设计，都适用单一职责原则。</p>

      
    </div>
      <div id="remark"></div>
    <div class="article-info article-info-index">
      
      <a href="/2018/09/29/designPatternsSRP/" class="archive-article-date">
  	<time datetime="2018-09-29T06:46:46.000Z" itemprop="datePublished"><i class="icon-clock"></i>2018-09-29</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端/">前端</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端设计模式/">前端设计模式</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/单一职责原则/">单一职责原则</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/个人博客/">个人博客</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
    </nav>
  


      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2019 谢雨轩
    	</div>
      	<div class="footer-right">虽然生的丑 毕竟想的美</div>
    </div>
  </div>
</footer>

    </div>
    <script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: true,
		root: "/",
		innerArchive: true
	}
</script>

<script src="/./main.js"></script>


    
<div class="tools-col">
  <ul class="btn-wrap">
    
      <li class="chose" data-hook="tools-section-all"><span class="text">全部</span><i class="icon-book"></i></li>
    
    
      <li data-hook="tools-section-tag"><span class="text">标签</span><i class="icon-price-tags"></i></li>
    
    
      <li data-hook="tools-section-friends"><span class="text">友链</span><i class="icon-link"></i></li>
    
    
      <li data-hook="tools-section-me"><span class="text">我</span><i class="icon-smile"></i></li>
    
  </ul>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all chose">
    	</section>
    

    
    	<section class="tools-section tools-section-tag">
    			<div class="widget tagcloud" id="js-tagcloud">
    				<a href="/tags/FHS/" style="font-size: 11.67px;">FHS</a> <a href="/tags/css-hack/" style="font-size: 10px;">css hack</a> <a href="/tags/excel表格导出/" style="font-size: 10px;">excel表格导出</a> <a href="/tags/jquery/" style="font-size: 10px;">jquery</a> <a href="/tags/jquery源码/" style="font-size: 10px;">jquery源码</a> <a href="/tags/jquery源码教程/" style="font-size: 10px;">jquery源码教程</a> <a href="/tags/js原型/" style="font-size: 10px;">js原型</a> <a href="/tags/license/" style="font-size: 10px;">license</a> <a href="/tags/linux/" style="font-size: 11.67px;">linux</a> <a href="/tags/linux操作/" style="font-size: 10px;">linux操作</a> <a href="/tags/linux文件/" style="font-size: 10px;">linux文件</a> <a href="/tags/linux环境变量/" style="font-size: 10px;">linux环境变量</a> <a href="/tags/node/" style="font-size: 10px;">node</a> <a href="/tags/nodejs/" style="font-size: 10px;">nodejs</a> <a href="/tags/react/" style="font-size: 10px;">react</a> <a href="/tags/react-redux/" style="font-size: 10px;">react-redux</a> <a href="/tags/rich-text/" style="font-size: 10px;">rich-text</a> <a href="/tags/underscore/" style="font-size: 10px;">underscore</a> <a href="/tags/underscore源码/" style="font-size: 10px;">underscore源码</a> <a href="/tags/vim/" style="font-size: 10px;">vim</a> <a href="/tags/vim命令/" style="font-size: 10px;">vim命令</a> <a href="/tags/webpack/" style="font-size: 16.67px;">webpack</a> <a href="/tags/webpack-4-0/" style="font-size: 15px;">webpack 4.0</a> <a href="/tags/webpack优化/" style="font-size: 10px;">webpack优化</a> <a href="/tags/webpack教程/" style="font-size: 15px;">webpack教程</a> <a href="/tags/依赖倒置原则/" style="font-size: 11.67px;">依赖倒置原则</a> <a href="/tags/全栈/" style="font-size: 10px;">全栈</a> <a href="/tags/前端/" style="font-size: 20px;">前端</a> <a href="/tags/前端学习/" style="font-size: 10px;">前端学习</a> <a href="/tags/前端工程师/" style="font-size: 10px;">前端工程师</a> <a href="/tags/前端常用网站/" style="font-size: 10px;">前端常用网站</a> <a href="/tags/前端打包工具/" style="font-size: 10px;">前端打包工具</a> <a href="/tags/前端设计模式/" style="font-size: 18.33px;">前端设计模式</a> <a href="/tags/单一职责原则/" style="font-size: 10px;">单一职责原则</a> <a href="/tags/原创/" style="font-size: 13.33px;">原创</a> <a href="/tags/图片加载/" style="font-size: 10px;">图片加载</a> <a href="/tags/图片加载完成事件/" style="font-size: 10px;">图片加载完成事件</a> <a href="/tags/开闭原则/" style="font-size: 10px;">开闭原则</a> <a href="/tags/微信小程序/" style="font-size: 10px;">微信小程序</a> <a href="/tags/技术发展/" style="font-size: 10px;">技术发展</a> <a href="/tags/接口隔离原则/" style="font-size: 10px;">接口隔离原则</a> <a href="/tags/正则/" style="font-size: 10px;">正则</a> <a href="/tags/源码/" style="font-size: 11.67px;">源码</a> <a href="/tags/滚动信息条间歇性滚动/" style="font-size: 10px;">滚动信息条间歇性滚动</a> <a href="/tags/理解https/" style="font-size: 10px;">理解https</a> <a href="/tags/迪米特法则/" style="font-size: 10px;">迪米特法则</a> <a href="/tags/里氏替换原则/" style="font-size: 10px;">里氏替换原则</a>
    			</div>
    	</section>
    

    
    	<section class="tools-section tools-section-friends">
  		
  			<div class="friends-wrap" id="js-friends">
  			
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="https://github.com/Vera0707/huanhuashuixie/tree/master/framework">流行框架练习</a>
  	        
  	        </div>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">一枚深水前端&lt;br/&gt;&lt;br/&gt;大神带带我&lt;br/&gt;小白我要升级打倒小怪兽</div>
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
  <link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
  <script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
  <!--<script>-->
      <!--var WIDTH = window.innerWidth, HEIGHT = window.innerHeight, POINT = 35;-->

      <!--var canvas = document.getElementById('body-wrap');-->
      <!--canvas.width = WIDTH,-->
          <!--canvas.height = HEIGHT;-->
      <!--var context = canvas.getContext('2d');-->
      <!--context.strokeStyle = 'rgba(0,0,0,0.2)',-->
          <!--context.strokeWidth = 1,-->
          <!--context.fillStyle = 'rgba(0,0,0,0.1)';-->
      <!--var circleArr = [];-->

      <!--//线条：开始xy坐标，结束xy坐标，线条透明度-->
      <!--function Line (x, y, _x, _y, o) {-->
          <!--this.beginX = x,-->
              <!--this.beginY = y,-->
              <!--this.closeX = _x,-->
              <!--this.closeY = _y,-->
              <!--this.o = o;-->
      <!--}-->
      <!--//点：圆心xy坐标，半径，每帧移动xy的距离-->
      <!--function Circle (x, y, r, moveX, moveY) {-->
          <!--this.x = x,-->
              <!--this.y = y,-->
              <!--this.r = r,-->
              <!--this.moveX = moveX,-->
              <!--this.moveY = moveY;-->
      <!--}-->
      <!--//生成max和min之间的随机数-->
      <!--function num (max, _min) {-->
          <!--var min = arguments[1] || 0;-->
          <!--return Math.floor(Math.random()*(max-min+1)+min);-->
      <!--}-->
      <!--// 绘制原点-->
      <!--function drawCricle (cxt, x, y, r, moveX, moveY) {-->
          <!--var circle = new Circle(x, y, r, moveX, moveY)-->
          <!--cxt.beginPath()-->
          <!--cxt.arc(circle.x, circle.y, circle.r, 0, 2*Math.PI)-->
          <!--cxt.closePath()-->
          <!--cxt.fill();-->
          <!--return circle;-->
      <!--}-->
      <!--//绘制线条-->
      <!--function drawLine (cxt, x, y, _x, _y, o) {-->
          <!--var line = new Line(x, y, _x, _y, o)-->
          <!--cxt.beginPath()-->
          <!--cxt.strokeStyle = 'rgba(0,0,0,'+ o +')'-->
          <!--cxt.moveTo(line.beginX, line.beginY)-->
          <!--cxt.lineTo(line.closeX, line.closeY)-->
          <!--cxt.closePath()-->
          <!--cxt.stroke();-->

      <!--}-->
      <!--//每帧绘制-->
      <!--function draw () {-->
          <!--context.clearRect(0,0,canvas.width, canvas.height);-->
          <!--for (var i = 0; i < POINT; i++) {-->
              <!--drawCricle(context, circleArr[i].x, circleArr[i].y, circleArr[i].r);-->
          <!--}-->
          <!--for (var i = 0; i < POINT; i++) {-->
              <!--for (var j = 0; j < POINT; j++) {-->
                  <!--if (i + j < POINT) {-->
                      <!--var A = Math.abs(circleArr[i+j].x - circleArr[i].x),-->
                          <!--B = Math.abs(circleArr[i+j].y - circleArr[i].y);-->
                      <!--var lineLength = Math.sqrt(A*A + B*B);-->
                      <!--var C = 1/lineLength*7-0.009;-->
                      <!--var lineOpacity = C > 0.03 ? 0.03 : C;-->
                      <!--if (lineOpacity > 0) {-->
                          <!--drawLine(context, circleArr[i].x, circleArr[i].y, circleArr[i+j].x, circleArr[i+j].y, lineOpacity);-->
                      <!--}-->
                  <!--}-->
              <!--}-->
          <!--}-->
      <!--}-->
      <!--//初始化生成原点-->
      <!--function init () {-->
          <!--circleArr = [];-->
          <!--for (var i = 0; i < POINT; i++) {-->
              <!--circleArr.push(drawCricle(context, num(WIDTH), num(HEIGHT), num(15, 2), num(10, -10)/40, num(10, -10)/40));-->
          <!--}-->
          <!--draw();-->
      <!--}-->
      <!--//调用执行-->
      <!--window.onload = function () {-->
          <!--init();-->
          <!--setInterval(function () {-->
              <!--for (var i = 0; i < POINT; i++) {-->
                  <!--var cir = circleArr[i];-->
                  <!--cir.x += cir.moveX;-->
                  <!--cir.y += cir.moveY;-->
                  <!--if (cir.x > WIDTH) cir.x = 0;-->
                  <!--else if (cir.x < 0) cir.x = WIDTH;-->
                  <!--if (cir.y > HEIGHT) cir.y = 0;-->
                  <!--else if (cir.y < 0) cir.y = HEIGHT;-->
              <!--}-->
              <!--draw();-->
          <!--}, 10);-->
      <!--}-->
  <!--</script>-->
  <!--<script>-->
      <!--var gitment = new Gitment({-->
          <!--id: '', // 可选。默认为 location.href-->
          <!--owner: 'vera0707',-->
          <!--repo: 'https://github.com/vera0707/vera0707.github.io',-->
          <!--labels: "gitment-introduction",-->
          <!--oauth: {-->
              <!--client_id: '412dc716eeeb8fa2983f',-->
              <!--client_secret: 'e350354961bdca67937a21eed747e23ba1e6f86e'-->
          <!--}-->
      <!--})-->
      <!--gitment.render('remark')-->
  <!--</script>-->
</body>
</html>